<!DOCTYPE html>
<html>
<head>
<title>Wed Jul 21, 2021 : #operations (chtc)</title>
</head>
<body>
<h3>Wed Jul 21, 2021 : #operations (chtc)</h3>
<span style="color: #235e5b"><span style="font-size: small">(09:31:05)</span> <b>johnkn:</b></span> I'm getting a connection timeout when I try and query <a href="http://batlab-cm.chtc.wisc.edu">batlab-cm.chtc.wisc.edu</a> from my CS desktop, but I don't see the connection attempt in the collector log there.  is there a firewall in the way?<br/>
<span style="color: #3c989f"><span style="font-size: small">(09:42:07)</span> <b>wiscmoate:</b></span> @johnkn unlikely, it's configured to allow UW system IP ranges:<br/><pre>[moate@batlab-cm ~]$ sudo iptables -L htcondor_dst_ing -v -n<br/>Chain htcondor_dst_ing (2 references)<br/> pkts bytes target     prot opt in     out     source               destination<br/> 298K   18M u_wi_sys_src_acc  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* 41240020_u_wi_sys_src_acc_entry */<br/> 5374  220K DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* 41240099_all_drp */</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(09:42:18)</span> <b>wiscmoate:</b></span> That being said, mistakes could have been made somewhere in the tree<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:42:24)</span> <b>johnkn:</b></span> Ok. sort of figured out the first issue.  I was using the wrong port to query, but its still failing, now because of security negotiation<br/>
<span style="color: #d58247"><span style="font-size: small">(09:45:51)</span> <b>gthain:</b></span> <pre>$ hostname<br/><a href="http://moria.cs.wisc.edu">moria.cs.wisc.edu</a><br/>-bash-4.2$ CONDOR_CONFIG=/dev/null condor_status -pool <a href="http://batlab-cm.chtc.wisc.edu">batlab-cm.chtc.wisc.edu</a> -tot<br/><br/>                     Total Owner Claimed Unclaimed Matched Preempting Backfill  Drain<br/><br/>        X86_64/LINUX     2     0       0         2       0          0        0      0<br/>          X86_64/OSX     8     0       0         8       0          0        0      0<br/>      X86_64/WINDOWS     9     0       0         9       0          0        0      0<br/><br/>               Total    19     0       0        19       0          0        0      0</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(09:49:49)</span> <b>wiscmoate:</b></span> It looks like <tt>SEC_READ_AUTHENTICATION</tt> is unset, so it should be <tt>OPTIONAL</tt>, I'd expect it to work for you TJ depending on your client's configuration and whether or not the IP address is white-listed<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:50:56)</span> <b>johnkn:</b></span> Looks like security negotiation is deciding that authentication is required (it's optional on my end), and the the only common auth method is SSL, which is not going to work because I have never set up a cert.<br/>
<span style="color: #3c989f"><span style="font-size: small">(09:52:07)</span> <b>wiscmoate:</b></span> I don't think gthain's example would have worked if authentication was <tt>REQUIRED</tt><br/>
<span style="color: #99a949"><span style="font-size: small">(09:53:13)</span> <b>matyas:</b></span> what's SEC_READ_INTEGRITY / SEC_DEFAULT_INTEGRITY?<br/>
<span style="color: #3c989f"><span style="font-size: small">(09:54:07)</span> <b>wiscmoate:</b></span> <pre>[moate@submit3 ~]$ env _CONDOR_TOOL.SEC_CLIENT_AUTHENTICATION=NEVER condor_status -pool <a href="http://batlab-cm.chtc.wisc.edu">batlab-cm.chtc.wisc.edu</a><br/>Name                                 OpSys      Arch   State     Activity LoadAv Mem     ActvtyTime<br/><br/><a href="mailto:slot1@batlab-centos7-0.chtc.wisc.edu">slot1@batlab-centos7-0.chtc.wisc.edu</a> LINUX      X86_64 Unclaimed Idle      0.000  28929  5+19:19:49<br/>slot1@batlab-mac-0.local             OSX        X86_64 Unclaimed Idle      0.000  24576  0+01:29:40<br/>slot2@batlab-mac-0.local             OSX        X86_64 Unclaimed Idle      0.000  24576  0+14:05:18<br/>...</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(09:54:23)</span> <b>wiscmoate:</b></span> @matyas also unset<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:55:42)</span> <b>johnkn:</b></span> SEC_DEFAULT_INTEGRITY = required<br/>SEC_READ_INTEGRITY = OPTIONAL<br/>
<span style="color: #99a949"><span style="font-size: small">(09:55:54)</span> <b>matyas:</b></span> ah ok<br/>
<span style="color: #3c989f"><span style="font-size: small">(09:56:06)</span> <b>wiscmoate:</b></span> <pre>[moate@batlab-cm ~]$ condor_config_val -collector -dump SEC_DEFAULT SEC_READ<br/># Configuration from collector on &lt;128.104.100.52:9618?alias=batlab-cm.chtc.wisc.edu&gt; &lt;128.104.100.52:9618?alias=batlab-cm.chtc.wisc.edu&gt;<br/><br/># Parameters with names that match SEC_DEFAULT:<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = PASSWORD FS SSL<br/>SEC_DEFAULT_AUTHENTICATION_TIMEOUT = 20<br/>SEC_DEFAULT_CRYPTO_METHODS = AES BLOWFISH 3DES<br/># Contributing configuration file(s):<br/>#       /etc/condor/condor_config.security<br/>#       &lt;Default&gt;<br/><br/># Parameters with names that match SEC_READ:<br/>SEC_READ_AUTHENTICATION_METHODS = FS PASSWORD SSL<br/># Contributing configuration file(s):<br/>#       /etc/condor/hosts/batlab-cm.chtc.wisc.edu.local</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(09:56:26)</span> <b>wiscmoate:</b></span> Ah, you meant for the client<br/>
<span style="color: #99a949"><span style="font-size: small">(09:57:56)</span> <b>matyas:</b></span> If either <tt>SEC_*_INTEGRITY</tt> or <tt>SEC_*_ENCRYPTION</tt> are REQUIRED, they also force authentication<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:59:38)</span> <b>johnkn:</b></span> that was it, I had to set AUTHENTICATION, INTEGRITY and ENCRYPTION to optional, then it worked<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:01:00)</span> <b>wiscmoate:</b></span> FYI, I'm working from home today (@tjslauson)<br/>
<span style="color: #99a949"><span style="font-size: small">(10:01:51)</span> <b>matyas:</b></span> see <a href="https://opensciencegrid.atlassian.net/browse/HTCONDOR-422">https://opensciencegrid.atlassian.net/browse/HTCONDOR-422</a> and <a href="https://opensciencegrid.atlassian.net/browse/HTCONDOR-482">https://opensciencegrid.atlassian.net/browse/HTCONDOR-482</a><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:08:05)</span> <b>johnkn:</b></span> The problem with the SEC_CLIENT knobs is that they have two "clients" with different needs.  tools need those knobs set to OPTIONAL, but daemons when acting as client need those knobs set to REQUIRED.   The knobs are currently set to what the daemons need, which breaks tools....<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:08:45)</span> <b>wiscmoate:</b></span> prepend with <tt>&lt;SUBSYSTEM&gt;.</tt> where able<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:09:10)</span> <b>johnkn:</b></span> a nasty hack, but the only option we've currently given you.<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:09:10)</span> <b>wiscmoate:</b></span> It's not great, I know<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:10:13)</span> <b>wiscmoate:</b></span> When I want to be really sure I do <tt>env _CONDOR_TOOL.SEC_CLIENT_*</tt><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:10:54)</span> <b>johnkn:</b></span> I (was) using the out-of-box recommended_v9.0 metaknob<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:12:05)</span> <b>wiscmoate:</b></span> Here's our schedd <tt>CLIENT</tt> access level configuration:<br/><pre>## CLIENT access level<br/><br/># DAGMAN is going to need to authentiate without privileged<br/># access to password or certificate files<br/>DAGMAN.SEC_CLIENT_AUTHENTICATION_METHODS = FS<br/><br/># Loose authentication is unfortunately necessary when talking<br/># to certain central managers, such as<br/># <a href="http://wid-cm.discovery.wisc.edu">wid-cm.discovery.wisc.edu</a>.  It will perform security<br/># NEGOTIATION, but if it does AUTHENTICATION then it only<br/># supports the GSI authentication method (which isn't really<br/># configured). So AUTHENTICATION will always fail with these<br/># hosts, and therefore AUTHENTICATION must be avoided with these<br/># hosts.<br/># Hopefully the server-side AUTHENTICATION will be demanding<br/># enough in most cases where the schedd is a client so that<br/># AUTHENTICATION is forced and a valid AUTHENTICATION and<br/># ENCRYPTION method are used.<br/>SCHEDD.SEC_CLIENT_AUTHENTICATION         = OPTIONAL<br/>SCHEDD.SEC_CLIENT_ENCRYPTION             = OPTIONAL<br/>SCHEDD.SEC_CLIENT_INTEGRITY              = OPTIONAL<br/>SCHEDD.SEC_CLIENT_AUTHENTICATION_METHODS = CLAIMTOBE PASSWORD SSL GSI IDTOKENS<br/><br/># Loose authentication is unfortunately necessary when talking<br/># to third-party CCB central managers (such as<br/># <a href="http://vultur.ssec.wisc.edu">vultur.ssec.wisc.edu</a>) and startds.<br/>#<br/># Hopefully the server-side AUTHENTICATION will be demanding<br/># enough in most cases where the shadow is a client so that<br/># AUTHENTICATION is forced and a valid AUTHENTICATION and<br/># ENCRYPTION method are used.<br/>SHADOW.SEC_CLIENT_AUTHENTICATION         = OPTIONAL<br/>SHADOW.SEC_CLIENT_ENCRYPTION             = OPTIONAL<br/>SHADOW.SEC_CLIENT_INTEGRITY              = OPTIONAL<br/>SHADOW.SEC_CLIENT_AUTHENTICATION_METHODS = CLAIMTOBE PASSWORD SSL GSI IDTOKENS<br/><br/># use only FS authentication for condor_submit<br/>SUBMIT.SEC_CLIENT_AUTHENTICATION_METHODS = FS</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:15:17)</span> <b>johnkn:</b></span> Ironically, I was trying to query the batlab collector to fetch accounting ads,  turns out it currently has none... :disappointed:<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:16:44)</span> <b>johnkn:</b></span> The main cm has some though...<br/><pre>D:\scratch\condor\master\test&gt;condor_userprio -pool <a href="http://cm.chtc.wisc.edu:9618">cm.chtc.wisc.edu:9618</a> -collector fascott mfrayer<br/>Last Priority Update:  7/21 10:15<br/>                       Effective   Priority  Wghted Total Usage  Time Since Submitter<br/>User Name               Priority    Factor   In Use (wghted-hrs) Last Usage  Ceiling<br/>--------------------- ------------ --------- ------ ------------ ---------- ---------<br/><a href="mailto:fascott@chtc.wisc.edu">fascott@chtc.wisc.edu</a>    379371.31   1000.00    174    567715.81      &lt;now&gt;<br/><a href="mailto:mfrayer@chtc.wisc.edu">mfrayer@chtc.wisc.edu</a>  19959672.00  10000.00   2739  12049411.00      &lt;now&gt;<br/>--------------------- ------------ --------- ------ ------------ ---------- ---------<br/>Number of users: 2                             2913  12617127.00    0+23:59</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(13:44:40)</span> <b>johnkn:</b></span> I would expect power and heat to be different ways of measuring the same thing....<br/>
<span style="color: #3c989f"><span style="font-size: small">(14:53:32)</span> <b>wiscmoate:</b></span> Power is input so you have to compare to how much power you bring in, and how many of the appropriate outlets are available; heat is waste, so you have to compare against how much of it you can get rid of per unit of time.  Sure you could probably predict a not-terrible approximation of heat generated based on power spent, but that's not the hard part.<br/>
<span style="color: #3c989f"><span style="font-size: small">(18:04:02)</span> <b>wiscmoate:</b></span> @johnkn what was the limitation on 128-core nodes?  Something like the startd could only handle so many slots or cores?<br/>
<span style="color: #9b3b45"><span style="font-size: small">(19:42:59)</span> <b>jfrey:</b></span> The startd starts to have issues when there are 100+ slots.<br/>
</body>
</html>
