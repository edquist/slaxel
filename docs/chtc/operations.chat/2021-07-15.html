<!DOCTYPE html>
<html>
<head>
<title>Thu Jul 15, 2021 : #operations (chtc)</title>
</head>
<body>
<h3>Thu Jul 15, 2021 : #operations (chtc)</h3>
<span style="color: #3c989f"><span style="font-size: small">(09:58:16)</span> <b>wiscmoate:</b></span> I'm going to be home at least part of the day today, if not all<br/>
<blockquote>
<span style="color: #9f69e7"><span style="font-size: small">(10:09:18)</span> <b>lmichael:</b></span> out sick? or just working from home?<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:15:58)</span> <b>wiscmoate:</b></span> The latter<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:31:27)</span> <b>wiscmoate:</b></span> @lmichael I was supposed to get you the HPC refresh quotes, wasn't I?<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:18:14)</span> <b>wiscmoate:</b></span> @lmichael this is the general "Purchases" google drive folder -&gt; <a href="https://drive.google.com/drive/folders/1for1Uki22ICgWh9GVcAhMkEZwW2U3Mkb?usp=sharing">https://drive.google.com/drive/folders/1for1Uki22ICgWh9GVcAhMkEZwW2U3Mkb?usp=sharing</a><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:19:37)</span> <b>wiscmoate:</b></span> This is the HPC tech refresh purchase folder -&gt; <a href="https://drive.google.com/drive/folders/1e1U9UyfFPD-c4q_zNZD0-5dl-8LHfmSk">https://drive.google.com/drive/folders/1e1U9UyfFPD-c4q_zNZD0-5dl-8LHfmSk</a><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:20:55)</span> <b>wiscmoate:</b></span> I believe this is the one-chassis quote you're interested in (<tt>#3000089712720.1</tt>)-&gt; <a href="https://drive.google.com/file/d/10220egKLdeg_1fHvut96hJiOkftEWFHQ/view?usp=sharing">https://drive.google.com/file/d/10220egKLdeg_1fHvut96hJiOkftEWFHQ/view?usp=sharing</a><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:22:33)</span> <b>wiscmoate:</b></span> Indeed, from my email to CSL:<br/><pre> Lab,<br/><br/>    Please make a purchase based on the attached quote from Dell,<br/> #3000089712741.1 for a total cost of $162,549.88.</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:24:04)</span> <b>wiscmoate:</b></span> According to the <a href="https://docs.google.com/spreadsheets/d/1zbmNLm5ylog0UFdLJbOyxVK60sirdLc0L5S4DB6VJHc/edit?usp=sharing">comparison spreadsheet</a> <tt>#3000089712720.1</tt> and <tt>#3000089712741.1</tt> are the same quote with quantity 1 and quantity 4 respectively<br/>
<span style="color: #9f69e7"><span style="font-size: small">(14:35:54)</span> <b>lmichael:</b></span> Yup! Thanks.<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-07-16 12:56:34)</span> <b>lmichael:</b></span> Can you go ahead and ask Dell about a quote for quantity 4 cables?<br/>
</blockquote>
<span style="color: #3c989f"><span style="font-size: small">(11:19:12)</span> <b>wiscmoate:</b></span> @tjslauson FYI our SLURM column has been 0 on the daily usage reports for the last couple of days;  due to the work you're doing on HPC maybe?<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:19:49)</span> <b>wiscmoate:</b></span> If there's not an obvious reason I'll try to spend some time looking at it<br/>
<span style="color: #e7392d"><span style="font-size: small">(11:20:58)</span> <b>ckoch5:</b></span> @wiscmoate that’s the EL6 cluster<br/>
<span style="color: #e7392d"><span style="font-size: small">(11:21:04)</span> <b>ckoch5:</b></span> so it shouldn’t be reporting any data. :slightly_smiling_face:<br/>
<span style="color: #e7392d"><span style="font-size: small">(11:21:11)</span> <b>ckoch5:</b></span> new cluster is <tt>CHTC-HPC</tt><br/>
<span style="color: #3c989f"><span style="font-size: small">(11:21:29)</span> <b>wiscmoate:</b></span> Ah, right<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:21:31)</span> <b>wiscmoate:</b></span> Thank you!<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:22:39)</span> <b>wiscmoate:</b></span> I was just noticing total hours were low-ish, and my immediate hypothesis was <tt>SLURM</tt> being zero<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:23:16)</span> <b>wiscmoate:</b></span> Looks like I don't need a "jump-to-conclusions mat", I'm already pretty good at it<br/>
<span style="color: #2b6836"><span style="font-size: small">(12:43:58)</span> <b>jcpatton:</b></span> <pre>I have had a few hundred jobs held today on the same machine (<a href="http://e024.chtc.wisc.edu">e024.chtc.wisc.edu</a>) with the error below. I have released these jobs, but wanted to let you know in case there was an issue.<br/><br/>7/15 11:21 Error from <a href="mailto:slot1_13@e024.chtc.wisc.edu">slot1_13@e024.chtc.wisc.edu</a>: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:46:29)</span> <b>wiscmoate:</b></span> Strange;  @gthain shouldn't HTCondor stop accepting docker jobs if the daemon is borked?  (I haven't actually looked at this yet)<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(12:46:34)</span> <b>tjslauson:</b></span> host isn't healthy, I'm taking a couple-minute physical look<br/>
<span style="color: #e7392d"><span style="font-size: small">(12:46:46)</span> <b>ckoch5:</b></span> I feel like that host has caused problems before…<br/>
<blockquote>
<span style="color: #4bbe2e"><span style="font-size: small">(13:10:05)</span> <b>tjslauson:</b></span> looks like there's been at least 12 problems with it over the last 8 years :sweat_smile:  and many of them disk issues<br/>
</blockquote>
<span style="color: #d58247"><span style="font-size: small">(12:46:57)</span> <b>gthain:</b></span> It should, but it might take a couple of failures to notice<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(12:57:33)</span> <b>tjslauson:</b></span> looks like a disk failure behind sda.  Surprisingly it didn't fail hard enough to cause the kernel, SSH, or condor to be caught failing by our monitoring, but the host couldn't do much of anything useful.<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(12:57:44)</span> <b>tjslauson:</b></span> I've shut e024 down pending a later rebuild.<br/>
<span style="color: #3c989f"><span style="font-size: small">(13:00:14)</span> <b>wiscmoate:</b></span> Thanks Tim<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(13:02:12)</span> <b>tjslauson:</b></span> thanks Jason and Megan!<br/>
<span style="color: #3c989f"><span style="font-size: small">(13:02:29)</span> <b>wiscmoate:</b></span> That too<br/>
<span style="color: #4cc091"><span style="font-size: small">(15:55:37)</span> <b>blin:</b></span> i'm on a call with georgia tech and they're wondering about best practices wrt log retention @wiscmoate @tjslauson it looks like you guys don't mess around with the number of logs we keep around but futz with the sizes<br/>
<span style="color: #4cc091"><span style="font-size: small">(15:55:39)</span> <b>blin:</b></span> any particular reason why?<br/>
<span style="color: #3c989f"><span style="font-size: small">(15:57:04)</span> <b>wiscmoate:</b></span> @blin HTCondor log retention?<br/>
<span style="color: #4cc091"><span style="font-size: small">(15:59:23)</span> <b>blin:</b></span> ya<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:01:25)</span> <b>wiscmoate:</b></span> So, our logging "strategy" (which is *not* a strategy because that would imply planning) is mostly based on trial and error.  We make an adjustment, it breaks, we adjust again.<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:02:22)</span> <b>wiscmoate:</b></span> I'm not sure if you're aware, but we actually use logrotate -<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:02:54)</span> <b>wiscmoate:</b></span> For example, here's logrotate configuration for a schedd (<a href="http://submit-1.chtc.wisc.edu">submit-1.chtc.wisc.edu</a>):<br/><pre>[moate@submit-1 ~]$ cat /etc/logrotate.d/hourly/htcondor_schedd_logs<br/># THIS FILE IS AUTOMATICALLY DISTRIBUTED BY PUPPET.  ANY CHANGES WILL BE<br/># OVERWRITTEN.<br/><br/>/var/log/condor/EventLog.1 /var/log/condor/MaterializeLog.old /var/log/condor/ShadowLog.old /var/log/condor/SchedLog.old {<br/>  compress<br/>  compresscmd /usr/bin/bzip2<br/>  compressext .bz2<br/>  dateext<br/>  dateformat .%Y_%m_%d_%H<br/>  hourly<br/>  missingok<br/>  nocopytruncate<br/>  nocreate<br/>  nodelaycompress<br/>  olddir old<br/>  rotate 64<br/>  size 1<br/>  su condor condor<br/>}</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(16:03:53)</span> <b>wiscmoate:</b></span> We had problems in the past with logrotate yanking out files that an HTCondor daemon had open, so now we have HTCondor rotate out a log file, and logrotate acts on that file<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:04:23)</span> <b>wiscmoate:</b></span> The <tt>rotate 64</tt> setting above means "retain 64 log files"<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:04:44)</span> <b>wiscmoate:</b></span> <tt>size 1</tt> means "don't worry about size, just rotate the file"<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:05:11)</span> <b>wiscmoate:</b></span> That's because the log file won't exist until HTCondor does its own rotation, which as you pointed out is size-based<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:05:35)</span> <b>wiscmoate:</b></span> So if there's a file at all, rotate it<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:09:20)</span> <b>wiscmoate:</b></span> <pre>[moate@submit-1 ~]$ condor_config_val -schedd -v MAX_SCHEDD_LOG<br/>MAX_SCHEDD_LOG = 4 Gb<br/> # at: /etc/condor/include/schedd.conf, line 4<br/> # raw: MAX_SCHEDD_LOG = 4 Gb<br/> # default: $(MAX_DEFAULT_LOG)</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(16:10:47)</span> <b>wiscmoate:</b></span> So right now when the SCHEDD log reaches 4Gb, HTCondor rotates it out to <tt>/var/log/condor/SchedLog.old</tt>;  Every hour logrotate compresses that file into <tt>/var/log/condor/old</tt> and deletes the original<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:11:29)</span> <b>wiscmoate:</b></span> What we don't want to happen is for HTCondor to rotate more than once per hour, because then logrotate would miss a log file and data would go missing<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:12:04)</span> <b>wiscmoate:</b></span> Whenever we see the log partition fill up, we make adjustments, usually by reducing the <tt>rotate NN</tt> logrotate setting<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:12:47)</span> <b>wiscmoate:</b></span> If we think logs are going missing then we increase <tt>MAX_SCHEDD_LOG</tt> to give logrotate ample time to do its thing<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:13:29)</span> <b>wiscmoate:</b></span> I think @tannenba told us he wants a month of log retention, some two years back or so<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:14:28)</span> <b>wiscmoate:</b></span> Clear as mud?<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:20:30)</span> <b>wiscmoate:</b></span> <pre>[moate@submit-1 condor]$ ls -alh /var/log/condor/old/SchedLog.old.2021_0* | sed -n -r '1p;$p'<br/>-rw-r--r-- 1 condor condor 115M Mar  2 07:35 /var/log/condor/old/SchedLog.old.2021_03_02_08.bz2<br/>-rw-r--r-- 1 condor condor  74M Jul 14 21:03 /var/log/condor/old/SchedLog.old.2021_07_14_22.bz2</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(16:21:02)</span> <b>wiscmoate:</b></span> Looks like we're currently retaining about ~3.5~ 4.5 months-ish for schedds<br/>
<span style="color: #4cc091"><span style="font-size: small">(16:39:02)</span> <b>blin:</b></span> ah i see, thanks @wiscmoate. that's frightening but it makes sense :slightly_smiling_face:<br/>
<span style="color: #4cc091"><span style="font-size: small">(16:39:09)</span> <b>blin:</b></span> not sure i want to recommend that to a green site<br/>
<span style="color: #3c989f"><span style="font-size: small">(16:50:09)</span> <b>wiscmoate:</b></span> It's not pretty, but it's a pretty decent balance between "simplicity" (as opposed to doing something fancy like ElasticSearch) and maintaining a set number of compressed logs with dates in the file name.<br/>
</body>
</html>
