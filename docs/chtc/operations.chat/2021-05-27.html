<!DOCTYPE html>
<html>
<head>
<title>Thu May 27, 2021 : #operations (chtc)</title>
</head>
<body>
<h3>Thu May 27, 2021 : #operations (chtc)</h3>
<span style="color: #684b6c"><span style="font-size: small">(08:09:04)</span> <b>bbockelman:</b></span> @jcpatton - <a href="https://accounting.chtc.wisc.edu/app/kibana#/management/kibana/index_patterns/9b64d720-5c23-11eb-8041-c97f0900e377?_g=()&amp;_a=(tab:indexedFields)">https://accounting.chtc.wisc.edu/app/kibana#/management/kibana/index_patterns/9b64d720-5c23-11eb-8041-c97f0900e377?_g=()&amp;_a=(tab:indexedFields)</a><br/>
<span style="color: #684b6c"><span style="font-size: small">(08:09:27)</span> <b>bbockelman:</b></span> I clicked on the "star" button to make <tt>chtc-2021-*</tt> the default<br/>
<span style="color: #2b6836"><span style="font-size: small">(08:09:43)</span> <b>jcpatton:</b></span> thanks!<br/>
<span style="color: #2b6836"><span style="font-size: small">(08:10:45)</span> <b>jcpatton:</b></span> ah, I never even noticed that button, or rather didn’t expect it to do that<br/>
<span style="color: #e7392d"><span style="font-size: small">(08:40:58)</span> <b>ckoch5:</b></span> @bbockelman thank you!!<br/>
<span style="color: #e7392d"><span style="font-size: small">(08:43:51)</span> <b>ckoch5:</b></span> question for @jcpatton - I’m having Ayushi recreate some of the histograms of GPU jobs.<br/>
<span style="color: #e7392d"><span style="font-size: small">(08:44:03)</span> <b>ckoch5:</b></span> x-axis should be completiondate or similar<br/>
<span style="color: #e7392d"><span style="font-size: small">(08:44:30)</span> <b>ckoch5:</b></span> but if she chooses the “date histogram” aggregation option, there’s only six fields that can be used and they’re all obscure job attributes<br/>
<span style="color: #2b6836"><span style="font-size: small">(08:46:32)</span> <b>jcpatton:</b></span> I would have to play around with it, I don't really know much about all the graphing options in kibana<br/>
<span style="color: #e7392d"><span style="font-size: small">(08:50:53)</span> <b>ckoch5:</b></span> ^^ @bbockelman do you know much about the date histogram visualization option<br/>
<span style="color: #e7392d"><span style="font-size: small">(09:04:07)</span> <b>ckoch5:</b></span> @jcpatton I wonder if our issues have something to do with this “conflict” message:<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:04:21)</span> <b>jcpatton:</b></span> yep, I just took a look and that’s what’s happening<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:04:24)</span> <b>jcpatton:</b></span> I’m trying to resolve it right now<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:04:59)</span> <b>jcpatton:</b></span> I *think* it’s fixed now<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:05:40)</span> <b>jcpatton:</b></span> I see <tt>CompletionDate</tt> in the list of Fields available for Date Histograms now<br/>
<span style="color: #e7392d"><span style="font-size: small">(09:15:43)</span> <b>ckoch5:</b></span> YESSS! we are in business.<br/>
<span style="color: #e7392d"><span style="font-size: small">(09:15:47)</span> <b>ckoch5:</b></span> Thanks @jcpatton. :grin:<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:45:25)</span> <b>jfrey:</b></span> ssh’ing to chtc machines from the compsci vpn shouldn’t require duo, correct?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:50:30)</span> <b>tim:</b></span> Only when the using public key (RSA). We have to ask Moate to not request Duo when using a password.<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:56:35)</span> <b>jfrey:</b></span> Ok.<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:05:12)</span> <b>wiscmoate:</b></span> We can populate <tt>.ssh/authorized_keys</tt> if you need a public key distributed<br/>
<span style="color: #3c989f"><span style="font-size: small">(10:05:46)</span> <b>wiscmoate:</b></span> Otherwise send an email to <tt><a href="mailto:htcondor-inf@cs.wisc.edu">htcondor-inf@cs.wisc.edu</a></tt> and we'll discuss<br/>
<span style="color: #9b3b45"><span style="font-size: small">(10:24:22)</span> <b>jfrey:</b></span> Ok. I was just mistaken about the current state of Duo settings in CHTC.<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:07:10)</span> <b>tim:</b></span> @wiscmoate one use case is that flightworthy developers would like to login to the various CHTC nodes to diagnose problems and not have to deal with DUO. So, would you distribute public keys for the staff that request it?<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:20:59)</span> <b>wiscmoate:</b></span> ~Sure~<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:21:27)</span> <b>wiscmoate:</b></span> I spoke too soon -<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:23:26)</span> <b>wiscmoate:</b></span> It should be OK so long as it *is* coming from CS VPN (which already authenticated with DUO)<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:23:43)</span> <b>wiscmoate:</b></span> I think you were suggesting that already though<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:25:49)</span> <b>tim:</b></span> Yes, FW developers would like to login to CHTC nodes from the CS VPN without Duo. Either allowing now DUO when coming from CS VPN (password or not), or need the public key and provide some way to get it distributed over the pool.<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:27:09)</span> <b>tim:</b></span> FYI IPv6 networking from the CS VPN does not seem to be working today. (It worked yesterday.)<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:27:10)</span> <b>wiscmoate:</b></span> To be clear, CS VPN + publickey auth to skip DUO<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:27:33)</span> <b>wiscmoate:</b></span> Maybe they changed the CS VPN range -<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:28:04)</span> <b>wiscmoate:</b></span> Which node are you SSHing into?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:29:54)</span> <b>tim:</b></span> It tried batlab and submit2. However, I am coming from my parents house. So, it might be a Spectrum thing. I will try again when I get home from the TDS network.<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:37:47)</span> <b>wiscmoate:</b></span> I would hope the VPN would behave the same no matter what ISP it's coming from....<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:39:19)</span> <b>wiscmoate:</b></span> @tjslauson please <tt>ssh -p 55556 <a href="http://submit2.chtc.wisc.edu">submit2.chtc.wisc.edu</a></tt>;  it will fail, that's expected.  I have a tcpdump listening to capture your IP address.<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(11:40:51)</span> <b>tjslauson:</b></span> it's executing, waiting for the timeout<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:41:12)</span> <b>wiscmoate:</b></span> Er, I hit the wrong Tim :wink: Sorry<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:41:18)</span> <b>wiscmoate:</b></span> I meant @tim<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(11:41:19)</span> <b>tjslauson:</b></span> heh :stuck_out_tongue:<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:41:28)</span> <b>wiscmoate:</b></span> The Timumverate strikes again<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:42:11)</span> <b>tim:</b></span> @wiscmoate it's running<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:42:25)</span> <b>wiscmoate:</b></span> I see it, thanks<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:44:25)</span> <b>wiscmoate:</b></span> Weird, it fits within the CSL VPN range<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:47:00)</span> <b>wiscmoate:</b></span> @tim it's prompting you for DUO?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:48:58)</span> <b>tim:</b></span> No Duo for ssh to submit2, using public key.<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:49:09)</span> <b>tim:</b></span> I used duo to get into the VPN<br/>
<span style="color: #bb86b7"><span style="font-size: small">(11:50:26)</span> <b>tim:</b></span> Name an exec node with IPv6. I'll try a login with password.<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:52:28)</span> <b>wiscmoate:</b></span> Password shouldn't be avoiding DUO<br/>
<span style="color: #3c989f"><span style="font-size: small">(11:52:34)</span> <b>wiscmoate:</b></span> Just publickey<br/>
<span style="color: #d58247"><span style="font-size: small">(11:53:50)</span> <b>gthain:</b></span> A minor annoyance is that CSL now requires 2FA even on console logins<br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:06:38)</span> <b>tim:</b></span> So, I am confused. I attempted a public key login from the CSL VPN to submit2 via IPv6 and it hangs. I can use IPv4 and it works. We did a little experiment, and you saw my IPv6 packets and you thought I would be prompted for DUO and I was not. So, where does that leave us?<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:09:03)</span> <b>wiscmoate:</b></span> &gt;  I attempted a public key login from the CSL VPN to submit2 via IPv6 and it hangs<br/>OK, I was confused about this - I was under the impression that it was asking for DUO rather than hanging<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:12:55)</span> <b>wiscmoate:</b></span> To be clear, you shouldn't have been prompted for anything during my experiment -<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:13:28)</span> <b>wiscmoate:</b></span> <tt>-p 55556</tt> was to gather your IPv4 and IPv6 addresses, it would have hung and that's expected<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:14:03)</span> <b>wiscmoate:</b></span> But you are saying that when you connect via CSL VPN IPv6 to <a href="http://submit2.chtc.wisc.edu">submit2.chtc.wisc.edu</a> port <tt>22</tt>, that's hanging, correct?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:14:46)</span> <b>tim:</b></span> Yes<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:16:16)</span> <b>wiscmoate:</b></span> @tim please give it another shot, SSH from CSL VPN IPv6 to <a href="http://submit2.chtc.wisc.edu">submit2.chtc.wisc.edu</a> port <tt>22</tt><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:16:25)</span> <b>wiscmoate:</b></span> I'm watching on tcpdump<br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:16:50)</span> <b>tim:</b></span> It's going (or rather hanging)<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:17:36)</span> <b>wiscmoate:</b></span> I think there's a CSL VPN issue:<br/><pre>12:16:42.180181 IP6 2607:f388:1080:2::13e.47706 &gt; 2607:f388:107c:501:a236:9fff:fe3c:caa8.22: Flags [S], seq 1142975666, win 64320, options [mss 1340,sackOK,TS val 2981089421 ecr 0,nop,wscale 8], length 0<br/>12:16:42.180246 IP6 2607:f388:107c:501:a236:9fff:fe3c:caa8.22 &gt; 2607:f388:1080:2::13e.47706: Flags [S.], seq 266526527, ack 1142975667, win 28560, options [mss 1440,sackOK,TS val 1329612291 ecr 2981089421,nop,wscale 8], length 0<br/>12:16:43.180868 IP6 2607:f388:107c:501:a236:9fff:fe3c:caa8.22 &gt; 2607:f388:1080:2::13e.47706: Flags [S.], seq 266526527, ack 1142975667, win 28560, options [mss 1440,sackOK,TS val 1329613292 ecr 2981089421,nop,wscale 8], length 0<br/>12:16:43.206213 IP6 2607:f388:1080:2::13e.47706 &gt; 2607:f388:107c:501:a236:9fff:fe3c:caa8.22: Flags [S], seq 1142975666, win 64320, options [mss 1340,sackOK,TS val 2981090449 ecr 0,nop,wscale 8], length 0<br/>12:16:43.206241 IP6 2607:f388:107c:501:a236:9fff:fe3c:caa8.22 &gt; 2607:f388:1080:2::13e.47706: Flags [S.], seq 266526527, ack 1142975667, win 28560, options [mss 1440,sackOK,TS val 1329613317 ecr 2981089421,nop,wscale 8], length 0</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:18:13)</span> <b>wiscmoate:</b></span> There's an incoming <tt>SYN</tt> as expected, and a responding <tt>SYN,ACK</tt> as expected, but no <tt>ACK</tt><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:18:35)</span> <b>wiscmoate:</b></span> If our firewall was at fault, we wouldn't be seeing that <tt>SYN,ACK</tt><br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:19:22)</span> <b>tim:</b></span> Thank you, I'll file a ticket with the CSL.<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:19:24)</span> <b>wiscmoate:</b></span> I don't think your client is getting the <tt>SYN,ACK</tt>, either that our our server isn't getting your client's <tt>ACK</tt><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:20:41)</span> <b>wiscmoate:</b></span> You say this works from TDS?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:21:25)</span> <b>tim:</b></span> Don't know for sure. I just noticed that it was not working at my parents house. I'll have to give it a try when I get home this afternoon.<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:21:44)</span> <b>wiscmoate:</b></span> Here's a capture of your (or somebody else') IPv4 attempt:<br/><pre>12:18:53.254708 IP 10.130.244.27.48828 &gt; <a href="tel:128.104.101.92.22">128.104.101.92.22</a>: Flags [S], seq 2818785588, win 65280, options [mss 1360,sackOK,TS val 3164857516 ecr 0,nop,wscale 8], length 0<br/>12:18:53.254798 IP <a href="tel:128.104.101.92.22">128.104.101.92.22</a> &gt; 10.130.244.27.48828: Flags [S.], seq 1750234160, ack 2818785589, win 28960, options [mss 1460,sackOK,TS val 1329743365 ecr 3164857516,nop,wscale 8], length 0<br/>12:18:53.307589 IP 10.130.244.27.48828 &gt; <a href="tel:128.104.101.92.22">128.104.101.92.22</a>: Flags [.], ack 1, win 255, options [nop,nop,TS val 3164857566 ecr 1329743365], length 0</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(12:21:58)</span> <b>wiscmoate:</b></span> As you can see, there's a <tt>SYN</tt>, a <tt>SYN,ACK</tt> and an <tt>ACK</tt><br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:22:41)</span> <b>tim:</b></span> Yup, the IPv4 handshake looks good.<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:23:14)</span> <b>wiscmoate:</b></span> That's a nasty problem<br/>
<span style="color: #3c989f"><span style="font-size: small">(12:26:08)</span> <b>wiscmoate:</b></span> @lmichael I put <tt>/usr/local/bin</tt> in <tt>root</tt>'s path, should take effect at about 7:00 PM tonight<br/>
<span style="color: #bb86b7"><span style="font-size: small">(13:09:22)</span> <b>tim:</b></span> Did you change anything? IPv6 and IPv4 logins work to submit2.  So, there may be a Spectrum vs. TDS difference.<br/>
<span style="color: #bb86b7"><span style="font-size: small">(13:09:30)</span> <b>tim:</b></span> @wiscmoate<br/>
<span style="color: #bb86b7"><span style="font-size: small">(13:09:44)</span> <b>tim:</b></span> I am currently back home using TDS.<br/>
<span style="color: #3c989f"><span style="font-size: small">(13:12:11)</span> <b>wiscmoate:</b></span> @tim I changed nothing<br/>
<span style="color: #bb86b7"><span style="font-size: small">(13:13:29)</span> <b>tim:</b></span> Thank you for taking the time to look into it.<br/>
</body>
</html>
