<!DOCTYPE html>
<html>
<head>
<title>Fri Jun 4, 2021 : #operations (chtc)</title>
</head>
<body>
<h3>Fri Jun 4, 2021 : #operations (chtc)</h3>
<span style="color: #e7392d"><span style="font-size: small">(08:04:33)</span> <b>ckoch5:</b></span> draft email to users - needs suggestions/confirmation: <a href="https://docs.google.com/document/d/1Waxd-OydrAAX4s_3rz0Cc858iUsRjMZ9f6musyFVrYU/edit#">https://docs.google.com/document/d/1Waxd-OydrAAX4s_3rz0Cc858iUsRjMZ9f6musyFVrYU/edit#</a><br/>
<span style="color: #2b6836"><span style="font-size: small">(09:03:43)</span> <b>jcpatton:</b></span> looks good to me<br/>
<span style="color: #e7392d"><span style="font-size: small">(09:22:31)</span> <b>ckoch5:</b></span> @tjslauson said there may be new issues this morning<br/>
<span style="color: #e7392d"><span style="font-size: small">(09:22:41)</span> <b>ckoch5:</b></span> so I’m going to hold off for now<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(09:27:49)</span> <b>tjslauson:</b></span> chiming in on the above (we talked in-person), overnight the FS began reporting issues again.  I'd say it's probably in a similar state to what it was in over the weekend.  I might need to take the cluster down for maintenance - my question is whether our users are seeing enough problems right now to merit it happening today (into the weekend potentially) or if we can wait until early next week.<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(09:28:48)</span> <b>tjslauson:</b></span> @ckoch5 @lmichael would it help if I joined the huddle this morning?<br/>
<blockquote>
<span style="color: #9f69e7"><span style="font-size: small">(09:31:00)</span> <b>lmichael:</b></span> <a href="http://go.wisc.edu/lmzoom">go.wisc.edu/lmzoom</a> at 9:40, or come to my office for that time<br/>
</blockquote>
<span style="color: #9f69e7"><span style="font-size: small">(09:30:18)</span> <b>lmichael:</b></span> @wiscmoate @bbockelman it DOES look like the COBA server is already prioritized, but based upon username?<br/><pre>Start = ((SuspendedByAdmin =!= true &amp;&amp; ROOT_PART_GT_85_PERCENT =?= false &amp;&amp; EXECUTE_IS_READONLY =?= false) &amp;&amp; ((PartitionableSlot =!= true || State == "Matched" || (time() - EnteredCurrentState) &gt; 20 * 60) || ((PartitionableSlot =!= true || State == "Matched" || (time() - EnteredCurrentState) &gt; 0) &amp;&amp; TARGET.RequestCpus &gt;= ifThenElse(Cpus &lt; 4,1,4)) || (false))) &amp;&amp; (split(Target.AccountingGroup,".")[0] =?= "COBA" || Target.AcctGroupUser =?= "elbrandt" || Target.AcctGroupUser =?= "ckoch5" || Target.AcctGroupUser =?= "bbockelm" || Target.Owner =?= "agitter")</pre><br/>Do we still need by-user prioritization? @ckoch5 tells me that Brian did something to make sure <tt>elbrandt</tt>’s interactive jobs could start in short order.<br/>How do we move forward with our short-term plan to implement bologna batch (for the <tt>COBA</tt> and <tt>COBA_BroadSingh</tt> , given what we decided with @johnkn’s input yesterday? (see Ops meeting notes and email)<br/><a href="https://docs.google.com/document/d/19Z4In-WlZaKT7oaGejuG7EvAn5WGAvEc9uqTQ6YhjJg/edit?usp=sharing">https://docs.google.com/document/d/19Z4In-WlZaKT7oaGejuG7EvAn5WGAvEc9uqTQ6YhjJg/edit?usp=sharing</a><br/>
<blockquote>
<span style="color: #9f69e7"><span style="font-size: small">(10:57:53)</span> <b>lmichael:</b></span> @wiscmoate won’t get back to this until later today, but perhaps @bbockelman and @johnkn can hash out an appropriate strategy before then, still incorporating the need for quick interactive matches, which we didn’t discuss at the Ops meeting?<br/><br/>@bbockelman do you remember the in-English policy you implemented for user <tt>ebrandt</tt> (and others) that I pasted to start this thread? Would you expect it to still work if we go bologna batch with priority for specific accounting groups (not users, which I think will end up being a big pain in the long-run with Moate having to make frequent updates to add a single user)?<br/>
<span style="color: #9f69e7"><span style="font-size: small">(10:58:38)</span> <b>lmichael:</b></span> COBA collaborators (high priority) can’t effectively run their work until we figure this out, and one of them has a fast-approaching deadline.<br/>
<span style="color: #684b6c"><span style="font-size: small">(11:35:13)</span> <b>bbockelman:</b></span> Is there any reason why we can't simply add the additional users to the list above?<br/>
<span style="color: #9f69e7"><span style="font-size: small">(11:40:30)</span> <b>lmichael:</b></span> already with this group, it’s gone from 2 to 7 users in just a few weeks, and the COBA project intends to have numerous groups of collaborators added on over the next 1-2 years. It would be a LOT of manual addition and (typically) Christina and I waiting on Moate to get the tine to make the change. Using accounting groups make this scale a lot better, as the users just have to identify with one of a few groups.<br/>
<span style="color: #684b6c"><span style="font-size: small">(15:15:13)</span> <b>bbockelman:</b></span> Sure, except that accounting groups doesn't work with this, right?  That's why we set it up in the first place.<br/><br/>My advice is to simply make the change to add the new individuals for today and to start working on an improved solution next week.<br/>
<span style="color: #e7392d"><span style="font-size: small">(15:16:27)</span> <b>ckoch5:</b></span> @bbockelman the only reason accounting groups didn’t work (I think) was because they got clobbered w/ the fastmatch attribute if you tried to run a job on the targeted server interactively. if they aren’t running interactively, accounting_group should be fine.<br/>
<span style="color: #684b6c"><span style="font-size: small">(15:18:31)</span> <b>bbockelman:</b></span> Right - we need to untangle that and come up with a solution that works for both interactive and non-interactive jobs.<br/>
<span style="color: #e7392d"><span style="font-size: small">(15:20:43)</span> <b>ckoch5:</b></span> I think it’s worth asking Eric if he’s still running interactive jobs; if not, we could swap back to a more standard config. I’m happy to do that.<br/>
<span style="color: #9f69e7"><span style="font-size: small">(15:52:29)</span> <b>lmichael:</b></span> Wouldn’t it be okay for interactive jobs to run on this server without fast-match? (through the ‘regular’ negotiator?)<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-07 10:13:23)</span> <b>lmichael:</b></span> ping on my question above ^ @bbockelman<br/>Do interactive jobs ONLY work via fastmatch? We could otherwise tell the groups they can run interactive jobs, but they might just take a while on THIS server. (while we work on an improved solution)<br/><br/>If we can get this decided, then Moate can implement in decent time for user Michael to get started with Christina ASAP, as hoped for.<br/>
<span style="color: #684b6c"><span style="font-size: small">(2021-06-07 16:44:08)</span> <b>bbockelman:</b></span> &gt;  Do interactive jobs ONLY work via fastmatch? We could otherwise tell the groups they can run interactive jobs, but they might just take a while on THIS server. (while we work on an improved solution)<br/>Trying to recall the particulars of this case.  I think it's this: If you are filtering by the <tt>AccountingGroup</tt> in the <tt>START</tt> expression, then the fact the job transform will always change interactive jobs so the accounting group so it's no longer <tt>COBA</tt> will cause the interactive job to never start.<br/><br/>That said, all Moate needs to do is add Mike's NetID to the start expression.  Being that he's going on vacation for a week in ~20 minutes and we don't have any proposed configuration on how to setup preemption with GPUs (I would suggest that HTCSS develop an example we can copy/paste from on <tt><a href="http://dumbo.chtc.wisc.edu">dumbo.chtc.wisc.edu</a></tt>), I still think the start expression is the place to start.<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-07 17:11:16)</span> <b>lmichael:</b></span> @moate, please add all the NetID’s from the COBA_BroadCimini and COBA_BroadSingh groups, then?<br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-07 17:30:04)</span> <b>wiscmoate:</b></span> I'm working a half day tomorrow (my flight got pushed back)<br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-07 17:30:20)</span> <b>wiscmoate:</b></span> I'll work on it either tonight or tomorrow<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-07 17:55:15)</span> <b>johnkn:</b></span> Proposed configuration for doing bologna backfill slots with GPUs in them has been dormant in the CHTC configs for many months now.<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-08 09:04:50)</span> <b>lmichael:</b></span> Many thanks, @wiscmoate!<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-08 09:05:20)</span> <b>lmichael:</b></span> @johnkn what do you mean ‘dormant’. Like it’s configured, but not working? Or there’s a minor bit of config change to let GPU backfill jobs run? (@wiscmoate’s headed on vacation, so the bologna backfill will have to wait until he’s back. Right now, we’re focusing on the short-term fix for members of the COBA collaboration to use their server with priority, even without backfill).<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-08 09:27:20)</span> <b>johnkn:</b></span> The statements are there, but not enabled because a single knob is set to disable them.<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-08 09:28:07)</span> <b>johnkn:</b></span> When we first tried to do GPU backfill, we found a Condor bug, and turned off the config, but did *not* remove it from the config files<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-08 09:36:03)</span> <b>lmichael:</b></span> @johnkn Ah. So, what, specifically, will Moate need to change? @bbockelman suggested that we use a Tony Gitter server once @wiscmoate is back, but perhaps you can put the specifics into an email or RT ticket to htcondor-inf?<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-08 09:46:42)</span> <b>johnkn:</b></span> Memory is not what it used to be, but I'm sure Moate knows and has this in a ticket already.  It's not like this is the first time we've had this exact convesation.<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-08 10:05:21)</span> <b>johnkn:</b></span> looks like the relevant bits of config are in /etc/condor/include/gpulab_dual_layer.conf.<br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-08 10:40:15)</span> <b>wiscmoate:</b></span> &gt; @wiscmoate, please add all the NetID’s from the COBA_BroadCimini and COBA_BroadSingh groups, then?<br/>@lmichael based on that I'm going to add logic for the following netids to the <tt>START</tt> expression (if it doesn't already exist):<br/>• <tt>jje</tt><br/>• <tt>amlucas3</tt><br/>• <tt>ssingh273</tt><br/>• <tt>jcaicedo</tt><br/>• <tt>mbornholdt</tt><br/>• <tt>mhaghighi</tt><br/>
<span style="color: #684b6c"><span style="font-size: small">(2021-06-08 11:16:06)</span> <b>bbockelman:</b></span> Sounds good!  Maybe leave a note for TimS in the ticket in case we need to change again in the next week.<br/>
<span style="color: #684b6c"><span style="font-size: small">(2021-06-08 11:16:59)</span> <b>bbockelman:</b></span> Also do note the <tt>split(Target.AccountingGroup,".")[0] =?= "COBA"</tt> clause -- you'll want to do the same for the other new groups.<br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-08 11:22:54)</span> <b>wiscmoate:</b></span> Here is the <tt>START</tt> expression after my most recent commit:<br/><pre>((SuspendedByAdmin =!= true &amp;&amp; ROOT_PART_GT_85_PERCENT =?= false &amp;&amp; EXECUTE_IS_READONLY =?= false) &amp;&amp; ((PartitionableSlot =!= true || State == "Matched" || (time() - EnteredCurrentState) &gt; 20 * 60) || ((PartitionableSlot =!= true || State == "Matched" || (time() - EnteredCurrentState) &gt; 0) &amp;&amp; TARGET.RequestCpus &gt;= ifThenElse(Cpus &lt; 4,1,4)) || (false))) &amp;&amp; (split(TARGET.AccountingGroup,".")[0] =?= "COBA" || TARGET.AcctGroupUser =?= "elbrandt" || TARGET.AcctGroupUser =?= "ckoch5" || TARGET.AcctGroupUser =?= "bbockelm" || TARGET.AcctGroupUser =?= "agitter" || TARGET.AcctGroupUser =?= "ssingh273" || TARGET.AcctGroupUser =?= "jcaicedo" || TARGET.AcctGroupUser =?= "mbornholdt" || TARGET.AcctGroupUser =?= "mhaghighi" || TARGET.AcctGroupUser =?= "jje" || TARGET.AcctGroupUser =?= "amlucas3")</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-08 11:23:37)</span> <b>wiscmoate:</b></span> @bbockelman do I still need to use the <tt>split()</tt> since I'm using <tt>TARGET.AcctGroupUser</tt> rather than <tt>TARGET.AccountingGroup</tt>?<br/>
<span style="color: #684b6c"><span style="font-size: small">(2021-06-08 11:26:17)</span> <b>bbockelman:</b></span> Hm.  It's probably a bit redundant if we have all the users listed manually.  Scratch that idea, I'm fairly sure it's redundant.<br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-08 11:29:04)</span> <b>wiscmoate:</b></span> Here's the commit I used, for possible imminent future reference -&gt; <a href="https://git.chtc.wisc.edu/?p=chtc_htcondor_config.git;a=commit;h=3e4bdc9c7c243be7f5e461c542ed5c0dee1b0883">https://git.chtc.wisc.edu/?p=chtc_htcondor_config.git;a=commit;h=3e4bdc9c7c243be7f5e461c542ed5c0dee1b0883</a><br/>
<span style="color: #684b6c"><span style="font-size: small">(2021-06-08 12:32:44)</span> <b>bbockelman:</b></span> thanks!<br/>
<span style="color: #235e5b"><span style="font-size: small">(2021-06-08 13:34:38)</span> <b>johnkn:</b></span> If you are going to have a big list like that, it would be more efficient to make that a string list<br/><pre>SPECIAL_PEOPLE = COBA, elbrandt, ckoch5, bbockelm, agitter, ssingh273, jcaicedo, mbornholdt, mgaghighi, jje, amlucas3<br/>START = blahblah &amp;&amp; StringListMember(TARGET.AcctGroupUser, "$(SPECIAL_PEOPLE)")</pre><br/>
<span style="color: #3c989f"><span style="font-size: small">(2021-06-08 13:40:16)</span> <b>wiscmoate:</b></span> Makes sense<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-08 14:30:42)</span> <b>lmichael:</b></span> :raised_hands:<br/>
</blockquote>
<span style="color: #3c989f"><span style="font-size: small">(10:24:42)</span> <b>wiscmoate:</b></span> @lmichael I'm going to defer for now, I tore up the racks of the new PowerEdge C6525s yesterday and need to put them back together.  Might be able to follow this up this afternoon after a Sysadmin PVL meeting.<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(10:33:49)</span> <b>tjslauson:</b></span> @blin @matyas and anyone else in here who is using our HPC cluster - per this week's filesystem issues, we've decided to bring the HPC cluster down for maintenance.  See the <tt>chtc-users</tt> email that just went out, and if you have any specific questions feel free to drop them in here!<br/>
<span style="color: #4cc091"><span style="font-size: small">(10:39:38)</span> <b>blin:</b></span> ah right, thanks<br/>
<span style="color: #99a949"><span style="font-size: small">(10:44:02)</span> <b>matyas:</b></span> thanks, good to know<br/>
</body>
</html>
