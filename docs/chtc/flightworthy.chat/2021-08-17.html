<!DOCTYPE html>
<html>
<head>
<title>Tue Aug 17, 2021 : #flightworthy (chtc)</title>
</head>
<body>
<h3>Tue Aug 17, 2021 : #flightworthy (chtc)</h3>
<span style="color: #99a949"><span style="font-size: small">(11:26:38)</span> <b>matyas:</b></span> @johnkn I have a print formats question:<br/>how do I get <tt>OR ...</tt> to work?<br/>I have<br/><pre>SELECT<br/>RoutedJob AS "R" WIDTH 1 OR "-"</pre><br/>where RoutedJob is either true or undefined, but instead of "t" and "-", I'm getting "t" and "u" in my output<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:28:48)</span> <b>johnkn:</b></span> Haven't looked at the code in a while, but I think what you did is right.<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:29:08)</span> <b>johnkn:</b></span> Is <tt>RoutedJob</tt> true or not-present? or is it actually set to <tt>undefined</tt> ?<br/>
<span style="color: #99a949"><span style="font-size: small">(11:30:11)</span> <b>matyas:</b></span> true or not present<br/>
<span style="color: #99a949"><span style="font-size: small">(11:30:49)</span> <b>matyas:</b></span> I guess I can do<br/><pre>(RoutedJob ?: "-") AS "R" WIDTH 1</pre><br/><br/>
<span style="color: #235e5b"><span style="font-size: small">(11:31:26)</span> <b>johnkn:</b></span> might just be a bug. lots of wierd edge cases that I never fixed.  try without the width<br/>
<span style="color: #99a949"><span style="font-size: small">(11:32:22)</span> <b>matyas:</b></span> no dice<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:33:49)</span> <b>johnkn:</b></span> yeah, just use your workaround for now.  I'll try and look at it<br/>
<span style="color: #99a949"><span style="font-size: small">(11:33:56)</span> <b>matyas:</b></span> ok<br/>
<span style="color: #99a949"><span style="font-size: small">(11:38:55)</span> <b>matyas:</b></span> Is this how you're supposed to use FIELDSUFFIX?<br/><pre>SELECT FIELDSUFFIX "   "</pre><br/><br/>
<span style="color: #99a949"><span style="font-size: small">(11:44:13)</span> <b>matyas:</b></span> (btw it segfaults)<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:17:55)</span> <b>johnkn:</b></span> what tool?  and do you have a stacktrace?<br/>
<span style="color: #99a949"><span style="font-size: small">(14:24:42)</span> <b>matyas:</b></span> condor_q. How do I get a stacktrace?<br/>
<span style="color: #4cc091"><span style="font-size: small">(14:26:26)</span> <b>blin:</b></span> maybe <tt>_condor_TOOL_DEBUG=D_FULLDEBUG condor_q -debug blah blah blah</tt>?<br/>
<span style="color: #99a949"><span style="font-size: small">(14:27:57)</span> <b>matyas:</b></span> tried D_ALL:2<br/>
<span style="color: #99a949"><span style="font-size: small">(14:28:13)</span> <b>matyas:</b></span> is that more or less than FULLDEBUG? I can never remember<br/>
<blockquote>
<span style="color: #4cc091"><span style="font-size: small">(14:31:26)</span> <b>blin:</b></span> it's more<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:31:58)</span> <b>johnkn:</b></span> way more.  if you value your sanity. never use D_ALL:2<br/>
</blockquote>
<span style="color: #684b6c"><span style="font-size: small">(14:29:35)</span> <b>bbockelman:</b></span> @matyas - <tt>gdb --args condor_q -debug blah blah</tt> ; type <tt>run</tt> ; type <tt>bt</tt> when it segfaults.<br/>
<blockquote>
<span style="color: #99a949"><span style="font-size: small">(15:12:56)</span> <b>matyas:</b></span> gdb output with D_FULLDEBUG:2 and <tt>condor_q -debug -pr test-q.cpf</tt><br/><pre>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/issue:  \S<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/redhat-release:  Fedora release 34 (Thirty Four)<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Using IDs: 4 processors, 2 CPUs, 2 HTs<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Reading condor configuration from '/etc/condor/condor_config'<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: lo 127.0.0.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: wlp4s0 192.168.0.65 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: virbr0 192.168.122.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: tun0 10.130.178.170 up<br/><br/>Program received signal SIGSEGV, Segmentation fault.<br/>0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>(gdb) bt<br/>#0  0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#1  0x00007ffff7cde054 in _allocation_pool::insert(char const*, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#2  0x00007ffff7d75a49 in SetAttrListPrintMaskFromStream(SimpleInputStream&amp;, case_sensitive_sorted_tokener_lookup_table&lt;CustomFormatFnTableItem&gt; const&amp;, AttrListPrintMask&amp;, PrintMaskMakeSettings&amp;, std::vector&lt;GroupByKeyInfo, std::allocator&lt;GroupByKeyInfo&gt; &gt;&amp;, AttrListPrintMask*, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;) () from /lib64/libcondor_utils_8_8_10.so<br/>#3  0x0000555555572102 in set_print_mask_from_stream(AttrListPrintMask&amp;, char const*, bool, StringList&amp;, AttrListPrintMask&amp;) [clone .constprop.0] ()<br/>#4  0x0000555555562b9f in main ()</pre><br/>where test-q.cpf is<br/><pre><br/>SELECT FIELDSUFFIX "   "<br/>Owner AS "OWNER" PRINTAS OWNER WIDTH -8<br/>QDate AS "SUBMITTED" PRINTAS QDATE WIDTH AUTO</pre><br/>
</blockquote>
<span style="color: #235e5b"><span style="font-size: small">(14:29:41)</span> <b>johnkn:</b></span> Nevermind.  I can repro.<br/>
<span style="color: #684b6c"><span style="font-size: small">(14:29:52)</span> <b>bbockelman:</b></span> (additionally, <tt>valgrind</tt> output is always welcome)<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:30:50)</span> <b>johnkn:</b></span> looks like the separator stuff doesn't work right with the print format files when used with condor_q,<br/>
<span style="color: #9b3b45"><span style="font-size: small">(14:35:21)</span> <b>jfrey:</b></span> Does anyone know anything about DESYâ€™s krb credd configuration?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:42:05)</span> <b>johnkn:</b></span> Zach,  maybe Jason?<br/>
<span style="color: #99a949"><span style="font-size: small">(15:12:56)</span> <b>matyas:</b></span> gdb output with D_FULLDEBUG:2 and <tt>condor_q -debug -pr test-q.cpf</tt><br/><pre>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/issue:  \S<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/redhat-release:  Fedora release 34 (Thirty Four)<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Using IDs: 4 processors, 2 CPUs, 2 HTs<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Reading condor configuration from '/etc/condor/condor_config'<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: lo 127.0.0.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: wlp4s0 192.168.0.65 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: virbr0 192.168.122.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: tun0 10.130.178.170 up<br/><br/>Program received signal SIGSEGV, Segmentation fault.<br/>0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>(gdb) bt<br/>#0  0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#1  0x00007ffff7cde054 in _allocation_pool::insert(char const*, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#2  0x00007ffff7d75a49 in SetAttrListPrintMaskFromStream(SimpleInputStream&amp;, case_sensitive_sorted_tokener_lookup_table&lt;CustomFormatFnTableItem&gt; const&amp;, AttrListPrintMask&amp;, PrintMaskMakeSettings&amp;, std::vector&lt;GroupByKeyInfo, std::allocator&lt;GroupByKeyInfo&gt; &gt;&amp;, AttrListPrintMask*, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;) () from /lib64/libcondor_utils_8_8_10.so<br/>#3  0x0000555555572102 in set_print_mask_from_stream(AttrListPrintMask&amp;, char const*, bool, StringList&amp;, AttrListPrintMask&amp;) [clone .constprop.0] ()<br/>#4  0x0000555555562b9f in main ()</pre><br/>where test-q.cpf is<br/><pre><br/>SELECT FIELDSUFFIX "   "<br/>Owner AS "OWNER" PRINTAS OWNER WIDTH -8<br/>QDate AS "SUBMITTED" PRINTAS QDATE WIDTH AUTO</pre><br/>
<blockquote>
<span style="color: #99a949"><span style="font-size: small">(15:12:56)</span> <b>matyas:</b></span> gdb output with D_FULLDEBUG:2 and <tt>condor_q -debug -pr test-q.cpf</tt><br/><pre>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/issue:  \S<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Result of reading /etc/redhat-release:  Fedora release 34 (Thirty Four)<br/> <br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Using IDs: 4 processors, 2 CPUs, 2 HTs<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Reading condor configuration from '/etc/condor/condor_config'<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: lo 127.0.0.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: wlp4s0 192.168.0.65 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: virbr0 192.168.122.1 up<br/>08/17/21 15:10:30 (pid:49008) (D_ALWAYS:2) Enumerating interfaces: tun0 10.130.178.170 up<br/><br/>Program received signal SIGSEGV, Segmentation fault.<br/>0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>(gdb) bt<br/>#0  0x00007ffff7cddd35 in _allocation_pool::consume(int, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#1  0x00007ffff7cde054 in _allocation_pool::insert(char const*, int) () from /lib64/libcondor_utils_8_8_10.so<br/>#2  0x00007ffff7d75a49 in SetAttrListPrintMaskFromStream(SimpleInputStream&amp;, case_sensitive_sorted_tokener_lookup_table&lt;CustomFormatFnTableItem&gt; const&amp;, AttrListPrintMask&amp;, PrintMaskMakeSettings&amp;, std::vector&lt;GroupByKeyInfo, std::allocator&lt;GroupByKeyInfo&gt; &gt;&amp;, AttrListPrintMask*, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;) () from /lib64/libcondor_utils_8_8_10.so<br/>#3  0x0000555555572102 in set_print_mask_from_stream(AttrListPrintMask&amp;, char const*, bool, StringList&amp;, AttrListPrintMask&amp;) [clone .constprop.0] ()<br/>#4  0x0000555555562b9f in main ()</pre><br/>where test-q.cpf is<br/><pre><br/>SELECT FIELDSUFFIX "   "<br/>Owner AS "OWNER" PRINTAS OWNER WIDTH -8<br/>QDate AS "SUBMITTED" PRINTAS QDATE WIDTH AUTO</pre><br/>
</blockquote>
<span style="color: #99a949"><span style="font-size: small">(15:13:49)</span> <b>matyas:</b></span> (that's 8.8.10 but my 9.0.4 CE shows the same issue, I just don't have gdb installed in that container)<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:56:06)</span> <b>johnkn:</b></span> Thanks.  that's helpful, as I suspected, classad pretty printer that condor_q uses is not prepared to handle custom field or row separators from a print-format file.  should be pretty easy to fix, but there is no workaround.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:02:03)</span> <b>johnkn:</b></span> I need a reviewer for HTCONDOR-646.  a change to the way one of the JobRouter HOOKs is invoked to make it more consistent with what 8.8 did.<br/>
<span style="color: #99a949"><span style="font-size: small">(17:04:27)</span> <b>matyas:</b></span> separately, this seems weird:<br/>this is ok:<br/><pre>SELECT<br/>        (isUndefined(OSG_PROJECT_NAME) ? ProjectName : strcat("[OSG]", OSG_PROJECT_NAME)) AS "PROJECT"</pre><br/>but if I do <tt>strcat("[OSG] ", OSG_PROJECT_NAME)</tt> instead (put a space after the <tt>[OSG]</tt>) then I get<br/><pre>attribute or expression is not valid: (isUndefined(OSG_PROJECT_NAME) ? ProjectName : strcat("[OSG] ", OSG_PROJECT_NAME)) AS "PROJECT"</pre><br/>though I can work around that by doing <tt>strcat("[OSG]", " ", OSG_PROJECT_NAME)</tt><br/>
<span style="color: #235e5b"><span style="font-size: small">(17:10:28)</span> <b>johnkn:</b></span> try putting '' around the expression.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:11:58)</span> <b>johnkn:</b></span> (that's single quote)<br/>
<span style="color: #99a949"><span style="font-size: small">(17:27:18)</span> <b>matyas:</b></span> no luck with single quote:<br/><pre>attribute or expression is not valid: (isUndefined(OSG_PROJECT_NAME) ? ProjectName : strcat("[OSG] ", OSG_PROJECT_NAME))'</pre><br/>I have single quotes on both sides of that expression, but the opening single quote got chopped off in the error message<br/>
<span style="color: #9b3b45"><span style="font-size: small">(17:49:19)</span> <b>jfrey:</b></span> @johnkn I can take the HTCONDOR-646 review<br/>
</body>
</html>
