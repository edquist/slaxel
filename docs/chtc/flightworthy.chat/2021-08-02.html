<!DOCTYPE html>
<html>
<head>
<title>Mon Aug 2, 2021 : #flightworthy (chtc)</title>
</head>
<body>
<h3>Mon Aug 2, 2021 : #flightworthy (chtc)</h3>
<span style="color: #99a949"><span style="font-size: small">(09:37:06)</span> <b>matyas:</b></span> I could use some naming advice. (Yeah I know I shouldn't ask here but I will anyway :wink: )<br/>
<blockquote>
<span style="color: #99a949"><span style="font-size: small">(09:47:38)</span> <b>matyas:</b></span> If you ask the docker build script to make the latest condor images for el7, you'll get the following sets of tags:<br/><tt>:9.1.2-el7</tt> because that's the specific condor version<br/><tt>:9.1-el7</tt> because it's the latest in the 9.1 series<br/><tt>:el7</tt> because it's the latest in the default series<br/>and when I do HTCONDOR-493 you'll also get <tt>:latest</tt> because it's the latest in the default series for the default distro<br/><br/>That's a lot of tags. I was thinking of adding a command-line argument to only make the most specific tag (<tt>:9.1.2-el7</tt>) but I have no idea what to call it. Ideas I had were:<br/>• --one-tag<br/>• --one-tag-per-image<br/>• --versioned-tags-only<br/>• --no-generic-tags<br/>• --specific-tags-only<br/>• --exact-version-tags<br/>any thoughts or other ideas?<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:31:15)</span> <b>tlmiller:</b></span> It depends on why you only want to make the most-specific tag -- in what situation is it wrong or unwanted to make all of the tags?  If you're just testing, why is the most-specific tag OK?  (If there's a good reason, then maybe <tt>--testing</tt> or <tt>--tags=testing</tt> would be good.)<br/>
<span style="color: #99a949"><span style="font-size: small">(10:49:27)</span> <b>matyas:</b></span> mostly I don't want to clutter up <tt>docker images</tt> with 20 lines per distro<br/>
<span style="color: #99a949"><span style="font-size: small">(10:50:28)</span> <b>matyas:</b></span> for the services we run in kubernetes we typically specify a given exact version so we know what we're getting when we kill and restart a pod, for example<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:52:06)</span> <b>tlmiller:</b></span> Well, I guess if you're not uploading the container to docker hub, I don't care that it's improperly tagged.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:52:52)</span> <b>matyas:</b></span> right, if you're building for pushing to dockerhub then you're going to want all the tags<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:55:14)</span> <b>tlmiller:</b></span> So maybe a name related to that?  Otherwise, I guess I'd do <tt>--version-tag-only</tt> (or <tt>--tags=version</tt>, depending).  (Maybe specific-version or micro-version, if you need to be specific.)<br/>
</blockquote>
<span style="color: #5a4592"><span style="font-size: small">(09:39:06)</span> <b>tannenba:</b></span> @jcpatton Hey Jason, how exactly does your daily usage report compute Good CPU Hours and All CPU Hours in terms of what job ad attributes are you using to compute these two values?  Also, is this source code for the code to create this script sitting someplace I can look at?  Thanks.<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:39:54)</span> <b>jcpatton:</b></span> <a href="https://github.com/CHTC/JobAccounting/tree/python">https://github.com/CHTC/JobAccounting/tree/python</a> (you’ll want to stick to the <tt>python</tt> branch)<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:41:16)</span> <b>jcpatton:</b></span> “Good CPU Hours” is <tt>CommittedTime * RequestCpus</tt>, “All CPU Hours” is <tt>RemoteWallClockTime * RequestCpus</tt><br/>
<span style="color: #5a4592"><span style="font-size: small">(09:41:40)</span> <b>tannenba:</b></span> Thanks Jason!<br/>
<span style="color: #2b6836"><span style="font-size: small">(09:42:31)</span> <b>jcpatton:</b></span> Most of the calculations are done in the <tt>compute_custom_columns</tt> methods of the filter classes, e.g. <a href="https://github.com/CHTC/JobAccounting/blob/python/accounting/filters/ChtcScheddCpuFilter.py#L400">https://github.com/CHTC/JobAccounting/blob/python/accounting/filters/ChtcScheddCpuFilter.py#L400</a><br/>
<span style="color: #5a4592"><span style="font-size: small">(09:42:54)</span> <b>tannenba:</b></span> Yep, already found it :slightly_smiling_face:<br/>
<span style="color: #99a949"><span style="font-size: small">(09:47:38)</span> <b>matyas:</b></span> If you ask the docker build script to make the latest condor images for el7, you'll get the following sets of tags:<br/><tt>:9.1.2-el7</tt> because that's the specific condor version<br/><tt>:9.1-el7</tt> because it's the latest in the 9.1 series<br/><tt>:el7</tt> because it's the latest in the default series<br/>and when I do HTCONDOR-493 you'll also get <tt>:latest</tt> because it's the latest in the default series for the default distro<br/><br/>That's a lot of tags. I was thinking of adding a command-line argument to only make the most specific tag (<tt>:9.1.2-el7</tt>) but I have no idea what to call it. Ideas I had were:<br/>• --one-tag<br/>• --one-tag-per-image<br/>• --versioned-tags-only<br/>• --no-generic-tags<br/>• --specific-tags-only<br/>• --exact-version-tags<br/>any thoughts or other ideas?<br/>
<blockquote>
<span style="color: #99a949"><span style="font-size: small">(09:47:38)</span> <b>matyas:</b></span> If you ask the docker build script to make the latest condor images for el7, you'll get the following sets of tags:<br/><tt>:9.1.2-el7</tt> because that's the specific condor version<br/><tt>:9.1-el7</tt> because it's the latest in the 9.1 series<br/><tt>:el7</tt> because it's the latest in the default series<br/>and when I do HTCONDOR-493 you'll also get <tt>:latest</tt> because it's the latest in the default series for the default distro<br/><br/>That's a lot of tags. I was thinking of adding a command-line argument to only make the most specific tag (<tt>:9.1.2-el7</tt>) but I have no idea what to call it. Ideas I had were:<br/>• --one-tag<br/>• --one-tag-per-image<br/>• --versioned-tags-only<br/>• --no-generic-tags<br/>• --specific-tags-only<br/>• --exact-version-tags<br/>any thoughts or other ideas?<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:31:15)</span> <b>tlmiller:</b></span> It depends on why you only want to make the most-specific tag -- in what situation is it wrong or unwanted to make all of the tags?  If you're just testing, why is the most-specific tag OK?  (If there's a good reason, then maybe <tt>--testing</tt> or <tt>--tags=testing</tt> would be good.)<br/>
<span style="color: #99a949"><span style="font-size: small">(10:49:27)</span> <b>matyas:</b></span> mostly I don't want to clutter up <tt>docker images</tt> with 20 lines per distro<br/>
<span style="color: #99a949"><span style="font-size: small">(10:50:28)</span> <b>matyas:</b></span> for the services we run in kubernetes we typically specify a given exact version so we know what we're getting when we kill and restart a pod, for example<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:52:06)</span> <b>tlmiller:</b></span> Well, I guess if you're not uploading the container to docker hub, I don't care that it's improperly tagged.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:52:52)</span> <b>matyas:</b></span> right, if you're building for pushing to dockerhub then you're going to want all the tags<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:55:14)</span> <b>tlmiller:</b></span> So maybe a name related to that?  Otherwise, I guess I'd do <tt>--version-tag-only</tt> (or <tt>--tags=version</tt>, depending).  (Maybe specific-version or micro-version, if you need to be specific.)<br/>
</blockquote>
<span style="color: #684b6c"><span style="font-size: small">(12:53:31)</span> <b>bbockelman:</b></span> Hi folks --<br/>
<span style="color: #684b6c"><span style="font-size: small">(12:53:43)</span> <b>bbockelman:</b></span> Where are the tags for 9.0.4 and 9.1.2?<br/>
<span style="color: #684b6c"><span style="font-size: small">(12:54:06)</span> <b>bbockelman:</b></span> Also, is there a security ticket associated with the commit for 9.0.4?<br/>
<span style="color: #235e5b"><span style="font-size: small">(12:55:43)</span> <b>johnkn:</b></span> @matyas, perhaps the problem is the default behavior here?  is it really correct to assume that a build is always the latest one? shouldn't that be opt-in behavior?  perhaps <tt>-tag-latest</tt> and <tt>-no-tag-latest</tt> arguments are needed?<br/>
<span style="color: #684b6c"><span style="font-size: small">(12:57:01)</span> <b>bbockelman:</b></span> Also <tt>V9_0_4-branch</tt> isn't showing the fix that I understand it to need.<br/>
<span style="color: #99a949"><span style="font-size: small">(12:57:29)</span> <b>matyas:</b></span> @johnkn the containers are built by yum installing RPMs (or apt installing debs); if you don't specify a version then you will automatically get the latest<br/>
<span style="color: #99a949"><span style="font-size: small">(12:58:21)</span> <b>matyas:</b></span> once that's done, the script runs <tt>condor_version</tt> to figure out what it just installed and adds the version-specific tags<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:00:33)</span> <b>tlmiller:</b></span> I think TJ was asking if any arbitrary invocation of the script should assume that it's creating the canonical image, and I think, but am not sure, that doing so is the intended purpose of the script, and that Mat's use case (updating only the local repo) is not the usual one.<br/>
<span style="color: #99a949"><span style="font-size: small">(13:06:16)</span> <b>matyas:</b></span> yep. Tim runs <tt>./build-condor-images --push</tt> during the release process and the canonical images get built and pushed to dockerhub<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:07:28)</span> <b>johnkn:</b></span> Sounds like if you check out an older branch and run that script.  it will update <tt>:latest</tt> correct?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:07:49)</span> <b>matyas:</b></span> the branch doesn't matter<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:08:52)</span> <b>johnkn:</b></span> the script isn't in the repo?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:09:30)</span> <b>matyas:</b></span> ok fine the default series is declared as a constant in the script<br/>
<span style="color: #99a949"><span style="font-size: small">(13:09:51)</span> <b>matyas:</b></span> but I didn't really intend the script to be different from branch to branch<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:10:41)</span> <b>johnkn:</b></span> but unless the script actually switches branches, its gonna build whatever version you have checked out, right?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:10:53)</span> <b>matyas:</b></span> no, it yum installs from the repos<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:11:04)</span> <b>johnkn:</b></span> ah, ok.<br/>
<span style="color: #2b6836"><span style="font-size: small">(13:20:41)</span> <b>jcpatton:</b></span> I’m helping with the OSGVS today so won’t be at the HTCSS meeting<br/>
<span style="color: #2b6836"><span style="font-size: small">(13:21:47)</span> <b>jcpatton:</b></span> I don’t have anything to add to the list of July achievements<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:54:10)</span> <b>jfrey:</b></span> Who would like to claim responsibility for interacting with G-Research on a regular basis?<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:55:59)</span> <b>johnkn:</b></span> It's usually me that catches their tickets<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:56:01)</span> <b>jfrey:</b></span> We have two entries for them as close collaborators to inform about security releases, both of which bounced.<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:56:28)</span> <b>johnkn:</b></span> The have a support contract<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:56:50)</span> <b>jfrey:</b></span> The emails we have for the security list are <a href="mailto:tyrone.cox@gresearch.co.uk">tyrone.cox@gresearch.co.uk</a> and <a href="mailto:katy.lowther@gresearch.co.uk">katy.lowther@gresearch.co.uk</a>.<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:57:10)</span> <b>jfrey:</b></span> I think we need to find another person there who’s still active.<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:57:13)</span> <b>johnkn:</b></span> I don't know either of those names :wink:<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:58:28)</span> <b>johnkn:</b></span> Is it legit to grep through condor-support looking for contacts?<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:58:52)</span> <b>jfrey:</b></span> If that’s the best we can do, sure.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:00:07)</span> <b>johnkn:</b></span> Most recent support email I responded to is from <a href="mailto:Alex.Butterworth@gresearch.co.uk">Alex.Butterworth@gresearch.co.uk</a><br/>
<span style="color: #9b3b45"><span style="font-size: small">(17:00:49)</span> <b>jfrey:</b></span> If no one else chimes in saying they interact with them outside of condor-support, I’d say Alex is our person.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:01:15)</span> <b>johnkn:</b></span> Slightly older contact. <a href="mailto:Michael.McClenahan@gresearch.co.uk">Michael.McClenahan@gresearch.co.uk</a><br/>
<span style="color: #9b3b45"><span style="font-size: small">(17:03:08)</span> <b>jfrey:</b></span> Cox and Lowther are also the contacts listed on the contracted support page.<br/>
</body>
</html>
