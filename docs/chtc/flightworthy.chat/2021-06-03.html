<!DOCTYPE html>
<html>
<head>
<title>Thu Jun 3, 2021 : #flightworthy (chtc)</title>
</head>
<body>
<h3>Thu Jun 3, 2021 : #flightworthy (chtc)</h3>
<span style="color: #16569E"><span style="font-size: small">(09:24:39)</span> <b>edquist:</b></span> Good morning @jfrey - are the patches for HTCONDOR-534 / gittrac #6159 in a branch?  i am looking to apply them for our osg builds; wondering if i need to grab them out of the gittrac ticket or if i can get them from git directly<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:26:10)</span> <b>tim:</b></span> <b>@edquist</b> Brian asked me to apply the patches. I can get them for you if you'd rather.<br/>
<span style="color: #16569E"><span style="font-size: small">(09:26:42)</span> <b>edquist:</b></span> ah ok, thanks tim<br/>
<span style="color: #16569E"><span style="font-size: small">(09:26:47)</span> <b>edquist:</b></span> either way is fine<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:26:48)</span> <b>jfrey:</b></span> The changes are in V9_0-branch.<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:27:27)</span> <b>jfrey:</b></span> The commit message contain <tt>HTCONDOR-534</tt>, and the jira ticket includes a link to them.<br/>
<span style="color: #4cc091"><span style="font-size: small">(09:27:43)</span> <b>blin:</b></span> ah sorry for the miscommunication: @tim if you can do it, go for it. <b>@edquist</b> you can hack on the other items we discussed<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:28:09)</span> <b>jfrey:</b></span> I have a few open PRs for blahp changes that could use some testing.<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:28:36)</span> <b>jfrey:</b></span> I’ve tested them in a personal setup, but I’d like to see them work in the OSG setup.<br/>
<span style="color: #16569E"><span style="font-size: small">(09:28:56)</span> <b>edquist:</b></span> ah all i saw in HTCONDOR-534 was the mention of gittrac #6159 but i did not see links to the changes<br/>
<span style="color: #16569E"><span style="font-size: small">(09:29:44)</span> <b>edquist:</b></span> @tim let me know if you would like me to handle patching and/or builds otherwise i guess feel free to tackle them<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:30:16)</span> <b>tim:</b></span> <b>@edquist</b> I'll tackle the HTCondor builds<br/>
<span style="color: #16569E"><span style="font-size: small">(09:30:22)</span> <b>edquist:</b></span> sounds good, thanks<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:31:56)</span> <b>tim:</b></span> @jfrey I think that I'll merge your PRs and cut an RC build for the blahp so that it can be tested.<br/>
<span style="color: #16569E"><span style="font-size: small">(09:34:13)</span> <b>edquist:</b></span> @jfrey - we are also looking to patch condor 8.8 - i took a look at your commit from V9_0-branch (<tt>4c861d4e2</tt> - "Keep GridJobId for completed and removed grid batch jobs. HTCONDOR-534"), looks like it applies cleanly to V8_8-branch.  Is it ok to apply this as-is, or will it need any tweaking to backport?  (despite the patch applying cleanly)<br/>
<span style="color: #9b3b45"><span style="font-size: small">(09:34:37)</span> <b>jfrey:</b></span> Back-porting as-is should be fine.<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:37:27)</span> <b>tim:</b></span> <b>@edquist</b> If you are looking at HTCondor 8.8 patches, you may as well do all three 8.8.13, 9.0.1, and 9.1.0. I have a release to get out the door today.<br/>
<span style="color: #16569E"><span style="font-size: small">(09:41:07)</span> <b>edquist:</b></span> fine with me<br/>
<span style="color: #16569E"><span style="font-size: small">(09:41:37)</span> <b>edquist:</b></span> do you have the SOFTWARE ticket number(s) handy?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(09:46:14)</span> <b>tim:</b></span> Like I said, no ticket has been created yet.<br/>
<span style="color: #16569E"><span style="font-size: small">(09:51:39)</span> <b>edquist:</b></span> Ah, i missed your comment (i see it now in the direct-message).  thanks!<br/>
<span style="color: #16569E"><span style="font-size: small">(10:18:49)</span> <b>edquist:</b></span> so, i see SOFTWARE-4625 is marked for 3.6 and 3.5.37-upcoming, and only mentions *9.0.1*<br/>
<span style="color: #16569E"><span style="font-size: small">(10:18:58)</span> <b>edquist:</b></span> are we also building 9.1.0 ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:21:52)</span> <b>johnkn:</b></span> 9.1.0 includes all of the changes that are in 9.0.1.  Is that the question?<br/>
<span style="color: #bb86b7"><span style="font-size: small">(10:24:29)</span> <b>tim:</b></span> Also, see <a href="https://opensciencegrid.atlassian.net/browse/SOFTWARE-4636">https://opensciencegrid.atlassian.net/browse/SOFTWARE-4636</a><br/>
<span style="color: #16569E"><span style="font-size: small">(10:32:29)</span> <b>edquist:</b></span> ahhh<br/>
<span style="color: #16569E"><span style="font-size: small">(10:32:32)</span> <b>edquist:</b></span> ok thanks<br/>
<span style="color: #16569E"><span style="font-size: small">(10:33:02)</span> <b>edquist:</b></span> no the question was, in osg are we building 9.1.0, since i see we osg 3.6 and 3.5-upcoming are both labeled for the 9.0.1 ticket<br/>
<span style="color: #16569E"><span style="font-size: small">(10:33:15)</span> <b>edquist:</b></span> but i forgot we have a 3.6-upcoming also<br/>
<span style="color: #16569E"><span style="font-size: small">(10:33:24)</span> <b>edquist:</b></span> (first time using it?)<br/>
<span style="color: #bb86b7"><span style="font-size: small">(10:35:43)</span> <b>tim:</b></span> Yes<br/>
<span style="color: #9f69e7"><span style="font-size: small">(11:40:21)</span> <b>lmichael:</b></span> @tlmiller @jcpatton I’m trying to understand what happens to jobs that use the new exit-driven checkpointing in the OSPool. I have a user who is running such jobs (successfully, according to him!), but I can’t figure out the CommittedTime or other metric of the most recent execution. It looks like everything is additive and/or broken:<br/><pre>[lmichael@login04 ~]$ condor_q 9713789.0 -nobatch<br/>-- Schedd: <a href="http://login04.osgconnect.net">login04.osgconnect.net</a> : &lt;192.170.227.166:9618?... @ 06/03/21 11:38:57<br/> ID         OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD<br/>9713789.0   curotto         5/20 12:42  13+01:34:21 R  0   74.0 run.sh ReplicaExchange1<br/><br/>Total for query: 1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended <br/>Total for all users: 33535 jobs; 350 completed, 0 removed, 17467 idle, 14644 running, 1074 held, 0 suspended<br/><br/>[lmichael@login04 ~]$ condor_q 9713789.0 -run<br/>-- Schedd: <a href="http://login04.osgconnect.net">login04.osgconnect.net</a> : &lt;192.170.227.166:9618?... @ 06/03/21 11:39:00<br/> ID         OWNER            SUBMITTED     RUN_TIME HOST(S)<br/>9713789.0   curotto         5/20 12:42  13+01:34:24 <a href="mailto:glidein_1_659664150@osg-10133546.0-red-c1635.unl.edu">glidein_1_659664150@osg-10133546.0-red-c1635.unl.edu</a><br/>[lmichael@login04 ~]$ condor_q 9713789.0 -af CommittedTime<br/>0</pre><br/>Am I not looking at the ‘right’ attributes? There’s basically NO way that all of their ~25 jobs have been running within single executions for 13 days.<br/>
<span style="color: #9f69e7"><span style="font-size: small">(11:42:38)</span> <b>lmichael:</b></span> The below gives ~18 hours, which seems more reasonable for this job, but is there an attribute that already does the math of <tt>currenttime-enteredcurrentstatus</tt>?<br/><pre>[lmichael@login04 ~]$ condor_q 9713789.0 -af '(CurrentTime - EnteredCurrentStatus)'<br/>65991</pre><br/><br/>
<span style="color: #9f69e7"><span style="font-size: small">(11:43:02)</span> <b>lmichael:</b></span> And isn’t <tt>-run</tt> supposed to give the time of just the current execution?<br/>
<span style="color: #2b6836"><span style="font-size: small">(11:46:36)</span> <b>jcpatton:</b></span> huh, I thought <tt>CommittedTime</tt> wasn’t being set right when using vanilla universe self checkpointing, that’s good to know… I don’t think we have a separate attribute then for getting the “current” runtime<br/>
<blockquote>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-04 11:45:07)</span> <b>lmichael:</b></span> @jcpatton @johnkn @tlmiller why not have an attribute with the ‘current’ commitedtime?<br/>
<span style="color: #9f69e7"><span style="font-size: small">(2021-06-04 11:45:25)</span> <b>lmichael:</b></span> or, why not committedtime represent the ‘current’ value?<br/>
<span style="color: #9e3997"><span style="font-size: small">(2021-06-04 12:47:52)</span> <b>tlmiller:</b></span> There's no particular reason; it was just never implemented.  It should be easier to implement now that the standard universe is gone.  (The design for the feature was very deliberately that nothing but the starter knew that the job was checkpointing itself.)<br/>
</blockquote>
<span style="color: #235e5b"><span style="font-size: small">(11:54:34)</span> <b>johnkn:</b></span> <tt>-run</tt> does not just give time of the current execution, you use <tt>-currentrun</tt> for that<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:38:22)</span> <b>tlmiller:</b></span> @lmichael "Everything being additive and/or broken" is almost certainly correct.  (Usage reported by the startd should be correct, because it doesn't know what's going on.)<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:43:26)</span> <b>tlmiller:</b></span> See GT#4969 and/or GT#5246, depending on what exactly you're asking for.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:43:27)</span> <b>chtc:</b></span> <a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=4969">GT#4969</a> | Correctly report checkpointing status from vanilla universe. [*defer* at 2016-Apr-21 14:12]<br/><a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=5246">GT#5246</a> | Increase monitorability of vanilla universe checkpointing. [*defer* at 2016-Apr-27 15:03]<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:51:24)</span> <b>tannenba:</b></span> <b>@edquist</b> @blin @tim Hi Guys, re the discussion this morning of backporting of random patches into some OSG fork of HTCSS  :  can someone give a pithy explanation of why OSG needs to fork HTCSS?  Can we plan for a date when this practice is no longer needed, or do you guys feel that is not possible?<br/>
<span style="color: #16569E"><span style="font-size: small">(12:51:41)</span> <b>edquist:</b></span> uhhhhhhhhh<br/>
<span style="color: #4cc091"><span style="font-size: small">(12:51:49)</span> <b>blin:</b></span> that is a multi-year project<br/>
<span style="color: #16569E"><span style="font-size: small">(12:52:01)</span> <b>edquist:</b></span> it's like what every distro ever out there does<br/>
<span style="color: #16569E"><span style="font-size: small">(12:52:33)</span> <b>edquist:</b></span> they backport patches for bugfixes and features they want into the selected versions for their various series they maintain<br/>
<span style="color: #16569E"><span style="font-size: small">(12:52:42)</span> <b>edquist:</b></span> which is also exactly what we do in this case<br/>
<span style="color: #16569E"><span style="font-size: small">(12:53:52)</span> <b>edquist:</b></span> it's a warm tradition<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:53:58)</span> <b>tlmiller:</b></span> @tannenba AFAICT, the only requirement is to merge OSG's and HTCSS's support policies.<br/>
<span style="color: #4cc091"><span style="font-size: small">(12:54:04)</span> <b>blin:</b></span> the root issue is the different cadences by which OSG/HTCSS release different series and the resulting differences in support timelines<br/>
<span style="color: #16569E"><span style="font-size: small">(12:54:08)</span> <b>edquist:</b></span> it's like drinking guiness and jaimo for the irish<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:54:38)</span> <b>tlmiller:</b></span> (By which I mean, "OSG supports 8.8 and we don't.")<br/>
<span style="color: #16569E"><span style="font-size: small">(12:55:00)</span> <b>edquist:</b></span> they are not likely to bow to the english crown and start drinking tea, any time soon<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:55:02)</span> <b>tlmiller:</b></span> "Merging our support policies" may entail synchronizing our release schedule. :)<br/>
<span style="color: #4cc091"><span style="font-size: small">(12:55:06)</span> <b>blin:</b></span> having the ability to patch things quickly on our end also puts less load on you for rushing out fixes for the OSG, though arguably that eventually goes away in PATh<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:55:17)</span> <b>tannenba:</b></span> <b>@edquist</b> Do they?  Or do they primarily select what versions of upstream software they want included?  (yes, I know RedHat pulls various kernel patches in and out.... but isn't that the exception, not the rule?)<br/>
<span style="color: #16569E"><span style="font-size: small">(12:55:40)</span> <b>edquist:</b></span> redhat is the exception not the rule?<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:56:09)</span> <b>tlmiller:</b></span> With respect to distros, every distro I'm aware of has and uses the support for patches to the upstream source in their packaging tools.  Sometimes it's just to correct installation paths (e.g., Debian vs RedHat).<br/>
<span style="color: #16569E"><span style="font-size: small">(12:56:24)</span> <b>edquist:</b></span> cloudera maintains HUNDREDS of patches for each of the packages that it ships<br/>
<span style="color: #bb86b7"><span style="font-size: small">(12:56:33)</span> <b>tim:</b></span> We routinely have patches that get applied in the Fedora and Debian source repositories that we merge back into our code base.<br/>
<span style="color: #16569E"><span style="font-size: small">(12:56:35)</span> <b>edquist:</b></span> HUN<br/>
<span style="color: #16569E"><span style="font-size: small">(12:56:36)</span> <b>edquist:</b></span> DREDS<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:56:37)</span> <b>tlmiller:</b></span> How many packages are patched in a given distro I couldn't tell you.<br/>
<span style="color: #16569E"><span style="font-size: small">(12:56:48)</span> <b>edquist:</b></span> (actually thousands, for hadoop)<br/>
<span style="color: #16569E"><span style="font-size: small">(12:57:30)</span> <b>edquist:</b></span> if you want badly enough to have statistics, i could make a lunchtime project to gather some<br/>
<span style="color: #16569E"><span style="font-size: small">(12:57:51)</span> <b>edquist:</b></span> but i think it is probably not an uncommon practice, especially for bugs<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:58:04)</span> <b>tannenba:</b></span> Cloudera provides the support for their forked Hadoop, they don't send Cloudera customers back upstream to support their patchwork.....<br/>
<span style="color: #16569E"><span style="font-size: small">(12:58:08)</span> <b>edquist:</b></span> i do not know what debian and friends do<br/>
<span style="color: #16569E"><span style="font-size: small">(12:58:50)</span> <b>edquist:</b></span> i don't know if i understand - we (osg) are the cloudera in this example right?<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:59:02)</span> <b>tannenba:</b></span> Yes....<br/>
<span style="color: #99a949"><span style="font-size: small">(12:59:03)</span> <b>matyas:</b></span> we're more like EPEL<br/>
<span style="color: #99a949"><span style="font-size: small">(12:59:11)</span> <b>matyas:</b></span> but they pretty much do the same thing<br/>
<span style="color: #99a949"><span style="font-size: small">(12:59:24)</span> <b>matyas:</b></span> Cloudera is unusual in the magnitude<br/>
<span style="color: #4cc091"><span style="font-size: small">(13:01:09)</span> <b>blin:</b></span> it's really a question of squaring away our release and support policies: this fix that we're patching in is important to CEs across the OSG and i'd prefer a release next week (we still haven't gotten 9.0.1/9.1.0 out the door anyway). I don't think HTCSS can move that fast on an official release with your CHTC testing requirements<br/>
<span style="color: #16569E"><span style="font-size: small">(13:04:44)</span> <b>edquist:</b></span> yeah i think (1) if redhat/centos were the exception then it still would not be _that_ strange for us to take them as a model since we (osg) all live in rpm land; but (2) i don't really think redhat is an exception.  i think other distros do it too<br/>
<span style="color: #16569E"><span style="font-size: small">(13:05:47)</span> <b>edquist:</b></span> slackware is somewhat rare in that it (well, Pat) prefers to stick with the minimal unpatched releases (except perhaps for security fixes)<br/>
<span style="color: #16569E"><span style="font-size: small">(13:06:15)</span> <b>edquist:</b></span> i'm willing to be told otherwise, but that's my impression anyway<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:28:24)</span> <b>tlmiller:</b></span> ... isn't machine RANK a thing?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:28:32)</span> <b>tlmiller:</b></span> ... no, wait, that won't help.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:57:22)</span> <b>tlmiller:</b></span> On a technical level, I found Pelletier's  85th percentile tool very interesting.<br/>
<span style="color: #99a949"><span style="font-size: small">(15:10:50)</span> <b>matyas:</b></span> I forget... what was that? (He didn't post his slides, we just have the video)<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:38:51)</span> <b>johnkn:</b></span> Can anyone review HTCONDOR-533 condor_store_cred QUERY and DELETE don't work for KRB credentials?  pretty simple fix..<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:39:01)</span> <b>johnkn:</b></span> <a href="https://opensciencegrid.atlassian.net/browse/HTCONDOR-533">https://opensciencegrid.atlassian.net/browse/HTCONDOR-533</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:03:57)</span> <b>tlmiller:</b></span> He sent me the details an email I can share if you're curious,<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:04:37)</span> <b>tlmiller:</b></span> but the gist of the idea was to grovel around condor_history for the memory usage numbers of sufficiently-similar jobs, and use the result to set request_memory.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:05:01)</span> <b>tlmiller:</b></span> With the intent of reducing memory allocated but not used.<br/>
<span style="color: #9b3b45"><span style="font-size: small">(16:05:04)</span> <b>jfrey:</b></span> @johnkn I can review the change.<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:05:44)</span> <b>johnkn:</b></span> @jfrey Thanks.  hold off a bit I just realized the code is not quite correct for binary creds<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:06:28)</span> <b>tlmiller:</b></span> (IIRC, "sufficiently-similar" was already defined by the submitter for other reasons.)<br/>
<span style="color: #99a949"><span style="font-size: small">(16:12:26)</span> <b>matyas:</b></span> @tlmiller even having that data might be useful -- "here's a memory use histogram for $USER with $EXECUTABLE"<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:12:49)</span> <b>tlmiller:</b></span> It's in the history file. ;)<br/>
<span style="color: #99a949"><span style="font-size: small">(16:14:38)</span> <b>matyas:</b></span> yeah -- I should say collating that data would be useful<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:15:59)</span> <b>tlmiller:</b></span> <pre>    condor_history -since "JobFinishedHookDone &lt; ${last_update}" \<br/>                   -constraint '!isUndefined(QuestaSimTestName) &amp;&amp;<br/>                                !isUndefined(MemoryUsage) &amp;&amp; MemoryUsage &gt; 1024' \<br/>                   -autoformat \<br/>        'strcat(ifThenElse(regexp("--test \S+", Args),<br/>                    regexps("--test[ =](\S+).uvm *", Args, "\1"),<br/>                    regexps("--wd[ =]regressions/(\S+)_\d+ *", Args, "\1")),<br/>            ":",<br/>            ifThenElse(regexp("(\+define|)\+(NUM_TILES|NUMBER_OF_TILES)=", Args),<br/>                int(regexps(".*(\+define|)\+(NUM_TILES|NUMBER_OF_TILES)=(\d+).*", Args,"\3")), 1) )' \<br/>        'quantize(MemoryUsage, 1024)' 2&gt;/dev/null | sort  -k1,1 -k2n &gt; ${queryfile}</pre><br/><br/>
<span style="color: #99a949"><span style="font-size: small">(16:25:38)</span> <b>matyas:</b></span> scary but neat<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:27:29)</span> <b>tlmiller:</b></span> Yeah.  The result is processed by awk -- it builds a sorted list of all reported memory usage and then returns the 85th-percentile entry.<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:31:47)</span> <b>johnkn:</b></span> That strcat() could be much simpler submit stuffed a few custom attributes to help out.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:33:31)</span> <b>tlmiller:</b></span> I'm guessing he didn't want to muck about with the existing job(s) too much.<br/>
<span style="color: #684b6c"><span style="font-size: small">(19:18:04)</span> <b>bbockelman:</b></span> Just a thought - this would be excellent in a set ad!<br/>
</body>
</html>
