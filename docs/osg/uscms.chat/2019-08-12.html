<!DOCTYPE html>
<html>
<head>
<title>Mon Aug 12, 2019 : #uscms (osg)</title>
</head>
<body>
<h3>Mon Aug 12, 2019 : #uscms (osg)</h3>
<span style="color: #a72f79"><span style="font-size: small">(13:15:27)</span> <b>andrew.melo:</b></span> Could an xrootd person (@marian?) take a look at <a href="https://hypernews.cern.ch/HyperNews/CMS/get/wanaccess/596.html">https://hypernews.cern.ch/HyperNews/CMS/get/wanaccess/596.html</a> ?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:15:41)</span> <b>andrew.melo:</b></span> @eric.appelt ^<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:21:08)</span> <b>jthiltges:</b></span> Any recent upgrades to xrootd? If so, plugins were updated too?<br/>
<span style="color: #53b759"><span style="font-size: small">(13:21:14)</span> <b>marian:</b></span> Andrew, for a short answer, you can indeed stop cmsd for a moment ...<br/>
<span style="color: #43761b"><span style="font-size: small">(13:22:05)</span> <b>blin:</b></span> @jthiltges there was a recent release of the xrootd rucio n2n plugin<br/>
<span style="color: #43761b"><span style="font-size: small">(13:22:47)</span> <b>blin:</b></span> and we've got a version of xrootd-lcmaps in testing that may break existing installations<br/>
<span style="color: #43761b"><span style="font-size: small">(13:23:02)</span> <b>blin:</b></span> but that's all, off the top of my head, since the upgrade to xrootd 4.10.0<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:23:39)</span> <b>jthiltges:</b></span> Sorry, I meant to ask if there were recent upgrades on the affected host itself. But that's good info to know, thank you.<br/>
<span style="color: #53b759"><span style="font-size: small">(13:23:54)</span> <b>marian:</b></span> I don't think Vandy upgraded anything at this point<br/>
<span style="color: #53b759"><span style="font-size: small">(13:24:06)</span> <b>marian:</b></span> @eric.appelt: I guess there something that xrootd doesn't like on the host within networking<br/>
<span style="color: #53b759"><span style="font-size: small">(13:24:30)</span> <b>marian:</b></span> at least some of the context in the hn talks about it...<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:25:35)</span> <b>jthiltges:</b></span> Looks like you're right Marian. Stats show v4.8.5.<br/>
<span style="color: #53b759"><span style="font-size: small">(13:26:21)</span> <b>marian:</b></span> <a href="http://xrootd-vanderbilt.sites.opensciencegrid.org">xrootd-vanderbilt.sites.opensciencegrid.org</a> has address 129.59.197.113 ... what <tt>$ip addr list</tt> would tell from the host when logged in?<br/>
<span style="color: #53b759"><span style="font-size: small">(13:33:21)</span> <b>marian:</b></span> I sent email to @eric.appelt and other people involved in the thread, just in case...<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:52:41)</span> <b>jthiltges:</b></span> Sorry, I'd missed that there was an email thread. (I rarely use the HN web interface.)<br/><br/>Interestingly, the FNAL regional redirector seems to have the nat2.accre host, while the UNL one has xrootd1.accre.<br/><br/><pre>$ xrdfs <a href="http://cmsxrootd2.fnal.gov">cmsxrootd2.fnal.gov</a> locate -m '*' | grep vand<br/><a href="http://nat2.accre.vanderbilt.edu:1094">nat2.accre.vanderbilt.edu:1094</a> Server Read<br/><a href="http://sed.accre.vanderbilt.edu:1094">sed.accre.vanderbilt.edu:1094</a> Server Read<br/><br/>$ xrdfs <a href="http://xrootd.unl.edu">xrootd.unl.edu</a> locate -m '*' | grep vand<br/><a href="http://xrootd1.accre.vanderbilt.edu:1094">xrootd1.accre.vanderbilt.edu:1094</a> Server Read<br/><a href="http://sed.accre.vanderbilt.edu:1094">sed.accre.vanderbilt.edu:1094</a> Server Read</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:06:10)</span> <b>bbockelm:</b></span> That smells like a DNS issue.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:06:20)</span> <b>bbockelm:</b></span> Is it possible that IPs changed at some point?<br/>
<span style="color: #53b759"><span style="font-size: small">(14:10:02)</span> <b>eric.appelt:</b></span> Hi Everyone - I'm just getting started again with CMS and trying to help with the Vanderbilt T2. I'm currently a systems administrator at the Vanderbilt Research Computing Cluster (ACCRE) of which the Vanderbilt T2 is a part. I was a post-doc in the CMS collaboration a number of years ago before leaving for private industry, and I'm very happy to be helping out again.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:10:42)</span> <b>andrew.melo:</b></span> Half and half - sed should be <a href="http://xrootd-vanderbilt.opensciencegrid.org">xrootd-vanderbilt.opensciencegrid.org</a><br/>
<span style="color: #53b759"><span style="font-size: small">(14:10:49)</span> <b>eric.appelt:</b></span> We had some misconfigured reverse DNS entries which may not have affected us until ~5-6 days ago when the SOAs for our records were updated.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:10:56)</span> <b>andrew.melo:</b></span> Nat2 should be xrootd1.accre.v.e<br/>
<span style="color: #53b759"><span style="font-size: small">(14:13:09)</span> <b>eric.appelt:</b></span> <a href="http://xrootd1.accre.vanderbilt.edu">xrootd1.accre.vanderbilt.edu</a> is a new machine which we provisioned, and in the initial provisioning the external network interface was misconfigured, so when the xrootd service was initially started it appeared to be routed through our network address translation server (<a href="http://nat2.accre.vanderbilt.edu">nat2.accre.vanderbilt.edu</a>)<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:15:58)</span> <b>bockjoo:</b></span> I am not sure if it is related but <a href="http://sed.accre.vanderbilt.edu">sed.accre.vanderbilt.edu</a> is also 129.59.197.113. As a result, HC is not happy.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:16:56)</span> <b>bbockelm:</b></span> So, xrootd often indefinitely caches name lookups.  Assuming you've already restarted the <tt>cmsd</tt> on the problematic machine once, it might clear up by bouncing the redirector at FNAL.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:17:28)</span> <b>andrew.melo:</b></span> Sed is the hostname from before when OSG (generously) issued us some temporary certs while we waited on digicert to get their shit together<br/>
<span style="color: #53b759"><span style="font-size: small">(14:19:34)</span> <b>eric.appelt:</b></span> We just corrected the reverse DNS record for 129.59.197.113 to point to <a href="http://xrootd-vanderbilt.opensciencegrid.org">xrootd-vanderbilt.opensciencegrid.org</a> instead of sed this morning, so that may still be propagating<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:20:15)</span> <b>bockjoo:</b></span> OK. that's something else then.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:31:15)</span> <b>bbockelm:</b></span> Yeah - I would suggest filing a ticket and asking Yujun to bounce the cmsd at the FNAL end.<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:31:32)</span> <b>bockjoo:</b></span> @jthiltges For some reason, <a href="http://cms-xrd-global.cern.ch">cms-xrd-global.cern.ch</a> is not picking up <a href="http://xrootd.unl.edu">xrootd.unl.edu</a>.<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:31:56)</span> <b>bockjoo:</b></span> It always picks up <a href="http://cmsxrootd2.fnal.gov">cmsxrootd2.fnal.gov</a><br/>
<span style="color: #7d414c"><span style="font-size: small">(14:32:21)</span> <b>bockjoo:</b></span> I guess it's Yujun's ball.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:33:44)</span> <b>jthiltges:</b></span> My hazy memory is that the behavior of seeing a single regional redirector on the global redirector is normal. But @marian would probably know for sure.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:34:30)</span> <b>andrew.melo:</b></span> Ironically, the Sam tests use an older version of the client that doesn't complain about the dns mappings vein correct<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:36:48)</span> <b>bockjoo:</b></span> On top of that, SAM does not complain xrootd-access error on your ce1 (test #5) and call it success.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:39:27)</span> <b>jthiltges:</b></span> Comments from Andrew Hanushevsky in an email thread from a couple years ago where we were wondering about this behavior:<br/><br/>&gt; Now, say you have two redirectors and each connects to a meta-manager (assume it's not replicated). From the meta-manager's perspective, since it knows both are replicas of each other it can pick either one to talk to. So, it chooses one to be the primary manager and the other is placed in stand-by mode and designated as the alternate. So, all requests always go to the primary until the primary fails. If that happens, the secondary is made the primary. Why do it this way? Because it's the simplest solution and avoids a lot of recovery logic should you have two active (i.e. primary) redirectors. Is it the best way of doing it. Frankly, no; it's not the best in terms of load sharing. However, it is a robust and simple solution; especially should the meta-manager be replicated as well.<br/><br/>&gt; 1) Why doesn't xrdmapc show both meta-manager subscriptions?<br/>&gt; Because it was designed that way. A secondary manager subscription is considered a "hidden" subscription. So, the meta-manager doesn't reveal it. It's just something it can use should the primary fail. I agree, that produces a misleading display and would make you worry. I can see what I can do to solve that issue. However, it's not that simple as one has to consider all the side-effects to other applications that query subscriptions.<br/>
<span style="color: #53b759"><span style="font-size: small">(14:41:40)</span> <b>marian:</b></span> Yujun is on the HN thread, I'll reply again asking him to bounce cmsd(s) on FNAL redirectors<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:52:30)</span> <b>bockjoo:</b></span> @jthiltges Thanks! Very good to know!<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:09:26)</span> <b>bockjoo:</b></span> global redirector now sees <a href="http://xrootd1.accre.vanderbilt.edu">xrootd1.accre.vanderbilt.edu</a> but it's only because of "Andy's phenomenon" as @jthiltges quoted above unl redirector is now the one on global redirector. <a href="http://cmsxrootd2.fnal.gov">cmsxrootd2.fnal.gov</a> still sees nat2 instead of xrootd1. But until redirector fails back to <a href="http://cmxrootd2.fnal.gov">cmxrootd2.fnal.gov</a>, things should be OK, I guess. cmsd on site1 should be restarted for cmsxrootd2.<br/>
</body>
</html>
