<!DOCTYPE html>
<html>
<head>
<title>Thu May 2, 2019 : #uscms (osg)</title>
</head>
<body>
<h3>Thu May 2, 2019 : #uscms (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(10:09:25)</span> <b>bbockelm:</b></span> set the channel description: Discussions about UCSMS sites<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:09:54)</span> <b>bbockelm:</b></span> set the channel topic: Public forum for discussing CMS site topics<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:10:51)</span> <b>bbockelm:</b></span> Hi all - after trying to find people this morning across multiple Slack instances and communication types, I decided to create a new channel for USCMS folks.<br/>
<span style="color: #d1707d"><span style="font-size: small">(10:11:12)</span> <b>gattebury:</b></span> :thumbsup:  â€¦ a few of us mentioned doing this a while back, but obviously forgot!<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:11:30)</span> <b>bbockelm:</b></span> I invited a random smattering of T2 people; it's an open channel so feel free to invite additional folks.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:30:35)</span> <b>bbockelm:</b></span> @clundstedt - in terms of debugging HTTPS transfers, I think we have all the usual suspects here.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:30:42)</span> <b>bbockelm:</b></span> and even a few more like @ajit<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:40:41)</span> <b>bbockelm:</b></span> <a href="https://fts3-devel.cern.ch:8449/fts3/ftsmon/#/jobs?source_se=&amp;dest_se=davs:%2F%2Fxrootd-local.unl.edu&amp;time_window=4">https://fts3-devel.cern.ch:8449/fts3/ftsmon/#/jobs?source_se=&amp;dest_se=davs:%2F%2Fxrootd-local.unl.edu&amp;time_window=4</a> fwiw, here's the filter we're hoping will ... eventually ... go green.<br/>
<span style="color: #e06b56"><span style="font-size: small">(10:48:01)</span> <b>jthiltges:</b></span> I wish they'd stick to UTC time. The status page is in UTC, while the FTS logs are +0200. Makes log comparisons more tedious.<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:59:52)</span> <b>andrew.melo:</b></span> I wish *we* stuck to UTC time...<br/>
<span style="color: #7d414c"><span style="font-size: small">(11:08:05)</span> <b>bockjoo:</b></span> Is there any way that I can generate expiring host certificate in 6 hours? I asked InCommon cert from my Research Computing. They are slow. Otherwise, I have to change my redirector.<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:23:30)</span> <b>bbockelm:</b></span> No, unfortunately, there's not much you can do.<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:23:46)</span> <b>bbockelm:</b></span> (other than finding out where there office is and walk into it in the next 6 hours)<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:28:08)</span> <b>bockjoo:</b></span> @bbockelm Does this cert generate look correct to you?<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:28:24)</span> <b>bockjoo:</b></span> osg-cert-request --hostname <a href="http://cmsio.rc.ufl.edu">cmsio.rc.ufl.edu</a> --country US<br/>--state Florida --locality Gainesville --organization 'UF Research Computing'<br/>--altname <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> --altname <a href="http://cslrm.rc.ufl.edu">cslrm.rc.ufl.edu</a> --altname <a href="http://osg.rc.ufl.edu">osg.rc.ufl.edu</a><br/>--altname <a href="http://cmsio3.rc.ufl.edu">cmsio3.rc.ufl.edu</a> --altname <a href="http://cmsio4.rc.ufl.edu">cmsio4.rc.ufl.edu</a> --altname<br/><a href="http://cmsio5.rc.ufl.edu">cmsio5.rc.ufl.edu</a> --altname <a href="http://cmsio6.rc.ufl.edu">cmsio6.rc.ufl.edu</a> --altname <a href="http://cmsio7.rc.ufl.edu">cmsio7.rc.ufl.edu</a><br/>--altname <a href="http://cmsio8.rc.ufl.edu">cmsio8.rc.ufl.edu</a> --altname <a href="http://cmsio9.rc.ufl.edu">cmsio9.rc.ufl.edu</a> --altname<br/><a href="http://cmsio10.rc.ufl.edu">cmsio10.rc.ufl.edu</a><br/>
<span style="color: #7d414c"><span style="font-size: small">(13:28:48)</span> <b>bockjoo:</b></span> It creats one certificate for all hosts, hostnames as SAN.<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:29:22)</span> <b>bockjoo:</b></span> Our RC looked your doc and executed this command.<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:30:05)</span> <b>bockjoo:</b></span> <a href="https://urldefense.proofpoint.com/v2/url?u=https-3A__bbockelm.github.io_docs_security_host-2Dcerts_-23requesting-2Dincommon-2Digtf-2Dhost-2Dcertificates&amp;d=DwMFaQ&amp;c=sJ6xIWYx-zLMB3EPkvcnVg&amp;r=bGB50D2-lkBP49NmP8_8-m3qpgwoAI53tQ2XWUDib48&amp;m=HEMCn4_kRWOoKa_K_0MwW7R-gC26N4kYEc77eG1K8AA&amp;s=u1sHS0xdVyGVk_Ev9TSJNSmJqzvhv99jHAxNNyN6FPU&amp;e=">https://urldefense.proofpoint.com/v2/url?u=https-3A__bbockelm.github.io_docs_security_host-2Dcerts_-23requesting-2Dincommon-2Digtf-2Dhost-2Dcertificates&amp;d=DwMFaQ&amp;c=sJ6xIWYx-zLMB3EPkvcnVg&amp;r=bGB50D2-lkBP49NmP8_8-m3qpgwoAI53tQ2XWUDib48&amp;m=HEMCn4_kRWOoKa_K_0MwW7R-gC26N4kYEc77eG1K8AA&amp;s=u1sHS0xdVyGVk_Ev9TSJNSmJqzvhv99jHAxNNyN6FPU&amp;e=</a><br/>
<span style="color: #7d414c"><span style="font-size: small">(13:40:21)</span> <b>bockjoo:</b></span> The command created a crippled certificate:<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:40:28)</span> <b>bockjoo:</b></span> openssl x509 -in  igtf/cmsio_rc_ufl_edu_cert.cer -noout -subject<br/>subject= /DC=org/DC=incommon/C=US/ST=FL/L=Gainesville/O=University of Florida/OU=High Performance Computing Center/CN=<a href="http://cmsio.rc.ufl.edu">cmsio.rc.ufl.edu</a><br/>which is expected<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:40:44)</span> <b>bockjoo:</b></span> openssl x509 -in  igtf/cmsio_rc_ufl_edu_cert.cer -noout -text | grep -A 1 "X509v3 Subject Alternative Name:"<br/>            X509v3 Subject Alternative Name:<br/>                DNS:<a href="http://cmsio.rc.ufl.edu">cmsio.rc.ufl.edu</a><br/>which is unexpected<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:40:49)</span> <b>bockjoo:</b></span> I was expecting<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:41:14)</span> <b>bockjoo:</b></span> X509v3 Subject Alternative Name:<br/>               DNS:<a href="http://cmsio.rc.ufl.edu">cmsio.rc.ufl.edu</a>, DNS:<a href="http://cmsio5.rc.ufl.edu">cmsio5.rc.ufl.edu</a>, DNS:<a href="http://cmsio6.rc.ufl.edu">cmsio6.rc.ufl.edu</a>, ......<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:45:39)</span> <b>bbockelm:</b></span> FYI - here's the correct doc link: <a href="https://opensciencegrid.org/docs/security/host-certs/#requesting-incommon-igtf-host-certificates">https://opensciencegrid.org/docs/security/host-certs/#requesting-incommon-igtf-host-certificates</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(13:46:04)</span> <b>bbockelm:</b></span> however, your usage looks correct.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:46:11)</span> <b>bbockelm:</b></span> Do you still have the CSR around?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:46:26)</span> <b>bbockelm:</b></span> The <tt>&lt;HOSTNAME&gt;.req</tt> file, that is<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:47:32)</span> <b>bockjoo:</b></span> I have<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:48:09)</span> <b>bbockelm:</b></span> The contents are public (no private key in it - private key should be <tt>&lt;HOSTNAME&gt;-key.pem</tt>).  Can you post them here?<br/>
<span style="color: #7d414c"><span style="font-size: small">(13:49:08)</span> <b>bockjoo:</b></span> -----BEGIN CERTIFICATE REQUEST-----<br/>MIIDpjCCAo4CAQAwcDEZMBcGA1UEAwwQY21zaW8ucmMudWZsLmVkdTELMAkGA1UE<br/>BhMCVVMxEDAOBgNVBAgMB0Zsb3JpZGExFDASBgNVBAcMC0dhaW5lc3ZpbGxlMR4w<br/>HAYDVQQKDBVVRiBSZXNlYXJjaCBDb21wdXRpbmcwggEiMA0GCSqGSIb3DQEBAQUA<br/>A4IBDwAwggEKAoIBAQDabMxiJKkPA3cnUst8zG8uOvhgZrdAKVOt0wj2D8YjShz9<br/>fjQBEL6d+40urKxkEipP/Ah0ToWxUo8I34Rp3xG7fGdEJ0VVEohMXxDoB9nQslgF<br/>MRoUtE38SYnGHWFH3GE8cxv2fOHiRHbuZVCVk+xEO9X8G4e3KvCoXH9I3O5kVlsM<br/>zw3g71TgQ1xo0wxQlaswP4SZXT/AlfLq7LcEFYGC+LTI965z1h21tnvUvY8mxQll<br/>ZIlpBlJyZxlOjdTJlOdvPo7E4T7+2iE0h5w/YYqq+yXwMLzWcmMtNSqUrCANm04G<br/>CMjQwRBunkYfWOq/0WYE5Hu8mk2ZwmXDl83B7suFAgMBAAGggfAwge0GCSqGSIb3<br/>DQEJDjGB3zCB3DCB2QYDVR0RAQH/BIHOMIHLgg5jbXMucmMudWZsLmVkdYIQY3Ns<br/>cm0ucmMudWZsLmVkdYIOb3NnLnJjLnVmbC5lZHWCEWNtc2lvMy5yYy51ZmwuZWR1<br/>ghFjbXNpbzQucmMudWZsLmVkdYIRY21zaW81LnJjLnVmbC5lZHWCEWNtc2lvNi5y<br/>Yy51ZmwuZWR1ghFjbXNpbzcucmMudWZsLmVkdYIRY21zaW84LnJjLnVmbC5lZHWC<br/>EWNtc2lvOS5yYy51ZmwuZWR1ghJjbXNpbzEwLnJjLnVmbC5lZHUwDQYJKoZIhvcN<br/>AQELBQADggEBAHSg10FZsxWqKihJAAqMXukLHZoUADw3+pAV2S+JV//9uHfUwmYF<br/>8qG9BFNQWTlfSVWPa2TpVwHtNx2Vbi/3t9vSPu5hzrsOThjiGFVwB8qEvj2LDKlj<br/>SQzFncIVzzFVjtR8FhErOXfyBzbV5aPQFk0WS6XPTfyqD+w3P/+6czjk8zC/trLq<br/>dcQFaSr1n4qcuY90mj2TIDgxssgb/ovnYx7TRkYslAM03XV27R2QA8/bBowOZ46w<br/>Wa+q1vJIkPbJ9yUvWPGySsgIzUGZ01wQBPe704BH+i9C1YZl0U7ag2xIkiBeZGg3<br/>1pLpKxw2QJuerhK4O7112wVKmHRw59Fri90=<br/>-----END CERTIFICATE REQUEST-----<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:53:08)</span> <b>bbockelm:</b></span> thanks!  Give me a second to recall how to parse this.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:54:39)</span> <b>bbockelm:</b></span> Ah, here we go:<br/><pre><br/>$ openssl req -in /tmp/bar2 -noout -text<br/>Certificate Request:<br/>    Data:<br/>        Version: 0 (0x0)<br/>        Subject: CN=<a href="http://cmsio.rc.ufl.edu">cmsio.rc.ufl.edu</a>, C=US, ST=Florida, L=Gainesville, O=UF Research Computing<br/>        Subject Public Key Info:<br/>            Public Key Algorithm: rsaEncryption<br/>                Public-Key: (2048 bit)<br/>                Modulus:<br/>                    00:da:6c:cc:62:24:a9:0f:03:77:27:52:cb:7c:cc:<br/> &lt;snip/&gt;<br/>                Exponent: 65537 (0x10001)<br/>        Attributes:<br/>        Requested Extensions:<br/>            X509v3 Subject Alternative Name: critical<br/>                DNS:<a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a>, DNS:<a href="http://cslrm.rc.ufl.edu">cslrm.rc.ufl.edu</a>, DNS:<a href="http://osg.rc.ufl.edu">osg.rc.ufl.edu</a>, DNS:<a href="http://cmsio3.rc.ufl.edu">cmsio3.rc.ufl.edu</a>, DNS:<a href="http://cmsio4.rc.ufl.edu">cmsio4.rc.ufl.edu</a>, DNS:<a href="http://cmsio5.rc.ufl.edu">cmsio5.rc.ufl.edu</a>, DNS:<a href="http://cmsio6.rc.ufl.edu">cmsio6.rc.ufl.edu</a>, DNS:<a href="http://cmsio7.rc.ufl.edu">cmsio7.rc.ufl.edu</a>, DNS:<a href="http://cmsio8.rc.ufl.edu">cmsio8.rc.ufl.edu</a>, DNS:<a href="http://cmsio9.rc.ufl.edu">cmsio9.rc.ufl.edu</a>, DNS:<a href="http://cmsio10.rc.ufl.edu">cmsio10.rc.ufl.edu</a><br/>    Signature Algorithm: sha256WithRSAEncryption<br/>         74:a0:d7:41:59:b3:15:aa:2a:28:49:00:0a:8c:5e:e9:0b:1d:<br/> &lt;snip/&gt;<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(13:54:53)</span> <b>bbockelm:</b></span> So the request looks correct but what came back is incorrect.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:55:17)</span> <b>bbockelm:</b></span> So the problem may be on the research computing side.<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:00:21)</span> <b>bockjoo:</b></span> Last year, with a single host with one SAN, it worked. But I don't know how the guy did it.<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:24:40)</span> <b>bockjoo:</b></span> OK. Got the one with the correct SANs.<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:27:38)</span> <b>bockjoo:</b></span> But gridftp load balance always pick the host with the new certificate. For example, I have 5 gridftp servers. 1 of them has the conglomerate SAN host certificate, the others not. client always pick the one with the conglomerate SAN host certificate. Bad English?<br/>
<span style="color: #7d414c"><span style="font-size: small">(14:28:35)</span> <b>bockjoo:</b></span> Nevermind! It picks fairly.<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:50:05)</span> <b>bbockelm:</b></span> happy to help!<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:50:36)</span> <b>bbockelm:</b></span> @bockjoo - you are on XRootD 4.9.1, right?  Do you have SciTokens and Macaroons enabled?  Can you start exporting the <tt>davs</tt> protocol via PhEDEx<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:01:31)</span> <b>bbockelm:</b></span> ah, I see there's already a transfer tried:<br/><pre><br/>DEBUG   Thu, 02 May 2019 22:39:12 +0200; Davix: &gt; HEAD /store/PhEDEx_LoadTest07/LoadTest07_Debug_US_Florida/US_Nebraska/453/LoadTest07_Florida_7A_9BUHUdHYJL9mmqnG_453 HTTP/1.1<br/>&gt; User-Agent: fts_url_copy/3.9.0 gfal2/2.16.3 neon/0.0.29<br/>&gt; Keep-Alive: <br/>&gt; Connection: Keep-Alive<br/>&gt; TE: trailers<br/>&gt; Host: <a href="http://cmsio7.rc.ufl.edu:1094">cmsio7.rc.ufl.edu:1094</a><br/>&gt; Want-Digest: ADLER32<br/>&gt; Authorization: Bearer MDAxYmxvY2F0aW9uIFQyX1VTX0Zsb3JpZGEKMDAzNGlkZW50aWZpZXIgODRlM2MyY2MtNDM4Yy00OWI4LThlMWYtMDVkMTQzNmE3ZDUxCjAw.....andmore<br/>&gt; ClientInfo: job-id=549cf448-6d1a-11e9-b884-fa163e044255;file-id=8774616258;retry=0<br/>&gt; <br/></pre><br/><br/>responds with:<br/><br/><pre><br/>DEBUG   Thu, 02 May 2019 22:39:13 +0200; Davix: &lt; HTTP/1.1 405 Method Not Allowed<br/>DEBUG   Thu, 02 May 2019 22:39:13 +0200; Davix: &lt; Connection: Close<br/>DEBUG   Thu, 02 May 2019 22:39:13 +0200; Davix: &lt; Content-Length: 0<br/>DEBUG   Thu, 02 May 2019 22:39:13 +0200; Davix: &lt; <br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:04:26)</span> <b>bbockelm:</b></span> ah - it's the <tt>ADLER32</tt> request!<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:05:37)</span> <b>bbockelm:</b></span> @justas.balcas - you have the same thing.  For HDFS, you should add:<br/><pre><br/>xrootd.chksum max 2 md5 adler32 crc32<br/>ofs.ckslib * /usr/lib64/libXrdHdfs.so<br/></pre><br/><br/>For Florida, I think you can just skip the <tt>ofs.ckslib</tt> line.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:07:07)</span> <b>bbockelm:</b></span> @andrew.melo - any chance you could also export <tt>davs</tt> from Vandy?<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:08:27)</span> <b>andrew.melo:</b></span> Come again?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:10:42)</span> <b>bbockelm:</b></span> What version of Xrootd are you running?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:11:35)</span> <b>bbockelm:</b></span> <a href="https://twiki.cern.ch/twiki/bin/view/Main/XRootDoverHTTP">https://twiki.cern.ch/twiki/bin/view/Main/XRootDoverHTTP</a> if it's 4.9.1, you should be able to enable pieces I need to do PhEDEx transfers via HTTPS.<br/>
<span style="color: #de5f24"><span style="font-size: small">(16:27:54)</span> <b>justas.balcas:</b></span> @bbockelm checksum configs are in place<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:30:00)</span> <b>andrew.melo:</b></span> AFAIK I have it enabled -- our local sysadmin is being a total dick because the TLS ciphers aren't what he wants<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:30:38)</span> <b>andrew.melo:</b></span> (I'm in Brasilia visiting family but if there's a config option you want, I can smash that into our config management)<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:31:35)</span> <b>andrew.melo:</b></span> Oh wait, I fo sure didn't enable writing yet<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:32:10)</span> <b>andrew.melo:</b></span> The performance for fuse is .. not great, so I need to find out how to write a plugin<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:33:30)</span> <b>bbockelm:</b></span> ah - there's a way to set the TLS settings if you'd like.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:33:45)</span> <b>bbockelm:</b></span> Melo, we can bring it up after you get home<br/>
<span style="color: #7d414c"><span style="font-size: small">(16:40:14)</span> <b>bockjoo:</b></span> ${bockjoo@ala:~} gfal-copy -f -K ADLER32 treecopier.py <a href="davs://cmsio10.rc.ufl.edu:1094//store/temp/user/bockjoo/treecopier.py">davs://cmsio10.rc.ufl.edu:1094//store/temp/user/bockjoo/treecopier.py</a><br/>Copying file:///home/bockjoo/treecopier.py   [FAILED]  after 0s<br/>gfal-copy error: 5 (Input/output error) - DESTINATION CHECKSUM HTTP 500 : Unexpected server error: 500<br/>
<span style="color: #7d414c"><span style="font-size: small">(16:40:30)</span> <b>bockjoo:</b></span> 190502 17:39:26 14101 ofs_chksum: cms0019.762:43@alachua.ihepa.ufl.edu Unable to checksum /cms/data/store/temp/user/bockjoo/treecopier.py; operation not supported<br/>
<span style="color: #7d414c"><span style="font-size: small">(16:43:41)</span> <b>bockjoo:</b></span> 190502 17:39:26 14101 ofs_FAttr: Unable to get attr XrdCks.adler32 from /cms/data/store/temp/user/bockjoo/treecopier.py; operation not supported<br/>is the one eariler message in the xrootd log<br/>
<span style="color: #7d414c"><span style="font-size: small">(18:12:16)</span> <b>bockjoo:</b></span> Can somebody run this command for me?<br/>
<span style="color: #7d414c"><span style="font-size: small">(18:12:20)</span> <b>bockjoo:</b></span> xrdfs <a href="http://cmsio5.rc.ufl.edu:1094">cmsio5.rc.ufl.edu:1094</a> query config version<br/>
<span style="color: #7d414c"><span style="font-size: small">(18:50:39)</span> <b>bockjoo:</b></span> @bbockelm I installed the IGTF InCommon hostcert with the conglomerate SANs to cover all the hosts on <a href="http://cmsio5.rc.ufl.edu">cmsio5.rc.ufl.edu</a>. The certificate works for gridftp and xrootd in general with the full pledged proxy, but SAM test xrootd access fails on cmsio5. I guess the SAM test proxy is the one delegated multiple-times.<br/>
<span style="color: #9e3997"><span style="font-size: small">(20:33:33)</span> <b>bbockelm:</b></span> Ah - there's a Gotcha there: only the very newest XRootD clients can do SANs.<br/>
<span style="color: #a72f79"><span style="font-size: small">(21:12:18)</span> <b>andrew.melo:</b></span> Can I do something like name all my xrootd hosts the same? <br/>
<span style="color: #7d414c"><span style="font-size: small">(23:33:38)</span> <b>bockjoo:</b></span> @bbockelm Do you have any idea how to fix the davs issue?<br/>
</body>
</html>
