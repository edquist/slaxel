<!DOCTYPE html>
<html>
<head>
<title>Tue Oct 29, 2019 : #uscms (osg)</title>
</head>
<body>
<h3>Tue Oct 29, 2019 : #uscms (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(09:04:39)</span> <b>bockjoo:</b></span> @bbockelm This works :(base) [coldhead@oo ~]$ gfal-sum <a href="davs://cmsio6.rc.ufl.edu:1094//store/mc/test.root">davs://cmsio6.rc.ufl.edu:1094//store/mc/test.root</a> ADLER32<br/><a href="davs://cmsio6.rc.ufl.edu:1094//store/mc/test.root">davs://cmsio6.rc.ufl.edu:1094//store/mc/test.root</a> 9ecd7018<br/>but this does not : (base) [coldhead@oo ~]$ gfal-sum <a href="davs://cmsio6.rc.ufl.edu:1094/store/cmsuf_test/test_gfal_sum.root">davs://cmsio6.rc.ufl.edu:1094/store/cmsuf_test/test_gfal_sum.root</a> ADLER32<br/>gfal-sum error: 1 (Operation not permitted) - HTTP 403 : Permission refused<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:00:31)</span> <b>bockjoo:</b></span> (base) [coldhead@oo ~]$ gfal-sum <a href="gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root">gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root</a> ADLER32<br/><a href="gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root">gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root</a> 9ecd7018<br/>is fine, though.<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:02:45)</span> <b>bockjoo:</b></span> gfal-sum <a href="root://cmsio6.rc.ufl.edu//store/mc/test.root">root://cmsio6.rc.ufl.edu//store/mc/test.root</a> ADLER32<br/><a href="root://cmsio6.rc.ufl.edu//store/mc/test.root">root://cmsio6.rc.ufl.edu//store/mc/test.root</a> 9ecd7018<br/>and<br/>gfal-sum <a href="gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root">gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root</a> ADLER32<br/><a href="gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root">gsiftp://cmsio6.rc.ufl.edu/cmsuf/test/test_gfal_sum.root</a> 9ecd7018<br/>are fine, though.<br/>For some reason, davs protocol is messed up.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:20:17)</span> <b>bbockelm:</b></span> I can't imagine that being anything but a bug.  Do you know how to reproduce with <tt>curl</tt>?<br/>
<blockquote>
<span style="color: #7d414c"><span style="font-size: small">(2019-10-30 18:18:51)</span> <b>bockjoo:</b></span> curl --verbose --connect-timeout 60 -D /tmp/tmp.o7pqMOQB8y -s -f -L --ipv4         --connect-to <a href="http://cmsio6.rc.ufl.edu:1094:128.227.221.223:1094">cmsio6.rc.ufl.edu:1094:128.227.221.223:1094</a> --capath /etc/grid-security/certificates         -H 'X-No-Delegate: true' --location-trusted --cacert $X509_USER_PROXY -E $X509_USER_PROXY         -H 'Credential: none' -m 180 -I -H 'Want-Digest: adler32' -o/dev/null <a href="https://cmsio6.rc.ufl.edu:1094//store/user/bockjoo/cmsuf/test.root">https://cmsio6.rc.ufl.edu:1094//store/user/bockjoo/cmsuf/test.root</a><br/>
<span style="color: #7d414c"><span style="font-size: small">(2019-10-30 18:19:17)</span> <b>bockjoo:</b></span> fails but this command works<br/>
<span style="color: #7d414c"><span style="font-size: small">(2019-10-30 18:19:32)</span> <b>bockjoo:</b></span> curl --verbose --connect-timeout 60 -D /tmp/tmp.o7pqMOQB8y -s -f -L --ipv4         --connect-to <a href="http://cmsio6.rc.ufl.edu:1094:128.227.221.223:1094">cmsio6.rc.ufl.edu:1094:128.227.221.223:1094</a> --capath /etc/grid-security/certificates         -H 'X-No-Delegate: true' --location-trusted --cacert $X509_USER_PROXY -E $X509_USER_PROXY         -H 'Credential: none' -m 180 -I -H 'Want-Digest: adler32' -o/dev/null <a href="https://cmsio6.rc.ufl.edu:1094//store/user/bockjoo/test.root">https://cmsio6.rc.ufl.edu:1094//store/user/bockjoo/test.root</a><br/>
<span style="color: #7d414c"><span style="font-size: small">(2019-10-30 18:20:43)</span> <b>bockjoo:</b></span> Note /store/user/bockjoo/cmsuf/test.root is mapped to the Lustre 2.5 and /store/user/bockjoo/test.root is mapped to the Lustre 1.9 (the current production)<br/>
</blockquote>
<span style="color: #7d414c"><span style="font-size: small">(10:23:23)</span> <b>bockjoo:</b></span> I am not sure if I understand you. Can you give me some hint for the curl command?<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:26:14)</span> <b>bockjoo:</b></span> By the way, /store/cmsuf_test is a new lustre: [root@cmsio6 ~]#  ls -al /cms/data/store/cmsuf_test<br/>lrwxrwxrwx 1 root root 11 Oct 29 09:36 /cms/data/store/cmsuf_test -&gt; /cmsuf/test<br/>[root@cmsio6 ~]#  ls  /cms/data/store/mc | head -1<br/>DMWM_Test<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:26:35)</span> <b>bockjoo:</b></span> But both /cms and /cmsuf are mounted with the same xattr option.<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:27:00)</span> <b>bockjoo:</b></span> /cms is lustre 1.9 and /cmsuf is lustre 2.5.<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:34:51)</span> <b>bockjoo:</b></span> If you mean smoke-test by curl, my smoke-test is failing with   failed to load '/etc/grid-security/certificates/DigiCertGridRootCA-Root.na<br/>mespaces' from CURLOPT_CAPATH<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:42:39)</span> <b>bockjoo:</b></span> In case of /store/mc/test.root, at the gfal-sum command, the xrootd log shows:<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:42:58)</span> <b>bockjoo:</b></span> 191029 16:39:11 6975 multiuser_UserSentry: No security entity object provided<br/>191029 16:39:11 6975 ofs_FAttr: Unable to set attr XrdCks.adler32 from /cms/data/store/mc/gnu3d.dem; permission denied<br/>But the client sees the checksum anyway<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:46:25)</span> <b>bockjoo:</b></span> In case of /store/mc/test_gfal_sum.root which is coming from /cmsuf is lustre 2.5, at the gfal-sum command, the xrootd log shows:<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:46:41)</span> <b>bockjoo:</b></span> 191029 16:46:29 6890 multiuser_UserSentry: No security entity object provided<br/>191029 16:46:29 6890 ofs_chksum: http Unable to checksum /cms/data/store/mc/test_gfal_sum.root; permission denied<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:47:13)</span> <b>bockjoo:</b></span> And the client sees "HTTP 403 : Permission refused" error.<br/>
<span style="color: #7d414c"><span style="font-size: small">(15:47:46)</span> <b>bockjoo:</b></span> I am not sure why ofs_chksum is called in the second case.<br/>
</body>
</html>
