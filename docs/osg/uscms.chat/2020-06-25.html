<!DOCTYPE html>
<html>
<head>
<title>Thu Jun 25, 2020 : #uscms (osg)</title>
</head>
<body>
<h3>Thu Jun 25, 2020 : #uscms (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(10:00:40)</span> <b>bbockelm:</b></span> @andrew.melo ^^^ yes!  That is 100% doable.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:02:00)</span> <b>bbockelm:</b></span> That's exactly what Condor-CE is -- and the HTCondor team wants to grow that use case.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:17:21)</span> <b>dweitzel:</b></span> This use case is used at Nebraska all the time.  We have users that want to use pegasus or dagman, but run on our SLURM cluster.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:17:47)</span> <b>dweitzel:</b></span> There's a lot of nifty knobs, of course.  For example, maximum number of jobs in the Slurm Queue (throttle submissions).<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:18:28)</span> <b>dweitzel:</b></span> You are looking for the "batch" grid_resource: <a href="https://htcondor.readthedocs.io/en/latest/grid-computing/grid-universe.html#the-batch-grid-type-for-pbs-lsf-sge-and-slurm">https://htcondor.readthedocs.io/en/latest/grid-computing/grid-universe.html#the-batch-grid-type-for-pbs-lsf-sge-and-slurm</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(10:23:23)</span> <b>andrew.melo:</b></span> OK, I'll look at that. My condor-fu is so weak that I didn't really know what I was looking for<br/>
<span style="color: #43761b"><span style="font-size: small">(10:55:04)</span> <b>blin:</b></span> hey guys, i'm doing a post mortem on the AddTrust Root CA expiration and i'm wondering if anyone remembers how issues with the IGTF 1.103 January update manifested<br/>
<span style="color: #43761b"><span style="font-size: small">(10:55:17)</span> <b>blin:</b></span> @dmason ^^<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:05:22)</span> <b>andrew.melo:</b></span> Vanderbilt has a cert that contained that CA in the chain, so when the change was pushed, nobody trusted us<br/>
<span style="color: #43761b"><span style="font-size: small">(11:07:17)</span> <b>blin:</b></span> was this when it expired last month?<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:07:31)</span> <b>andrew.melo:</b></span> No, January, I was the one of the ones who complained loudly<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:07:49)</span> <b>andrew.melo:</b></span> I presume you don't have access to CMS' hypernews system?<br/>
<span style="color: #bc3663"><span style="font-size: small">(11:10:07)</span> <b>dmason:</b></span> Yes — If this is the one I’m thinking of we saw in Vanderbilt, also started failing the FNAL FTS system, I think there were also factory auth errors.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:10:52)</span> <b>andrew.melo:</b></span> This is the initial message from me:<br/><pre>Approximately, 15 (?) hours ago, FTS transfers w/the RAL FTS server have started showing the following error consistently towards vanderbilt (and a lot of other sites' phedex quality dropped around that time)<br/><br/>Non recoverable error: [13] globus_ftp_control: gss_init_sec_context failed OpenSSL Error: s3_clnt.c:1188: in library: SSL routines, function SSL3_GET_SERVER_CERTIFICATE: certificate verify failed globus_gsi_callback_module: Could not verify credential globus_gsi_callback_module: Can't get the local trusted CA certificate: Untrusted self-signed certificate in chain with hash 157753a5 <br/><br/>This CA's hash appears to be in our distribution:<br/><br/>phedex@se1# openssl x509 -in /etc/grid-security/certificates/157753a5.0 -noout -text<br/>Certificate:<br/>    Data:<br/>        Version: 3 (0x2)<br/>        Serial Number: 1 (0x1)<br/>    Signature Algorithm: sha1WithRSAEncryption<br/>        Issuer: C=SE, O=AddTrust AB, OU=AddTrust External TTP Network, CN=AddTrust External CA Root<br/>        Validity<br/>            Not Before: May 30 10:48:38 2000 GMT<br/>            Not After : May 30 10:48:38 2020 GMT<br/>        Subject: C=SE, O=AddTrust AB, OU=AddTrust External TTP Network, CN=AddTrust External CA Root<br/><br/>But it appears that root CA is being phased out (note the expiration in may of this year):<br/><br/><a href="https://www.xolphin.com/support/Rootcertificates/Phasing_out_Addtrust_External_CA_Root_certificate">https://www.xolphin.com/support/Rootcertificates/Phasing_out_Addtrust_External_CA_Root_certificate</a><br/><br/>I don't claim to understand everything about x509, but does this claim that this CA can sign certs for the InCommon-issued certificates in the US?<br/><br/># tail -n 2 /etc/grid-security/certificates/157753a5.namespaces<br/>TO Issuer "/C=US/O=Internet2/OU=InCommon/CN=InCommon IGTF Server CA" \<br/>  PERMIT Subject "/DC=org/DC=incommon/.*"<br/><br/>Cheers<br/>Andrew</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:11:10)</span> <b>blin:</b></span> did you guys see any indication of the errors locally at the site or did you just figure this all out through central monitoring tools?<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:14:27)</span> <b>andrew.melo:</b></span> I have a page that periodically refreshes w/the "important" images about the health of the T2, when I noticed transfers failing, I investigated my local logs to get the details<br/>
<span style="color: #43761b"><span style="font-size: small">(11:16:20)</span> <b>blin:</b></span> this looks like a client error:<br/><pre>[13] globus_ftp_control: gss_init_sec_context failed OpenSSL Error: s3_clnt.c:1188: in library: SSL routines, function SSL3_GET_SERVER_CERTIFICATE: certificate verify failed globus_gsi_callback_module: Could not verify credential globus_gsi_callback_module: Can't get the local trusted CA certificate: Untrusted self-signed certificate in chain with hash 157753a5 </pre><br/>do you remember where you got that?<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:17:21)</span> <b>andrew.melo:</b></span> Gridftp log<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:17:36)</span> <b>andrew.melo:</b></span> Nope, FTS server llog<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:22:27)</span> <b>andrew.melo:</b></span> TBH, I think the IGTF really bungled it. Instead of in one stroke both changing the intermediate issuing CA for DigiCert and dropping AddTrust, the pain could have been avoided by first changing the chain and then 6 months (or whatever) later, dropping AddTrust.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:23:42)</span> <b>andrew.melo:</b></span> It's not that AddTrust was compromised, it was just expiring soon<br/>
<span style="color: #43761b"><span style="font-size: small">(11:23:50)</span> <b>blin:</b></span> yeah, it's been...painful<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:24:46)</span> <b>andrew.melo:</b></span> (it's also weird to me that the spec doesn't clearly state what to do if (CA)-&gt;(cert) the cert is valid longer than the CA)<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:26:26)</span> <b>andrew.melo:</b></span> ((well, it's x509, so I don't know why I'm so surprised))<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:26:42)</span> <b>andrew.melo:</b></span> On the upside, we should soon be free from x509 and igtf shenanigans :slightly_smiling_face:<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:28:39)</span> <b>jthiltges:</b></span> Even Comodo/Sectigo has struggled to get things right. (Expiring intermediates. Etc. Sigh.)<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:43:15)</span> <b>andrew.melo:</b></span> It's a bit different to struggle in an incredibly heterogenous customer base like comodo. Youd think that someone with a narrow user base like the IGTF could've done a better job<br/>
<span style="color: #7d414c"><span style="font-size: small">(11:57:25)</span> <b>bockjoo:</b></span> I don't have /etc/grid-security/certificates/01b5d333.0 anymore<br/>
<span style="color: #7d414c"><span style="font-size: small">(11:57:32)</span> <b>bockjoo:</b></span> I have<br/>
<span style="color: #7d414c"><span style="font-size: small">(11:57:55)</span> <b>bockjoo:</b></span> (base) [bockjoo@cms cvmfs]$ rpm -qf /etc/grid-security/certificates<br/>fetch-crl-3.0.19-1.el7.noarch<br/>osg-ca-certs-1.88-1.osg35.el7.noarch<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:58:26)</span> <b>jthiltges:</b></span> Got a Sectigo certificate in February with intermediates that expired in May. Their whole business is selling you access to prime numbers at exorbitant rates. And they still messed up. ¯\_(ツ)_/¯<br/>I do agree that IGTF could have done better, and heartily agree with your hope to be free from x509/IGTF shenanigans.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:58:26)</span> <b>andrew.melo:</b></span> Yeah, that's the point, @bockjoo :slightly_smiling_face:<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:59:13)</span> <b>andrew.melo:</b></span> Previously the CA bundle would chain some certs to 01b5d333, then they changed the chains and deleted 01b5d333<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:00:37)</span> <b>andrew.melo:</b></span> But for hosts who didn't update yet, they would send a 01b5d333-chained cert to hosts who no longer had 01b5d333 in their root-of-trust<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:01:45)</span> <b>andrew.melo:</b></span> @jthiltges I feel your pain. We don't have an InCommon sub @ Vanderbilt, so we've been buying them from DigiCert. For people who are running a business, they are terrible at taking my money<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:02:59)</span> <b>andrew.melo:</b></span> I got a nasty email from them saying an invoice from march was unpaid and they were gonna revoke the certs, etc... We told them we sent a PO out the very same day as the invoice and then they sheepishly said, "oh yeah, we somehow didn't notice that one"<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:40:15)</span> <b>bbockelm:</b></span> &gt;  TBH, I think the IGTF really bungled it. Instead of in one stroke both changing the intermediate issuing CA for DigiCert and dropping AddTrust, the pain could have been avoided by first changing the chain and then 6 months (or whatever) later, dropping AddTrust.<br/>@andrew.melo - that's actually how it can work for browsers because the browser community does it all the time.  I think IGTF learned an important lesson about what happens when people use OpenSSL and crappy Java libraries.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:56:03)</span> <b>andrew.melo:</b></span> In fairness, and I'm not one to defend Java, rejecting the certs was the right move -- after the update, the cert didn't chain to a root of trust<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:56:23)</span> <b>andrew.melo:</b></span> And, of course, they did the same thing 3 months later, w/o a ATTENTION EVERYONE notice<br/>
<span style="color: #43761b"><span style="font-size: small">(14:59:54)</span> <b>blin:</b></span> tbf, sending an announcement was OSG's responsibility and we dropped the ball<br/>
<span style="color: #43761b"><span style="font-size: small">(15:00:51)</span> <b>blin:</b></span> though i don't think an announcement would have really helped, only expiration really teased out the "oh crap, i forgot about this part of the infrastructure" cases<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:01:25)</span> <b>andrew.melo:</b></span> I ~wouldn't~ don't blame the OSG ... even if OSG held back on pushing the CA update to their local repos to give enough time for the admins to have a heads up, if the european sites picked up the IGTF cert bundle through whatever process they use, then things break the same way<br/>
<span style="color: #43761b"><span style="font-size: small">(15:02:49)</span> <b>blin:</b></span> true<br/>
<span style="color: #43761b"><span style="font-size: small">(15:03:27)</span> <b>blin:</b></span> we didn't really see that, though, did we? did the europeans hold off or did they move off of el6?<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:08:16)</span> <b>andrew.melo:</b></span> When they re-did the update, it broke the same way. And I feel like it was some particularly inconvenient time for me to rush to a terminal to pull the certs<br/>
<span style="color: #43761b"><span style="font-size: small">(16:26:27)</span> <b>blin:</b></span> oh i missed that :anguished:<br/>
</body>
</html>
