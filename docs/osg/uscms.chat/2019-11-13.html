<!DOCTYPE html>
<html>
<head>
<title>Wed Nov 13, 2019 : #uscms (osg)</title>
</head>
<body>
<h3>Wed Nov 13, 2019 : #uscms (osg)</h3>
<span style="color: #a72f79"><span style="font-size: small">(09:59:03)</span> <b>andrew.melo:</b></span> OK, so I've spent some time trying to figure out what permutation of DNS entries is needed to have multiple xrootd hosts be accessible via the same certificate. I landed on the following (where xrootd1/2 are the hosts and <a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a> is the DNS alias). I landed on the following<br/><br/><pre><br/>[root@xrootd2 ~]# dig +short <a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a><br/>129.59.197.97<br/>129.59.197.94<br/>[root@xrootd2 ~]# dig +short <a href="http://xrootd1.accre.vanderbilt.edu">xrootd1.accre.vanderbilt.edu</a><br/>129.59.197.97<br/>[root@xrootd2 ~]# dig +short <a href="http://xrootd2.accre.vanderbilt.edu">xrootd2.accre.vanderbilt.edu</a><br/>129.59.197.94<br/>[root@xrootd2 ~]# dig +short -x 129.59.197.97<br/><a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a>.<br/>[root@xrootd2 ~]# dig +short -x 129.59.197.94<br/><a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a>.<br/></pre><br/><br/>I've got the following servers running<br/><pre><br/>xrootd2.a.v.e:<br/>1094 - redirector<br/>1095 - server connected to FUSE<br/>1096 - server connected using xrootd plugin<br/><br/>xrootd1.a.v.e<br/>1094 - Redirect TCP connections to xrootd2 w/ <tt>ncat -v -k -l 0.0.0.0 1094 --sh-exec "ncat <a href="http://xrootd2.accre.vanderbilt.edu">xrootd2.accre.vanderbilt.edu</a> 1094"</tt> (I'd like to add a second redirector here)<br/>1095 - server connected to FUSE<br/>1096 - server connected using xrootd plugin<br/></pre><br/><br/>It appears, though, that xrootd is using some version of forward/reverse DNS resolution to divine out its publically accessible address(es), so I'm not sure I have things configured right. I guess I have 2 Qs, A) is there a way to say "this is your external IP"? and B) is xrootd internally passing around the IP or the hostname? I'm a bit confused by this:<br/><br/><pre><br/>xrdmapc --list all <a href="http://xrootd.accre.vanderbilt.edu:1094">xrootd.accre.vanderbilt.edu:1094</a><br/>0**** <a href="http://xrootd.accre.vanderbilt.edu:1094">xrootd.accre.vanderbilt.edu:1094</a><br/>      Srv <a href="http://xrootd.accre.vanderbilt.edu:1095">xrootd.accre.vanderbilt.edu:1095</a><br/>      Srv <a href="http://xrootd.accre.vanderbilt.edu:1096">xrootd.accre.vanderbilt.edu:1096</a><br/>      Srv <a href="http://xrootd.accre.vanderbilt.edu:1096">xrootd.accre.vanderbilt.edu:1096</a><br/>      Srv <a href="http://xrootd.accre.vanderbilt.edu:1095">xrootd.accre.vanderbilt.edu:1095</a><br/><br/>xrd <a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a> locateall /store/testmelo3252019<br/>Note: this tool is DEPRECATED, use xrdfs instead.<br/><br/>------------- Location #1<br/>InfoType: kXrdcLocDataServer<br/>CanWrite: true<br/>Location: '129.59.197.94:1095'<br/><br/><br/>------------- Location #2<br/>InfoType: kXrdcLocDataServer<br/>CanWrite: true<br/>Location: '129.59.197.94:1096'<br/><br/><br/>------------- Location #3<br/>InfoType: kXrdcLocDataServer<br/>CanWrite: true<br/>Location: '129.59.197.94:1096'<br/><br/><br/>------------- Location #4<br/>InfoType: kXrdcLocDataServer<br/>CanWrite: true<br/>Location: '129.59.197.94:1095'<br/><br/></pre><br/><br/>(originally posted to the software channel by mistake)<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:07:11)</span> <b>bbockelm:</b></span> ah - I think that might do it!<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:07:49)</span> <b>bbockelm:</b></span> (with respect to GSI)<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:08:33)</span> <b>andrew.melo:</b></span> I'm receiving connections to both hosts, so that's good<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:08:55)</span> <b>bbockelm:</b></span> I think I'd have to look at the output of <tt>xrdcp</tt> to see if it responds with hosts or IPs.  The protocol allows both (and different implementations do different things).<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:09:02)</span> <b>andrew.melo:</b></span> (e.g.) <a href="https://graphite.accre.vanderbilt.edu/dashboard/#lfs-xrootd">https://graphite.accre.vanderbilt.edu/dashboard/#lfs-xrootd</a> ...<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:09:04)</span> <b>bbockelm:</b></span> My impression was SLAC Xrootd did hostnames.<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:10:22)</span> <b>andrew.melo:</b></span> I think (?) hostname is OK because the client will RR the various DNS entries?<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:11:30)</span> <b>andrew.melo:</b></span> but <tt>xrd locateall</tt> is concerning, I'd like to add many more (non-redirecting) xrootd hosts, but if it's passing down just a single IP, then that's not what I want<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:13:06)</span> <b>andrew.melo:</b></span> FWIW, I also get the following<br/><pre><br/>------ <a href="mailto:redirector@xrootd2.accre.vanderbilt.edu">redirector@xrootd2.accre.vanderbilt.edu</a> phase 2 manager initialization completed.<br/>191113 08:51:02 14429 Start: Waiting for primary server to login.<br/>------ cmsd <a href="mailto:redirector@xrootd2.accre.vanderbilt.edu">redirector@xrootd2.accre.vanderbilt.edu</a>:1213 initialization completed.<br/>191113 08:51:02 14439 do_Login:: Primary server 14398 logged in; data port is 1094<br/>Config Connecting to 2 managers and 1 site.<br/>191113 08:51:02 14412 XrdSetIF: Skipping duplicate public interface [::129.59.197.97]<br/>191113 08:51:02 14412 Protocol: redirector.14398:23@xrootd logged in.<br/>191113 08:51:02 14433 Protocol: Logged into T1_US_FNAL <a href="http://cmsxrootd2.fnal.gov">cmsxrootd2.fnal.gov</a><br/>191113 08:51:02 14441 ManTree: Now connected to 2 root node(s)<br/>191113 08:51:02 14441 Protocol: Logged into US-Regional-Nebraska <a href="http://xrootd.unl.edu">xrootd.unl.edu</a><br/>191113 08:51:03 14410 Config: manager service enabled.<br/>191113 08:51:03 14440 State: Status changed to suspended + nostaging<br/>191113 08:51:11 14442 XrdSetIF: Skipping duplicate public interface [::129.59.197.97]<br/>191113 08:51:11 14440 State: Status changed to active<br/>191113 08:51:11 14443 XrdSetIF: Skipping duplicate public interface [::129.59.197.97]<br/>191113 08:51:11 14410 XrdSetIF: Skipping duplicate public interface [::129.59.197.97]<br/>191113 08:51:11 14523 XrdSetIF: Skipping duplicate public interface [::129.59.197.97]<br/></pre><br/>but the hacked up-netcat redirector I have on 129.59.197.97 (<a href="http://xrootd2.accre.vanderbilt.edu">xrootd2.accre.vanderbilt.edu</a>) is receiving plenty of connections<br/><pre><br/>Ncat: Connection from 128.104.227.14.<br/>Ncat: Connection from 128.104.227.14:23529.<br/>Ncat: Connection from 144.92.181.152.<br/>Ncat: Connection from 144.92.181.152:25935.<br/>Ncat: Connection from 193.109.175.202.<br/>Ncat: Connection from 193.109.175.202:49256.<br/>Ncat: Connection from 129.59.197.22.<br/>Ncat: Connection from 129.59.197.22:45054.<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(10:26:56)</span> <b>bbockelm:</b></span> look at the <tt>xrdcp</tt> output on ... maybe debug level 3?<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:29:39)</span> <b>andrew.melo:</b></span> Hmmm, it "seems" like it's a hostname? Unless it's doing a reverse dns before it prints to the console?<br/><pre><br/>[2019-11-13 10:28:29.138847 -0600][Dump   ][XRootD            ] [<a href="http://xrootd.accre.vanderbilt.edu:1094">xrootd.accre.vanderbilt.edu:1094</a>] Got kXR_redirect response to message kXR_open (file: /store/ONLYATVANDY-LFS.txt, mode: 00, flags: kXR_open_read kXR_async kXR_retstat ): <a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a>, port 1095<br/>[2019-11-13 10:28:29.138947 -0600][Dump   ][XRootD            ] [<a href="http://xrootd.accre.vanderbilt.edu:1094">xrootd.accre.vanderbilt.edu:1094</a>] Current server has been assigned as a load-balancer for message kXR_open (file: /store/ONLYATVANDY-LFS.txt, mode: 00, flags: kXR_open_read kXR_async kXR_retstat )<br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] URL: <a href="http://xrootd.accre.vanderbilt.edu:1095/">xrootd.accre.vanderbilt.edu:1095/</a><br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] Protocol:  root<br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] User Name: <br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] Password:  <br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] Host Name: <a href="http://xrootd.accre.vanderbilt.edu">xrootd.accre.vanderbilt.edu</a><br/>[2019-11-13 10:28:29.139016 -0600][Dump   ][Utility           ] Port:      1095<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(11:21:25)</span> <b>bbockelm:</b></span> No, if it was an IP address, you'd get an IP address there.<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:21:55)</span> <b>bbockelm:</b></span> so, on first DNS resolution, <tt>xrdcp</tt> will randomize the returned address.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:29:52)</span> <b>andrew.melo:</b></span> Nice. Well, I guess when I add the other hosts (I guess I'll add an <a href="http://xrootd-srv.accre.vanderbilt.edu">xrootd-srv.accre.vanderbilt.edu</a> for everything that's not also a redirector), I need to really make sure xrootd is accessible on everything in the alias so the RR doesn't hit a bad node<br/>
</body>
</html>
