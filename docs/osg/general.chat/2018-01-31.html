<!DOCTYPE html>
<html>
<head>
<title>Wed Jan 31, 2018 : #general (osg)</title>
</head>
<body>
<h3>Wed Jan 31, 2018 : #general (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(09:45:38)</span> <b>bbockelm:</b></span> What is the host OS version?  Does <tt>/home</tt> exist within the container?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(10:04:19)</span> <b>james.clark:</b></span> This is on CIT's ldas-pcdev2 should be SL7 with: <pre>Linux ldas-pcdev2 3.10.0-693.11.6.el7.x86_64 #1 SMP Wed Jan 3 18:09:42 CST 2018 x86_64 x86_64 x86_64 GNU/Linux</pre>.    I thought I'd set up home but i'll double check.   I failed to mention it but the job runs perfectly if i create the image by hand, by pulling in the docker image<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:38:59)</span> <b>bbockelm:</b></span> is the <tt>/home</tt> directory created in the image in CVMFS?<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:15:23)</span> <b>fkhan:</b></span> Just wondering if anyone has had issues between HTCondor and SELinux on a CE? I am running 8.6.8-2 (from Madison) with HTCondor CE 3.0.4-1 on the CE and the /var/log/messages is flooded with:<br/><pre><br/>Jan 31 12:11:50 htccedev02 setroubleshoot: SELinux is preventing /usr/sbin/condor_schedd from read access on the directory /etc/grid-security/certificates-1.69NEW. For complete SELinux messages run: sealert -l 49724f78-401c-4e42-888c-0eb96cd8950e<br/>Jan 31 12:11:50 htccedev02 python: SELinux is preventing /usr/sbin/condor_schedd from read access on the directory /etc/grid-security/certificates-1.69NEW.#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that condor_schedd should be allowed read access on the certificates-1.69NEW directory by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c 'condor_schedd' --raw | audit2allow -M my-condorschedd#012# semodule -i my-condorschedd.pp#012<br/>Jan 31 12:11:50 htccedev02 setroubleshoot: failed to retrieve rpm info for /etc/grid-security/certificates-1.69NEW<br/>Jan 31 12:11:50 htccedev02 setroubleshoot: SELinux is preventing /usr/sbin/condor_schedd from read access on the directory /etc/grid-security/certificates-1.69NEW. For complete SELinux messages run: sealert -l 49724f78-401c-4e42-888c-0eb96cd8950e<br/>Jan 31 12:11:50 htccedev02 python: SELinux is preventing /usr/sbin/condor_schedd from read access on the directory /etc/grid-security/certificates-1.69NEW.#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that condor_schedd should be allowed read access on the certificates-1.69NEW directory by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c 'condor_schedd' --raw | audit2allow -M my-condorschedd#012# semodule -i my-condorschedd.pp#012<br/>Jan 31 12:11:53 htccedev02 setroubleshoot: failed to retrieve rpm info for /etc/cloud-security<br/>Jan 31 12:11:53 htccedev02 setroubleshoot: SELinux is preventing /usr/sbin/condor_schedd from search access on the directory /etc/cloud-security. For complete SELinux messages run: sealert -l d1c21cfb-ffca-4ca1-95db-2cf81b8c4b98<br/>Jan 31 12:11:53 htccedev02 python: SELinux is preventing /usr/sbin/condor_schedd from search access on the directory /etc/cloud-security.#012#012*****  Plugin catchall (100. confidence) suggests   **************************#012#012If you believe that condor_schedd should be allowed search access on the cloud-security directory by default.#012Then you should report this as a bug.#012You can generate a local policy module to allow this access.#012Do#012allow this access for now by executing:#012# ausearch -c 'condor_schedd' --raw | audit2allow -M my-condorschedd#012# semodule -i my-condorschedd.pp#012<br/></pre><br/>The same 8.6.8-2 on another submit machine (just running condor) doesn't throw any errors and is happy. SELinux version is the same on both machines and is enabled on both of em too.<br/><pre><br/># rpm -qa | grep 'selinux' | sort<br/>libselinux-2.5-11.el7.i686<br/>libselinux-2.5-11.el7.x86_64<br/>libselinux-python-2.5-11.el7.x86_64<br/>libselinux-utils-2.5-11.el7.x86_64<br/>selinux-policy-3.13.1-166.el7_4.7.noarch<br/>selinux-policy-targeted-3.13.1-166.el7_4.7.noarch<br/></pre><br/>
<span style="color: #e06b56"><span style="font-size: small">(12:18:47)</span> <b>fkhan:</b></span> The CE itself runs fine though. Pilots coming in, getting matched etc.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:10:33)</span> <b>bbockelm:</b></span> doesn't look familiar to me.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:10:40)</span> <b>bbockelm:</b></span> @tim.theisen is the right person to ask.<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:47:22)</span> <b>fkhan:</b></span> thanks Brian. From time to time, I also see this:<br/><pre><br/>Jan 31 13:44:17 cmsosgce4 python: SELinux is preventing /usr/sbin/condor_schedd from getattr access on the file /storage/local/data1/condor/spool/history.#012#012*****  Pl<br/>ugin catchall_labels (83.8 confidence) suggests   *******************#012#012If you want to allow condor_schedd to have getattr access on the history file#012Then you need<br/> to change the label on /storage/local/data1/condor/spool/history#012Do#012# semanage fcontext -a -t FILE_TYPE '/storage/local/data1/condor/spool/history'#012where FILE_TY<br/>PE is one of the following: NetworkManager_log_t, NetworkManager_tmp_t, abrt_helper_exec_t, abrt_tmp_t, abrt_upload_watch_tmp_t, abrt_var_cache_t, abrt_var_log_t, abrt_var<br/>_run_t, acct_data_t, admin_crontab_tmp_t, afs_logfile_t, aide_log_t, alsa_tmp_t, amanda_log_t, amanda_tmp_t, antivirus_log_t, antivirus_tmp_t, apcupsd_log_t, apcupsd_tmp_t<br/>, apmd_log_t, apmd_tmp_t, arpwatch_tmp_t, asterisk_log_t, asterisk_tmp_t, auditadm_sudo_tmp_t, auth_cache_t, automount_tmp_t, awstats_tmp_t, bacula_log_t, bacula_tmp_t, bi<br/>n_t, bitlbee_log_t, bitlbee_tmp_t, bluetooth_helper_tmp_t, bluetooth_helper_tmpfs_t, bluetooth_tmp_t, boinc_log_t, boinc_project_tmp_t, boinc_tmp_t, boot_t, bootloader_tmp<br/>........<br/></pre><br/>Truncating the message, seems to go on for a few lines. @tim.theisen please let me know if I can provide more information to help you reproduce this<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:07:23)</span> <b>bbockelm:</b></span> yeah - you probably need to relabel the spool directory<br/>
<span style="color: #73769d"><span style="font-size: small">(14:07:48)</span> <b>tim.theisen:</b></span> I haven't seen this either. Have you checked the contexts on the /etc/grid-security/certificates? (ls -Z)<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:07:49)</span> <b>bbockelm:</b></span> ah - it's potential true that, locally, we utilize the CVMFS version of the CA certs for inside the Docker container.<br/>
<span style="color: #de5f24"><span style="font-size: small">(14:09:22)</span> <b>tiradani:</b></span> don’t want to sidetrack the conversation, but this is a CE… so, which HTCondor?  is this the CE HTCondor?<br/>
<span style="color: #73769d"><span style="font-size: small">(14:09:56)</span> <b>tim.theisen:</b></span> The HTCondor team has a plan to look at the HTCondor configuration and tell the admin or relabel the required directories for SELinux.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:10:09)</span> <b>fkhan:</b></span> I can do the relabeling, but is that expected to be done manually? We do write to an external disk, so the location is non standard.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:11:11)</span> <b>fkhan:</b></span> <pre><br/># ls -Zal /etc/grid-security/<br/>total 152<br/>drwxr-xr-x.   5 system_u:object_r:etc_t:s0       root root  4096 Jan 25 15:41 .<br/>drwxr-xr-x. 115 system_u:object_r:etc_t:s0       root root 12288 Jan 31 13:52 ..<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root   234 Oct 17 15:38 ban-mapfile<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root   200 Oct 17 15:38 ban-voms-mapfile<br/>lrwxrwxrwx.   1 system_u:object_r:etc_t:s0       root root    20 Jan 25 07:28 certificates -&gt; certificates-1.69NEW<br/>drwxr-xr-x.   2 unconfined_u:object_r:user_tmp_t:s0 root root 49152 Jan 21 18:45 certificates-1.68NEW.old<br/>drwxr-xr-x.   2 system_u:object_r:system_cronjob_tmp_t:s0 root root 49152 Jan 25 12:49 certificates-1.69NEW<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root   290 Jan 19 16:07 grid-mapfile<br/>-rw-r--r--.   1 unconfined_u:object_r:etc_t:s0   root root    60 Jan 19 16:48 gsi-authz.conf<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root  2879 Nov  2 07:10 gsi.conf<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root  1678 Jan 19 15:59 hostcert.pem<br/>-rw-------.   1 system_u:object_r:etc_t:s0       root root  1679 Jan 19 15:59 hostkey.pem<br/>drwxr-xr-x.  37 system_u:object_r:etc_t:s0       root root  4096 Jan 19 16:06 vomsdir<br/>-rw-r--r--.   1 system_u:object_r:etc_t:s0       root root   519 Jan 19 16:07 voms-mapfile<br/></pre><br/>
<span style="color: #73769d"><span style="font-size: small">(14:12:14)</span> <b>tim.theisen:</b></span> Right now HTCondor does not have a mechanism to check and label for you. The labels are correct for a default installation. If you run a non-standard installation, you have to label the directories manually.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:16:37)</span> <b>fkhan:</b></span> What I find weird here is that we have a similar installation on another machine (which just runs one condor_schedd, i.e. no CE). It also writes to an external non standard location, but it doesn't show me any errors. I never added any selinux labels to those directories<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:27:39)</span> <b>bbockelm:</b></span> is selinux on or off on the other machine?<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:32:36)</span> <b>fkhan:</b></span> it is on on both machines<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:32:58)</span> <b>fkhan:</b></span> the other node is a wmagent schedd for the global pool<br/>
<span style="color: #73769d"><span style="font-size: small">(14:59:59)</span> <b>tim.theisen:</b></span> How do the contexts on the working machine look?<br/>
</body>
</html>
