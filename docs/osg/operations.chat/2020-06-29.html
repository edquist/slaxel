<!DOCTYPE html>
<html>
<head>
<title>Mon Jun 29, 2020 : #operations (osg)</title>
</head>
<body>
<h3>Mon Jun 29, 2020 : #operations (osg)</h3>
<span style="color: #43761b"><span style="font-size: small">(09:14:23)</span> <b>blin:</b></span> @dweitzel please add me to the noise, too<br/>
<span style="color: #c386df"><span style="font-size: small">(09:24:09)</span> <b>matyas:</b></span> bring the noise :metal:<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:30:50)</span> <b>dweitzel:</b></span> @efajardo I'm seeing jobs with the VO = clas12.  I don't see that VO registered in topology.  The usage is coming from 3 hosts, uconn, and 2 from syracuse.<br/>
<span style="color: #a63024"><span style="font-size: small">(10:34:24)</span> <b>efajardo:</b></span> @dweitzel can they be put under the JLAB umbrella<br/>
<span style="color: #a63024"><span style="font-size: small">(10:34:26)</span> <b>efajardo:</b></span> <a href="https://github.com/opensciencegrid/topology/blob/master/virtual-organizations/JLab.yaml">https://github.com/opensciencegrid/topology/blob/master/virtual-organizations/JLab.yaml</a><br/>
<span style="color: #a63024"><span style="font-size: small">(10:34:40)</span> <b>efajardo:</b></span> I do not want to ask them to register again<br/>
<span style="color: #a63024"><span style="font-size: small">(10:34:47)</span> <b>efajardo:</b></span> It is registered as a project<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:37:13)</span> <b>dweitzel:</b></span> Sure.  Correcting it is easy.  but, how is it being picked up as clas12 VO in the first place.  the DN is:<br/><pre>/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu">osg-jlab-1.t2.ucsd.edu</a></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(10:37:43)</span> <b>efajardo:</b></span> cause the VO is CLAS12<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:37:56)</span> <b>dweitzel:</b></span> it's being mapped as clas12 with the vo-client?<br/>
<span style="color: #a63024"><span style="font-size: small">(10:38:15)</span> <b>efajardo:</b></span> <pre>subject   : /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu/CN=853486378">osg-jlab-1.t2.ucsd.edu/CN=853486378</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu">osg-jlab-1.t2.ucsd.edu</a><br/>identity  : /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu">osg-jlab-1.t2.ucsd.edu</a><br/>type      : RFC compliant proxy<br/>strength  : 1024 bits<br/>path      : /etc/grid-security/pilot_clas12_proxy.proxy<br/>timeleft  : 22:53:07<br/>key usage : Digital Signature, Key Encipherment, Data Encipherment<br/>=== VO clas12 extension information ===<br/>VO        : clas12<br/>subject   : /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu">osg-jlab-1.t2.ucsd.edu</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://jlabvoms.t2.ucsd.edu">jlabvoms.t2.ucsd.edu</a><br/>attribute : /clas12/Role=NULL/Capability=NULL<br/>timeleft  : 22:53:07<br/>uri       : <a href="http://jlabvoms.t2.ucsd.edu:15001">jlabvoms.t2.ucsd.edu:15001</a></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(10:38:16)</span> <b>efajardo:</b></span> yea<br/>
<span style="color: #a63024"><span style="font-size: small">(10:38:25)</span> <b>efajardo:</b></span> Since JLAB is kidna like Fermilab<br/>
<span style="color: #a63024"><span style="font-size: small">(10:38:30)</span> <b>efajardo:</b></span> they want to have several experiments<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:38:32)</span> <b>dweitzel:</b></span> I think there is a disconnect.  There is a VO in the OSG that is not registered in topology.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:39:01)</span> <b>dweitzel:</b></span> All of fermilab's VOs are registered.<br/>
<span style="color: #a63024"><span style="font-size: small">(10:42:44)</span> <b>efajardo:</b></span> ok<br/>
<span style="color: #43761b"><span style="font-size: small">(11:37:18)</span> <b>blin:</b></span> @jthiltges is there an issue with the central collector?<br/>
<blockquote>
<span style="color: #e06b56"><span style="font-size: small">(11:53:14)</span> <b>jthiltges:</b></span> Whatever's happening is after Apache. Somewhere in the CEView and beyond layer. Still doing some troubleshooting before blindly restarting (and potentially losing the chance to debug).<br/>
<span style="color: #43761b"><span style="font-size: small">(12:25:11)</span> <b>blin:</b></span> Does <tt>condor_ce_status -any</tt> from the collector host show anything?<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:26:21)</span> <b>jthiltges:</b></span> Yup. Seems normal.<br/><a href="https://paste.centos.org/view/054aadf8">https://paste.centos.org/view/054aadf8</a><br/>
<span style="color: #e06b56"><span style="font-size: small">(12:26:53)</span> <b>jthiltges:</b></span> At this point, I'm inclined to blame somewhat aggressive HTTP scanning from the OSG security team. @dweitzel.<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:27:49)</span> <b>jthiltges:</b></span> They've got something like 100 requests active right now. And the CEView hamster just can't spin the wheel fast enough.<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:35:33)</span> <b>jthiltges:</b></span> <br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:51:32)</span> <b>jthiltges:</b></span> After poking into CEView code, the <tt>ad_to_json</tt> function seems to be particularly expensive. Takes about 6 seconds to evaluate _every_ expression in every classad. <a href="https://github.com/htcondor/htcondor-ce/blob/master/src/htcondorce/web.py#L82-L94">https://github.com/htcondor/htcondor-ce/blob/master/src/htcondorce/web.py#L82-L94</a><br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:52:01)</span> <b>blin:</b></span> yikes, what version of htcondor-ce are you running?<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:53:24)</span> <b>jthiltges:</b></span> Running 4.2.1. (I've still got that outstanding ticket to upgrade the ITB collector. =/ )<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:54:04)</span> <b>blin:</b></span> hrm we touched that recently in 4.4.0<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:54:15)</span> <b>blin:</b></span> what version of condor?<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:54:39)</span> <b>jthiltges:</b></span> 8.8.8<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:55:22)</span> <b>jthiltges:</b></span> I've been poking at a test environment in docker. I'll try updating to 4.4.0 and see what happens.<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:55:35)</span> <b>blin:</b></span> the code looks the same in 4.2.1 <a href="https://github.com/htcondor/htcondor-ce/blob/v4.2.1/src/htcondorce/web_utils.py#L106-L118">https://github.com/htcondor/htcondor-ce/blob/v4.2.1/src/htcondorce/web_utils.py#L106-L118</a><br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:55:54)</span> <b>blin:</b></span> it's a little odd that this is popping up all of a sudden<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:56:46)</span> <b>jthiltges:</b></span> My guess is that it's always been on the slow side. It's the simultaneous security scan that made it fall over.<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:57:14)</span> <b>jthiltges:</b></span> Got me looking for slower parts, along with ways to enable cherrypy's caching.<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:57:43)</span> <b>blin:</b></span> hrm i'd believe it<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:58:17)</span> <b>blin:</b></span> @bbockelm ^^ worth noting that the central collector has slowed to a crawl with htcondor-ce 4.2.1 (we haven't gotten to updating to 4.4.0 which has the registry app)<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:58:54)</span> <b>jthiltges:</b></span> The registry app will be separate, or an extension of CEView?<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 09:59:04)</span> <b>blin:</b></span> separate<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:59:09)</span> <b>jthiltges:</b></span> :+1:<br/>
<span style="color: #9e3997"><span style="font-size: small">(2020-06-30 09:59:14)</span> <b>bbockelm:</b></span> Hm - I'm not super-familiar with that code.  Derek should be able to look at it?<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-06-30 09:59:34)</span> <b>jthiltges:</b></span> I'll chat with Derek. Thanks!<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 10:00:19)</span> <b>blin:</b></span> the main point though is that we haven't really touched that code outside of 4.4.0 recently, so something else in condor/condor-ce is probably causing this issue<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-06-30 10:01:33)</span> <b>blin:</b></span> and the most recent change that's relevant to the central collector was accepting SSL auth<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-07-01 11:18:16)</span> <b>jthiltges:</b></span> @blin When you say that the central collector isn't returning any ads, what do you mean?<br/><br/><pre>$ condor_status -pool <a href="http://collector1.opensciencegrid.org:9619">collector1.opensciencegrid.org:9619</a> -any<br/>MyType             TargetType         Name<br/><br/>Scheduler          None               <a href="http://249cc.yeg.cybera.ca">249cc.yeg.cybera.ca</a><br/>Scheduler          None               <a href="http://CE01.CMSAF.MIT.EDU">CE01.CMSAF.MIT.EDU</a><br/>Scheduler          None               <a href="http://CE02.CMSAF.MIT.EDU">CE02.CMSAF.MIT.EDU</a><br/>Scheduler          None               <a href="http://CE03.CMSAF.MIT.EDU">CE03.CMSAF.MIT.EDU</a><br/>...</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:18:44)</span> <b>blin:</b></span> <pre>blin@blin-latitude:~$ condor_status -schedd <a href="http://collector.opensciencegrid.org:9619">collector.opensciencegrid.org:9619</a><br/>blin@blin-latitude:~$ condor_status -any <a href="http://collector.opensciencegrid.org:9619">collector.opensciencegrid.org:9619</a><br/>blin@blin-latitude:~$ </pre><br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:18:54)</span> <b>blin:</b></span> (same thing for collector1)<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-07-01 11:20:51)</span> <b>jthiltges:</b></span> The <tt>-pool</tt> flag shouldn't be needed? (I'm a condor noob!)<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:22:00)</span> <b>blin:</b></span> oh christ<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:22:57)</span> <b>blin:</b></span> nvm then, i'm just a dummy<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-07-01 11:26:33)</span> <b>jthiltges:</b></span> No worries at all!<br/>There are still some underlying CEView issues I'm trying to clean up. So far, it appears to be concurrency related. (Or at least made much worse by simultaneous requests).<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-07-01 11:27:52)</span> <b>jthiltges:</b></span> The CherryPy server alone seems to be fine. It just gets bogged down when Apache is in front. Still pondering.<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:28:26)</span> <b>blin:</b></span> yeah, that's way less firey than i thought it was<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-07-01 11:28:34)</span> <b>blin:</b></span> i wouldn't worry about this all too much<br/>
<span style="color: #e06b56"><span style="font-size: small">(2020-07-01 12:14:23)</span> <b>jthiltges:</b></span> Too late! Was already too far down the rabbit hole. :slightly_smiling_face:<br/>One of the issues was CherryPy and poor handling of HTTP keepalives. The easy option was disabling KA in mod_proxy. More gory details here: <a href="https://github.com/cherrypy/cherrypy/issues/1764">https://github.com/cherrypy/cherrypy/issues/1764</a><br/><br/>And some ClassAd-to-JSON tweaks should speed the table loading. Added to existing PR. <a href="https://github.com/htcondor/htcondor-ce/pull/355">https://github.com/htcondor/htcondor-ce/pull/355</a><br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(11:37:31)</span> <b>blin:</b></span> <a href="http://collector.opensciencegrid.org/">collector.opensciencegrid.org/</a> hangs<br/>
<span style="color: #43761b"><span style="font-size: small">(11:37:47)</span> <b>blin:</b></span> and queries with the cli tools turn up empty<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:41:13)</span> <b>jthiltges:</b></span> Checking now. So far, no signs of recent config changes.<br/>
<span style="color: #43761b"><span style="font-size: small">(11:41:59)</span> <b>blin:</b></span> oh it finally went through in my browser<br/>
<span style="color: #43761b"><span style="font-size: small">(11:42:17)</span> <b>blin:</b></span> the CE table isn't loading, though<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:42:18)</span> <b>jthiltges:</b></span> Same here. But still running slowly. I haven't restarted any services.<br/>
</body>
</html>
