<!DOCTYPE html>
<html>
<head>
<title>Fri Jul 9, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Fri Jul 9, 2021 : #operations (osg)</h3>
<span style="color: #9d8eee"><span style="font-size: small">(09:24:08)</span> <b>cat:</b></span> Is there a good (easy, accurate) way to tell what VOs a given site supports?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:46:07)</span> <b>blin:</b></span> easy AND accurate? that's a big ask :stuck_out_tongue:<br/>
<span style="color: #43761b"><span style="font-size: small">(09:47:01)</span> <b>blin:</b></span> are there VOs in particular that you care about for this? and when you say site, are you using it colloquially or in the Topology sense?<br/>
<span style="color: #9d8eee"><span style="font-size: small">(09:53:08)</span> <b>cat:</b></span> Sure, I have an underlying question: LIGO is working on an access point that is to submit into the LIGO Pool and flock to the OS Pool — I would like to be able to identify jobs that clearly ran in the OS Pool. However, some sites (e.g., Syracuse) contribute to both pools, so if I look at an execute hostname, I cannot tell which pool was used to run the job. However, if I can identify sites (casually speaking) that contribute to the OS Pool but not the LIGO Pool, and if I see a job that runs there, then I know that it ran in the OS Pool.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(09:53:20)</span> <b>cat:</b></span> Make sense?<br/>
<span style="color: #9d8eee"><span style="font-size: small">(09:53:43)</span> <b>cat:</b></span> (Also note that this LIGO access point is not set up for OS Pool flocking yet, I believe.)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:00:34)</span> <b>blin:</b></span> if you wanna do this post facto then it seems like it'd be best to dig through the GRACC<br/>
<span style="color: #43761b"><span style="font-size: small">(10:04:44)</span> <b>blin:</b></span> it's not 100% clear to me what inputs you have. completed job ads?<br/>
<span style="color: #9d8eee"><span style="font-size: small">(10:20:33)</span> <b>cat:</b></span> From the user’s perspective, there will be job logs and maybe job output that includes output from the <tt>hostname</tt> command.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(10:20:56)</span> <b>cat:</b></span> But if we could cook up a GRACC report that just shows this, that would be awesomer.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(10:21:25)</span> <b>cat:</b></span> That presumes that the schedd on the LIGO access point is reporting to OSG GRACC, right?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:30:06)</span> <b>dweitzel:</b></span> Ligo submit points report to GRACC. But, gracc doesn’t have good visibility on what “pool” the job ran in. As far as I know, we don’t mark jobs as to what pool they ran in. In fact, I doubt a user could even tell what pool they are running in. <br/>
<span style="color: #9e3997"><span style="font-size: small">(10:55:42)</span> <b>bbockelm:</b></span> (why not look at the job's ClassAd?  says the remote pool name there if it's flocked)<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:08:12)</span> <b>dweitzel:</b></span> Should we be capturing that in gratia?<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:38:50)</span> <b>bbockelm:</b></span> Seems a reasonable add.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(11:43:42)</span> <b>cat:</b></span> What if the job has not been flocked?<br/>
<span style="color: #235e5b"><span style="font-size: small">(12:22:15)</span> <b>dweitzel:</b></span> I'm looking at some flocked jobs, what attribute should I be looking for?<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(12:33:22)</span> <b>blin:</b></span> @gthain do you know what attr we can look at for associating a job with the flocked to pool that it ran on?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:34:41)</span> <b>blin:</b></span> also, what should we look at to determine the pool for jobs that haven't flocked?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:32:03)</span> <b>bbockelm:</b></span> You want to look at <tt>LastRemotePool</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(13:32:44)</span> <b>bbockelm:</b></span> Annoyingly, that attribute is _only_ set when flocking.  You can get the schedd's <tt>COLLECTOR_HOST</tt> configuration value as a proxy for the local poolname.<br/>
</blockquote>
<span style="color: #53b759"><span style="font-size: small">(13:52:31)</span> <b>marian:</b></span> @jdost321, @didavila... can one of you push forward to request at UCSD fix the DNS reverse lookup of the Factory host?<br/><pre>$ host <a href="http://gfactory-2.opensciencegrid.org">gfactory-2.opensciencegrid.org</a><br/><a href="http://gfactory-2.opensciencegrid.org">gfactory-2.opensciencegrid.org</a> has address 169.228.38.43<br/>$ host 169.228.38.43<br/>Host 43.38.228.169.in-addr.arpa. not found: 3(NXDOMAIN)</pre><br/>we (BrianL and I) suspect this may be causing issues for the JLAB CE that is still running older version of the condor on the CE get through ...<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:55:48)</span> <b>bbockelm:</b></span> what version?<br/>
<span style="color: #385a86"><span style="font-size: small">(13:56:55)</span> <b>jdost321:</b></span> We haven't needed a reverse lookup for the lifetime of that factory since we moved hosts, Terrence was against making one I don't remember the reasoning<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:56:58)</span> <b>bbockelm:</b></span> I ask because the issue with reverse DNS was in the client side of the code.<br/>
<span style="color: #385a86"><span style="font-size: small">(13:57:25)</span> <b>jdost321:</b></span> been ok 4+ years without it<br/>
<span style="color: #43761b"><span style="font-size: small">(13:57:45)</span> <b>blin:</b></span> 8.8.10<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:57:53)</span> <b>bbockelm:</b></span> (so I'm not sure why the CE would be the client here ... I think the factory is always the client)<br/>
<span style="color: #385a86"><span style="font-size: small">(13:58:15)</span> <b>jdost321:</b></span> right, factory is the client when submitting to a ce<br/>
<span style="color: #43761b"><span style="font-size: small">(13:59:15)</span> <b>blin:</b></span> hrmmm, well that probably shoots that theory out of the water then, which is unfortunate<br/>
<span style="color: #43761b"><span style="font-size: small">(14:00:24)</span> <b>blin:</b></span> we were seeing GSI errors due to disliking the issuer cert but it wasn't clear which side was the problem<br/>
<span style="color: #43761b"><span style="font-size: small">(14:01:02)</span> <b>blin:</b></span> the host cert was fine, signed by InCommon IGTF, and we updated their CA certs + CRLs<br/>
<span style="color: #43761b"><span style="font-size: small">(14:01:28)</span> <b>blin:</b></span> errr i guess the CE could be complaining about the issuer of the pilot proxy but I'd expect to see a more widespread problem in that case<br/>
<span style="color: #43761b"><span style="font-size: small">(14:04:57)</span> <b>blin:</b></span> @marian which VOs should they be accepting proxies for?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:09:27)</span> <b>bbockelm:</b></span> Copy/paste some error messages here?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:10:47)</span> <b>blin:</b></span> the zoom meeting ended and we couldn't get copy/paste working in the screen share =/<br/>
<span style="color: #53b759"><span style="font-size: small">(14:11:32)</span> <b>marian:</b></span> yep<br/>
<span style="color: #53b759"><span style="font-size: small">(14:11:34)</span> <b>marian:</b></span> mnt<br/>
<span style="color: #53b759"><span style="font-size: small">(14:12:29)</span> <b>marian:</b></span> <pre>07/09/21 14:04:56 (D_ALWAYS:2) This process has a valid certificate &amp; key<br/>07/09/21 14:04:56 (D_ALWAYS) Condor GSI authentication failure<br/>GSS Major Status: Authentication Failed<br/>GSS Minor Status Error Chain:<br/>globus_gsi_gssapi: SSL handshake problems<br/>OpenSSL Error: s3_srvr.c:3327: in library: SSL routines, function ssl3_get_client_certificate: certificate verify failed<br/>globus_gsi_callback_module: Could not verify credential<br/>globus_gsi_callback_module: Could not verify credential: unable to get issuer certificate<br/>07/09/21 14:04:56 (cid:417) (D_AUDIT) Command=QMGMT_WRITE_CMD, peer=&lt;169.228.38.43:27000&gt;<br/>07/09/21 14:04:56 (cid:417) (D_AUDIT) Authentication Failed, MethodsTried=FS,SCITOKENS,GSI<br/>07/09/21 14:04:56 (D_ALWAYS) DC_AUTHENTICATE: authentication of &lt;169.228.38.43:27000&gt; did not result in a valid mapped user name, which is required for this command (1112 QMGMT_WRITE_CMD), so aborting.<br/>07/09/21 14:04:56 (D_ALWAYS) DC_AUTHENTICATE: reason for authentication failure: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using GSI|GSI:5004:COMMON Failed to authenticate (655360:1142)|AUTHENTICATE:1004:Failed to authenticate using FS|FS:1004:Unable to lstat(/tmp/FS_XXXFNc5bI)<br/>07/09/21 14:05:11 (D_ALWAYS:2) Clearing userlog file cache<br/>07/09/21 14:05:11 (D_ALWAYS:2) JobsRunning = 0<br/>1:09<br/>[root@osg-ce-1 condor-ce]# condor_ce_version<br/>$CondorVersion: 8.8.10 Aug 12 2020 PackageID: 8.8.10-1.3 $<br/>$CondorPlatform: X86_64-CentOS_7.8 $</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(14:13:11)</span> <b>marian:</b></span> accepted VOs are:<br/><pre>CLAS12, EIC, GLUEX</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(14:16:01)</span> <b>marian:</b></span> all three have changed proxies in the past week/two but that shouldn't be the issue from the Frontend point of view<br/>
<span style="color: #43761b"><span style="font-size: small">(14:16:12)</span> <b>blin:</b></span> what's the output of <tt>openssl x509 -in /etc/grid-security/hostcert.pem -noout -text</tt> again?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:16:28)</span> <b>blin:</b></span> and what're the contents of <tt>/etc/grid-security/grid-mapfile</tt> and <tt>/etc/grid-security/voms-mapfile</tt>?<br/>
<span style="color: #53b759"><span style="font-size: small">(14:20:15)</span> <b>marian:</b></span> lost that part but asking admins to provide it ... don't have access to that CE host yet<br/>
<span style="color: #53b759"><span style="font-size: small">(14:20:56)</span> <b>marian:</b></span> I know grid-mapfile has only three lines ... but that was like that for months<br/>
<span style="color: #53b759"><span style="font-size: small">(14:21:28)</span> <b>marian:</b></span> voms-mapfile defines the three VOs I mentioned ... I should get to full output and post here<br/>
<span style="color: #43761b"><span style="font-size: small">(14:23:01)</span> <b>blin:</b></span> i guess the mapfiles shouldn't matter, i think condor's blowing up the GSI auth before it hits the lcmaps callout<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:23:30)</span> <b>bbockelm:</b></span> This appears to be an issue with the server not liking the client's X.509 chain.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:24:00)</span> <b>bbockelm:</b></span> What VO is failing in the above?<br/>
<span style="color: #53b759"><span style="font-size: small">(14:24:33)</span> <b>marian:</b></span> CLAS12 I was troubleshooting, but it's same for EIC ...<br/>
<span style="color: #53b759"><span style="font-size: small">(14:24:51)</span> <b>marian:</b></span> I'd say nothing goes through that CE atm<br/>
<span style="color: #53b759"><span style="font-size: small">(14:25:28)</span> <b>marian:</b></span> I think all VOs then are down to same problem<br/>
<span style="color: #53b759"><span style="font-size: small">(14:25:34)</span> <b>marian:</b></span> on that particular CE<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:26:21)</span> <b>bbockelm:</b></span> where does the CLAS12 frontend run?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:27:29)</span> <b>blin:</b></span> both clas12/eic are in the jlab FE in osgdev<br/>
<span style="color: #385a86"><span style="font-size: small">(14:30:35)</span> <b>jdost321:</b></span> so far i see clas12 pilots running but only at the italian CNAF site<br/><pre>condor_q -global -const 'GlideinClient=?="JLabVO-1_0.clas12" &amp;&amp; jobstatus==2' -af glideinentryname  | sort | uniq<br/>CLAS12_T1_IT_CNAF_ce01-htc<br/>CLAS12_T1_IT_CNAF_ce02-htc<br/>CLAS12_T1_IT_CNAF_ce03-htc<br/>CLAS12_T1_IT_CNAF_ce04-htc</pre><br/>
<span style="color: #385a86"><span style="font-size: small">(14:31:19)</span> <b>jdost321:</b></span> could we be missing updated voms packages for the US sites? maybe they are just mapping the DN at CNAF<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:32:14)</span> <b>bbockelm:</b></span> bah, <tt>osgdev</tt>.  No wonder I couldn't find it.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:32:40)</span> <b>bbockelm:</b></span> @jdost321 - can't be VOMS, this is happening prior to the VOMS check.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:34:18)</span> <b>bbockelm:</b></span> what's the CE name?<br/>
<span style="color: #53b759"><span style="font-size: small">(14:34:21)</span> <b>marian:</b></span> yeah, there are quite some CLAS12 jobs accepted:<br/>
<span style="color: #53b759"><span style="font-size: small">(14:34:29)</span> <b>marian:</b></span> <a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:38:22)</span> <b>bbockelm:</b></span> <pre>[root@vo-frontend-jlab-57dd74c5f6-nc7p9 /]# condor_status -schedd -pool <a href="http://collector.opensciencegrid.org:9619">collector.opensciencegrid.org:9619</a> | grep jlab<br/>[root@vo-frontend-jlab-57dd74c5f6-nc7p9 /]#</pre><br/>Hm - not showing up in the central collector, that's suspicious.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:39:26)</span> <b>bbockelm:</b></span> ah - the error message from the client is better:<br/><pre>07/09/21 19:38:59 Condor GSI authentication failure<br/>GSS Major Status: Authentication Failed<br/>GSS Minor Status Error Chain:<br/>globus_gss_assist: Error during context initialization<br/>globus_gsi_gssapi: Unable to verify remote side's credentials<br/>globus_gsi_gssapi: SSL handshake problems: Couldn't do ssl handshake<br/>OpenSSL Error: s3_pkt.c:1493: in library: SSL routines, function ssl3_read_bytes: tlsv1 alert unknown ca SSL alert number 48</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:39:52)</span> <b>bbockelm:</b></span> Brian Lin was on the right track - can you <tt>cat /etc/grid-security/hostcert.pem</tt> ?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:41:15)</span> <b>bbockelm:</b></span> You know, I have a special branch of condor that will save the certificate that it doesn't like... let me see if I can find it.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:41:47)</span> <b>bbockelm:</b></span> (<a href="https://github.com/htcondor/htcondor/pull/181">https://github.com/htcondor/htcondor/pull/181</a> TOFU mode!)<br/>
<span style="color: #53b759"><span style="font-size: small">(14:43:24)</span> <b>marian:</b></span> yeah, I saw also errors not authentication with <a href="http://hcc-collector.unl.edu">hcc-collector.unl.edu</a> ...<br/>
<span style="color: #53b759"><span style="font-size: small">(14:43:51)</span> <b>marian:</b></span> I can ask them give me that <tt>cat</tt> and post back ... don't have access to that CE ... only to the schedds at JLaB<br/>
<span style="color: #53b759"><span style="font-size: small">(14:45:08)</span> <b>marian:</b></span> ugh, what do you want me to do with that pull 181? :slightly_smiling_face: I don't think they might roll it there...<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:48:36)</span> <b>bbockelm:</b></span> No no -- just saying that I've got something clever on the client side.<br/>
<span style="color: #53b759"><span style="font-size: small">(14:51:42)</span> <b>marian:</b></span> ah, ok<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:51:51)</span> <b>bbockelm:</b></span> :confused: interesting - I can query successfully with a proxy from CERN but not the clas12 one.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:52:15)</span> <b>bbockelm:</b></span> Also ask them for a <tt>rpm -q osg-ca-certs; rpm -q osg-ca-certs --verify</tt><br/>
<span style="color: #53b759"><span style="font-size: small">(14:52:30)</span> <b>marian:</b></span> ok, adding to questions<br/>
<span style="color: #43761b"><span style="font-size: small">(14:53:11)</span> <b>blin:</b></span> we updated the CA certs live so i'd be shocked if it was an issue with the local CA installation<br/>
<span style="color: #53b759"><span style="font-size: small">(14:53:12)</span> <b>marian:</b></span> fwiw, we've updated to latest and ran fetch-crl with Brian<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:55:06)</span> <b>bbockelm:</b></span> what's the ticket#?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:57:08)</span> <b>didavila:</b></span> I have seen this error before: <tt>tlsv1 alert unknown ca SSL alert number 48</tt> when a new version of a LE cert gets deployed in a condor node<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:57:32)</span> <b>didavila:</b></span> and by new I mean signed by a different intermediate CA<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:58:05)</span> <b>didavila:</b></span> seems to me that the factory does not recognize the CA which signed the CE’s cert<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:58:49)</span> <b>didavila:</b></span> do we have access to the CE?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:59:51)</span> <b>bbockelm:</b></span> @didavila - that's the mystery, this is an InCommon cert:<br/><br/><pre>$ ./check_ce_cert --ce-hostname <a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a> --collector <a href="http://osg-ce-1.jlab.org:9619">osg-ce-1.jlab.org:9619</a> | openssl x509 -noout<br/> -text<br/>Certificate:<br/>    Data:<br/>        Version: 3 (0x2)<br/>        Serial Number:<br/>            ba:eb:bc:a3:8d:10:b9:a8:c7:fb:1f:81:e6:59:73:ec<br/>    Signature Algorithm: sha256WithRSAEncryption<br/>        Issuer: C=US, O=Internet2, OU=InCommon, CN=InCommon IGTF Server CA<br/>        Validity<br/>            Not Before: Jul  6 00:00:00 2021 GMT<br/>            Not After : Jul  6 23:59:59 2022 GMT<br/>        Subject: DC=org, DC=incommon, C=US, ST=Virginia, L=Newport News, O=Thomas Jefferson National Accelerator Facility, OU=SciComp, CN=osg-ce-1.j<br/><a href="http://lab.org">lab.org</a></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(15:00:24)</span> <b>bbockelm:</b></span> (although @blin this makes me worry that there's some intermediate InCommon cert about to hit us)<br/>
<span style="color: #53b759"><span style="font-size: small">(15:01:37)</span> <b>marian:</b></span> here we go;<br/>
<span style="color: #53b759"><span style="font-size: small">(15:01:59)</span> <b>marian:</b></span> <pre>[root@osg-ce-1 ~]# openssl x509 -in /etc/grid-security/hostcert.pem -noout -text<br/>Certificate:<br/>    Data:<br/>        Version: 3 (0x2)<br/>        Serial Number:<br/>            ba:eb:bc:a3:8d:10:b9:a8:c7:fb:1f:81:e6:59:73:ec<br/>    Signature Algorithm: sha256WithRSAEncryption<br/>        Issuer: C=US, O=Internet2, OU=InCommon, CN=InCommon IGTF Server CA<br/>        Validity<br/>            Not Before: Jul  6 00:00:00 2021 GMT<br/>            Not After : Jul  6 23:59:59 2022 GMT<br/>        Subject: DC=org, DC=incommon, C=US, ST=Virginia, L=Newport News, O=Thomas Jefferson National Accelerator Facility, OU=SciComp, CN=<a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a><br/>        Subject Public Key Info:<br/>            Public Key Algorithm: rsaEncryption<br/>                Public-Key: (2048 bit)<br/>                Modulus:<br/>          Exponent: 65537 (0x10001)<br/>        X509v3 extensions:<br/>            X509v3 Authority Key Identifier:<br/>                keyid:61:E6:5F:C9:27:BA:40:F8:EC:28:06:F3:89:32:5A:56:5F:E2:8E:D1<br/>            X509v3 Subject Key Identifier:<br/>                59:30:41:30:61:F8:CE:7C:29:A3:27<br/>15:BB:61:3A:1B:EE:61:FC<br/>            X509v3 Key Usage: critical<br/>                Digital Signature, Key Encipherment, Data Encipherment<br/>            X509v3 Basic Constraints: critical<br/>                CA:FALSE<br/>            X509v3 Extended Key Usage:<br/>                TLS Web Server Authentication, TLS Web Client Authentication<br/>            X509v3 Certificate Policies:<br/>                Policy: 1.3.6.1.4.1.5923.1.4.3.4.1.1<br/>                Policy: 1.2.840.113612.5.2.2.1<br/>           X509v3 CRL Distribution Points:<br/>                Full Name:<br/>                  URI:<a href="http://crl.incommon-igtf.org/InCommonIGTFServerCA.crl">http://crl.incommon-igtf.org/InCommonIGTFServerCA.crl</a><br/>            Authority Information Access:<br/>                CA Issuers - URI:<a href="http://crt.incommon-igtf.org/InCommonIGTFServerCA.crt">http://crt.incommon-igtf.org/InCommonIGTFServerCA.crt</a><br/>                OCSP - URI:<a href="http://ocsp.incommon-igtf.org">http://ocsp.incommon-igtf.org</a><br/>            CT Precertificate SCTs:<br/>                Signed Certificate Timestamp:<br/>                    Version   : v1(0)<br/>                    Log ID    : 46:A5:55:EB:75:FA:91:20:30:B5:A2:89:69:F4:F3:7D:<br/>                                11:2C:41:74:BE:FD:49:B8:85<br/>F2:FC:70:FE:6D:47<br/>                    Timestamp : Jul  6 19:58:53.820 2021 GMT<br/>                    Extensions: none<br/>                    Signature : ecdsa-with-SHA256<br/>[root@osg-ce-1 ~]# cat /etc/grid-security/grid-mapfile<br/># This file is managed by Puppet. DO NOT EDIT.<br/>"/DC=org/DC=cilogon/C=US/O=University of Wisconsin-Madison/CN=Brian Lin A2266246"<br/>"/DC=org/DC=cilogon/C=US/O=Thomas Jefferson National Accelerator Facility/CN=Wesley Moore A21306551" wmoore<br/>"/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a>" fejlab<br/>[root@osg-ce-1 ~]# cat /etc/grid-security/voms-mapfile<br/># <a href="https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#mapping-vos">https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#mapping-vos</a><br/>#<br/># Consult the default VO mappings in /usr/share/osg/voms-mapfile-default to<br/># determine the mapped Unix account names.<br/>"/Gluex/Role=NULL/Capability=NULL" osg-gluex<br/>"/clas12/*" osg-clas12<br/>"/eic/*" osg-eic<br/>[root@osg-ce-1 ~]# rpm -q osg-ca-certs; rpm -q osg-ca-certs --verify<br/>osg-ca-certs-1.97-1.osg35.el7.noarch</pre><br/><br/>
<span style="color: #53b759"><span style="font-size: small">(15:02:20)</span> <b>marian:</b></span> @didavila, we don't have access to that CE<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:02:20)</span> <b>bbockelm:</b></span> Nope - I need the <tt>cat</tt> of the hostcert.pem<br/>
<span style="color: #53b759"><span style="font-size: small">(15:02:29)</span> <b>marian:</b></span> yeah, asked that too<br/>
<span style="color: #53b759"><span style="font-size: small">(15:02:30)</span> <b>marian:</b></span> mnt<br/>
<span style="color: #43761b"><span style="font-size: small">(15:04:28)</span> <b>blin:</b></span> @bbockelm how would a new intermediate would bite us as long as the IGTF CA is still signing the host certs? i could see it being a problem if the sites are including the full chain in their hostcert<br/>
<span style="color: #43761b"><span style="font-size: small">(15:06:33)</span> <b>blin:</b></span> Kurt/Wesley are on slack, maybe we should just invite them to this channel?<br/>
<span style="color: #53b759"><span style="font-size: small">(15:10:56)</span> <b>marian:</b></span> I'm pretty much posting output from Kurt he is giving me from DM-ing with him ... he doesn't watch Slack often, though<br/>
<span style="color: #53b759"><span style="font-size: small">(15:11:26)</span> <b>marian:</b></span> here we go:<br/>
<span style="color: #53b759"><span style="font-size: small">(15:11:31)</span> <b>marian:</b></span> <pre>[root@osg-ce-1 ~]# cat /etc/grid-security/hostcert.pem<br/>-----BEGIN CERTIFICATE-----<br/>MIIGzTCCBbWgAwIBAgIRALrrvKONELmox/sfgeZZc+wwDQYJKoZIhvcNAQELBQAw<br/>VjELMAkGA1UEBhMCVVMxEjAQBgNVBAoTCUludGVybmV0MjERMA8GA1UECxMISW5D<br/>b21tb24xIDAeBgNVBAMTF0luQ29tbW9uIElHVEYgU2VydmVyIENBMB4XDTIxMDcw<br/>NjAwMDAwMFoXDTIyMDcwNjIzNTk1OVowgc0xEzARBgoJkiaJk/IsZAEZFgNvcmcx<br/>GDAWBgoJkiaJk/IsZAEZFghpbmNvbW1vbjELMAkGA1UEBhMCVVMxETAPBgNVBAgT<br/>CFZpcmdpbmlhMRUwEwYDVQQHEwxOZXdwb3J0IE5ld3MxNzA1BgNVBAoTLlRob21h<br/>cyBKZWZmZXJzb24gTmF0aW9uYWwgQWNjZWxlcmF0b3IgRmFjaWxpdHkxEDAOBgNV<br/>BAsTB1NjaUNvbXAxGjAYBgNVBAMTEW9zZy1jZS0xLmpsYWIub3JnMIIBIjANBgkq<br/>hkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2/Yoas7s3EYdhyoAUU0G6b4hoA9Gaqj5<br/>gR28vEXDl+Y+HiXjw1ukbJhtWRdVmu7OqMHlGnARSvovCy8gJmINSgpCqs9H/QGb<br/>FrFrmUl6XkIg4YD53cEWxniRX6TacK0EIZQ1Fa1SEU3sepiWog5D/WLh53lGZGVO<br/>cpVxvhSoSkjU9uHZWqAJpgSfilLJVl3CpOOpvyBQ4Rc8o2Oq2Usbq1nli5Ac6Yi8<br/>55xKNgcdvT2E3KQYmFVcS1xDSgGu31s0jxYacc04IU3TrycIzlxRqUx7CfyFJtTL<br/>4SuoVe1L7TjKddB8RVgIagFGjlJ8ggUxZY2v4EykkXkrtI1BrbDzcwIDAQABo4ID<br/>HDCCAxgwHwYDVR0jBBgwFoAUYeZfySe6QPjsKAbziTJaVl/ijtEwHQYDVR0OBBYE<br/>FFkwQTBh+M58KaMnqxW7YTob7mH8MA4GA1UdDwEB/wQEAwIEsDAMBgNVHRMBAf8E<br/>AjAAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAyBgNVHSAEKzApMA8G<br/>DSsGAQQBriMBBAMEAQEwDAYKKoZIhvdMBQICATAIBgZngQwBAgIwRgYDVR0fBD8w<br/>PTA7oDmgN4Y1aHR0cDovL2NybC5pbmNvbW1vbi1pZ3RmLm9yZy9JbkNvbW1vbklH<br/>VEZTZXJ2ZXJDQS5jcmwwfAYIKwYBBQUHAQEEcDBuMEEGCCsGAQUFBzAChjVodHRw<br/>Oi8vY3J0LmluY29tbW9uLWlndGYub3JnL0luQ29tbW9uSUdURlNlcnZlckNBLmNy<br/>dDApBggrBgEFBQcwAYYdaHR0cDovL29jc3AuaW5jb21tb24taWd0Zi5vcmcwggF/<br/>BgorBgEEAdZ5AgQCBIIBbwSCAWsBaQB3AEalVet1+pEgMLWiiWn0830RLEF0vv1J<br/>uIWr8vxw/m1HAAABen1m53wAAAQDAEgwRgIhAK8si0Ao1lGQ8BrGFa3MdEozbTvR<br/>UV2H2Ja6E3NTdidCAiEAsBP6IxqW63vkzRFRdH40J9iq3n6uIANsGXcic/JB8bwA<br/>dgBByMqx3yJGShDGoToJQodeTjGLGwPr60vHaPCQYpYG9gAAAXp9Zuc3AAAEAwBH<br/>MEUCIHyQy7jI0WCnLCq/tzerUu+NRB9ZjZi4TF3C2rhrm+CFAiEAtyZtbK8CGnrK<br/>v/sleTcFQAN7CyKNXFFTJCBSPZP1ktMAdgApeb7wnjk5IfBWc59jpXflvld9nGAK<br/>+PlNXSZcJV3HhAAAAXp9ZucSAAAEAwBHMEUCIAJkImHaJSxUS+/pAIuhlQ6lqzmA<br/>Pa2wYhM7SbfFNWN2AiEAiYn4PWFm1lSo0HqbTAmUHwAn1F0hvIjs0jLqYJqw/hQw<br/>HAYDVR0RBBUwE4IRb3NnLWNlLTEuamxhYi5vcmcwDQYJKoZIhvcNAQELBQADggEB<br/>AH2lgnH7okwPhrcblF8tqSYg/YN8Q3FFYM6+obanpK+/0Dn/N6dMdWw8BdBrA5Ht<br/>5fLIP3vEDH3aAz/YFwAsFvhnfvD5pvK/UjhO7Dbx2M52icsPMRZWJSN/kMAl3fSX<br/>8hnzlZ87PFvNKxElj06J8GOiKJoageRe13wvz1/9tGz/c+xJE4OVeeFeVRIK+rW/<br/>Qd/FDdRlPeCf6/PziJVjHWQHv4DR5WIxzxmWADgeKUKcXGG9HczPXqkbwnes6xRN<br/>2o7tPqk3MxAw2rqUAjkBMWAnop31CIyLj2oVN7fv8lsowLGwkMvrfl5rDiGHMipX<br/>92una8CqrDRV8qXooKS8xpI=<br/>-----END CERTIFICATE-----<br/>-----BEGIN CERTIFICATE-----<br/>MIIF5TCCA82gAwIBAgIRAKJ784Vgmf4VaM2qFHU5jtYwDQYJKoZIhvcNAQENBQAw<br/>gYUxCzAJBgNVBAYTAkdCMRswGQYDVQQIExJHcmVhdGVyIE1hbmNoZXN0ZXIxEDAO<br/>BgNVBAcTB1NhbGZvcmQxGjAYBgNVBAoTEUNPTU9ETyBDQSBMaW1pdGVkMSswKQYD<br/>VQQDEyJDT01PRE8gUlNBIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MB4XDTE0MDEw<br/>MTAwMDAwMFoXDTIzMTIzMTIzNTk1OVowVjELMAkGA1UEBhMCVVMxEjAQBgNVBAoT<br/>CUludGVybmV0MjERMA8GA1UECxMISW5Db21tb24xIDAeBgNVBAMTF0luQ29tbW9u<br/>IElHVEYgU2VydmVyIENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA<br/>hc90D6ReKjC10rFRqMRp/+oLUj+/Qqvc71TeoukKtRDKVkzZ31wqimaoLN6phV4y<br/>W525nJo7HuE+P23CFOAYfE3JToqwRwwPkOX6b1T2HWZlQoKQgWuVvAN0X66ti3IP<br/>7yKFfJ+6diAx5lnhMpkO9+FKQN7HmlP8nIQkqhjuLYEKjwlCvo6k8ALHtPz2S8w4<br/>16b5BpCY1l5wNSe3mt71Ol4cYyHmJ398wCW3p9N5BBdJKPgBkDVIANDngh5Q30GE<br/>tuYqWBmcqxTtMuRCpTC661y80Ib2vh6ypnr0s7LwPoKQkHjKZvIKdcGgkiCSAz5k<br/>ljSw6QbfRpb5VoT/0sBHMwIDAQABo4IBfDCCAXgwHwYDVR0jBBgwFoAUu69+Aj36<br/>pvE8hI6t7jiY7NkyMtQwHQYDVR0OBBYEFGHmX8knukD47CgG84kyWlZf4o7RMA4G<br/>A1UdDwEB/wQEAwIBhjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdJQQWMBQGCCsG<br/>AQUFBwMBBggrBgEFBQcDAjAyBgNVHSAEKzApMA8GDSsGAQQBriMBBAMEAQEwDAYK<br/>KoZIhvdMBQICATAIBgZngQwBAgIwTAYDVR0fBEUwQzBBoD+gPYY7aHR0cDovL2Ny<br/>bC5jb21vZG9jYS5jb20vQ09NT0RPUlNBQ2VydGlmaWNhdGlvbkF1dGhvcml0eS5j<br/>cmwwcQYIKwYBBQUHAQEEZTBjMDsGCCsGAQUFBzAChi9odHRwOi8vY3J0LmNvbW9k<br/>b2NhLmNvbS9DT01PRE9SU0FBZGRUcnVzdENBLmNydDAkBggrBgEFBQcwAYYYaHR0<br/>cDovL29jc3AuY29tb2RvY2EuY29tMA0GCSqGSIb3DQEBDQUAA4ICAQAQFIPT14MV<br/>pGw2cNhWYOmafXfQ2dWfmsxccnBL2+6F3KrZTfK2KKcyp0DsdWaCyJLwRHcxJXL7<br/>Cd1TZFWjqa/agNGsK7B3u8UKZRVwMyvPDtQ8yRzv2qipLNNbSMPvKBZdHpfA5/F6<br/>H15l0tJwdvMAcwt17lW0wzV0VrjSN+t7o5WQdGiF4wL7oX/gc/+9yQf45ijOhAOJ<br/>ayIAWZcD1MnADq+Rhon8NkWk2XpHJ6oFwLNE+ePS9oLRiLAN0LO0EQm0VNXCuCEk<br/>G6nKAFTwHDNSIFDkwdXyAh5UbMK7db+8Ov/aywUOo+8f1SbKkzQDpFjiZ0g1j/16<br/>duwaJQZG0apR35jodALK2kwdyWls4b41Yipv4smLJURTNf9+3i2+YBt6TSFeGuFU<br/>CGe67WEjkPTAGKoTcqDT1YECoGOGHFx6J5rbAtF9u0EDFwuxCkrzT9KV/Pi17CbT<br/>3HqeN2fiBGfqz3m9cwFijTyVyZYMRiC1TTloUXk60fv6TvUJlfQDsX4vZ9IcU7SP<br/>nCfxKXJsZWn9CYx/C5CFGR8u29CRn1IwDv+CpvKz0Z9jEFw+ZVvU9EClj2aN8UiN<br/>7ljJniNnuPDPVhx4wkqRyz05fQS5Txkp5Ljyj/zvngO9alW4tMA0iUgYZRFKQbhq<br/>JfcTEHuGEWV1/air3h4K3++bIqe9p1DeRQ==<br/>-----END CERTIFICATE-----<br/>-----BEGIN CERTIFICATE-----<br/>MIIFfjCCBGagAwIBAgIQZ970PvF72uJP9ZQGBtLAhDANBgkqhkiG9w0BAQwFADB7<br/>MQswCQYDVQQGEwJHQjEbMBkGA1UECAwSR3JlYXRlciBNYW5jaGVzdGVyMRAwDgYD<br/>VQQHDAdTYWxmb3JkMRowGAYDVQQKDBFDb21vZG8gQ0EgTGltaXRlZDEhMB8GA1UE<br/>AwwYQUFBIENlcnRpZmljYXRlIFNlcnZpY2VzMB4XDTA0MDEwMTAwMDAwMFoXDTI4<br/>MTIzMTIzNTk1OVowgYUxCzAJBgNVBAYTAkdCMRswGQYDVQQIExJHcmVhdGVyIE1h<br/>bmNoZXN0ZXIxEDAOBgNVBAcTB1NhbGZvcmQxGjAYBgNVBAoTEUNPTU9ETyBDQSBM<br/>aW1pdGVkMSswKQYDVQQDEyJDT01PRE8gUlNBIENlcnRpZmljYXRpb24gQXV0aG9y<br/>aXR5MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAkehUktIKVrGsDSTd<br/>xc9EZ3SZKzejfSNwAHG8U9/E+ioSj0t/EFa9n3Byt2F/yUsPF6c947AEYe7/EZfH<br/>9IY+Cvo+XPmT5jR62RRr55yzhaCCenavcZDX7P0N+pxs+t+wgvQUfvm+xKYvT3+Z<br/>f7X8Z0NyvQwA1onrayzT7Y+YHBSrfuXjbvzYqOSSJNpDa2K4Vf3qwbxstovzDo2a<br/>5JtsaZn4eEgwRdWt4Q08RWD8MpZRJ7xnw8outmvqRsfHIKCxH2XeSAi6pE6p8oNG<br/>N4Tr6MyBSENnTnIqm1y9TBsoilwie7SrmNnu4FGDwwlGTm0+mfqVF9p8M1dBPI1R<br/>7Qu2XK8sYxrfV8g/vOldxJuvRZnio1oktLqpVj3Pb6r/SVi+8Kj/9Lit6Tf7urj0<br/>Czr56ENCHonYhMsT8dm74YlguIwoVqwUHZwK53Hrzw7dPamWoUi9PPevtQ0iTMAR<br/>gexWO/bTouJbt7IEIlKVgJNp6I5MZfGRAy1wdALqi2cVKWlSArvX31BqVUa/oKMo<br/>YX9w0MOiqiwhqkfOKJwGRXa/ghgntNWutMtQ5mv0TIZxMOmm3xaG4Nj/QN370EKI<br/>f6MzOi5cHkERgWPOGHFrK+ymircxXDpqR+DDeVnWIBqv8mqYqnK8V0rSS527EPyw<br/>TEHl7R09XiidnMy/s1Hap0flhFMCAwEAAaOB8jCB7zAfBgNVHSMEGDAWgBSgEQoj<br/>PpbxB+zirynvgqV/0DCktDAdBgNVHQ4EFgQUu69+Aj36pvE8hI6t7jiY7NkyMtQw<br/>DgYDVR0PAQH/BAQDAgGGMA8GA1UdEwEB/wQFMAMBAf8wEQYDVR0gBAowCDAGBgRV<br/>HSAAMEMGA1UdHwQ8MDowOKA2oDSGMmh0dHA6Ly9jcmwuY29tb2RvY2EuY29tL0FB<br/>QUNlcnRpZmljYXRlU2VydmljZXMuY3JsMDQGCCsGAQUFBwEBBCgwJjAkBggrBgEF<br/>BQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMA0GCSqGSIb3DQEBDAUAA4IB<br/>AQB/8lY1sG2VSk50rzribwGLh9Myl+34QNJ3UxHXxxYuxp3mSFa+gKn4vHjSyGMX<br/>roztFjH6HxjJDsfuSHmfx8m5vMyIFeNoYdGfHUthgddWBGPCCGkm8PDlL9/ACiup<br/>BfQCWmqJ17SEQpXj6/d2IF412cDNJQgTTHE4joewM4SRmR6R8ayeP6cdYIEsNkFU<br/>oOJGBgusG8eZNoxeoQukntlCRiTFxVuBrq2goNyfNriNwh0V+oitgRA5H0TwK5/d<br/>EFQMBzSxNtEU/QcCPf9yVasn1iyBQXEpjUH0UFcafmVgr8vFKHaYrrOoU3aL5iFS<br/>a+oh0IQOSU6IU9qSLucdCGbX<br/>-----END CERTIFICATE-----<br/>[root@osg-ce-1 ~]#</pre><br/><br/>
<span style="color: #53b759"><span style="font-size: small">(15:11:41)</span> <b>marian:</b></span> ^ @bbockelm<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:12:02)</span> <b>didavila:</b></span> yeap, looks like the are including the intermediate certs within the hostcert<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:12:42)</span> <b>didavila:</b></span> IIRC if you remove all but the first block of:<br/><pre>-----BEGIN CERTIFICATE-----<br/>-----END CERTIFICATE-----</pre><br/><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:12:50)</span> <b>didavila:</b></span> that could fix it<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:14:37)</span> <b>didavila:</b></span> the subject of the last block is:<br/><pre>subject= /C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Certification Authority</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:15:01)</span> <b>didavila:</b></span> isn’t that not longer included in the list of CA certs?<br/>
<span style="color: #53b759"><span style="font-size: small">(15:15:26)</span> <b>marian:</b></span> asked to backup cert and do suggested edit and restart <tt>condor-ce.service</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(15:17:16)</span> <b>blin:</b></span> nah, i think that's still good. it looks like that CA is no longer self signed? from the above chain:<br/><pre>$ openssl x509 -in root -noout -subject -issuer<br/>subject=C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Certification Authority<br/>issuer=C = GB, ST = Greater Manchester, L = Salford, O = Comodo CA Limited, CN = AAA Certificate Services</pre><br/>vs what we ship<br/><pre># openssl x509 -in COMODO-RSA-CA.pem -noout -subject -issuer<br/>subject= /C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Certification Authority<br/>issuer= /C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Certification Authority</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(15:18:28)</span> <b>blin:</b></span> which i mean, should work fine as long as they don't include the newly signed RSA CA<br/>
<span style="color: #43761b"><span style="font-size: small">(15:18:34)</span> <b>blin:</b></span> this came up here <a href="https://support.opensciencegrid.org/a/tickets/67118">https://support.opensciencegrid.org/a/tickets/67118</a><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:22:46)</span> <b>didavila:</b></span> yeap, that makes sense<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:23:35)</span> <b>didavila:</b></span> should we then add the new signer of COMODO to the osg-ca-certs?<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:23:37)</span> <b>bbockelm:</b></span> that's what I was afraid of.  This technically is an OpenSSL bug.  OpenSSL is getting confused because the client and server are both signed by the same CA _but_ have two different chains of trust for the same CA.  That's not illegal per se but apparently OpenSSL can't handle it.<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(15:25:35)</span> <b>blin:</b></span> i suppose we should petition the IGTF folks to add the AAA root?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:08:55)</span> <b>bbockelm:</b></span> Yup!  Maybe @drakejc would want to take up that banner?<br/>
</blockquote>
<span style="color: #53b759"><span style="font-size: small">(15:24:05)</span> <b>marian:</b></span> they did edit on the cert file and restarted CE<br/>
<span style="color: #53b759"><span style="font-size: small">(15:24:15)</span> <b>marian:</b></span> there is a slight change in the behaviour:<br/>
<span style="color: #53b759"><span style="font-size: small">(15:24:33)</span> <b>marian:</b></span> <pre>07/09/21 16:22:10 (D_SECURITY) DC_AUTHENTICATE: Success.<br/>07/09/21 16:22:10 (D_ALWAYS) PERMISSION DENIED to gsi@unmapped from host 169.228.38.43 for command 60021 (DC_NOP_WRITE), access level WRITE: reason: cached result for WRITE; see first case for the full reason<br/>07/09/21 16:22:10 (D_SECURITY) DC_AUTHENTICATE: sending session ad:<br/>ReturnCode = "DENIED"<br/>ValidCommands = "60004,60012,60021,421,464,481,511,521,74000,507,60007,457,60020,443,441,6,12,515,516,1111,471"<br/>TriedAuthentication = true<br/>Sid = "osg-ce-1:155802:1625862130:5"<br/>User = "gsi@unmapped"<br/>07/09/21 16:22:10 (D_SECURITY) DC_AUTHENTICATE: sent session osg-ce-1:155802:1625862130:5 info!<br/>07/09/21 16:22:10 (D_ALWAYS) DC_AUTHENTICATE: Command not authorized, done!</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(15:25:00)</span> <b>marian:</b></span> <pre>...<br/><br/>ValidCommands = "60004,60012,60021,421,478,480,486,488,489,487,499,502,464,1112,481,509,511,521,74000,507,60007,457,60020,443,441,6,12,515,516,519,1111,471"<br/>07/09/21 16:23:36 (D_SECURITY) SECMAN: other side is $CondorVersion: 8.8.13 Mar 19 2021 PackageID: 8.8.13-0.533839 RC $, NOT reauthenticating.<br/>07/09/21 16:23:36 (D_SECURITY) DC_AUTHENTICATE: not authenticating.<br/>07/09/21 16:23:36 (D_SECURITY) DC_AUTHENTICATE: message authenticator enabled with key id osg-ce-1:155802:1625862215:8.<br/>07/09/21 16:23:36 (D_SECURITY) DC_AUTHENTICATE: Success.<br/>07/09/21 16:23:36 (D_ALWAYS) PERMISSION GRANTED to osg-gluex@users.htcondor.org from host 169.228.38.43 for command 1111 (QMGMT_READ_CMD), access level READ: reason: READ authorization policy allows access by anyone<br/>07/09/21 16:23:36 (D_ALWAYS:2) ForkWorker::Fork: New child of 155802 = 156109<br/>07/09/21 16:23:36 (D_ALWAYS) Number of Active Workers 0<br/>07/09/21 16:23:36 (D_ALWAYS:2) QMGR forked query<br/>07/09/21 16:23:36 (D_ALWAYS:2) QMGR forked query done</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(15:25:25)</span> <b>marian:</b></span> <pre>[root@osg-ce-1 condor-ce]# condor_ce_q<br/>-- Schedd: <a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a> : &lt;129.57.198.168:28848&gt; @ 07/09/21 16:24:11<br/>OWNER     BATCH_NAME    SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS<br/>wmoore    ID: 482     11/13 21:05      _      _      _      1 482.0<br/>osg-gluex ID: 276857   7/9  16:18      _      _      1      1 276857.0<br/>osg-gluex ID: 276858   7/9  16:24      _      _      1      1 276858.0<br/>Total for query: 3 jobs; 0 completed, 1 removed, 2 idle, 0 running, 0 held, 0 suspended<br/>Total for all users: 3 jobs; 0 completed, 1 removed, 2 idle, 0 running, 0 held, 0 suspended</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(15:25:33)</span> <b>marian:</b></span> so something glideins in!!!<br/>
<span style="color: #53b759"><span style="font-size: small">(15:25:38)</span> <b>marian:</b></span> from GLUEX!<br/>
<span style="color: #53b759"><span style="font-size: small">(15:26:38)</span> <b>marian:</b></span> I see also signs from JLAB FE glideins that are requested:<br/><pre>000 (6305974.003.000) 07/09 13:25:06 Job submitted from host: &lt;169.228.38.43:9618?addrs=169.228.38.43-9618&amp;noUDP&amp;sock=3507309_d3b8_11&gt;</pre><br/>...from condor activity log<br/>
<span style="color: #53b759"><span style="font-size: small">(15:27:33)</span> <b>marian:</b></span> nevermind, said it too early, gets held:<br/><pre>012 (6305974.003.000) 07/09 13:26:19 Job was held.<br/>        Error connecting to schedd <a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a>: SECMAN:2007:Failed to received post-auth ClassAd<br/>        Code 0 Subcode 0</pre><br/>and later removed ...<br/>
<span style="color: #53b759"><span style="font-size: small">(15:31:09)</span> <b>marian:</b></span> <pre>$ condor_ce_ping -verbose -name <a href="http://osg-ce-1.jlab.org">osg-ce-1.jlab.org</a> -pool <a href="http://osg-ce-1.jlab.org:9619">osg-ce-1.jlab.org:9619</a> WRITE<br/>WRITE failed!<br/>SECMAN:2010:Received "DENIED" from server for user gsi@unmapped using method GSI.</pre><br/>that also slightly changed what I had before ...<br/>
<span style="color: #43761b"><span style="font-size: small">(15:33:15)</span> <b>blin:</b></span> what proxy are you using there? this smells of a mapping issue now<br/>
<span style="color: #43761b"><span style="font-size: small">(15:33:32)</span> <b>blin:</b></span> (they should probably remove the fejlab line from their grid-mapfile but I don't think that's necessarily relevant)<br/>
<span style="color: #53b759"><span style="font-size: small">(15:34:51)</span> <b>marian:</b></span> I have this;<br/>
<span style="color: #53b759"><span style="font-size: small">(15:35:14)</span> <b>marian:</b></span> <pre> voms-proxy-info -all<br/>subject   : /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org/CN=1842328224">fejlab.svc.opensciencegrid.org/CN=1842328224</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a><br/>identity  : /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a><br/>type      : RFC compliant proxy<br/>strength  : 1024 bits<br/>path      : pilot_clas12_proxy.proxy<br/>timeleft  : 20:59:00<br/>key usage : Digital Signature, Key Encipherment, Data Encipherment<br/>=== VO clas12 extension information ===<br/>VO        : clas12<br/>subject   : /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://clas12.voms.opensciencegrid.org">clas12.voms.opensciencegrid.org</a><br/>attribute : /clas12/Role=NULL/Capability=NULL<br/>timeleft  : 20:59:00<br/>uri       : <a href="http://clas12.voms.opensciencegrid.org:15001">clas12.voms.opensciencegrid.org:15001</a></pre><br/>
<span style="color: #53b759"><span style="font-size: small">(15:35:48)</span> <b>marian:</b></span> which we added manually on that CE in the <tt>grid-mapfile</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(15:36:12)</span> <b>blin:</b></span> yeah, sites generally shouldn't do that for pilots<br/>
<span style="color: #43761b"><span style="font-size: small">(15:36:19)</span> <b>blin:</b></span> they should rely on the voms-mapfile<br/>
<span style="color: #53b759"><span style="font-size: small">(15:36:27)</span> <b>marian:</b></span> also, the note, they used letsencrypt cert on that CE before they switched to incommon<br/>
<span style="color: #43761b"><span style="font-size: small">(15:37:35)</span> <b>blin:</b></span> for example, i think having the grid-mapfile line will result in clas12/eic being mapped to the same user since their proxies can only be differentiated based on their VO attrs<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:40:49)</span> <b>didavila:</b></span> is condor using gridmpafile? doesn’t it have its own mapfile ?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:41:10)</span> <b>didavila:</b></span> the one pointed by <tt>CERTIFICATE_MAPFILE</tt>` ?<br/>
<span style="color: #53b759"><span style="font-size: small">(15:41:53)</span> <b>marian:</b></span> that is <tt>condor_mapfile</tt> you're referring to<br/>
<span style="color: #53b759"><span style="font-size: small">(15:42:52)</span> <b>marian:</b></span> I think we went through these with BrianL during online Zoom debugging<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:43:27)</span> <b>didavila:</b></span> yes<br/>
<span style="color: #53b759"><span style="font-size: small">(15:43:28)</span> <b>marian:</b></span> wanted to see if submit and local run works ... that's why hard-coded mapping<br/>
<span style="color: #53b759"><span style="font-size: small">(15:43:36)</span> <b>marian:</b></span> that worked<br/>
<span style="color: #43761b"><span style="font-size: small">(15:44:09)</span> <b>blin:</b></span> <tt>/etc/condor-ce/condor_mapfile</tt> is the mapfile "entrypoint". if it contains <tt>GSI (.*) GSS_ASSIST_GRIDMAP</tt> it will do a callout to another service like LCMAPS<br/>
<span style="color: #53b759"><span style="font-size: small">(15:44:16)</span> <b>marian:</b></span> <tt>condor_mapfile</tt> on the CE is very minimal<br/>
<span style="color: #43761b"><span style="font-size: small">(15:44:17)</span> <b>blin:</b></span> and LCMAPS uses the grid-mapfile and vo-mapfile<br/>
<span style="color: #53b759"><span style="font-size: small">(15:52:56)</span> <b>marian:</b></span> how could we wrap this up for today with the JLAB CE?<br/>
<span style="color: #53b759"><span style="font-size: small">(15:53:41)</span> <b>marian:</b></span> people there are ending work day...<br/>
<span style="color: #43761b"><span style="font-size: small">(15:54:20)</span> <b>blin:</b></span> get <tt>/etc/grid-security/*mapfile</tt> , <tt>/etc/grid-security/gsi-authz.conf</tt>, <tt>/etc/condor-ce/condor_mapfile</tt> , and <tt>condor_ce_config_val -dump</tt><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:00:07)</span> <b>didavila:</b></span> if you could add:<br/>SCHEDD_DEBUG=D_SECURITY<br/>in their ce configs, you could see, in the logs, more info about how the mapping is being done<br/>
<span style="color: #53b759"><span style="font-size: small">(16:00:40)</span> <b>marian:</b></span> I believe we added it...<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:02:03)</span> <b>didavila:</b></span> duh, you’re right, I see it in the logs, so maybe you need a bit more logs, something above:<br/><pre>07/09/21 16:22:10 (D_SECURITY) DC_AUTHENTICATE: Success.</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:02:17)</span> <b>didavila:</b></span> there should be some mention of the mapping<br/>
<span style="color: #43761b"><span style="font-size: small">(16:02:36)</span> <b>blin:</b></span> there is a 30 min mapping cache<br/>
<span style="color: #43761b"><span style="font-size: small">(16:03:02)</span> <b>blin:</b></span> <a href="https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#htcondor-ce-hosts">https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#htcondor-ce-hosts</a><br/>
<span style="color: #43761b"><span style="font-size: small">(16:03:23)</span> <b>blin:</b></span> may be worth turning that off/down if they're actively mucking with mappings<br/>
<span style="color: #53b759"><span style="font-size: small">(16:05:10)</span> <b>marian:</b></span> <pre>[root@osg-ce-1 condor-ce]# cat /etc/grid-security/*mapfile<br/># File managed by Puppet - DO NOT EDIT<br/># This file is for users to be banned from this site<br/># Add shell-style (i.e. fnmatch(3)) patterns, in quotes, one per line, based on<br/># user cert DNs.<br/>#<br/># Example:<br/># "/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Bad User"<br/># File managed by Puppet - DO NOT EDIT<br/># This file is for VOs to be banned from this site<br/># Add shell-style (i.e. fnmatch(3)) patterns, in quotes, one per line, based on<br/># proxy FQANs.<br/>#<br/># Examples:<br/># "/fermilab/*"<br/># "/cms/Role=cmsuser/*"<br/># This file is managed by Puppet. DO NOT EDIT.<br/>"/DC=org/DC=cilogon/C=US/O=University of Wisconsin-Madison/CN=Brian Lin A2266246"<br/>"/DC=org/DC=cilogon/C=US/O=Thomas Jefferson National Accelerator Facility/CN=Wesley Moore A21306551" wmoore<br/>"/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a>" fejlab<br/># <a href="https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#mapping-vos">https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#mapping-vos</a><br/>#<br/># Consult the default VO mappings in /usr/share/osg/voms-mapfile-default to<br/># determine the mapped Unix account names.<br/>"/Gluex/Role=NULL/Capability=NULL" osg-gluex<br/>"/clas12/*" osg-clas12<br/>"/eic/*" osg-eic<br/>[root@osg-ce-1 condor-ce]# cat /etc/grid-security/gsi-authz.conf<br/>globus_mapping liblcas_lcmaps_gt4_mapping.so lcmaps_callout<br/>[root@osg-ce-1 condor-ce]# cat /etc/condor-ce/condor_mapfile<br/>GSI (.*) GSS_ASSIST_GRIDMAP<br/>SSL "[-.A-Za-z0-9/= ]*/CN=([-.A-Za-z0-9/= ]+)" \1@unmapped.htcondor.org<br/>CLAIMTOBE .* anonymous@claimtobe<br/>FS "^(root|condor)$" \1@daemon.htcondor.org<br/>FS "(.*)" \1</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(16:06:56)</span> <b>blin:</b></span> they should remove this line<br/><pre>"/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://fejlab.svc.opensciencegrid.org">fejlab.svc.opensciencegrid.org</a>" fejlab</pre><br/>because grid-mapfile &gt; voms-mapfile so both EIC and CLAS12 will mistakenly be mapped to <tt>fejlab</tt><br/>
<span style="color: #53b759"><span style="font-size: small">(16:08:58)</span> <b>marian:</b></span> ok, that was mine experimental today ... will ask them remove<br/>
<span style="color: #53b759"><span style="font-size: small">(16:10:46)</span> <b>marian:</b></span> btw, here is config dump:<br/>
<span style="color: #53b759"><span style="font-size: small">(16:11:10)</span> <b>marian:</b></span> ...aaaand, we have person who has root offline for today<br/>
<span style="color: #43761b"><span style="font-size: small">(16:12:26)</span> <b>blin:</b></span> Wesley? Kurt was mentioning that he owned the puppet config<br/>
<blockquote>
<span style="color: #5a4592"><span style="font-size: small">(2021-07-12 13:19:16)</span> <b>kurtjstrosahl:</b></span> This system was built by Wes.  Some of the files say they were managed by puppet, but when I checked Puppet was disabled.<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-07-12 13:22:46)</span> <b>blin:</b></span> ah good to know<br/>
</blockquote>
<span style="color: #53b759"><span style="font-size: small">(16:13:02)</span> <b>marian:</b></span> Kurt was giving me all of this... puppet service is turned off on that host<br/>
</body>
</html>
