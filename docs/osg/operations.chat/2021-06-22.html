<!DOCTYPE html>
<html>
<head>
<title>Tue Jun 22, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Tue Jun 22, 2021 : #operations (osg)</h3>
<span style="color: #aba727"><span style="font-size: small">(13:27:16)</span> <b>moate:</b></span> Did tigermaster k8s auth change or am I doing something really stupid? -&gt;<br/><pre>[moate@tigermaster0000 ~]$ kubectl get pods<br/>error: You must be logged in to the server (Unauthorized)</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(13:30:04)</span> <b>matyas:</b></span> the auth changed<br/>
<span style="color: #c386df"><span style="font-size: small">(13:30:15)</span> <b>matyas:</b></span> the previous credential had a lifetime of 1 year<br/>
<span style="color: #c386df"><span style="font-size: small">(13:30:20)</span> <b>matyas:</b></span> @jpeterson can give you a new one<br/>
<span style="color: #aba727"><span style="font-size: small">(13:30:27)</span> <b>moate:</b></span> ah<br/>
<span style="color: #aba727"><span style="font-size: small">(13:30:32)</span> <b>moate:</b></span> Thanks<br/>
<span style="color: #aba727"><span style="font-size: small">(13:33:07)</span> <b>moate:</b></span> @jpeterson shouldn't puppet have refreshed <tt>$HOME/.kube/config</tt>?<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:34:43)</span> <b>jpeterson:</b></span> dunno. but I just did.<br/>
<span style="color: #aba727"><span style="font-size: small">(13:35:42)</span> <b>moate:</b></span> Thanks<br/>
<span style="color: #53b759"><span style="font-size: small">(15:04:57)</span> <b>marian:</b></span> I think we've a bit of issue with new eic cert when requesting voms extension:<br/><pre>$ voms-proxy-init -cert ~/.globus/eic.voms.opensciencegrid.org.pem -key ~/.globus/eic.voms.opensciencegrid.org-key.pem -voms eic -valid 192:00 -out ~/.globus/fejlabeic.proxy --debug<br/>Detected Globus version: 2.2<br/>Unspecified proxy version, settling on version 4 (RFC)<br/>PCI extension info:<br/> Path length: -1<br/> Policy language not specified.<br/> Policy file not specified.<br/>Number of bits in key :1024<br/>Files being used:<br/> CA certificate file: none<br/> Trusted certificates directory : /etc/grid-security/certificates<br/> Proxy certificate file : /home/bockelman/zvada/.globus/fejlabeic.proxy<br/> User certificate file: /home/bockelman/zvada/.globus/eic.voms.opensciencegrid.org.pem<br/> User key file: /home/bockelman/zvada/.globus/eic.voms.opensciencegrid.org-key.pem<br/>Output to /home/bockelman/zvada/.globus/fejlabeic.proxy<br/>Your identity: /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://eic.voms.opensciencegrid.org">eic.voms.opensciencegrid.org</a><br/>Using configuration file /home/bockelman/zvada/.glite/vomses<br/>Using configuration file /etc/vomses<br/>Creating temporary proxy to /tmp/tmp_x509up_u3774_30350 .........++++++<br/>.............................................................++++++<br/><br/>No policy language specified, Gsi impersonation proxy assumed. Done<br/>Contacting  <a href="http://eic.voms.opensciencegrid.org:15001">eic.voms.opensciencegrid.org:15001</a> [/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://eic.voms.opensciencegrid.org">eic.voms.opensciencegrid.org</a>] "eic" Failed<br/><br/>None of the contacted servers for eic were capable<br/>of returning a valid AC for the user.</pre><br/>^ @blin, any thoughts? I've updated vo-client package so it recognizes it from <tt>/etc/vomses</tt> file, but I'm afraid whether <a href="http://eic.voms.opensciencegrid.org">eic.voms.opensciencegrid.org</a> needs to link any any existing host? and, should it be voms host? previously with an old cert it was <tt><a href="http://eicvoms.t2.ucsd.edu">eicvoms.t2.ucsd.edu</a></tt> that linked to <tt><a href="http://esnet-xcache-01.t2.ucsd.edu">esnet-xcache-01.t2.ucsd.edu</a></tt> ... can we make something similar for <a href="http://eic.voms.opensciencegrid.org">eic.voms.opensciencegrid.org</a>?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:06:33)</span> <b>blin:</b></span> why are you using <tt>voms-proxy-init</tt> here? don't you just use the gwms-renew-proxies service/cron/script?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:13:59)</span> <b>blin:</b></span> @marian ^^<br/>
<span style="color: #53b759"><span style="font-size: small">(15:14:42)</span> <b>marian:</b></span> well, this is desired by design, I think ... in the Frontend<br/>
<span style="color: #43761b"><span style="font-size: small">(15:18:43)</span> <b>blin:</b></span> yeah, exactly<br/>
<span style="color: #43761b"><span style="font-size: small">(15:18:56)</span> <b>blin:</b></span> proxy generation should be done using the documented method<br/>
<span style="color: #53b759"><span style="font-size: small">(15:21:11)</span> <b>marian:</b></span> maybe a different image can be used than this?<br/><a href="https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/jlab-deployment-patch.yaml#L10">https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/jlab-deployment-patch.yaml#L10</a><br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:11)</span> <b>blin:</b></span> it looks like all the other FEs are using that so i think that's fine<br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:50)</span> <b>blin:</b></span> you'll want to manage your <tt>proxies.ini</tt> to handle <tt>gwms-renew-proxies</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(15:33:48)</span> <b>blin:</b></span> <a href="https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-glow/proxies.ini">https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-glow/proxies.ini</a><br/>
<span style="color: #53b759"><span style="font-size: small">(15:33:53)</span> <b>marian:</b></span> any example?<br/>
<span style="color: #53b759"><span style="font-size: small">(15:33:57)</span> <b>marian:</b></span> oh, ok<br/>
<span style="color: #53b759"><span style="font-size: small">(15:39:49)</span> <b>marian:</b></span> hmm, I have this: <a href="https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/proxies.ini">https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/proxies.ini</a> ... it sets <tt>use_voms_server = false</tt> ... I had also another problem with secret for EIC, resealing now ... will ping when I see same problem<br/>
<span style="color: #53b759"><span style="font-size: small">(15:49:19)</span> <b>marian:</b></span> still, we may need to update image <tt>glideinwms/gwms-frontend:dev</tt> to use latest <tt>vo-client-113</tt> package... pod init fails on this:<br/><pre>Cloning repo: <a href="https://github.com/opensciencegrid/osg-flock.git">https://github.com/opensciencegrid/osg-flock.git</a><br/>Branch not set, using: 'master'<br/>Cloning into 'osg-flock'...<br/>Renewed proxy from '/etc/grid-security/gwms-frontend/hostcert.pem' to '/etc/grid-security/frontend.proxy'.<br/>ERROR: Failed to renew proxy /etc/grid-security/pilot_clas12_proxy.proxy: Could not find entry in /etc/vomses for /etc/grid-security/voms/vomscert.pem. Please verify your VO data installation.<br/>ERROR: Failed to renew proxy /etc/grid-security/pilot_eic_proxy.proxy: Could not find entry in /etc/vomses for /etc/grid-security/eicvoms/vomscert.pem. Please verify your VO data installation.</pre><br/>current FE uses <tt>vo-client-110</tt> that doesn't have <a href="http://eic.voms.opensciencegrid.org">eic.voms.opensciencegrid.org</a> nor <a href="http://clas12.voms.opensciencegrid.org">clas12.voms.opensciencegrid.org</a> in <tt>/etc/vomses</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(15:58:44)</span> <b>blin:</b></span> i think @didavila manages that? i'm not sure if he's back from vacation so @marcom should be able to help if that's the case<br/>
<span style="color: #53b759"><span style="font-size: small">(16:00:49)</span> <b>marian:</b></span> @didavila is back, I was him bothering with my PR review earlier today ... I'll poke around<br/>
<span style="color: #53b759"><span style="font-size: small">(16:01:06)</span> <b>marian:</b></span> for Marco it's too late<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:54:33)</span> <b>didavila:</b></span> @marian :I will trigger a new image build so that it gets the newest vo-client, will ping you when itâ€™s done<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(17:14:41)</span> <b>didavila:</b></span> the new image is available, I verified that it has vo-client-113<br/>
<span style="color: #53b759"><span style="font-size: small">(19:13:34)</span> <b>marian:</b></span> thanks Diego, testing ...<br/>
<span style="color: #53b759"><span style="font-size: small">(20:12:18)</span> <b>marian:</b></span> it's good, but another issue appeared, ugh:<br/>
<span style="color: #53b759"><span style="font-size: small">(20:18:20)</span> <b>marian:</b></span> <pre>The configuration is compatible with Python 3<br/>Unexpected error occurred loading the configuration file.<br/>Invalid frontend match_expr '(job.get("RequestCpus",1)&lt;=glidein["attrs"]["GLIDEIN_CPUS"]) and ((job.get("DESIRED_Sites","nosite")=="nosite") or (glidein["attrs"]["GLIDEIN_Site"] in job.get("DESIRED_Sites","nosite").split(","))) and (glidein["attrs"]["GLIDEIN_MaxMemMBs"]==0 or job.get("RequestMemory", 1024)&lt;=glidein["attrs"]["GLIDEIN_MaxMemMBs"]) and (job.get("UNDESIRED_Sites","nosite")=="nosite" or (glidein["attrs"]["GLIDEIN_Site"] not in job.get("UNDESIRED_Sites","").split(",")))': '&lt;=' not supported between instances of 'str' and 'int'<br/>Upgrading the frontend[FAILED]</pre><br/>this is according to this line: <a href="https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/frontend.xml#L18">https://github.com/opensciencegrid/tiger-osg-config/blob/master/manifests/development/vo-frontend-jlab/frontend.xml#L18</a> ... doest that ring bell? I wonder this wasn't problem before... anything else you have changed in the image, @didavila?<br/>
<span style="color: #53b759"><span style="font-size: small">(20:57:16)</span> <b>marian:</b></span> I've updated <tt>RequestCpus</tt> attribute to use <tt>int</tt> instead of <tt>string</tt> :<br/>
<span style="color: #53b759"><span style="font-size: small">(20:57:16)</span> <b>marian:</b></span> <a href="https://github.com/opensciencegrid/tiger-osg-config/commit/edb00319d3a3ea150458925ff3a8de1e6c62ccaf">https://github.com/opensciencegrid/tiger-osg-config/commit/edb00319d3a3ea150458925ff3a8de1e6c62ccaf</a><br/>
<span style="color: #53b759"><span style="font-size: small">(20:57:28)</span> <b>marian:</b></span> seems like JLAB FE is up and running now<br/>
</body>
</html>
