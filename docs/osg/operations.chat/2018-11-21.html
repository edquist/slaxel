<!DOCTYPE html>
<html>
<head>
<title>Wed Nov 21, 2018 : #operations (osg)</title>
</head>
<body>
<h3>Wed Nov 21, 2018 : #operations (osg)</h3>
<span style="color: #99a949"><span style="font-size: small">(06:17:54)</span> <b>dwd:</b></span> @jthiltges @gattebury @marian hcc-cvmfs-repo is down — ssh to it says Connection reset by peer.  Alarms have gone off saying that updates are more than 8 hours stale<br/>
<span style="color: #99a949"><span style="font-size: small">(06:18:08)</span> <b>dwd:</b></span> @dweitzel<br/>
<span style="color: #d1707d"><span style="font-size: small">(07:23:12)</span> <b>gattebury:</b></span> <pre>/bin/login: error while loading shared libraries: libselinux.so.1: failed to[58041.446456] systemd-journald[500]: Failed to write entry (22 items, 633 bytes), ignoring: Permission denied<br/>[58041.449865] systemd-journald[500]: Failed to write entry (24 items, 647 bytes), ignoring: Permission denied<br/>[58041.452921] systemd-journald[500]: Failed to write entry (23 items, 662 bytes), ignoring: Permission denied</pre><br/><br/>That was spewing over the console when I tried logging in (from virsh console). On a reboot there’s an interesting number of selinux things like <tt>[   56.946892] type=1400 audit(1542806417.951:72): avc:  denied  { read } for  pid=860 comm="irqbalance" name="ld.so.cache" dev="dm-0" ino=8389488 scontext=system_u:system_r:irqbalance_t:s0 tcontext=system_u:object_r:unlabeled_t:s0 tclass=file</tt> which … seems very wrong.<br/><br/>I never logged into it yesterday after it reset, simply reported to john/derek/marian. Those types of errors seem rather absurd though, like someone/something mangled filesystem contexts. I’ll prod at it more in a few hours when I’m at work.<br/>
<span style="color: #d1707d"><span style="font-size: small">(07:24:06)</span> <b>gattebury:</b></span> No other hosts on that set of disks / VM host seem to be having such strange issues for whatever that’s worth.<br/>
<span style="color: #d1707d"><span style="font-size: small">(07:59:20)</span> <b>gattebury:</b></span> @dwd and others, I had another free moment and added selinux=0 to the kernel boot line and it looks to be happier. It’s booted and you can ssh in now at least. Plenty of what I assume are normal messages from some script Derek put on like:<br/><pre>Broadcast message from <a href="mailto:dweitzel@hcc-cvmfs-repo.unl.edu">dweitzel@hcc-cvmfs-repo.unl.edu</a> (Wed Nov 21 07:52:03 2018):<br/><a href="http://dune.osgstorage.org">dune.osgstorage.org</a> is forcefully remounted in 60 seconds.<br/>Please close files on /cvmfs/dune.osgstorage.org<br/><a href="http://dune.osgstorage.org">dune.osgstorage.org</a> is forcefully remounted NOW.</pre><br/><br/>I did *not* disable selinux in the config file / puppet, so if this reboots again I’m guessing it will get stuck. I will leave it up to you + Marian + John + Derek + whoever else admins this to decide what you want to do at this point. My vote would be a massive restorecon -R over _everything_ and see if it looks better. Possibly a forced fsck across everything for good measure too, though the end of the <tt>messages</tt> log from yesterday indicates all filesystems were clean and journals recovered after the reset. Why selinux issues cropped up overnight to this extent is beyond me.<br/><br/>Maybe there’s magic people have done which is out of the realm of normal? Anyway … it’s up. Have fun!<br/>
<span style="color: #e06b56"><span style="font-size: small">(09:27:33)</span> <b>jthiltges:</b></span> Regarding hcc-cvmfs-repo: Odd. I was able to login yesterday, shortly (~15:15) after it was rebooted.<br/>
<span style="color: #99a949"><span style="font-size: small">(09:28:05)</span> <b>dwd:</b></span> FYI the stratum 1 is caught up with all the updates from hcc-cvmfs-repo now<br/>
<span style="color: #16569E"><span style="font-size: small">(11:35:04)</span> <b>edquist:</b></span> @jthiltges, @dweitzel - i seem to be having trouble getting the <tt>/webhook</tt> prefix to map to the new script alias.<br/><br/>In <tt>/etc/httpd/conf.d/topology-itb-webhook.conf</tt> i have:<br/><pre><br/>WSGIScriptAlias /webhook /opt/topology-itb-webhook/src/topology-itb-webhook.wsgi process-group=topomerge<br/></pre><br/><br/>and it does seem that this <tt>/opt/topology-itb-webhook/src/topology-itb-webhook.wsgi</tt> is getting loaded, based on some debugging i've done (the app it points to gets loaded, based on output it logs to the httpd logs).  However, when i try to access a page under <tt>/webhook</tt>, i get the following error in <tt>/var/log/httpd/error_log</tt>:<br/><br/><pre><br/>[Wed Nov 21 10:40:19.154512 2018] [authz_core:error] [pid 15755] [client 128.105.14.55:50334] AH01630: client denied by server configuration: /opt/topology/src/topology.wsgi<br/></pre><br/><br/>which corresponds to this request from <tt>/var/log/httpd/access_log</tt>:<br/><br/><pre><br/><a href="http://monza.cs.wisc.edu">monza.cs.wisc.edu</a> - - [21/Nov/2018:10:40:19 -0600] "GET /webhook/pull_request HTTP/1.1" 404 233 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0"<br/></pre><br/><br/>Note that the error message complains about being denied by the <tt>/opt/topology/src/topology.wsgi</tt> config, which is specified from <tt>map.conf:WSGIScriptAlias /</tt> in some other httpd conf files, but as mentioned above, <tt>WSGIScriptAlias /webhook</tt> points to the <tt>/opt/topology-itb-webhook/src/topology-itb-webhook.wsgi</tt> config.<br/><br/>Any idea if i'm missing something obvious here?<br/><br/>(Thanks!)<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:41:54)</span> <b>jthiltges:</b></span> I think the issue is the duplicated VirtualHost. Combine the topomerge config into the topology-itb.conf and it should be good.<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:42:31)</span> <b>jthiltges:</b></span> I disabled puppet on topology-itb so it won't mangle the changes, until we can get them merged back in. <b>@edquist</b><br/>
<span style="color: #16569E"><span style="font-size: small">(11:43:06)</span> <b>edquist:</b></span> ok, i'll give that a try, thanks!<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:44:29)</span> <b>jthiltges:</b></span> (To summarize, there's two <tt>namevhost topology-itb</tt> configurations. And Apache is sending <tt>/webhook</tt> requests to the one which only has the topology-itb.wsgi, and not topology-itb-webhook.wsgi.)<br/>
<span style="color: #16569E"><span style="font-size: small">(11:44:30)</span> <b>edquist:</b></span> what about <tt>WSGIProcessGroup</tt> ?<br/>
<span style="color: #16569E"><span style="font-size: small">(11:44:53)</span> <b>edquist:</b></span> <tt>topomerge</tt> vs <tt>topology_itb</tt> ?<br/>
<span style="color: #16569E"><span style="font-size: small">(11:45:44)</span> <b>edquist:</b></span> in my separate <tt>topology-itb-webhook.wsgi</tt>, i had changed <tt>WSGIProcessGroup topology_itb</tt> to <tt>WSGIProcessGroup topomerge</tt><br/>
<span style="color: #16569E"><span style="font-size: small">(11:46:02)</span> <b>edquist:</b></span> but i suppose they need to share one if under the same VirtualHost<br/>
<span style="color: #e06b56"><span style="font-size: small">(11:46:03)</span> <b>jthiltges:</b></span> Set it in the WSGIScriptAlias only?<br/>
<span style="color: #16569E"><span style="font-size: small">(11:46:07)</span> <b>edquist:</b></span> ok<br/>
</body>
</html>
