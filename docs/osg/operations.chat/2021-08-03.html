<!DOCTYPE html>
<html>
<head>
<title>Tue Aug 3, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Tue Aug 3, 2021 : #operations (osg)</h3>
<span style="color: #e06b56"><span style="font-size: small">(10:06:18)</span> <b>jthiltges:</b></span> I'm going to switch repo.osg to running a new container tag with faster restarts. I'm expecting less than ~30s of downtime.<br/>
<span style="color: #e06b56"><span style="font-size: small">(10:17:35)</span> <b>jthiltges:</b></span> And repo is back. Almost slipped by unnoticed, but Igor caught me.<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:54:05)</span> <b>dweitzel:</b></span> @didavila @bbockelm The DN <tt>/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a></tt> is explicitly whitelisted for <a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a> CVMFS repo.  It comes from ligo's ldap.<br/>
<span style="color: #43761b"><span style="font-size: small">(12:50:50)</span> <b>blin:</b></span> @bbockelm @jdost321 how are we handling Hosted CE host certs these days? i'm seeing an expired ASU host cert on river<br/><pre>    Signature Algorithm: sha256WithRSAEncryption<br/>        Issuer: C=US, O=Let's Encrypt, CN=R3<br/>        Validity<br/>            Not Before: Apr 22 19:51:51 2021 GMT<br/>            Not After : Jul 21 19:51:51 2021 GMT<br/>        Subject: CN=<a href="http://hosted-ce20.opensciencegrid.org">hosted-ce20.opensciencegrid.org</a></pre><br/>
<span style="color: #e96699"><span style="font-size: small">(12:58:10)</span> <b>lincoln:</b></span> @blin That should be managed by certmanager I think<br/>
<span style="color: #e96699"><span style="font-size: small">(12:58:54)</span> <b>lincoln:</b></span> <pre>[root@river-c001 hosted-ce-certs]# kubectl describe certificate -n slate-group-osg-ops hosted-ce20 <br/>Name:         hosted-ce20<br/>Namespace:    slate-group-osg-ops<br/>Labels:       &lt;none&gt;<br/>Annotations:  &lt;none&gt;<br/>API Version:  <a href="http://cert-manager.io/v1alpha3">cert-manager.io/v1alpha3</a><br/>Kind:         Certificate<br/>Metadata:<br/>  Creation Timestamp:  2021-04-22T20:36:15Z<br/>  Generation:          2<br/>  Managed Fields:<br/>    API Version:  <a href="http://cert-manager.io/v1alpha3">cert-manager.io/v1alpha3</a><br/>    Fields Type:  FieldsV1<br/>    fieldsV1:<br/>      f:spec:<br/>        .:<br/>        f:issuerRef:<br/>          .:<br/>          f:name:<br/>        f:secretName:<br/>    Manager:      kubectl-create<br/>    Operation:    Update<br/>    Time:         2021-04-22T20:36:14Z<br/>    API Version:  <a href="http://cert-manager.io/v1alpha3">cert-manager.io/v1alpha3</a><br/>    Fields Type:  FieldsV1<br/>    fieldsV1:<br/>      f:metadata:<br/>        f:annotations:<br/>          .:<br/>          f:<a href="http://kubectl.kubernetes.io/last-applied-configuration">kubectl.kubernetes.io/last-applied-configuration</a>:<br/>      f:spec:<br/>        f:dnsNames:<br/>    Manager:      kubectl-client-side-apply<br/>    Operation:    Update<br/>    Time:         2021-04-22T20:50:37Z<br/>    API Version:  <a href="http://cert-manager.io/v1alpha2">cert-manager.io/v1alpha2</a><br/>    Fields Type:  FieldsV1<br/>    fieldsV1:<br/>      f:status:<br/>        f:conditions:<br/>        f:notAfter:<br/>    Manager:         controller<br/>    Operation:       Update<br/>    Time:            2021-04-22T20:51:51Z<br/>  Resource Version:  785160917<br/>  Self Link:         /apis/cert-manager.io/v1alpha3/namespaces/slate-group-osg-ops/certificates/hosted-ce20<br/>  UID:               8c2c16fd-3c99-4203-9499-1f08cadadaab<br/>Spec:<br/>  Dns Names:<br/>    <a href="http://hosted-ce20.opensciencegrid.org">hosted-ce20.opensciencegrid.org</a><br/>    <a href="http://asu-ce1.svc.opensciencegrid.org">asu-ce1.svc.opensciencegrid.org</a><br/>  Issuer Ref:<br/>    Name:       letsencrypt-prod<br/>  Secret Name:  hosted-ce20-tls<br/>Status:<br/>  Conditions:<br/>    Last Transition Time:  2021-04-22T20:51:51Z<br/>    Message:               Certificate is up to date and has not expired<br/>    Reason:                Ready<br/>    Status:                True<br/>    Type:                  Ready<br/>  Not After:               2021-09-19T18:53:05Z<br/>Events:                    &lt;none&gt;</pre><br/>
<span style="color: #e96699"><span style="font-size: small">(12:59:11)</span> <b>lincoln:</b></span> I wonder why it's <tt>Not After:               2021-09-19T18:53:05Z</tt> according to certmanager ?<br/>
<span style="color: #e96699"><span style="font-size: small">(13:01:34)</span> <b>lincoln:</b></span> maybe Certmanager already renewed it, but it's not propagated to the container? I see a hostcert/hostkey from apr 22<br/>
<span style="color: #e96699"><span style="font-size: small">(13:04:48)</span> <b>lincoln:</b></span> <pre>  - lastTransitionTime: "2021-06-21T19:53:06Z"<br/>    message: Certificate fetched from issuer successfully<br/>    reason: Issued<br/>    status: "True"<br/>    type: Ready</pre><br/>
<span style="color: #e96699"><span style="font-size: small">(13:04:52)</span> <b>lincoln:</b></span> from the certificaterequest object<br/>
<span style="color: #e96699"><span style="font-size: small">(13:05:09)</span> <b>lincoln:</b></span> does the HostedCE need to be restarted or something to get the new certificate ?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:06:13)</span> <b>blin:</b></span> ah thanks @lincoln. i'm guessing that this CE is either configured or using an old enough helm chart so that it's not using the bits you added to allow updated secrets to filter through to the pods w/o a redeploy<br/>
<span style="color: #e96699"><span style="font-size: small">(13:06:29)</span> <b>lincoln:</b></span> i added stuff to do that?? neat<br/>
<span style="color: #e96699"><span style="font-size: small">(13:08:12)</span> <b>lincoln:</b></span> well, if there's anything i can do to help just let me know<br/>
<span style="color: #43761b"><span style="font-size: small">(13:15:37)</span> <b>blin:</b></span> @lincoln yeah :slightly_smiling_face:. does that cert correspond to the <tt>hosted-ce20-tls</tt> secret?<br/>
<span style="color: #e96699"><span style="font-size: small">(13:16:24)</span> <b>lincoln:</b></span> let me look<br/>
<span style="color: #16569E"><span style="font-size: small">(13:42:01)</span> <b>edquist:</b></span> Hello Ops, i plan to update the topology image in tiger to 1.7.0 (<tt>opensciencegrid/topology:1.7.0</tt>), any objections?<br/>
<span style="color: #c386df"><span style="font-size: small">(13:46:27)</span> <b>matyas:</b></span> no<br/>
<span style="color: #c386df"><span style="font-size: small">(13:47:53)</span> <b>matyas:</b></span> go for it<br/>
<span style="color: #16569E"><span style="font-size: small">(13:54:35)</span> <b>edquist:</b></span> hold on to your butts<br/>
<span style="color: #c386df"><span style="font-size: small">(13:55:53)</span> <b>matyas:</b></span> holding<br/>
<span style="color: #43761b"><span style="font-size: small">(14:08:03)</span> <b>blin:</b></span> @bbockelm harbor fell over again and the health check looks...unhelpful<br/><pre>{<br/>  "errors": [<br/>    {<br/>      "code": "UNKNOWN",<br/>      "message": "internal server error"<br/>    }<br/>  ]<br/>}</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(14:09:59)</span> <b>blin:</b></span> logs from the core pod look angry<br/><pre>2021-08-03T19:07:16Z [WARNING] [/replication/registry/manager.go:163]: Update health status for '<a href="https://hub.docker.com">https://hub.docker.com</a>' error: pq: cannot execute UPDATE in a read-only transaction<br/>2021-08-03T19:07:16Z [ERROR] [/replication/registry/healthcheck.go:65]: Health check error: 1 out of 1 registries failed to update health status<br/>2021-08-03T19:07:45Z [ERROR] [/lib/orm/orm.go:72]: begin transaction failed: pq: cannot set transaction read-write mode during recovery<br/>2021-08-03T19:07:45Z [ERROR] [/lib/http/error.go:54]: {"errors":[{"code":"UNKNOWN","message":"unknown: deal with /api/v2.0/health request in transaction failed: pq: cannot set transaction read-write mode during recovery"}]} </pre><br/>
<span style="color: #43761b"><span style="font-size: small">(14:16:29)</span> <b>blin:</b></span> can't redeploy hosted CEs atm without harbor -.-<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:23:15)</span> <b>didavila:</b></span> who has the power to  add the new Edgar (Fabio) to the tiger repo? is that you @blin?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:23:47)</span> <b>blin:</b></span> yeah and a few others<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:23:51)</span> <b>didavila:</b></span> at the moment he could live with read-only access<br/>
<span style="color: #43761b"><span style="font-size: small">(16:24:01)</span> <b>blin:</b></span> separately, have you invited Fabio to Slack?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:25:06)</span> <b>blin:</b></span> he's got read access now<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:25:18)</span> <b>didavila:</b></span> thanks!<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:25:26)</span> <b>didavila:</b></span> I just sent him the invitation to slack<br/>
<span style="color: #9d8eee"><span style="font-size: small">(16:34:52)</span> <b>cat:</b></span> @didavila, I really need a formal request (ideally from Frank) to on-board Fabio throughout OSG and PATh…<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:36:27)</span> <b>didavila:</b></span> Ok, let me write an email to Frank with you in cc asking that, would that do it?<br/>
<span style="color: #9d8eee"><span style="font-size: small">(16:37:39)</span> <b>cat:</b></span> Yes. Mostly, I need a full name, a preferred name (Fabio), and really, really ideally FTE levels from various awards, but that last bit can wait.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(16:37:46)</span> <b>cat:</b></span> Let me double-check if I need anything else.<br/>
<span style="color: #9d8eee"><span style="font-size: small">(16:37:47)</span> <b>cat:</b></span> brb<br/>
<span style="color: #9d8eee"><span style="font-size: small">(16:38:26)</span> <b>cat:</b></span> Name, email address, Google sharing ID, start date, (area(s), award(s), and FTE rate(s))<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:09:23)</span> <b>bbockelm:</b></span> @blin - for the future, that’s always solvable via kicking the core pod<br/>
<span style="color: #c386df"><span style="font-size: small">(18:34:46)</span> <b>matyas:</b></span> kicked. let's see what happens...<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:53:23)</span> <b>bbockelm:</b></span> The good news is we now know the monitoring will catch this<br/>
<span style="color: #c386df"><span style="font-size: small">(19:02:58)</span> <b>matyas:</b></span> we do?<br/>
<span style="color: #c386df"><span style="font-size: small">(19:03:42)</span> <b>matyas:</b></span> I didn't see anything<br/>
</body>
</html>
