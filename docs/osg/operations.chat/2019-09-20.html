<!DOCTYPE html>
<html>
<head>
<title>Fri Sep 20, 2019 : #operations (osg)</title>
</head>
<body>
<h3>Fri Sep 20, 2019 : #operations (osg)</h3>
<span style="color: #e23f99"><span style="font-size: small">(08:33:28)</span> <b>marco.mascheroni:</b></span> @matyas do we need a specific rsync verison on the hosted ces?<br/><pre><br/>[root@hosted-ce30 ~]# ./hosted-ce-config/install-resource  CLARKSON-ACRES<br/>rsync: --chown=root:root: unknown option<br/>rsync error: syntax or usage error (code 1) at main.c(1435) [client=3.0.9]<br/>install-resource: Unable to install osg-configure config<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(08:33:32)</span> <b>marco.mascheroni:</b></span> <pre>[root@hosted-ce30 ~]# rsync --version<br/>rsync  version 3.0.9  protocol version 30<br/>Copyright (C) 1996-2011 by Andrew Tridgell, Wayne Davison, and others.<br/>Web site: <a href="http://rsync.samba.org/">http://rsync.samba.org/</a><br/>Capabilities:<br/>    64-bit files, 64-bit inums, 64-bit timestamps, 64-bit long ints,<br/>    socketpairs, hardlinks, symlinks, IPv6, batchfiles, inplace,<br/>    append, ACLs, xattrs, iconv, symtimes<br/><br/>rsync comes with ABSOLUTELY NO WARRANTY.  This is free software, and you<br/>are welcome to redistribute it under certain conditions.  See the GNU<br/>General Public Licence for details.<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(08:49:24)</span> <b>marco.mascheroni:</b></span> Also, I am getting this:<br/><pre><br/>*** rsyncing WN client changes to <a href="http://elsa.hpc.tcnj.edu:/home/osg/osg01~new~">elsa.hpc.tcnj.edu:/home/osg/osg01~new~</a><br/>rsync: connection unexpectedly closed (9 bytes received so far) [sender]<br/>rsync error: error in rsync protocol data stream (code 12) at io.c(605) [sender=3.0.9]<br/>*** Error rsyncing to remote host <a href="http://elsa.hpc.tcnj.edu:/home/osg/osg01">elsa.hpc.tcnj.edu:/home/osg/osg01</a>: Command '['rsync', '-e', 'ssh -l osg01', '-qaz', '--link-dest', '/home/osg/osg01', '--delete-before', '/tmp/tmpyQKf2k/deploy/osg-wn-client/', '<a href="http://elsa.hpc.tcnj.edu:/home/osg/osg01~new~">elsa.hpc.tcnj.edu:/home/osg/osg01~new~</a>']' returned non-zero exit status 12<br/></pre><br/>when running update-all-remote-wn-clients.<br/>What is the last param: '<a href="http://elsa.hpc.tcnj.edu:/home/osg/osg01~new~">elsa.hpc.tcnj.edu:/home/osg/osg01~new~</a>'? The homedir I want to write to is /home/osg/osg01, should I worry it is showing /home/osg/osg01~new~ ?<br/>
<span style="color: #e23f99"><span style="font-size: small">(08:59:52)</span> <b>marco.mascheroni:</b></span> Ouch, I think this is a showstopper for me (BTW I am instaling the New Jersey hsoted CE):<br/>
<span style="color: #e23f99"><span style="font-size: small">(08:59:59)</span> <b>marco.mascheroni:</b></span> <pre><br/>[osg01@hosted-ce30 ~]$ condor_ce_q -held<br/><br/><br/>-- Schedd: <a href="http://hosted-ce30.grid.uchicago.edu">hosted-ce30.grid.uchicago.edu</a> : &lt;128.135.158.171:9619?... @ 09/20/19 08:57:52<br/> ID      OWNER          HELD_SINCE  HOLD_REASON<br/>   2.0   osg01           9/20 08:55 Failed to start GAHP: Agent pid 30021\n/home/osg/osg01/bosco/glite/bin/batch_gahp.symlink: error while loading shared libraries: libclassad.so.7: cannot open shared object file: No such file or directory\nAgent pid 30021 killed\n<br/>   3.0   osg01           9/20 08:55 Failed to start GAHP: Agent pid 30021\n/home/osg/osg01/bosco/glite/bin/batch_gahp.symlink: error while loading shared libraries: libclassad.so.7: cannot open shared object file: No such file or directory\nAgent pid 30021 killed\n<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(09:00:13)</span> <b>marco.mascheroni:</b></span> The above is what I get from the cE<br/>
<span style="color: #e23f99"><span style="font-size: small">(09:00:27)</span> <b>marco.mascheroni:</b></span> And below is some info on the cluster ead node:<br/>
<span style="color: #e23f99"><span style="font-size: small">(09:00:35)</span> <b>marco.mascheroni:</b></span> <pre><br/>[osg01@login003 ~]$ ls bosco/glite/bin/batch_gahp<br/>bosco/glite/bin/batch_gahp<br/>[osg01@login003 ~]$ bosco/glite/bin/batch_gahp<br/>bosco/glite/bin/batch_gahp.symlink: error while loading shared libraries: libclassad.so.7: cannot open shared object file: No such file or directory<br/>[osg01@login003 ~]$ find . | grep libclass<br/>./bosco/glite/lib/libclassad.so.10<br/>./bosco/glite/lib/libclassad.so.8<br/>./bosco/glite/lib/libclassad.so<br/>./bosco/glite/lib/libclassad.so.8.8.5<br/>./bosco/glite/lib/libclassad.so.8.6.13<br/>[osg01@login003 ~]$ <br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(09:01:23)</span> <b>marco.mascheroni:</b></span> seems like this is looking for libclassad.so.7 which is not there?<br/>
<span style="color: #e23f99"><span style="font-size: small">(09:08:57)</span> <b>marco.mascheroni:</b></span> @jdost321 I think the osg-configure version we used yesterday for the dryrun was the old one<br/><pre><br/>[0707] root@test-004 ~# ls<br/>1  anaconda-ks.cfg  hosted-ce-config  install.post.log  install.postnochroot.log  NOTES  original-ks.cfg  test-004.t2.ucsd.edu.key  test-004.t2.ucsd.edu.pem<br/>[0707] root@test-004 ~# yum list installed osg-configure<br/>Loaded plugins: fastestmirror, priorities<br/>Loading mirror speeds from cached hostfile<br/> * base: <a href="http://mirrors.usc.edu">mirrors.usc.edu</a><br/> * epel: <a href="http://mirror.prgmr.com">mirror.prgmr.com</a><br/> * extras: <a href="http://mirror.scalabledns.com">mirror.scalabledns.com</a><br/> * osg: <a href="http://mirror.grid.uchicago.edu">mirror.grid.uchicago.edu</a><br/> * updates: <a href="http://repos.lax.quadranet.com">repos.lax.quadranet.com</a><br/>45 packages excluded due to repository priority protections<br/>Installed Packages<br/>osg-configure.noarch                                                                       2.4.1-1.osg34.el7                                                                       @osg<br/>[0708] root@test-004 ~#<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(09:09:16)</span> <b>marco.mascheroni:</b></span> I am using 3.1.0-1.osg35.el7 for the new jersey one<br/>
<span style="color: #e23f99"><span style="font-size: small">(09:09:27)</span> <b>marco.mascheroni:</b></span> I'll be back in an hour<br/>
<span style="color: #53b759"><span style="font-size: small">(09:19:02)</span> <b>isfiligoi:</b></span> @isfiligoi has left the channel<br/>
<span style="color: #c386df"><span style="font-size: small">(09:54:22)</span> <b>matyas:</b></span> the <tt>~new~</tt> thing is because it rsyncs to a new directory and then it swaps out the old directory with the new directory<br/>
<span style="color: #c386df"><span style="font-size: small">(09:54:59)</span> <b>matyas:</b></span> this minimizes the chances of the osg-wn-client directory being inconsistent<br/>
<span style="color: #c386df"><span style="font-size: small">(09:55:06)</span> <b>matyas:</b></span> I'll look into the rsync thing<br/>
<span style="color: #c386df"><span style="font-size: small">(09:58:06)</span> <b>matyas:</b></span> looks like the <tt>--chown</tt> argument is only in rsync 3.1 and newer<br/>
<span style="color: #c386df"><span style="font-size: small">(09:58:20)</span> <b>matyas:</b></span> which is what's on el7 but not el6<br/>
<span style="color: #c386df"><span style="font-size: small">(10:39:49)</span> <b>matyas:</b></span> @marco.mascheroni what's <tt>rpm -q condor-bosco</tt> on the CE?<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:42:04)</span> <b>marco.mascheroni:</b></span> <pre><br/>[root@hosted-ce30 ~]# rpm -q condor-bosco<br/>condor-bosco-8.8.5-1.3.osg35.el7.x86_64<br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(10:46:06)</span> <b>matyas:</b></span> is the remote node el6 or el7?<br/>
<span style="color: #c386df"><span style="font-size: small">(10:47:58)</span> <b>matyas:</b></span> do you have anything in /etc/osg/bosco_override on the ce<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:48:03)</span> <b>marco.mascheroni:</b></span> [osg01@login001 ~]$ cat /etc/redhat-release<br/>CentOS Linux release 7.6.1810 (Core)<br/>
<span style="color: #a63024"><span style="font-size: small">(11:37:37)</span> <b>paschos:</b></span> @jdost321 chicago has no updates this week<br/>
<span style="color: #c386df"><span style="font-size: small">(11:48:44)</span> <b>matyas:</b></span> @marco.mascheroni Carl's gonna rebuild the blahp tarball; looks like it was built against an old version of condor<br/>
<span style="color: #e23f99"><span style="font-size: small">(11:49:04)</span> <b>marco.mascheroni:</b></span> ok<br/>
<span style="color: #e23f99"><span style="font-size: small">(11:49:47)</span> <b>marco.mascheroni:</b></span> the rsync is fixed (my bad, I though the machine was new, had to yum update)<br/>
<span style="color: #c386df"><span style="font-size: small">(11:59:43)</span> <b>matyas:</b></span> that's fine. I fixed the script to not use that feature and just do the chown by hand<br/>
<span style="color: #c386df"><span style="font-size: small">(12:13:25)</span> <b>matyas:</b></span> (not actually by hand, just by running chown after rsync. it's still the script that does it)<br/>
<span style="color: #c386df"><span style="font-size: small">(13:39:47)</span> <b>matyas:</b></span> @marco.mascheroni the bosco tarball should be fixed. Delete the existing bosco cluster on the New Jersey hosted CE (<tt>bosco_cluster -r &lt;remote host&gt;</tt>) and rerun osg-configure to reinstall it<br/>
<span style="color: #e23f99"><span style="font-size: small">(13:50:58)</span> <b>marco.mascheroni:</b></span> So I need to update condor-bosco from osg-testing?<br/>
<span style="color: #c386df"><span style="font-size: small">(13:55:02)</span> <b>matyas:</b></span> can't hurt<br/>
<span style="color: #c386df"><span style="font-size: small">(13:55:45)</span> <b>matyas:</b></span> well, there wasn't an update to the rpm, just the tarball<br/>
<span style="color: #e23f99"><span style="font-size: small">(13:56:11)</span> <b>marco.mascheroni:</b></span> ah ok<br/>
<span style="color: #c386df"><span style="font-size: small">(13:56:21)</span> <b>matyas:</b></span> the tarball that bosco_cluster downloads, that is<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:19:09)</span> <b>marco.mascheroni:</b></span> Still getting the same error<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:19:42)</span> <b>marco.mascheroni:</b></span> (I did not run any yum update)<br/>
<span style="color: #c386df"><span style="font-size: small">(14:21:49)</span> <b>matyas:</b></span> try running <tt>bosco_cluster -a &lt;remote user&gt;@&lt;remote host&gt;</tt> by hand?<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:22:47)</span> <b>marco.mascheroni:</b></span> is it the same as putting <tt>install_cluster = always</tt> in the local ini ?<br/>
<span style="color: #c386df"><span style="font-size: small">(14:22:53)</span> <b>matyas:</b></span> yeah<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:22:57)</span> <b>marco.mascheroni:</b></span> I did that<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:25:45)</span> <b>marco.mascheroni:</b></span> <pre><br/>[osg01@login001 ~]$ ls bosco/glite/ -altr<br/>total 78<br/>drwxr-xr-x 4 osg01 osg01  4 Sep  9 15:45 share<br/>lrwxrwxrwx 1 osg01 osg01  3 Sep 11 15:22 libexec -&gt; bin<br/>drwxr-xr-x 4 osg01 osg01  4 Sep 20 15:20 ..<br/>drwxr-xr-x 2 osg01 osg01  2 Sep 20 15:20 log<br/>drwxr-xr-x 7 osg01 osg01  8 Sep 20 15:20 .<br/>drwxr-xr-x 3 osg01 osg01 11 Sep 20 15:20 lib<br/>drwxr-xr-x 2 osg01 osg01 69 Sep 20 15:20 bin<br/>drwxr-xr-x 4 osg01 osg01 11 Sep 20 15:20 etc<br/></pre><br/>timestamps were updated here<br/>
<span style="color: #c386df"><span style="font-size: small">(14:26:27)</span> <b>matyas:</b></span> do <tt>find bosco -type f -name \*classad\*</tt><br/>
<span style="color: #e23f99"><span style="font-size: small">(14:27:12)</span> <b>marco.mascheroni:</b></span> wait it is starting now<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:27:17)</span> <b>marco.mascheroni:</b></span> <pre><br/>drwxr-xr-x 4 osg01 osg01 11 Sep 20 15:20 etc<br/>[osg01@login001 ~]$ bosco/glite/bin/batch_gahp<br/>bosco/glite/bin/batch_gahp.symlink: /home/osg/osg01/bosco/glite/bin/../lib/condor/libglobus_common.so.0: no version information available (required by bosco/glite/bin/batch_gahp.symlink)<br/>sh: /etc/blah.config: No such file or directory<br/>$GahpVersion: 1.8.0 Mar 31 2008 INFN\ blahpd\ (poly,new_esc_format) $<br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(14:27:57)</span> <b>matyas:</b></span> is it dying or is it just complaining?<br/>
<span style="color: #385a86"><span style="font-size: small">(14:29:16)</span> <b>jdost321:</b></span> @jlstephen @lincoln I'm not able to ssh into the new hosted CE for New Jersey <pre>ssh <a href="mailto:root@hosted-ce30.grid.uchicago.edu">root@hosted-ce30.grid.uchicago.edu</a><br/>The authenticity of host '<a href="http://hosted-ce30.grid.uchicago.edu">hosted-ce30.grid.uchicago.edu</a> (128.135.158.171)' can't be established.<br/>ECDSA key fingerprint is SHA256:XHbK9Mjje8C47Gcbeoes6Sf7eOwnEboCuq3F3m2Mh5k.<br/>Are you sure you want to continue connecting (yes/no)? yes<br/>Warning: Permanently added '<a href="http://hosted-ce30.grid.uchicago.edu">hosted-ce30.grid.uchicago.edu</a>,128.135.158.171' (ECDSA) to the list of known hosts.<br/><a href="mailto:root@hosted-ce30.grid.uchicago.edu">root@hosted-ce30.grid.uchicago.edu</a>: Permission denied (publickey,hostbased).</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(14:31:55)</span> <b>marco.mascheroni:</b></span> just complaining, seeing if it works<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:34:23)</span> <b>marco.mascheroni:</b></span> <pre><br/>[osg01@login001 ~]$ which sbatch<br/>/cm/shared/apps/slurm/17.11.8/bin/sbatch<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(14:34:37)</span> <b>marco.mascheroni:</b></span> <pre><br/>   9.0   osg01           9/20 14:32 submission command failed (exit code = 1) (stdout:) (stderr:/home/osg/osg01/bosco/glite/libexec/slurm_submit.sh: line 88: /usr/bin/sbatch: No such<br/>file or directory-Error from sbatch: -)<br/><br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(14:36:04)</span> <b>marco.mascheroni:</b></span> Is it this config knob<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:36:18)</span> <b>marco.mascheroni:</b></span> <pre><br/>[osg01@login001 ~]$ grep "slurm_binpath" bosco/glite/etc/blah.config<br/>slurm_binpath=/usr/bin<br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(14:36:22)</span> <b>matyas:</b></span> yeah that's the one<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:36:50)</span> <b>marco.mascheroni:</b></span> so I need to put the blah.config in the git repo?<br/>
<span style="color: #c386df"><span style="font-size: small">(14:36:57)</span> <b>matyas:</b></span> yeah<br/>
<span style="color: #c386df"><span style="font-size: small">(14:37:18)</span> <b>matyas:</b></span> RESOURCE/bosco_override/glite/etc/blah.config<br/>
<span style="color: #c386df"><span style="font-size: small">(14:38:49)</span> <b>matyas:</b></span> then use <tt>install-resource RESOURCE</tt> to copy it into <tt>/etc/osg/bosco_override</tt> and run <tt>osg-configure -c</tt><br/>
<span style="color: #ea2977"><span style="font-size: small">(14:59:07)</span> <b>jlstephen:</b></span> @jdost321 can you try again<br/>
<span style="color: #385a86"><span style="font-size: small">(14:59:24)</span> <b>jdost321:</b></span> Thanks Judith I'm in!<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:59:49)</span> <b>marco.mascheroni:</b></span> @matyas ok, getting there, the current error is:<br/>```<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:59:56)</span> <b>marco.mascheroni:</b></span> <pre><br/>  20.0   osg01           9/20 14:55 submission command failed (exit code = 1) (stdout:) (stderr:sbatch: error: Memory specification can not be satisfied-sbatch: error: Batch job submission failed: Requested node configuration is not available-Error from sbatch: -)<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(15:00:22)</span> <b>marco.mascheroni:</b></span> when I manually removed:<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:00:52)</span> <b>marco.mascheroni:</b></span> <pre><br/>#SBATCH --mem<br/></pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(15:00:54)</span> <b>marco.mascheroni:</b></span> it worked<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:01:07)</span> <b>marco.mascheroni:</b></span> They do not want us to specify the memory<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:01:23)</span> <b>marco.mascheroni:</b></span> is there a clean way to do that, or should I just patch slurm_submit.sh?<br/>
<span style="color: #c386df"><span style="font-size: small">(15:02:47)</span> <b>matyas:</b></span> let me look<br/>
<span style="color: #c386df"><span style="font-size: small">(15:03:07)</span> <b>matyas:</b></span> I think there's a way to specify additional attributes but I dunno if there's a way to remove attributes<br/>
<span style="color: #c386df"><span style="font-size: small">(15:05:40)</span> <b>matyas:</b></span> was it just plain <tt>#SBATCH --mem</tt> or was it <tt>#SBATCH --mem=1024</tt> or something?<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:08:52)</span> <b>marco.mascheroni:</b></span> the second one<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:08:58)</span> <b>marco.mascheroni:</b></span> #SBATCH --mem=1024<br/>
<span style="color: #c386df"><span style="font-size: small">(15:09:34)</span> <b>matyas:</b></span> ok, if <tt>$bls_opt_req_mem</tt> is unset when <tt>slurm_submit.sh</tt> is run, then it won't add the line<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:10:49)</span> <b>marco.mascheroni:</b></span> I think it's fine to patch it for the time being. Gotta get to a plane now. We can see later if there is a clean solution<br/>
<span style="color: #c386df"><span style="font-size: small">(15:11:16)</span> <b>matyas:</b></span> Try adding <tt>unset bls_opt_req_mem</tt> to <tt>etc/blah.config</tt>?<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:11:22)</span> <b>marco.mascheroni:</b></span> Besides that we were able to submit the job to slurm<br/>
<span style="color: #e23f99"><span style="font-size: small">(15:11:29)</span> <b>marco.mascheroni:</b></span> ok<br/>
<span style="color: #385a86"><span style="font-size: small">(15:12:39)</span> <b>jdost321:</b></span> Mat, i will continue poking around where Marco left off as well this afternoon, just to get a better understanding of all this, I can try the unset later<br/>
<span style="color: #c386df"><span style="font-size: small">(15:19:19)</span> <b>matyas:</b></span> ok cool<br/>
</body>
</html>
