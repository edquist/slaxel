<!DOCTYPE html>
<html>
<head>
<title>Wed May 27, 2020 : #operations (osg)</title>
</head>
<body>
<h3>Wed May 27, 2020 : #operations (osg)</h3>
<span style="color: #c386df"><span style="font-size: small">(16:15:56)</span> <b>matyas:</b></span> @jdost321, @efajardo I'm having trouble with the GLOW frontend <a href="http://glidein2.chtc.wisc.edu">glidein2.chtc.wisc.edu</a> after swapping out the host cert<br/>
<span style="color: #c386df"><span style="font-size: small">(16:17:34)</span> <b>matyas:</b></span> It's not able to advertise to the collector; when I run condor_ping, I get this:<br/>&gt; condor_ping -debug -verbose -pool <a href="http://gfactory-2.opensciencegrid.org">gfactory-2.opensciencegrid.org</a> -type COLLECTOR DC_NOP<br/><pre>05/27/20 16:17:17 KEYCACHE: created: 0x1172190<br/>05/27/20 16:17:17 recognized DC_NOP as command name, using command 60011.<br/>05/27/20 16:17:17 SECMAN: command 60040 DC_SEC_QUERY to collector &lt;169.228.38.43:9618&gt; from TCP port 45334 (blocking).<br/>05/27/20 16:17:17 SECMAN: new session, doing initial authentication.<br/>05/27/20 16:17:17 SECMAN: Auth methods: FS,GSI<br/>05/27/20 16:17:17 AUTHENTICATE: setting timeout for &lt;169.228.38.43:9618&gt; to 20.<br/>05/27/20 16:17:17 HANDSHAKE: in handshake(my_methods = 'FS,GSI')<br/>05/27/20 16:17:17 HANDSHAKE: handshake() - i am the client<br/>05/27/20 16:17:17 HANDSHAKE: sending (methods == 36) to server<br/>05/27/20 16:17:17 HANDSHAKE: server replied (method = 4)<br/>05/27/20 16:17:17 AUTHENTICATE_FS: used dir /tmp/FS_XXXcsUDEw, status: 0<br/>05/27/20 16:17:17 AUTHENTICATE: method 4 (FS) failed.<br/>05/27/20 16:17:17 HANDSHAKE: in handshake(my_methods = 'GSI')<br/>05/27/20 16:17:17 HANDSHAKE: handshake() - i am the client<br/>05/27/20 16:17:17 HANDSHAKE: sending (methods == 32) to server<br/>05/27/20 16:17:17 HANDSHAKE: server replied (method = 32)<br/>05/27/20 16:17:18 ZKM: VOMS FQAN not present (error 1), ignoring.<br/>05/27/20 16:17:18 GSI_DAEMON_NAME is defined and the server /DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://gfactory-2.opensciencegrid.org">gfactory-2.opensciencegrid.org</a> is not specified in the GSI_DAEMON_NAME parameter<br/>05/27/20 16:17:18 AUTHENTICATE: method 32 (GSI) failed.<br/>05/27/20 16:17:18 HANDSHAKE: in handshake(my_methods = '')<br/>05/27/20 16:17:18 HANDSHAKE: handshake() - i am the client<br/>05/27/20 16:17:18 HANDSHAKE: sending (methods == 0) to server<br/>05/27/20 16:17:18 HANDSHAKE: server replied (method = 0)<br/>05/27/20 16:17:18 SECMAN: required authentication with collector &lt;169.228.38.43:9618&gt; failed, so aborting command DC_SEC_QUERY.<br/>DC_NOP failed!<br/>AUTHENTICATE:1003:Failed to authenticate with any method<br/>AUTHENTICATE:1004:Failed to authenticate using GSI<br/>GSI:5006:Failed to authenticate because the subject '/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://gfactory-2.opensciencegrid.org">gfactory-2.opensciencegrid.org</a>' is not currently trusted by you.  If it should be, add it to GSI_DAEMON_NAME or undefine GSI_DAEMON_NAME.<br/>AUTHENTICATE:1004:Failed to authenticate using FS</pre><br/>
<span style="color: #385a86"><span style="font-size: small">(16:20:58)</span> <b>jdost321:</b></span> let me make sure condor was actually reconfigured here after adding it<br/>
<span style="color: #385a86"><span style="font-size: small">(16:25:01)</span> <b>jdost321:</b></span> hmm but your log is complaining about the factory dn<br/>
<span style="color: #385a86"><span style="font-size: small">(16:35:55)</span> <b>jdost321:</b></span> somewhere in the FE you have a proxy generated from the hostcert to talk to the factory<br/>
<span style="color: #385a86"><span style="font-size: small">(16:36:01)</span> <b>jdost321:</b></span> the path should be somewhere in your frontend.xml<br/>
<span style="color: #385a86"><span style="font-size: small">(16:36:12)</span> <b>jdost321:</b></span> can you make sure its still being generated with the new cert?<br/>
<span style="color: #385a86"><span style="font-size: small">(16:37:10)</span> <b>jdost321:</b></span> classad_proxy<br/>
<span style="color: #385a86"><span style="font-size: small">(16:37:18)</span> <b>jdost321:</b></span> also you might have DNs in the xml file you have to update as well<br/>
<span style="color: #c386df"><span style="font-size: small">(16:39:49)</span> <b>matyas:</b></span> the proxies are fine; I have both the old factory DN and the new factory DN in frontend.xml<br/>
<span style="color: #385a86"><span style="font-size: small">(16:40:07)</span> <b>jdost321:</b></span> what about the DN for your own cert in the xml?<br/>
<span style="color: #c386df"><span style="font-size: small">(16:40:56)</span> <b>matyas:</b></span> Those are good too<br/>
<span style="color: #385a86"><span style="font-size: small">(16:45:56)</span> <b>jdost321:</b></span> well, on our side everything looks good.. Edita only added the new DN we didn't remove the old one<br/>
<span style="color: #385a86"><span style="font-size: small">(16:53:42)</span> <b>jdost321:</b></span> hmm wait.. we might have a typo :disappointed:<br/>
<span style="color: #385a86"><span style="font-size: small">(17:00:58)</span> <b>jdost321:</b></span> was missing a backslash escape char in the condor_mapfile<br/>
<span style="color: #385a86"><span style="font-size: small">(17:01:20)</span> <b>jdost321:</b></span> let's see if this fixes it, may take a few minutes for the factory to restart<br/>
<span style="color: #385a86"><span style="font-size: small">(17:05:27)</span> <b>jdost321:</b></span> i see chtc2 now in the list<br/>
<span style="color: #385a86"><span style="font-size: small">(17:05:29)</span> <b>jdost321:</b></span> condor_status -pool <a href="http://gfactory-2.opensciencegrid.org:9618">gfactory-2.opensciencegrid.org:9618</a> -any -const 'mytype=?="glideclient"' -af frontendname | sort |uniq -c<br/>     71 chtc2<br/>
<span style="color: #43761b"><span style="font-size: small">(17:07:03)</span> <b>blin:</b></span> wooo!<br/>
<span style="color: #43761b"><span style="font-size: small">(17:07:09)</span> <b>blin:</b></span> shows up in the factory dropdown too<br/>
<span style="color: #c386df"><span style="font-size: small">(17:07:10)</span> <b>matyas:</b></span> thanks!<br/>
<span style="color: #43761b"><span style="font-size: small">(17:07:23)</span> <b>blin:</b></span> nice detective work<br/>
<span style="color: #c386df"><span style="font-size: small">(17:07:29)</span> <b>matyas:</b></span> No idea why that manifests itself as the _frontend_ not trusting the _factory_<br/>
<span style="color: #385a86"><span style="font-size: small">(17:35:23)</span> <b>jdost321:</b></span> there's some weird magic env stuff the frontend does that you don't get runnign the commands from the terminal<br/>
<span style="color: #385a86"><span style="font-size: small">(17:35:36)</span> <b>jdost321:</b></span> sometimes the errors are misleading when you run them manually beacuase of it<br/>
<span style="color: #c386df"><span style="font-size: small">(17:41:32)</span> <b>matyas:</b></span> What's a good way of turning up the debugging in the frontend logs? All the /var/log/gwms-frontend/... logs showed was that it couldn't advertise to the collector<br/>
</body>
</html>
