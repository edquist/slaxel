<!DOCTYPE html>
<html>
<head>
<title>Tue Nov 6, 2018 : #operations (osg)</title>
</head>
<body>
<h3>Tue Nov 6, 2018 : #operations (osg)</h3>
<span style="color: #c386df"><span style="font-size: small">(09:18:27)</span> <b>matyas:</b></span> justification = our ui sucks and we should feel bad :stuck_out_tongue:<br/>
<span style="color: #c386df"><span style="font-size: small">(09:19:28)</span> <b>matyas:</b></span> I'm guessing the higher ups won't care enough though it might be worth mentioning it...<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:23:26)</span> <b>bbockelm:</b></span> where is the rgdowntime page rendered<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:23:48)</span> <b>bbockelm:</b></span> It's not a horrible idea to export a iCal format (e.g., <a href="https://icalendar.readthedocs.io/en/latest/usage.html#example">https://icalendar.readthedocs.io/en/latest/usage.html#example</a>)<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:24:19)</span> <b>bbockelm:</b></span> (then we can just use one of the million iCal renderers)<br/>
<span style="color: #c386df"><span style="font-size: small">(09:25:21)</span> <b>matyas:</b></span> I was just gonna suggest a simple-ish HTML page like what I did for contacts, but I like the iCal thing too<br/>
<span style="color: #c386df"><span style="font-size: small">(09:26:21)</span> <b>matyas:</b></span> the rgdowntime page is not really "rendered," I just crap out some XML and if you have a decent browser, it will pretty-print it<br/>
<span style="color: #c386df"><span style="font-size: small">(09:28:25)</span> <b>matyas:</b></span> could probably do the ical thing in half a day to a day<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:31:34)</span> <b>bbockelm:</b></span> is there a good script that shows how to burp out the XML by hand?<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:42:23)</span> <b>bbockelm:</b></span> hm - what's the minimum version of python 3 for the topology webapp these days?<br/>
<span style="color: #c386df"><span style="font-size: small">(09:43:13)</span> <b>matyas:</b></span> 3.6<br/>
<span style="color: #c386df"><span style="font-size: small">(09:44:24)</span> <b>matyas:</b></span> you can run <tt>src/webapp/rg_reader.py &lt;topology dir&gt; rgsummary.xml rgdowntime.xml</tt> to generate the xmls<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:27:25)</span> <b>bbockelm:</b></span> @matyas - <a href="https://github.com/opensciencegrid/topology/pull/276">https://github.com/opensciencegrid/topology/pull/276</a><br/>
<span style="color: #c386df"><span style="font-size: small">(13:02:00)</span> <b>matyas:</b></span> aren't you supposed to be at a meeting? :stuck_out_tongue:<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:48:29)</span> <b>bbockelm:</b></span> :wink: Better than checking email!<br/>
<span style="color: #53b759"><span style="font-size: small">(16:17:21)</span> <b>marian:</b></span> hey <b>@here</b> on another note regarding subject: "Re: Heads-up: Announcement for coming outage" ... We shouldn't wait until another day to send announcement out. Agreement/Disagreement? Send as proposed in my last reply?<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:38:03)</span> <b>jthiltges:</b></span> I'd like to switch <a href="http://topology-itb.opensciencegrid.org">topology-itb.opensciencegrid.org</a> over to a newly rebuilt VM (currently at 129.93.175.24). Any concerns?<br/>
<span style="color: #c386df"><span style="font-size: small">(16:39:31)</span> <b>matyas:</b></span> let me take a look<br/>
<span style="color: #c386df"><span style="font-size: small">(16:41:39)</span> <b>matyas:</b></span> can you copy over <tt>/etc/opt/topology/config-itb.py</tt> from the current topology-itb?<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:43:51)</span> <b>dweitzel:</b></span> Btw. We are going to swap itb and production tomorrow hopefully. Any concerns @matyas <br/>
<span style="color: #c386df"><span style="font-size: small">(16:44:01)</span> <b>matyas:</b></span> uhhhh<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:44:30)</span> <b>jthiltges:</b></span> In setting it up, I copied over <tt>/etc/opt/topology</tt> and <tt>/etc/letsencrypt</tt>, along with the osgcollab authorized keys<br/>
<span style="color: #c386df"><span style="font-size: small">(16:44:58)</span> <b>matyas:</b></span> well for some reason the configs are different<br/>
<span style="color: #c386df"><span style="font-size: small">(16:45:12)</span> <b>matyas:</b></span> puppet might be off on the current host though<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:47:07)</span> <b>jthiltges:</b></span> Ah... doh. I copied it from the production machine. Not itb.<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:48:23)</span> <b>jthiltges:</b></span> Should be fixed now.<br/>
<span style="color: #c386df"><span style="font-size: small">(16:48:47)</span> <b>matyas:</b></span> also something seems wrong with the webapp on the new host -- it's immediately redirecting to the map instead of displaying to the main page<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:49:32)</span> <b>jthiltges:</b></span> Hmm. I wonder if that's a vhost config thing if it's accessed by IP.<br/>
<span style="color: #c386df"><span style="font-size: small">(16:51:28)</span> <b>matyas:</b></span> @dweitzel what do you mean switch the two hosts? in dns?<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:52:03)</span> <b>dweitzel:</b></span> yes<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:52:07)</span> <b>dweitzel:</b></span> in DNS<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:52:20)</span> <b>dweitzel:</b></span> we will for repo as well, but that shouldn't have as much affect<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:52:40)</span> <b>dweitzel:</b></span> (and we will ask gridcf to swap as well)<br/>
<span style="color: #c386df"><span style="font-size: small">(16:52:42)</span> <b>matyas:</b></span> topology-itb is set up differently than production though<br/>
<span style="color: #c386df"><span style="font-size: small">(16:53:23)</span> <b>matyas:</b></span> webapp runs out of /opt/topology-itb instead of /opt/toplogy; uses config-itb.py instead of config-production.py<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:56:12)</span> <b>dweitzel:</b></span> I forget how the vhosts are setup.  I thought it would work out.<br/>
<span style="color: #c386df"><span style="font-size: small">(16:58:01)</span> <b>matyas:</b></span> so what order are you guys doing these in? the new host @jthiltges is setting up will be the new topology-itb and the existing topology-itb will be the new topology(production)?<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:00:17)</span> <b>dweitzel:</b></span> new host john is setting up will be production.  I suppose existing ITB will stay ITB.  Existing production will be go away.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:00:51)</span> <b>dweitzel:</b></span> We are trying to avoid the network downtime I mentioned during the call on monday.  The existing production topology would be affected.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:01:08)</span> <b>dweitzel:</b></span> @jthiltges sound right^<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:01:17)</span> <b>jthiltges:</b></span> :+1:<br/>
<span style="color: #c386df"><span style="font-size: small">(17:01:29)</span> <b>matyas:</b></span> in that case we should be setting up the new host as production, not itb, right?<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:01:57)</span> <b>dweitzel:</b></span> Yes, I think I got a bit confused in the swap.<br/>
<span style="color: #c386df"><span style="font-size: small">(17:02:21)</span> <b>matyas:</b></span> ok whew. that's less scary<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:03:12)</span> <b>jthiltges:</b></span> (Sigh. It's been complicated. We're undoing a previous swap.)<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:03:18)</span> <b>dweitzel:</b></span> @jthiltges I do want current repo-itb to go away.  It's an ugly beast.  It was the first repo made quickly to just get something working.  A bit hacky.  I think it's ok to create a new production repo, then kill repo-itb.<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:03:44)</span> <b>dweitzel:</b></span> and make the existing production repo go to repo-itb<br/>
<span style="color: #c386df"><span style="font-size: small">(17:05:53)</span> <b>matyas:</b></span> we are gonna want _some_ kind of repo-itb for testing<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:11:23)</span> <b>jthiltges:</b></span> Trying to summarize the dance, if only for my own sanity:<br/><pre>Today: rebuild ITB<br/>- old repo-itb =&gt; (gone)<br/>- new VM       =&gt; repo-itb<br/><br/>Tomorrow: swap ITB and production<br/>- repo     =&gt; repo-itb<br/>- repo-itb =&gt; repo</pre><br/>
<span style="color: #e06b56"><span style="font-size: small">(17:11:38)</span> <b>jthiltges:</b></span> And the same thing for topology.<br/>
<span style="color: #73769d"><span style="font-size: small">(17:12:39)</span> <b>tim.theisen:</b></span> If you make a new repo. There are a couple of scripts that are used in osgcollab's bin directory that get used when releasing tarballs.<br/>
<span style="color: #73769d"><span style="font-size: small">(17:13:04)</span> <b>tim.theisen:</b></span> What is the best way to make sure these are preserved/copied?<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:13:54)</span> <b>jthiltges:</b></span> For this go-around, I've been trying to document the build steps. I copied the <tt>/home/osgcollab</tt> and <tt>/home/gctuploader</tt> directories over.<br/>
<span style="color: #73769d"><span style="font-size: small">(17:14:31)</span> <b>tim.theisen:</b></span> OK, that works for me. They didn't get copied over last time. Thank you for taking care of this.<br/>
<span style="color: #c386df"><span style="font-size: small">(17:17:03)</span> <b>matyas:</b></span> @jthiltges that's not the dance I understood for topology. I thought it was <pre><br/>Today: new VM (make it look like production)<br/>Tomorrow: move topology to new VM<br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(17:25:32)</span> <b>matyas:</b></span> so which one is it?<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:29:29)</span> <b>jthiltges:</b></span> I guess I didn't realize there was a difference between prod and ITB. From the puppet side, there isn't one.<br/>
<span style="color: #c386df"><span style="font-size: small">(17:33:58)</span> <b>matyas:</b></span> @dweitzel how does httpd on topology-itb know to run the webapp out of /opt/topology-itb instead of /opt/topology?<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:35:50)</span> <b>jthiltges:</b></span> <pre>$ curl -s --insecure -H 'Host: <a href="http://topology.opensciencegrid.org">topology.opensciencegrid.org</a>' <a href="https://129.93.175.24">https://129.93.175.24</a> | grep title<br/>&lt;title&gt;OSG Topology Interface&lt;/title&gt;<br/><br/>$ curl -s --insecure -H 'Host: <a href="http://topology-itb.opensciencegrid.org">topology-itb.opensciencegrid.org</a>' <a href="https://129.93.175.24">https://129.93.175.24</a> | grep title<br/>&lt;title&gt;OSG Topology Interface (ITB instance)&lt;/title&gt;</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(17:36:40)</span> <b>dweitzel:</b></span> It actually runs both on both. It matters on the vhost <br/>
<span style="color: #e06b56"><span style="font-size: small">(17:36:43)</span> <b>jthiltges:</b></span> <pre>[root@hcc-osg-topology ~]# grep WSGIScriptAlias /etc/httpd/conf.d/topology-*<br/>/etc/httpd/conf.d/topology-itb.conf:WSGIScriptAlias / /opt/topology-itb/src/topology-itb.wsgi<br/>/etc/httpd/conf.d/topology-ssl.conf:WSGIScriptAlias / /opt/topology/src/topology.wsgi</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(17:37:00)</span> <b>dweitzel:</b></span> So. Clever configuration of the Apache process. <br/>
<span style="color: #c386df"><span style="font-size: small">(17:37:59)</span> <b>matyas:</b></span> what happens if the host is neither of these, e.g. with <a href="https://129.93.175.24">https://129.93.175.24</a> ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:38:27)</span> <b>dweitzel:</b></span> I think there’s a default?  Not sure. <br/>
<span style="color: #c386df"><span style="font-size: small">(17:42:27)</span> <b>matyas:</b></span> the redirect to the map seems a little weird. if I enter any of the webapp urls directly (e.g. <a href="https://129.93.175.24/generate_downtime">https://129.93.175.24/generate_downtime</a>), they work fine<br/>
<span style="color: #c386df"><span style="font-size: small">(17:43:13)</span> <b>matyas:</b></span> and the map dies with this message:<pre><br/>Google Maps JavaScript API error: RefererNotAllowedMapError<br/><a href="https://developers.google.com/maps/documentation/javascript/error-messages#referer-not-allowed-map-error">https://developers.google.com/maps/documentation/javascript/error-messages#referer-not-allowed-map-error</a><br/>Your site URL to be authorized: <a href="https://129.93.175.24/map/iframe#29.22889,-90.08789%7C4%7Cterrain">https://129.93.175.24/map/iframe#29.22889,-90.08789%7C4%7Cterrain</a><br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(17:43:18)</span> <b>matyas:</b></span> but I'm guessing that's to be expected<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:52:08)</span> <b>jthiltges:</b></span> For quick testing on my desktop, I added it to /etc/hosts.<br/>
<span style="color: #c386df"><span style="font-size: small">(18:06:58)</span> <b>matyas:</b></span> ok, looks like it works<br/>
<span style="color: #235e5b"><span style="font-size: small">(18:14:24)</span> <b>dweitzel:</b></span> Map is expected.  It’s restricted down so other people can’t overuse our api. It’s the thing we pay for if there’s too much usage. <br/>
<span style="color: #c386df"><span style="font-size: small">(18:14:51)</span> <b>matyas:</b></span> and it's based on which site the request is coming from?<br/>
<span style="color: #c386df"><span style="font-size: small">(18:15:29)</span> <b>matyas:</b></span> but the browser can fool it into thinking it's coming from a different site?<br/>
<span style="color: #c386df"><span style="font-size: small">(18:21:53)</span> <b>matyas:</b></span> anyway, I'm OK with the switchover<br/>
<span style="color: #c386df"><span style="font-size: small">(18:22:58)</span> <b>matyas:</b></span> other than the bit where osgcollab doesn't have sudo on the new host<br/>
<span style="color: #235e5b"><span style="font-size: small">(19:15:43)</span> <b>dweitzel:</b></span> yes, browser can spoof the referrer.<br/>
</body>
</html>
