<!DOCTYPE html>
<html>
<head>
<title>Mon Aug 9, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Mon Aug 9, 2021 : #operations (osg)</h3>
<span style="color: #5a4592"><span style="font-size: small">(10:41:29)</span> <b>kurtjstrosahl:</b></span> The jlab submit host (scosg20) is still not submitting jobs (hasn't been since Thursday) as per ticket 67792... is there any additional guidance or debugging we can do?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:58:20)</span> <b>blin:</b></span> hi @kurtjstrosahl, just skimming that ticket:<br/>1. what's <tt>openssl x509 -in /etc/grid-security/hostcert.pem -noout -subject -issuer</tt> give you?<br/>2. does <tt>/etc/grid-security/hostcert.pem</tt> only contain the leaf cert? it shouldn't contain the intermediate/root certs<br/>
<span style="color: #53b759"><span style="font-size: small">(11:11:04)</span> <b>marian:</b></span> the problem is actually happening with also scosg16 which worked before and likely stopped after security update of condor to 8.8.15 ... <a href="http://scosg16.jlab.org">scosg16.jlab.org</a> and <a href="http://scosg20.jlab.org">scosg20.jlab.org</a> have different certificate issuer:<br/>
<span style="color: #53b759"><span style="font-size: small">(11:11:33)</span> <b>marian:</b></span> scosg20 is InCommon cert:<br/>
<span style="color: #53b759"><span style="font-size: small">(11:11:40)</span> <b>marian:</b></span> <pre>openssl x509 -in /etc/grid-security/hostcert.pem -noout -subject -issuer<br/>subject= /DC=org/DC=incommon/C=US/ST=Virginia/L=Newport News/O=Thomas Jefferson National Accelerator Facility/OU=SciComp/CN=<a href="http://scosg20.jlab.org">scosg20.jlab.org</a><br/>issuer= /C=US/O=Internet2/OU=InCommon/CN=InCommon IGTF Server CA</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(11:12:07)</span> <b>marian:</b></span> scosg16 is Letsencrypt:<br/><pre>openssl x509 -in /etc/grid-security/hostcert.pem -noout -subject -issuer<br/>subject= /CN=<a href="http://scosg16.jlab.org">scosg16.jlab.org</a><br/>issuer= /C=US/O=Let's Encrypt/CN=R3</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:13:23)</span> <b>blin:</b></span> are they both access points?<br/>
<span style="color: #53b759"><span style="font-size: small">(11:18:48)</span> <b>marian:</b></span> yes, submit nodes<br/>
<span style="color: #53b759"><span style="font-size: small">(11:21:21)</span> <b>marian:</b></span> we didn't make scosg20 fully working yet, however ... but mysterious is scosg16 didn't have auth issues before update ... we communicated last on Saturday in the ticket with JLab admins, there is good set of replies that describe situation ... wanted to bring it up on standup shortly<br/>
<span style="color: #43761b"><span style="font-size: small">(11:21:51)</span> <b>blin:</b></span> where does the collector live? does that have <tt>osg-ca-certs</tt> installed or <tt>igtf-ca-certs</tt>? is the cert on scosg16 unexpired?<br/>
<span style="color: #53b759"><span style="font-size: small">(11:24:01)</span> <b>marian:</b></span> it is all unexpired as far as I can tell ... first things I ruled out expiration on Friday, too... btw, I didn't have good start of the day, not feeling good but checked in to at least try to bring up this problem with JLab ...<br/>
<span style="color: #53b759"><span style="font-size: small">(11:24:37)</span> <b>marian:</b></span> jlab collector is at UCSD, I have root access there<br/>
<span style="color: #53b759"><span style="font-size: small">(11:26:41)</span> <b>marian:</b></span> <pre>subject= /CN=<a href="http://scosg16.jlab.org">scosg16.jlab.org</a><br/>issuer= /C=US/O=Let's Encrypt/CN=R3<br/>notAfter=Oct 18 19:21:36 2021 GMT</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(11:27:18)</span> <b>marian:</b></span> collector:<br/><pre>subject= /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-jlab-1.t2.ucsd.edu">osg-jlab-1.t2.ucsd.edu</a><br/>issuer= /C=US/O=Internet2/OU=InCommon/CN=InCommon IGTF Server CA<br/>notAfter=Sep 28 23:59:59 2021 GMT</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(11:28:33)</span> <b>marian:</b></span> <tt>osg-ca-certs.noarch 0:1.91-1.osg35.el7</tt> on collector, going to update, just in case<br/>
<span style="color: #43761b"><span style="font-size: small">(11:30:25)</span> <b>blin:</b></span> yeah, i think that may be the problem<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:59:18)</span> <b>bbockelm:</b></span> Looks like the schedd can authenticate with the collector.  Can the negotiator auth. with the schedd?<br/>
<span style="color: #5a4592"><span style="font-size: small">(11:59:24)</span> <b>kurtjstrosahl:</b></span> Still seeing:<br/>08/09/21 12:58:16 (pid:217187) DC_AUTHENTICATE: required authentication of 192.170.227.251 failed: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using PASSWORD<br/>08/09/21 12:58:16 (pid:217187) DC_AUTHENTICATE: required authentication of 192.170.227.251 failed: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using PASSWORD<br/>08/09/21 12:58:17 (pid:217187) DC_AUTHENTICATE: required authentication of 192.170.227.251 failed: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using PASSWORD<br/>08/09/21 12:58:17 (pid:217187) DC_AUTHENTICATE: required authentication of 192.170.227.251 failed: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using PASSWORD<br/>08/09/21 12:58:20 (pid:217187) Received a superuser command<br/>08/09/21 12:58:20 (pid:217187) Number of Active Workers 0<br/>08/09/21 12:58:22 (pid:217187) Number of Active Workers 0<br/>08/09/21 12:58:22 (pid:217187) Number of Active Workers 1<br/>08/09/21 12:58:26 (pid:217187) Number of Active Workers 0<br/>08/09/21 12:58:27 (pid:217187) Number of Active Workers 0<br/>08/09/21 12:58:27 (pid:217187) Number of Active Workers 1<br/>08/09/21 12:58:29 (pid:217187) DC_AUTHENTICATE: required authentication of 169.228.130.127 failed: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using PASSWORD<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:16:36)</span> <b>bbockelm:</b></span> @kurtjstrosahl what file is that in?  Which host?<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:17:48)</span> <b>bbockelm:</b></span> If it’s in the ScheddLog, I’d suggest looking at the time stamps of config files in /etc/condor/config.d; did a new file get dropped during the upgrade?<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:23:14)</span> <b>kurtjstrosahl:</b></span> SchedLog on scosg16<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:24:02)</span> <b>kurtjstrosahl:</b></span> <pre>scosg16:~] ll -lsrt /etc/condor/config.d/<br/>total 104<br/>4 -rw-r--r-- 1 root root   27 May 18  2017 99-debug.config<br/>4 -rw-r--r-- 1 root root 1173 Apr 16  2018 99_gratia-gwms.conf<br/>4 -rw-r--r-- 1 root root  193 Apr 16  2018 99_gratia.conf<br/>4 -rw-r--r-- 1 root root 1366 Jul 10  2018 99_route_to_bosco.config<br/>4 -rw-r--r-- 1 root root  151 Nov 21  2018 99_release_tweaks.config<br/>4 -rw-r--r-- 1 root root   29 Apr  9  2019 90-ganglia-debug.config<br/>4 -rw-r--r-- 1 root root  678 Mar 26  2020 03_gwms_local.config<br/>8 -rw-r--r-- 1 root root 5327 Mar 26  2020 02_gwms_schedds.config<br/>4 -rw-r--r-- 1 root root 2213 Mar 26  2020 00_gwms_general.config<br/>4 -rw-r--r-- 1 root root   94 May  8  2020 99_filechecks.config<br/>4 -rw-r--r-- 1 root root   51 May 11  2020 90-shared-port-port.config<br/>4 -rw-r--r-- 1 root root   49 May 12  2020 93-flock-osgvo.config<br/>4 -rw-r--r-- 1 root root  549 May 14  2020 01_gwms_ganglia.config<br/>4 -rw-r--r-- 1 root root   55 Jul  1  2020 94-debugg.config<br/>4 -rw-r--r-- 1 root root   45 Jul  1  2020 99_for_debug.config<br/>4 -rw-r--r-- 1 root root   63 Jul  7  2020 60_job_request_defaults.config<br/>4 -rw-r--r-- 1 root root   65 Jul 29  2020 65-flock-osg.config<br/>4 -rw-r--r-- 1 root root   47 Jul 29  2020 92-flock-gluex.config<br/>4 -rw-r--r-- 1 root root  137 Jul 29  2020 98-ha-central-manager.config<br/>4 -rw-r--r-- 1 root root   25 Nov 30  2020 90-limits.config<br/>4 -rw-r--r-- 1 root root  257 May  3 15:18 99_local_tweaks.config<br/>4 -rw-r--r-- 1 root root  127 Jul 29 14:47 10-batch_gahp_blahp.config<br/>4 -rw-r--r-- 1 root root  198 Jul 29 14:47 00-restart_peaceful.config<br/>4 -rw-r--r-- 1 root root 2019 Jul 29 14:47 00-osg_default_security.config<br/>4 -rw-r--r-- 1 root root  981 Jul 29 14:47 00-osg_default_daemons.config</pre><br/><br/>
<span style="color: #5a4592"><span style="font-size: small">(12:26:25)</span> <b>kurtjstrosahl:</b></span> osg_default_security.config does have the following:<br/><pre># this will required PASSWORD authentications for daemon-to-daemon, and<br/># allow FS authentication for submitting jobs and running administrator commands<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = FS, PASSWORD<br/>SEC_DAEMON_AUTHENTICATION_METHODS = PASSWORD<br/>SEC_NEGOTIATOR_AUTHENTICATION_METHODS = PASSWORD<br/>SEC_PASSWORD_FILE = /etc/condor/passwords.d/POOL</pre><br/>
<span style="color: #5a4592"><span style="font-size: small">(12:31:39)</span> <b>kurtjstrosahl:</b></span> Interestingly enough... /etc/condor/passwords.d/POOL changed during the condor upgrade:<br/> root@scosg16:~] ll /etc/condor/passwords.d/POOL<br/>-r-------- 1 root root 64 Aug  5 11:43 /etc/condor/passwords.d/POOL<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:32:21)</span> <b>bbockelm:</b></span> Yeah, I think that might be your problem. Just to confirm the theory - can you comment those out?  I think they may be conflicting with security settings in 00_gwms_*<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:32:38)</span> <b>kurtjstrosahl:</b></span> Which line?<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:32:44)</span> <b>kurtjstrosahl:</b></span> or all of them?<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:34:57)</span> <b>kurtjstrosahl:</b></span> Just to test I moved that default_security file over to /tmp and did a condor_reconfig<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:35:30)</span> <b>kurtjstrosahl:</b></span> root@scosg16:~] condor_q | grep Total<br/>Total for query: 31333 jobs; 0 completed, 0 removed, 30397 idle, 605 running, 331 held, 0 suspended<br/>Total for all users: 31333 jobs; 0 completed, 0 removed, 30397 idle, 605 running, 331 held, 0 suspended<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:35:43)</span> <b>kurtjstrosahl:</b></span> and jobs started moving<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:43:01)</span> <b>kurtjstrosahl:</b></span> I commented out the lines I'd posted and put the file back, running condor_reconfig<br/>
<span style="color: #5a4592"><span style="font-size: small">(12:45:02)</span> <b>kurtjstrosahl:</b></span> and it's launched more jobs... so it looks like it was those lines<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:06:30)</span> <b>kurtjstrosahl:</b></span> So... why did this impact us?  We can't have been the first people to patch condor?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:12:20)</span> <b>blin:</b></span> that is curious, the <tt>00-*.conf</tt>  files have lived in the 8.8 OSG condor since the beginning of the release series<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:15:38)</span> <b>kurtjstrosahl:</b></span> Right, and I don't have a copy of those files from before the update to compare<br/>
<span style="color: #53b759"><span style="font-size: small">(13:17:02)</span> <b>marian:</b></span> btw, NegotiatorLog is reporting matched jobs again...<br/>
<span style="color: #43761b"><span style="font-size: small">(13:17:05)</span> <b>blin:</b></span> so we mark them as config(noreplace) in the packaging: meaning that if you had the files there but with lines commented out, we'd just drop <tt>00-osg_*.config.rpmnew</tt> files there that wouldn't take any effect<br/>
<span style="color: #53b759"><span style="font-size: small">(13:17:28)</span> <b>marian:</b></span> so this seem to have fix the issue ...<br/>
<span style="color: #43761b"><span style="font-size: small">(13:17:38)</span> <b>blin:</b></span> but if you deleted the files outright, installing the new package would place the uncommented config files in <tt>00-osg*.config</tt> where they would take effect<br/>
<span style="color: #53b759"><span style="font-size: small">(13:17:44)</span> <b>marian:</b></span> yeah, update shouldn't necessary overwrite the configs<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:19:48)</span> <b>kurtjstrosahl:</b></span> Here is what was updated<br/>    Updated    condor-8.8.10-1.1.osg34.el7.x86_64          @ osg<br/>    Update            8.8.15-1.2.osg35.el7.x86_64          @ osg<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:22:00)</span> <b>kurtjstrosahl:</b></span> I don't see any evidence that those files were removed before the update<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(13:25:32)</span> <b>blin:</b></span> one other possibility is that you guys were overriding the config in <tt>00-osg_default_security.config</tt> in a later file that was overridden on upgrade? or was otherwise removed?<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:26:58)</span> <b>kurtjstrosahl:</b></span> If we were doing so it was under the direct instruction of someone at osg<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:27:10)</span> <b>kurtjstrosahl:</b></span> I don't remember interacting with that file before<br/>
<span style="color: #43761b"><span style="font-size: small">(13:30:53)</span> <b>blin:</b></span> sure – i just don't have a good explanation for why an upgrade alone would cause that configuration to re-appear since the packaging will only drop in file updates if 1)  the file doesn't exist or 2) the file was unchanged<br/>
<span style="color: #53b759"><span style="font-size: small">(13:38:04)</span> <b>marian:</b></span> I don't think we instructed you (Kurt or others) to do this, so I still believe that update did it, for some reason... I think BrianL explained in 1) the file didn't exist on the system before so it was probably shiped by the update, sigh<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:39:22)</span> <b>kurtjstrosahl:</b></span> Which makes sense... but why did adding that file stop us and nobody else?<br/>
<span style="color: #53b759"><span style="font-size: small">(13:44:56)</span> <b>marian:</b></span> my guess - others may have had that file in the place already and most likely those lines commented out ... so the update created just <tt>.rmpnew</tt> config without taking effect ... @blin: from which condor version do you ship <tt>00-osg_default_security.config</tt> ?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:49:20)</span> <b>blin:</b></span> These files have existed in the OSG 8.8.x versions of condor since <tt>condor-8.8.4-1.6</tt>, which was released in Aug 2019<br/>
<span style="color: #53b759"><span style="font-size: small">(13:53:01)</span> <b>marian:</b></span> @kurtjstrosahl, do we know when was the last update to 8.8.10 on that host? I have theory that this was there for quite long and maybe at some clean up back in time with Edgar he asked you to remove it and it biten us now at upgrade to 8.8.15<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:54:57)</span> <b>kurtjstrosahl:</b></span> Looking at yum history list condor...<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:55:14)</span> <b>kurtjstrosahl:</b></span> condor was updated back in November<br/>
<span style="color: #43761b"><span style="font-size: small">(13:55:40)</span> <b>blin:</b></span> yeah, i don't think yum will give us much info. it's a matter of what's on disk in that config.d dir<br/>
<span style="color: #53b759"><span style="font-size: small">(13:55:50)</span> <b>marian:</b></span> any bash history which would show <tt>rm ...</tt> of that file?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:56:04)</span> <b>blin:</b></span> i'd be shocked if bash history went back to November :slightly_smiling_face:<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:56:17)</span> <b>kurtjstrosahl:</b></span> <pre>Packages Altered:<br/>    Updated condor-8.8.8-1.osg34.el7.x86_64             @ osg<br/>    Update         8.8.10-1.1.osg34.el7.x86_64          @ osg<br/>    Updated condor-classads-8.8.8-1.osg34.el7.x86_64    @ osg<br/>    Update                  8.8.10-1.1.osg34.el7.x86_64 @ osg<br/>    Updated condor-procd-8.8.8-1.osg34.el7.x86_64       @ osg<br/>    Update               8.8.10-1.1.osg34.el7.x86_64    @ osg<br/>    Updated python2-condor-8.8.8-1.osg34.el7.x86_64     @ osg<br/>    Update                 8.8.10-1.1.osg34.el7.x86_64  @ osg<br/>    Updated python3-condor-8.8.8-1.osg34.el7.x86_64     @osg<br/>    Update                 8.8.10-1.1.osg34.el7.x86_64  @ osg</pre><br/><br/>
<span style="color: #53b759"><span style="font-size: small">(13:56:53)</span> <b>marian:</b></span> if that update was in November it's very likely that between November-February Edgar could have asked you remove that file as non-needed<br/>
<span style="color: #53b759"><span style="font-size: small">(13:57:20)</span> <b>marian:</b></span> while he was right, but better we should have commented out the lines and keep the file present<br/>
<span style="color: #53b759"><span style="font-size: small">(13:57:42)</span> <b>marian:</b></span> OK, I'd conclude we understood problem and move on<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:58:08)</span> <b>kurtjstrosahl:</b></span> Nothing in bash history that would indicate that<br/>
<span style="color: #53b759"><span style="font-size: small">(13:58:29)</span> <b>marian:</b></span> ¯\_(ツ)_/¯<br/>
</blockquote>
<span style="color: #53b759"><span style="font-size: small">(13:22:24)</span> <b>marian:</b></span> @kurtjstrosahl, for <a href="http://scosg20.jlab.org">scosg20.jlab.org</a>, can you compare configs with scosg16 and populate changes so the scosg20 has identical configuration, please?<br/>
<span style="color: #5a4592"><span style="font-size: small">(13:39:49)</span> <b>kurtjstrosahl:</b></span> OK, I've saved the config.d directory on scosg20.  There are quite a few differences<br/>
<span style="color: #53b759"><span style="font-size: small">(13:51:14)</span> <b>marian:</b></span> (moved conversation further to direct chat with Kurt about scosg20 changes)<br/>
</body>
</html>
