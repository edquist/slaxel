<!DOCTYPE html>
<html>
<head>
<title>Tue Feb 2, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Tue Feb 2, 2021 : #operations (osg)</h3>
<span style="color: #A82F2F"><span style="font-size: small">(11:43:41)</span> <b>B01GA370NNT:</b></span> <br/>
<span style="color: #A82F2F"><span style="font-size: small">(11:44:02)</span> <b>B01GA370NNT:</b></span> <br/>
<span style="color: #A82F2F"><span style="font-size: small">(14:53:33)</span> <b>B01GA370NNT:</b></span> Your component *GRACC Frontend* has been set to *Under Maintenance* for over *3 hours*. (<a href="http://manage.statuspage.io/pages/ws62tz4wcmxv">http://manage.statuspage.io/pages/ws62tz4wcmxv</a>)<br/>
<span style="color: #43761b"><span style="font-size: small">(15:41:04)</span> <b>blin:</b></span> hey @jthiltges do you have time to try out the htcondor-ce 5.0.0 rc2 this week?<br/>
<blockquote>
<span style="color: #e06b56"><span style="font-size: small">(16:12:41)</span> <b>jthiltges:</b></span> Updated about 30 min ago. Still waiting for remote hosts to show up after the restart.<br/>
</blockquote>
<span style="color: #e06b56"><span style="font-size: small">(15:41:33)</span> <b>jthiltges:</b></span> Oh, thanks for the reminder. Will give it a spin shortly!<br/>
<span style="color: #43761b"><span style="font-size: small">(16:13:02)</span> <b>blin:</b></span> hrm, is this host still at UNL or is it on tiger yet?<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:14:01)</span> <b>jthiltges:</b></span> Still a host at UNL. (osgcollab account exists)<br/>
<span style="color: #e06b56"><span style="font-size: small">(16:17:11)</span> <b>jthiltges:</b></span> I had the vague idea there are session keys which need to time out, then new keys will be negotiated, and things will return to normal.<br/><br/>Before update:<br/><pre>02/02/21 15:41:31 PERMISSION GRANTED to <a href="mailto:ldas-osg-ce.ligo.caltech.edu@unmapped.htcondor.org">ldas-osg-ce.ligo.caltech.edu@unmapped.htcondor.org</a> from host 131.215.113.215 for command 1 (UPDATE_SCHEDD_AD), access level ADVERTISE_SCHEDD: reason: cached result for ADVERTISE_SCHEDD; see first case for the full reason</pre><br/>Now:<br/><pre>02/02/21 15:51:32 PERMISSION DENIED to unauthenticated@unmapped from host 131.215.113.215 for command 60010 (UPDATE_SCHEDD_AD), access level ADVERTISE_SCHEDD: reason: ADVERTISE_SCHEDD authorization policy contains no matching ALLOW entry for this request; identifiers used for this host: 131.215.113.215,<a href="http://ldas-osg-ce.ligo.caltech.edu">ldas-osg-ce.ligo.caltech.edu</a>, hostname size = 1, original ip address = 131.215.113.215</pre><br/>
<blockquote>
<span style="color: #e06b56"><span style="font-size: small">(16:30:03)</span> <b>jthiltges:</b></span> Ah... if there's not two-way connectivity, that's where the keys need to timeout.<br/><pre>02/02/21 16:26:40 Failed to send DC_INVALIDATE_KEY to daemon at &lt;208.69.128.80:9619&gt;: SECMAN:2003:TCP connection to daemon at &lt;208.69.128.80:9619&gt; failed.</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(17:11:12)</span> <b>blin:</b></span> do things look better after the invalidation then?<br/>
<span style="color: #e06b56"><span style="font-size: small">(17:13:18)</span> <b>jthiltges:</b></span> Nothing yet. =[<br/><pre>[root@collector-itb ~]# condor_ce_status -any<br/>MyType             TargetType         Name<br/><br/>Collector          None               My Pool - hcc-osg-collector-itb.unl.edu@h<br/>DaemonMaster       None               <a href="http://hcc-osg-collector-itb.unl.edu">hcc-osg-collector-itb.unl.edu</a></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(18:04:15)</span> <b>blin:</b></span> hrm that's a real doozy. we've got a giant diff for this release but we hardly touched the config<br/>
<span style="color: #43761b"><span style="font-size: small">(18:12:28)</span> <b>blin:</b></span> in the past I think we've seen issues with using the wrong mapfile. is this still set?<br/><pre>CERTIFICATE_MAPFILE = /etc/condor-ce/condor_mapfile.central_collector</pre><br/>and does that mapfile look like this?<br/><pre>GSI "[-.A-Za-z0-9/= ]*/CN=([-.A-Za-z0-9/= ]+)" \1@unmapped.htcondor.org<br/>SSL "[-.A-Za-z0-9/= ]*/CN=([-.A-Za-z0-9/= ]+)" \1@unmapped.htcondor.org<br/>CLAIMTOBE .* anonymous@claimtobe<br/>FS "^(root|condor)$" \1@daemon.htcondor.org<br/>FS "(.*)" \1</pre><br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-03 08:51:31)</span> <b>jthiltges:</b></span> Looks like it indeed.<br/><pre>[root@collector-itb ~]# condor_ce_config_val -dump  | grep mapfile<br/>CERTIFICATE_MAPFILE = /etc/condor-ce/condor_mapfile.central_collector<br/><br/>[root@collector-itb ~]# cat /etc/condor-ce/condor_mapfile.central_collector<br/>GSI "[-.A-Za-z0-9/= ]*/CN=([-.A-Za-z0-9/= ]+)" \1@unmapped.htcondor.org<br/>SSL "[-.A-Za-z0-9/= ]*/CN=([-.A-Za-z0-9/= ]+)" \1@unmapped.htcondor.org<br/>CLAIMTOBE .* anonymous@claimtobe<br/>FS "^(root|condor)$" \1@daemon.htcondor.org<br/>FS "(.*)" \1</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:52:52)</span> <b>blin:</b></span> curious. it's weird to me that mappings are resulting in <tt>unauthenticated@unmapped</tt>. I just set up a dev CE to try to advertise to the ITB collector and i'm seeing the same thing<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:53:20)</span> <b>blin:</b></span> <pre>02/03/21 08:50:10 (D_ALWAYS) SECMAN: FAILED: Received "DENIED" from server for user unauthenticated@unmapped using method SSL.<br/>02/03/21 08:50:10 (D_SECURITY) SECMAN: unable to create security session to &lt;129.93.175.45:9619&gt; via TCP, failing.</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:53:27)</span> <b>blin:</b></span> are you on vacation today?<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-03 08:54:23)</span> <b>jthiltges:</b></span> Sort of. No school for daughter... so taking a vacation day, and available here and there.<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:55:03)</span> <b>blin:</b></span> ah ok. is there someone else I can pester for logs and whatnot?<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:55:11)</span> <b>blin:</b></span> i don't want to take up more of your time than i have to!<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:57:32)</span> <b>blin:</b></span> oh hey i think it's actually "working as expected"<br/><pre>[root@fermicloud068 config.d]# condor_status -any -pool <a href="http://collector-itb.opensciencegrid.org:9619">collector-itb.opensciencegrid.org:9619</a><br/>MyType             TargetType         Name                                              <br/><br/>Scheduler          None               <a href="http://fermicloud068.fnal.gov">fermicloud068.fnal.gov</a>                            <br/>Collector          None               My Pool - hcc-osg-collector-itb.unl.edu@h         <br/>DaemonMaster       None               <a href="http://hcc-osg-collector-itb.unl.edu">hcc-osg-collector-itb.unl.edu</a>  </pre><br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 08:59:53)</span> <b>blin:</b></span> i think the problem is on the CE side now that we're defaulting to SSL auth. We default to system cert/key locations instead of the special grid locations<br/><pre>[root@fermicloud068 condor-ce]# condor_config_val -dump ^AUTH<br/># Configuration from machine: <a href="http://fermicloud068.fnal.gov">fermicloud068.fnal.gov</a><br/><br/># Parameters with names that match ^AUTH:<br/>AUTH_SSL_CLIENT_CAFILE = /etc/pki/tls/certs/ca-bundle.crt<br/>AUTH_SSL_SERVER_CAFILE = /etc/pki/tls/certs/ca-bundle.crt<br/>AUTH_SSL_SERVER_CERTFILE = /etc/pki/tls/certs/localhost.crt<br/>AUTH_SSL_SERVER_KEYFILE = /etc/pki/tls/private/localhost.key</pre><br/>so if the CE is using grid locations for host certs and they don't have symlinks in the system locations then they won't be able to acquire their own creds<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 09:00:48)</span> <b>blin:</b></span> admins can change their config but we wanted to rip the bandaid off at some point<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-03 09:01:11)</span> <b>jthiltges:</b></span> Real quick config hackery: <a href="https://collector-itb.opensciencegrid.org/.well-known/acme-challenge/condor-ce/">https://collector-itb.opensciencegrid.org/.well-known/acme-challenge/condor-ce/</a><br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-03 09:02:04)</span> <b>blin:</b></span> cool, thanks! this will help me nail down the owners of the CEs that we should talk to<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-03 09:03:20)</span> <b>jthiltges:</b></span> And pretty much any UNL person on here should be able to help: Marian, Derek, Carl, Garhan, Eric, etc. I'll be around, especially later today.<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-09 09:38:56)</span> <b>jthiltges:</b></span> Based on a comment from Brian in standup last week, I tried swapping the GSI/SSL ordering in the config:<br/><pre>COLLECTOR.SEC_ADVERTISE_STARTD_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,GSI,SSL<br/>COLLECTOR.SEC_ADVERTISE_MASTER_AUTHENTICATION_METHODS = GSI, SSL<br/>COLLECTOR.SEC_ADVERTISE_SCHEDD_AUTHENTICATION_METHODS = GSI, SSL</pre><br/>After a reconfig, I'm now seeing <a href="http://gridtest01.racf.bnl.gov">gridtest01.racf.bnl.gov</a>, <a href="http://ldas-osg-ce.ligo-la.caltech.edu">ldas-osg-ce.ligo-la.caltech.edu</a>, and <a href="http://ldas-osg-ce.ligo.caltech.edu">ldas-osg-ce.ligo.caltech.edu</a> on collector-itb.<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-09 09:46:50)</span> <b>blin:</b></span> great!<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-09 09:47:16)</span> <b>blin:</b></span> we did change the last two upstream but not the first one. hrm.<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-09 09:55:17)</span> <b>jthiltges:</b></span> I should have changed the knobs one at a time! I can do that.<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-09 09:55:45)</span> <b>jthiltges:</b></span> I'd just looked for anything with both GSI and SSL. =[<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-09 09:55:46)</span> <b>blin:</b></span> nah, don't worry about it. i think the first change is necessary but we missed it<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-09 09:56:30)</span> <b>jthiltges:</b></span> Will there be a new package with updated config? If so, let me know and I'll be happy to take it for a test spin.<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-09 09:56:57)</span> <b>blin:</b></span> yup there will be -- i think it'll just be a full release at this point, though!<br/>
<span style="color: #e06b56"><span style="font-size: small">(2021-02-09 09:57:52)</span> <b>jthiltges:</b></span> For now, I'm going to undo the local config, as well as the webserver changes to make the logs available. (Trying to push back the technical debt!)<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-02-09 09:59:04)</span> <b>blin:</b></span> we should all add financial analyst to our resumes with how much we work on debt :slightly_smiling_face:<br/>
</blockquote>
<span style="color: #A82F2F"><span style="font-size: small">(17:53:32)</span> <b>B01GA370NNT:</b></span> Your component *GRACC Frontend* has been set to *Under Maintenance* for over *6 hours*. (<a href="http://manage.statuspage.io/pages/ws62tz4wcmxv">http://manage.statuspage.io/pages/ws62tz4wcmxv</a>)<br/>
<span style="color: #A82F2F"><span style="font-size: small">(17:53:34)</span> <b>B01GA370NNT:</b></span> Your component *GRACC Backend* has been set to *Under Maintenance* for over *6 hours*. (<a href="http://manage.statuspage.io/pages/ws62tz4wcmxv">http://manage.statuspage.io/pages/ws62tz4wcmxv</a>)<br/>
<span style="color: #A82F2F"><span style="font-size: small">(23:53:32)</span> <b>B01GA370NNT:</b></span> Your component *GRACC Frontend* has been set to *Under Maintenance* for over *12 hours*. (<a href="http://manage.statuspage.io/pages/ws62tz4wcmxv">http://manage.statuspage.io/pages/ws62tz4wcmxv</a>)<br/>
<span style="color: #A82F2F"><span style="font-size: small">(23:53:34)</span> <b>B01GA370NNT:</b></span> Your component *GRACC Backend* has been set to *Under Maintenance* for over *12 hours*. (<a href="http://manage.statuspage.io/pages/ws62tz4wcmxv">http://manage.statuspage.io/pages/ws62tz4wcmxv</a>)<br/>
</body>
</html>
