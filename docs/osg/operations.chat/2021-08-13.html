<!DOCTYPE html>
<html>
<head>
<title>Fri Aug 13, 2021 : #operations (osg)</title>
</head>
<body>
<h3>Fri Aug 13, 2021 : #operations (osg)</h3>
<span style="color: #a2a5dc"><span style="font-size: small">(11:34:19)</span> <b>didavila:</b></span> hey condor experts, any idea why this GSI mapping goes wrong?<br/><pre>08/13/21 09:28:31 ZKM: setting default map to gsi@unmapped<br/>08/13/21 09:28:31 ZKM: name to map is '/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>'<br/>08/13/21 09:28:31 ZKM: pre-map: current user is 'gsi'<br/>08/13/21 09:28:31 ZKM: pre-map: current domain is 'unmapped'<br/>08/13/21 09:28:31 ZKM: map file already loaded.<br/>08/13/21 09:28:31 ZKM: attempting to map '/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>'<br/>08/13/21 09:28:31 ZKM: GSI was used, and FQAN is present.<br/>08/13/21 09:28:31 ZKM: 1: attempting to map '/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California&amp;comma; San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>,/atlas/Role=NULL/Capability=NULL,/atlas/lcg1/Role=NULL/Capability=NULL,/atlas/perf-muons/Role=NULL/Capability=NULL'<br/>08/13/21 09:28:31 ZKM: 2: mapret: 0 included_voms: 1 canonical_user: anonymous<br/>08/13/21 09:28:31 ZKM: found user anonymous, splitting.<br/>08/13/21 09:28:31 ZKM: post-map: current user is 'anonymous'<br/>08/13/21 09:28:31 ZKM: post-map: current domain is '<a href="http://uclhc-2.ps.uci.edu">uclhc-2.ps.uci.edu</a>'<br/>08/13/21 09:28:31 ZKM: post-map: current FQU is '<a href="mailto:anonymous@uclhc-2.ps.uci.edu">anonymous@uclhc-2.ps.uci.edu</a>'</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:34:45)</span> <b>didavila:</b></span> I have this in the mapfile:<br/><pre>GSI "/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>" condor</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(11:37:11)</span> <b>matyas:</b></span> anything else in the mapfile?<br/>
<span style="color: #c386df"><span style="font-size: small">(11:39:20)</span> <b>matyas:</b></span> also, anything else in /etc/condor-ce/mapfiles.d ?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:39:53)</span> <b>didavila:</b></span> this is the full mapfile:<br/><pre>GSI "/DC=org/DC=incommon/C=US/ST=California/L=Irvine/O=University of California, Irvine/OU=School of Physical Sciences/CN=<a href="http://uclhc-2.ps.uci.edu">uclhc-2.ps.uci.edu</a>" condor<br/>GSI "/DC=org/DC=incommon/C=US/ST=California/L=Irvine/O=University of California, Irvine/OU=School of Physical Sciences/CN=<a href="http://uclhc-1.ps.uci.edu">uclhc-1.ps.uci.edu</a>" schedd<br/>GSI "/DC=org/DC=incommon/C=US/ST=Wisconsin/L=Madison/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a>" osg-flock<br/>GSI "/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>" frontend<br/>GSI "/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>" condor<br/>GSI "^\/DC\=org\/DC\=incommon\/C\=US\/ST\=California\/L\=La\ Jolla\/O\=University\ of\ California\,\ San\ Diego\/CN\=uclhc\-fe\-1\.t2\.ucsd\.edu$" condor<br/>GSI (.*) anonymous<br/>FS (.*) \1</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:40:06)</span> <b>didavila:</b></span> this is not a CE, just a regular Schedd + CM<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:40:50)</span> <b>didavila:</b></span> CERTIFICATE_*MAP*FILE = /etc/condor/certs/condor_mapfile<br/>
<span style="color: #c386df"><span style="font-size: small">(11:43:34)</span> <b>matyas:</b></span> the thing in GSI is a regex; you might have to backslash-escape any <tt>/</tt> or <tt>.</tt> characters.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:44:23)</span> <b>didavila:</b></span> that’s why I also added the escaped version<br/>
<span style="color: #c386df"><span style="font-size: small">(11:44:28)</span> <b>matyas:</b></span> oh I see<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:44:40)</span> <b>didavila:</b></span> and also, I see that the mappings on the top work fine<br/>
<span style="color: #c386df"><span style="font-size: small">(11:47:30)</span> <b>matyas:</b></span> I'm looking at this line:<br/><pre>ZKM: 1: attempting to map '/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California&amp;comma; San Diego/CN=<a href="http://uclhc-fe-1.t2.ucsd.edu">uclhc-fe-1.t2.ucsd.edu</a>,/atlas/Role=NULL/Capability=NULL,/atlas/lcg1/Role=NULL/Capability=NULL,/atlas/perf-muons/Role=NULL/Capability=NULL'</pre><br/>Try removing the $ from the end of the escaped version<br/>
<span style="color: #c386df"><span style="font-size: small">(11:48:16)</span> <b>matyas:</b></span> if that doesn't work then, in addition to that, also replace <tt>\,</tt> with <tt>\&amp;comma\;</tt><br/>
<span style="color: #c386df"><span style="font-size: small">(11:50:54)</span> <b>matyas:</b></span> actually try replacing <tt>$</tt> with <tt>.*</tt> in the escaped version instead of just removing <tt>$</tt><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:07:28)</span> <b>didavila:</b></span> removing the $ didn’t make any change, let’s see with the &amp;comma<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:42:11)</span> <b>didavila:</b></span> it worked!! thanks @matyas<br/>
<span style="color: #c386df"><span style="font-size: small">(12:42:41)</span> <b>matyas:</b></span> great! we'll have to document that.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:43:01)</span> <b>didavila:</b></span> it’s weird that the ones above also have commas and they don’t show that problem<br/>
<span style="color: #c386df"><span style="font-size: small">(12:43:43)</span> <b>matyas:</b></span> looks like condor is using comma as the separator between the DN and any VOMS attributes<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:44:20)</span> <b>didavila:</b></span> yeah, it looks like the DNs above don’t have any voms attributes and that’s why they don;t have this problem<br/>
<span style="color: #c386df"><span style="font-size: small">(12:44:34)</span> <b>matyas:</b></span> that's annoying<br/>
<span style="color: #c386df"><span style="font-size: small">(12:47:13)</span> <b>matyas:</b></span> try using <tt>(\,|\&amp;comma\;)</tt> which will match both a regular comma (for when there are no VOMS attributes), and an escaped comma (for when there are)<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:22:05)</span> <b>jthiltges:</b></span> The test_mapfile utility or equivalent would be handy to have around. (Maybe dusted off and packaged in condor-test?)<br/><a href="https://github.com/htcondor/htcondor/blob/master/src/condor_utils/test_mapfile.cpp">https://github.com/htcondor/htcondor/blob/master/src/condor_utils/test_mapfile.cpp</a><br/><br/>Wouldn't have helped in this case, with the escaping being the issue... but still would make testing easier.<br/>
</body>
</html>
