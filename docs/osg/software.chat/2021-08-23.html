<!DOCTYPE html>
<html>
<head>
<title>Mon Aug 23, 2021 : #software (osg)</title>
</head>
<body>
<h3>Mon Aug 23, 2021 : #software (osg)</h3>
<span style="color: #235e5b"><span style="font-size: small">(08:25:35)</span> <b>spiperov:</b></span> The revocation lists under <tt>/cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.5/3.5.45-2/el7-x86_64/etc/grid-security/certificates</tt> (where our <tt>$X509_CERT_DIR</tt> currently points) are from Aug.17, and we cannot get VOMS proxies as a result.<br/>Some sort of CVMFS problem?<br/><br/>(this is after executing our 'standard' routine of:<br/><pre>export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch<br/>source $VO_CMS_SW_DIR/cmsset_default.sh<br/>source /cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.5/current/el7-x86_64/setup.sh</pre><br/>The revocation lists under <tt>/cvmfs/cms.cern.ch/grid/etc/grid-security/certificates</tt> seem OK<br/><br/>But the versions for OSG 3.6<br/>/cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.6/current/el7-x86_64/etc/grid-security/certificates<br/>as well as the 'current' under:<br/>/cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/current/el7-x86_64/etc/grid-security/certificates<br/>are in the same state as for OSG3.5.<br/>
<span style="color: #43761b"><span style="font-size: small">(08:42:22)</span> <b>blin:</b></span> @spiperov any reason you aren't using <tt>/cvmfs/oasis.opensciencegrid.org/mis/certificates/</tt>?<br/>
<span style="color: #43761b"><span style="font-size: small">(08:42:29)</span> <b>blin:</b></span> i see<br/><pre>[ouser.mis@hcc-oasis-login ~]$ ls -l /cvmfs/oasis.opensciencegrid.org/mis/certificates/ | egrep r0$ | head<br/>-rw-rw-r-- 1 ouser.mis ouser.mis   670 Aug 23 06:20 01b5d333.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis 40478 Aug 23 06:20 036b3363.r0<br/>-rw-r--r-- 1 ouser.mis ouser.mis   739 Aug 23 06:20 04f60c28.r0<br/>-rw-r--r-- 1 ouser.mis ouser.mis  2490 Aug 23 06:20 064e0aa9.r0<br/>-rw-r--r-- 1 ouser.mis ouser.mis  3700 Aug 23 06:20 06769ccd.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis  1462 Aug 23 06:20 072977ca.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis  8312 Aug 23 06:20 089450c2.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis   563 Aug 23 06:20 09ff08b7.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis  2425 Aug 23 06:20 0a49430a.r0<br/>-rw-rw-r-- 1 ouser.mis ouser.mis  3656 Aug 23 06:20 0e635db3.r0</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(08:45:02)</span> <b>blin:</b></span> though i do see dead links<br/><pre>[ouser.mis@hcc-oasis-login ~]$ ls -l /cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.6/current/el7-x86_64/etc/grid-security/certificates<br/>lrwxrwxrwx 1 ouser.mis ouser.mis 72 Aug 16 15:17 /cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.6/current/el7-x86_64/etc/grid-security/certificates -&gt; $(OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates)<br/>[ouser.mis@hcc-oasis-login ~]$ ls -l /cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.5/current/el7-x86_64/etc/grid-security/certificates <br/>lrwxrwxrwx 1 ouser.mis ouser.mis 72 Aug 16 15:15 /cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.5/current/el7-x86_64/etc/grid-security/certificates -&gt; $(OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates)</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(08:45:06)</span> <b>spiperov:</b></span> Only historical, I guess.<br/>Should we switch to those site-wide?<br/>Is that documented somewhere we can consult while doing such switch?<br/>
<span style="color: #43761b"><span style="font-size: small">(08:47:46)</span> <b>blin:</b></span> ah, it looks like we recommend the OSG release series specific links <a href="https://opensciencegrid.org/docs/worker-node/install-wn-oasis/#configure-the-ce">https://opensciencegrid.org/docs/worker-node/install-wn-oasis/#configure-the-ce</a><br/>
<span style="color: #43761b"><span style="font-size: small">(08:54:06)</span> <b>blin:</b></span> @tim.theisen @matyas <b>@edquist</b> any thoughts on the dead symlink?<br/>
<span style="color: #16569E"><span style="font-size: small">(08:56:41)</span> <b>edquist:</b></span> I'll take a look in just a sec<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:01:39)</span> <b>andrew.melo:</b></span> The thing that it points to also hasn't been updated in 5 days <tt>find /cvmfs/oasis.opensciencegrid.org/mis/certificates* -mtime -5</tt> gives nada<br/>
<span style="color: #16569E"><span style="font-size: small">(09:02:12)</span> <b>edquist:</b></span> erm<br/>
<span style="color: #16569E"><span style="font-size: small">(09:02:18)</span> <b>edquist:</b></span> <tt>$(OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates)</tt> ??<br/>
<span style="color: #16569E"><span style="font-size: small">(09:02:22)</span> <b>edquist:</b></span> is the target?<br/>
<span style="color: #16569E"><span style="font-size: small">(09:02:40)</span> <b>edquist:</b></span> perhaps it should be<br/><tt>${OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates}</tt><br/>
<span style="color: #16569E"><span style="font-size: small">(09:02:51)</span> <b>edquist:</b></span> (with curlies, instead of parens)<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:03:05)</span> <b>andrew.melo:</b></span> In either case, that directory isn't updating, even if the symlink is incorrect<br/>
<span style="color: #c386df"><span style="font-size: small">(09:04:29)</span> <b>matyas:</b></span> no not curlies<br/>
<span style="color: #c386df"><span style="font-size: small">(09:04:36)</span> <b>matyas:</b></span> the parens are special CVMFS magic<br/>
<span style="color: #c386df"><span style="font-size: small">(09:05:04)</span> <b>matyas:</b></span> it's expanded when CVMFS is mounted<br/>
<blockquote>
<span style="color: #c386df"><span style="font-size: small">(09:07:04)</span> <b>matyas:</b></span> not actually sure about that; maybe it's expanded when you try to cd into it (from a mounted CVMFS)<br/>
</blockquote>
<span style="color: #c386df"><span style="font-size: small">(09:05:31)</span> <b>matyas:</b></span> er.<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:05:38)</span> <b>andrew.melo:</b></span> Ah, and that explains why our site's been draining:<br/><pre>GSS Major Status: Authentication Failed<br/>GSS Minor Status Error Chain:<br/>globus_gss_assist: Error during context initialization<br/>globus_gsi_callback_module: Could not verify credential<br/>globus_gsi_callback_module: Could not verify credential<br/>globus_gsi_callback_module: Invalid CRL: The available CRL has expired<br/><br/>08/23/21 09:04:01 (pid:28797) SECMAN: required authentication with collector <a href="http://vocms0813.cern.ch:9618?sock=collector9662">vocms0813.cern.ch:9618?sock=collector9662</a> failed, so aborting command CCB_REGISTER.<br/>08/23/21 09:04:01 (pid:28797) ERROR: AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using GSI|GSI:5004:Failed to authenticate.  Globus is reporting error (655360:105)<br/>08/23/21 09:04:01 (pid:28797) CCBListener: connection to CCB server <a href="http://vocms0813.cern.ch:9618?sock=collector9662">vocms0813.cern.ch:9618?sock=collector9662</a> failed; will try to reconnect in 60 seconds.</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(09:05:53)</span> <b>blin:</b></span> the mis/certificates dir looks fine to me with updates today<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:06:03)</span> <b>andrew.melo:</b></span> We, uh, need that fixed ASAP<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:08:44)</span> <b>andrew.melo:</b></span> @blin what timestamp do you see on the <tt>*.r0</tt> files in there?<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(09:12:39)</span> <b>blin:</b></span> <a href="https://opensciencegrid.slack.com/archives/C08K1QJMA/p1629726149172200">https://opensciencegrid.slack.com/archives/C08K1QJMA/p1629726149172200</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(09:13:35)</span> <b>andrew.melo:</b></span> ... Why am I seeing Aug 17 on all my machines<br/>
<span style="color: #43761b"><span style="font-size: small">(09:14:06)</span> <b>blin:</b></span> we've seen this sort of issue in the past, but limited to only a few machines at a site, when cvmfs is borked on the WN<br/>
<span style="color: #43761b"><span style="font-size: small">(09:14:25)</span> <b>blin:</b></span> i'm in a meeting so i'm going to have to delegate to @matyas @tim.theisen <b>@edquist</b> @dwd<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:14:30)</span> <b>andrew.melo:</b></span> This is every one I've looked at<br/><pre>[root@cn450 glide_CtXRY7]# getfattr -n user.revision /cvmfs/oasis.opensciencegrid.org/<br/>getfattr: Removing leading '/' from absolute path names<br/># file: cvmfs/oasis.opensciencegrid.org/<br/>user.revision="18447"</pre><br/>
</blockquote>
<span style="color: #16569E"><span style="font-size: small">(09:11:07)</span> <b>edquist:</b></span> &gt;the parens are special CVMFS magic<br/>&gt;it's expanded when CVMFS is mounted<br/><br/>i see ok.  it just looked like there might have been something like<br/><br/><pre><br/>target=$(OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates)<br/>ln -s "$target" certificates<br/></pre><br/><br/>going on, where curlies would have expanded in the shell script, but with parens you don't get any variable expansion<br/>
<span style="color: #16569E"><span style="font-size: small">(09:11:21)</span> <b>edquist:</b></span> or<br/><br/><pre><br/>target="$(OASIS_CERTIFICATES:-/cvmfs/oasis.opensciencegrid.org/mis/certificates)"<br/></pre><br/><br/>
<span style="color: #16569E"><span style="font-size: small">(09:12:10)</span> <b>edquist:</b></span> then again i guess that couldn't be either too since the shell would interpret that as a command substitution<br/>
<span style="color: #99a949"><span style="font-size: small">(09:17:44)</span> <b>dwd:</b></span> There are errors on oasis-login in ~ouser.mis/dataupdater.log, which is the output from the process that automatically updates the repository<br/>
<span style="color: #c386df"><span style="font-size: small">(09:17:58)</span> <b>matyas:</b></span> nah it's kinda like @sys on AFS<br/>
<span style="color: #99a949"><span style="font-size: small">(09:19:17)</span> <b>dwd:</b></span> <pre>Running ['/home/login/ouser.mis/osg-wn-client/osgrun', 'osg-update-vos', '--location', '/stage/oasis/mis/vodata']<br/>Output: Repository osg is listed more than once in the configuration<br/>Cleaning repos: base carepo devops duosecurity epel extras goc hcc osg puppet<br/>              : puppet5 updates<br/>Other repos take up 234 M of disk space (use --verbose for details)<br/>Repository osg is listed more than once in the configuration<br/><a href="http://mirror.mia.velocihost.net/centos/7.9.2009/extras/x86_64/repodata/repomd.xml">http://mirror.mia.velocihost.net/centos/7.9.2009/extras/x86_64/repodata/repomd.xml</a>: [Errno 14] HTTP Error 403 - Forbidden<br/>Trying other mirror.<br/>To address this issue please refer to the below wiki article<br/><br/><a href="https://wiki.centos.org/yum-errors">https://wiki.centos.org/yum-errors</a><br/><br/>If above article doesn't help to resolve this issue please use <a href="https://bugs.centos.org/">https://bugs.centos.org/</a>.<br/><br/><a href="http://repo.opensciencegrid.org/osg/goc/el7/production/x86_64/repodata/repomd.xml">http://repo.opensciencegrid.org/osg/goc/el7/production/x86_64/repodata/repomd.xml</a>: [Errno 14] HTTPS Error 404 - Not Found<br/>Trying other mirror.<br/>To address this issue please refer to the below wiki article<br/><br/><a href="https://wiki.centos.org/yum-errors">https://wiki.centos.org/yum-errors</a><br/><br/>If above article doesn't help to resolve this issue please use <a href="https://bugs.centos.org/">https://bugs.centos.org/</a>.<br/><br/>failure: repodata/repomd.xml from goc: [Errno 256] No more mirrors to try.<br/><a href="http://repo.opensciencegrid.org/osg/goc/el7/production/x86_64/repodata/repomd.xml">http://repo.opensciencegrid.org/osg/goc/el7/production/x86_64/repodata/repomd.xml</a>: [Errno 14] HTTPS Error 404 - Not Found<br/>Error: Couldn't download vo-client: Command '['yumdownloader', 'vo-client', '--config=/home/login/ouser.mis/osg-wn-client/etc/yum.repos.d/osg.repo', '--setopt=osg.gpgkey=file:///home/login/ouser.mis/osg-wn-client/etc/pki/rpm-gpg/RPM-GPG-KEY-OSG']' returned non-zero exit status 1</pre><br/><br/>
<span style="color: #99a949"><span style="font-size: small">(09:20:16)</span> <b>dwd:</b></span> Trying to update from “goc” repo<br/>
<span style="color: #c386df"><span style="font-size: small">(09:22:21)</span> <b>matyas:</b></span> ah, we got rid of that repo<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:23:50)</span> <b>andrew.melo:</b></span> How could I fix this?<br/><pre>[root@cn450 glide_CtXRY7]# getfattr -n user.revision /cvmfs/oasis.opensciencegrid.org/<br/>getfattr: Removing leading '/' from absolute path names<br/># file: cvmfs/oasis.opensciencegrid.org/<br/>user.revision="18447"<br/>[root@cn450 glide_CtXRY7]# ls -l /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>-rw-rw-r-- 1 cvmfs cvmfs 670 Aug 17 12:20 /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>[root@cn450 glide_CtXRY7]# getfattr -n user.revision /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>getfattr: Removing leading '/' from absolute path names<br/># file: cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>user.revision="18447"</pre><br/>I'm on what appears to be the current revision, but the certificates path is stale. I'm seeing this on a whole mess of worker nodes here @ Vanderbilt<br/>
<blockquote>
<span style="color: #a72f79"><span style="font-size: small">(09:31:43)</span> <b>andrew.melo:</b></span> @dwd ^ any ideas about the above<br/>
<span style="color: #99a949"><span style="font-size: small">(09:33:23)</span> <b>dwd:</b></span> Yeah, the publishing had been broken, I just fixed the reason why, and it’s publishing now<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:36:21)</span> <b>andrew.melo:</b></span> Wait, but @blin saw <a href="https://opensciencegrid.slack.com/archives/C08K1QJMA/p1629727959179900?thread_ts=1629727724.179500&amp;cid=C08K1QJMA">https://opensciencegrid.slack.com/archives/C08K1QJMA/p1629727959179900?thread_ts=1629727724.179500&amp;cid=C08K1QJMA</a> .. Was it published and my local client was borked, or is brian on some sort of super machine?<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:36:37)</span> <b>andrew.melo:</b></span> Ahhhhhhh, wait, he's actually on the login node. I get it now<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:37:25)</span> <b>andrew.melo:</b></span> So it's just cranking out blank updates?<br/><pre>Aug 23 06:30:07 cn450 cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) switched to catalog revision 18446<br/>Aug 23 07:14:08 cn450 cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) switched to catalog revision 18447</pre><br/><br/>
</blockquote>
<span style="color: #c386df"><span style="font-size: small">(09:23:52)</span> <b>matyas:</b></span> Dave, do you know who has root on oasis-login? Can they remove /etc/yum.repos.d/goc*.repo?<br/>
<span style="color: #99a949"><span style="font-size: small">(09:24:03)</span> <b>dwd:</b></span> I do<br/>
<span style="color: #c386df"><span style="font-size: small">(09:24:58)</span> <b>matyas:</b></span> rpm -qf says it's not owned by any package so we might need to check puppet to make sure it doesn't get put back<br/>
<span style="color: #c386df"><span style="font-size: small">(09:25:28)</span> <b>matyas:</b></span> once we've done that, we can rerun the update script and that might fix things<br/>
<span style="color: #99a949"><span style="font-size: small">(09:26:17)</span> <b>dwd:</b></span> I deleted them and am re-running the script<br/>
<span style="color: #99a949"><span style="font-size: small">(09:27:57)</span> <b>dwd:</b></span> The script completed this time and queued a publish.  The goc.repo file used to be generated by puppet but @marian changed it to devops and I had noticed them not getting cleaned up on other oasis machines.  I’ll make sure it is deleted on all of them.<br/>
<span style="color: #99a949"><span style="font-size: small">(09:33:52)</span> <b>dwd:</b></span> It had been cleaned up everywhere except oasis and oasis-login production machines<br/>
<span style="color: #99a949"><span style="font-size: small">(09:46:28)</span> <b>dwd:</b></span> The publish finished, so it should be available in another 15 minutes<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:47:14)</span> <b>andrew.melo:</b></span> Sweet, there it is<br/><pre>[root@cn450 glide_CtXRY7]# ls -l /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>-rw-rw-r-- 1 cvmfs cvmfs 670 Aug 23 09:26 /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>[root@cn450 glide_CtXRY7]# getfattr -n user.revision /cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>getfattr: Removing leading '/' from absolute path names<br/># file: cvmfs/oasis.opensciencegrid.org/mis/certificates/01b5d333.r0<br/>user.revision="18448"</pre><br/>
<span style="color: #99a949"><span style="font-size: small">(09:53:27)</span> <b>dwd:</b></span> It’s on the FNAL stratum 1 now too<br/>
<span style="color: #c386df"><span style="font-size: small">(10:11:15)</span> <b>matyas:</b></span> Thanks Dave!<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:11:55)</span> <b>andrew.melo:</b></span> Thanks a ton!<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:18:49)</span> <b>spiperov:</b></span> Can someone here remind us how to trigger a reload of CVMFS on site?<br/>Squids? Individual nodes?<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:37:17)</span> <b>andrew.melo:</b></span> <tt>cvmfs_talk reload</tt> will force it to pull a new catalog<br/>
</body>
</html>
