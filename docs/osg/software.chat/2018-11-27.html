<!DOCTYPE html>
<html>
<head>
<title>Tue Nov 27, 2018 : #software (osg)</title>
</head>
<body>
<h3>Tue Nov 27, 2018 : #software (osg)</h3>
<span style="color: #53b759"><span style="font-size: small">(12:29:02)</span> <b>marian:</b></span> @blin, @matyas... have one of you downloaded xrootd-4.9.0-0.rc1 source rpm to upstream dir which is waiting for build in osg-development? can I go ahead or did you have other plans with this srpm?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:29:38)</span> <b>blin:</b></span> i put it there, i just wasn't sure if our spec file had any differences and didn't have time to investigate<br/>
<span style="color: #43761b"><span style="font-size: small">(12:29:49)</span> <b>blin:</b></span> but if a passthrough build is appropriate, go for it<br/>
<span style="color: #53b759"><span style="font-size: small">(12:31:27)</span> <b>marian:</b></span> yeah, I usually also compare spec etc ... I have sort of own way to do it ... is there JIRA ticket for this build?<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:37:10)</span> <b>andrew.melo:</b></span> hey @blin can you think of anything that would've changed in the new condor-ce you had me load that would mess with authentication?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:37:38)</span> <b>blin:</b></span> you're running 8.7.10, right?<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:37:40)</span> <b>andrew.melo:</b></span> I noticed that ce3 (the one with the updated binaries) is completely emptry, while ce4 (its twin w/o the binaries) is running fine<br/>
<span style="color: #43761b"><span style="font-size: small">(12:38:02)</span> <b>blin:</b></span> what version of htcondor-ce are on both machines?<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:38:25)</span> <b>andrew.melo:</b></span> condor on ce3<br/><pre><br/>Version     : 8.7.10<br/>Release     : 1.osgup.el7<br/></pre><br/>
<span style="color: #a72f79"><span style="font-size: small">(12:38:44)</span> <b>andrew.melo:</b></span> do you want condor's version or htcondor-ce?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:38:47)</span> <b>blin:</b></span> there's nothing i can think of that should have changed job submission auth<br/>
<span style="color: #43761b"><span style="font-size: small">(12:39:09)</span> <b>blin:</b></span> <tt>rpm -q htcondor-ce</tt> would be good<br/>
<span style="color: #43761b"><span style="font-size: small">(12:39:31)</span> <b>blin:</b></span> could you also run <tt>condor_ce_q -allusers -nobatch</tt> as root?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:18:43)</span> <b>andrew.melo:</b></span> <pre><br/>[root@ce3 ~]# rpm -q htcondor-ce<br/>htcondor-ce-3.1.4-1.osg34.el7.noarch<br/>[root@ce3 ~]# condor_ce_q -allusers -nobatch<br/><br/><br/>-- Schedd: <a href="http://ce3.accre.vanderbilt.edu">ce3.accre.vanderbilt.edu</a> : &lt;129.59.197.118:18648&gt; @ 11/27/18 13:18:35<br/> ID        OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD<br/>231533.0   lcgadmin        5/31 13:15   0+00:00:00 H  0    0.0 whoami<br/>231601.0   lcgadmin        5/31 13:42   0+00:00:00 H  0    0.0 whoami<br/>231619.0   lcgadmin        5/31 13:46   0+00:00:00 H  0    0.0 sleep 1200<br/>231655.0   lcgadmin        5/31 13:55   0+00:00:00 H  0    0.0 sleep 1200<br/>231659.0   lcgadmin        5/31 13:55   0+00:00:00 H  0    0.0 whoami<br/>231683.0   lcgadmin        5/31 13:58   0+00:00:00 H  0    0.0 whoami<br/>231724.0   lcgadmin        5/31 14:00   0+00:00:00 H  0    0.0 whoami<br/>231733.0   lcgadmin        5/31 14:01   0+00:00:00 H  0    0.0 whoami<br/>231737.0   lcgadmin        5/31 14:02   0+00:00:00 H  0    0.0 whoami<br/>231887.0   lcgadmin        5/31 15:12   0+00:01:00 H  0    0.0 whoami<br/>234841.0   cmsglidein      6/1  13:13   0+00:00:00 H  0    0.0 condor_ce_config<br/>234850.0   cmsglidein      6/1  13:15   0+00:00:00 H  0    0.0 condor_ce_config<br/><br/>Total for query: 12 jobs; 0 completed, 0 removed, 0 idle, 0 running, 12 held, 0 suspended <br/>Total for all users: 12 jobs; 0 completed, 0 removed, 0 idle, 0 running, 12 held, 0 suspended<br/></pre><br/>
<span style="color: #a72f79"><span style="font-size: small">(13:19:36)</span> <b>andrew.melo:</b></span> <br/>
<span style="color: #43761b"><span style="font-size: small">(13:22:48)</span> <b>blin:</b></span> this looks wrong:<br/><pre><br/>lcmaps[2620217]   LOG_DEBUG: 2018-11-24.22:24:49Z: lcmaps_voms_localaccount-plugin_run(): lcmaps_is_set_to_verify_voms_attributes() returned 1<br/>lcmaps[2620217]   LOG_DEBUG: 2018-11-24.22:24:49Z: lcmaps_voms_localaccount-plugin_run(): no FQANs registered by other plugins, trying run/introspect args<br/>lcmaps[2620217]    LOG_INFO: 2018-11-24.22:24:49Z: lcmaps_voms_localaccount-plugin_run(): no (valid) VOMS groups found --&gt; no mapping<br/>lcmaps[2620217]    LOG_INFO: 2018-11-24.22:24:49Z: lcmaps_voms_localaccount-plugin_run(): voms_localaccount plugin failed<br/></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(13:23:01)</span> <b>blin:</b></span> could you make sure all of your lcmaps packages come from the OSG repos?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:23:54)</span> <b>andrew.melo:</b></span> this looks like it's corect:<br/><pre><br/>[root@ce3 ~]# rpm -qa | grep lcmaps<br/>lcmaps-1.6.6-1.8.osg34.el7.x86_64<br/>lcmaps-db-templates-1.6.6-1.8.osg34.el7.x86_64<br/>lcmaps-plugins-basic-1.7.0-2.osg34.el7.x86_64<br/>vo-client-lcmaps-voms-84-1.osg34.el7.noarch<br/>lcas-lcmaps-gt4-interface-0.3.1-1.2.osg34.el7.x86_64<br/>lcmaps-plugins-verify-proxy-1.5.11-1.1.osg34.el7.x86_64<br/>lcmaps-plugins-voms-1.7.1-1.6.osg34.el7.x86_64<br/></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(13:25:18)</span> <b>blin:</b></span> can you find one of the cmserv proxies in <tt>/var/log/condor-ce/spool</tt> and inspect it with <tt>voms-proxy-info -file &lt;proxy&gt; -all</tt>?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:25:20)</span> <b>bbockelm:</b></span> are you missing osg-vo-client?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:25:29)</span> <b>andrew.melo:</b></span> I diffed both hosts rpms:<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:25:41)</span> <b>andrew.melo:</b></span> <br/>
<span style="color: #a72f79"><span style="font-size: small">(13:26:48)</span> <b>andrew.melo:</b></span> I have a <tt>vo-client</tt>, same on both<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:27:02)</span> <b>andrew.melo:</b></span> searching for <tt>osg-vo-client</tt> gives nada<br/>
<span style="color: #43761b"><span style="font-size: small">(13:27:03)</span> <b>blin:</b></span> <tt>vo-client-lcmaps-voms</tt>?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:27:23)</span> <b>bbockelm:</b></span> sorry, <tt>vo-client</tt> is correct.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:27:44)</span> <b>andrew.melo:</b></span> vo-client-lcmaps-voms is installed on both and the same version<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:28:36)</span> <b>andrew.melo:</b></span> @blin no proxies are in the spool, the only spool directories are for those really old, held jobs<br/>
<span style="color: #43761b"><span style="font-size: small">(13:28:57)</span> <b>blin:</b></span> oh damn, ok<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:38:05)</span> <b>andrew.melo:</b></span> I don't get it... the host cert is valid:<br/><pre><br/>[root@ce3 grid-security]# openssl x509 -enddate -noout -in hostcert.pem<br/>notAfter=Jun  2 19:30:52 2019 GMT<br/></pre><br/>but if I do a condor_ce_trace from another host, I get<br/><pre><br/>11/27/18 13:35:41 SharedPortClient: sent connection request to daemon at &lt;129.59.197.118:9619&gt; for shared port id 2620162_4994_3<br/>11/27/18 13:35:41 This process has a valid certificate &amp; key<br/>11/27/18 13:35:41 Condor GSI authentication failure<br/>GSS Major Status: Authentication Failed<br/>GSS Minor Status Error Chain:<br/>globus_gss_assist: Error during context initialization<br/>globus_gsi_gssapi: Unable to verify remote side's credentials<br/>globus_gsi_gssapi: SSL handshake problems: Couldn't do ssl handshake<br/>OpenSSL Error: s3_pkt.c:1493: in library: SSL routines, function ssl3_read_bytes: sslv3 alert certificate expired SSL alert number 45<br/><br/>11/27/18 13:35:41 SECMAN: required authentication with daemon at &lt;129.59.197.118:9619&gt; failed, so aborting command DC_SEC_QUERY.<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(13:38:33)</span> <b>bbockelm:</b></span> CRL on the client side?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:38:41)</span> <b>bbockelm:</b></span> erm, or maybe server side<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:39:52)</span> <b>andrew.melo:</b></span> if <tt>.r0</tt> files in /etc/grid-security/certificates are CRLs, they appear to have been updated on Nov 19th<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:41:06)</span> <b>andrew.melo:</b></span> fetch-crl-cron is on and enabled<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:41:36)</span> <b>bbockelm:</b></span> both sides?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:42:03)</span> <b>andrew.melo:</b></span> CE3 was on the 19th, ce4 is running jobs w/o issue, so I'm sure it's not weird<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:42:05)</span> <b>bbockelm:</b></span> Yeah, Nov 19 could indicate an expiration - 7 days ago.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:42:14)</span> <b>andrew.melo:</b></span> coincidentally, when I last rebooted<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:43:10)</span> <b>andrew.melo:</b></span> let me manually run it in a screen (headed to the airport) and see if that works .. then to find out why the cronjob isn't working<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:44:15)</span> <b>bbockelm:</b></span> <tt>sslv3 alert</tt> &lt;- alerts are typically sent from the remote side to you.<br/><tt>certificate expired SSL</tt> &lt;- there's a fixed number of alerts in the SSL protocol so "certificate expired" is used for both CRLs and CAs and actual certificate expirations.<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:28:39)</span> <b>andrew.melo:</b></span> So, it looks like a global change we made to PAM in config management is preventing cron from running fetch crl. It only now got triggered because I rebooted the machine to get a new kernel while I was upgrading condor<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:28:48)</span> <b>andrew.melo:</b></span> So, uh, that's cool<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:29:31)</span> <b>andrew.melo:</b></span> The CE node type triggered the pam change but not the exceptions that allow cron jobs as root<br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:18)</span> <b>blin:</b></span> :anguished:<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:32:56)</span> <b>bbockelm:</b></span> :confused: the packaging of fetch-crl has always bugged the crap outta me.<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:33:11)</span> <b>bbockelm:</b></span> it's this weird re-implementation of systemd features ... with systemd bolted on top<br/>
<span style="color: #43761b"><span style="font-size: small">(15:37:37)</span> <b>blin:</b></span> if that bothers you, don't look at gratia probe<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:38:19)</span> <b>bbockelm:</b></span> :wink: I'm pretty sure I'm the one who wrote that code.  It made better sense before systemd also!<br/>
<span style="color: #43761b"><span style="font-size: small">(15:39:56)</span> <b>blin:</b></span> "<tt>git blame</tt>...yeah, i guess that did make sense *squints*  7 years ago"<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:50:37)</span> <b>andrew.melo:</b></span> We have a Pam setting for our worker nodes to prevent users not currently running a job on that node from connecting and some of it bled to the CE .. I think<br/>
</body>
</html>
