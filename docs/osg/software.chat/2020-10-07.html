<!DOCTYPE html>
<html>
<head>
<title>Wed Oct 7, 2020 : #software (osg)</title>
</head>
<body>
<h3>Wed Oct 7, 2020 : #software (osg)</h3>
<span style="color: #73769d"><span style="font-size: small">(10:17:13)</span> <b>tim.theisen:</b></span> Did something break with CVMFS on EL6? All the nightlies failed that test.<br/>
<span style="color: #43761b"><span style="font-size: small">(10:20:39)</span> <b>blin:</b></span> @dwd ^^<br/>
<span style="color: #43761b"><span style="font-size: small">(10:21:24)</span> <b>blin:</b></span> did some CVMFS infrastructure change that needed to be reflected in the 3.4 EL6 config maybe?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:22:11)</span> <b>blin:</b></span> or maybe @marian @dweitzel? i'm seeing this:<br/><pre>AssertionError: Autofs failed to mount /cvmfs/oasis.opensciencegrid.org</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:23:49)</span> <b>dweitzel:</b></span> no, no changes that I know of.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:45:14)</span> <b>dwd:</b></span> There were some changes to the config repository yesterday.  It works on my el6 machine though<br/>
<span style="color: #99a949"><span style="font-size: small">(10:47:06)</span> <b>dwd:</b></span> Can somebody log into the machine and see /var/log/messages?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:50:58)</span> <b>blin:</b></span> that'd take a little bit of work since the tests are done<br/>
<span style="color: #99a949"><span style="font-size: small">(11:56:18)</span> <b>dwd:</b></span> @blin It’s probably worth the work if it can be done and we want to figure out what’s happening<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(12:07:15)</span> <b>blin:</b></span> Yeah, sorry, I was just suggesting that we didn't have it readily at our fingertips<br/>
</blockquote>
<span style="color: #73769d"><span style="font-size: small">(12:06:09)</span> <b>tim.theisen:</b></span> @dwd :<br/><pre>Oct  7 06:45:09 localhost cvmfs2: re-building cache database<br/>Oct  7 06:45:09 localhost cvmfs2: too little free space on the file system hosting the cache, 2730 MB available<br/>Oct  7 06:45:09 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) skipping DIRECT proxy to use fallback proxy<br/>Oct  7 06:45:19 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) switching proxy from <a href="http://144.92.180.99:8001">http://144.92.180.99:8001</a> to <a href="http://144.92.180.100:8001">http://144.92.180.100:8001</a><br/>Oct  7 06:45:19 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) switching proxy from <a href="http://144.92.180.100:8001">http://144.92.180.100:8001</a> to <a href="http://128.142.168.202:3126">http://128.142.168.202:3126</a><br/>Oct  7 06:45:19 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) geographic order of servers retrieved from <a href="http://cvmfs-s1bnl.opensciencegrid.org">cvmfs-s1bnl.opensciencegrid.org</a><br/>Oct  7 06:45:19 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) CernVM-FS: linking /cvmfs/config-osg.opensciencegrid.org to repository <a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a><br/>Oct  7 06:45:20 localhost cvmfs2: (<a href="http://cms.cern.ch">cms.cern.ch</a>) skipping DIRECT proxy to use fallback proxy<br/>Oct  7 06:45:32 localhost cvmfs2: (<a href="http://cms.cern.ch">cms.cern.ch</a>) switching proxy from <a href="http://144.92.180.99:8001">http://144.92.180.99:8001</a> to <a href="http://144.92.180.100:8001">http://144.92.180.100:8001</a><br/>Oct  7 06:45:32 localhost cvmfs2: (<a href="http://cms.cern.ch">cms.cern.ch</a>) geographic order of servers retrieved from <a href="http://cvmfs-stratum-one.cern.ch">cvmfs-stratum-one.cern.ch</a><br/>Oct  7 06:45:32 localhost cvmfs2: (<a href="http://cms.cern.ch">cms.cern.ch</a>) CernVM-FS: linking /cvmfs/cms.cern.ch to repository <a href="http://cms.cern.ch">cms.cern.ch</a><br/>Oct  7 06:45:33 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) failed to download repository manifest (2 - malformed URL)<br/>Oct  7 06:45:33 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) failed to fetch file catalog at <a href="http://oasis.opensciencegrid.org:/">oasis.opensciencegrid.org:/</a> (hash: 0000000000000000000000000000000000000000, error 2 [malformed URL])<br/>Oct  7 06:45:33 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) Failed to initialize root file catalog (16 - file catalog failure)<br/>Oct  7 06:45:36 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) skipping DIRECT proxy to use fallback proxy<br/>Oct  7 06:45:47 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) switching proxy from <a href="http://144.92.180.99:8001">http://144.92.180.99:8001</a> to <a href="http://144.92.180.100:8001">http://144.92.180.100:8001</a><br/>Oct  7 06:45:47 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) switching proxy from <a href="http://144.92.180.100:8001">http://144.92.180.100:8001</a> to <a href="http://128.142.168.202:3126">http://128.142.168.202:3126</a><br/>Oct  7 06:45:47 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) geographic order of servers retrieved from <a href="http://cvmfs-s1goc.opensciencegrid.org">cvmfs-s1goc.opensciencegrid.org</a><br/>Oct  7 06:45:47 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) CernVM-FS: linking /tmp/tmp8w3KkV to repository <a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a><br/>Oct  7 06:45:48 localhost cvmfs2: (<a href="http://singularity.opensciencegrid.org">singularity.opensciencegrid.org</a>) failed to download repository manifest (2 - malformed URL)<br/>Oct  7 06:45:48 localhost cvmfs2: (<a href="http://singularity.opensciencegrid.org">singularity.opensciencegrid.org</a>) failed to fetch file catalog at <a href="http://singularity.opensciencegrid.org:/">singularity.opensciencegrid.org:/</a> (hash: 0000000000000000000000000000000000000000, error 2 [malformed URL])<br/>Oct  7 06:45:48 localhost cvmfs2: (<a href="http://singularity.opensciencegrid.org">singularity.opensciencegrid.org</a>) Failed to initialize root file catalog (16 - file catalog failure)<br/>Oct  7 06:45:58 localhost cvmfs2: (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>) CernVM-FS: unmounted /tmp/tmp8w3KkV (<a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>)<br/>Oct  7 06:45:58 localhost cvmfs2: (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>) CernVM-FS: unmounted /cvmfs/config-osg.opensciencegrid.org (<a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a>)<br/>Oct  7 06:45:59 localhost cvmfs2: (<a href="http://cms.cern.ch">cms.cern.ch</a>) CernVM-FS: unmounted /cvmfs/cms.cern.ch (<a href="http://cms.cern.ch">cms.cern.ch</a>)</pre><br/>
<span style="color: #99a949"><span style="font-size: small">(12:10:16)</span> <b>dwd:</b></span> The second line shows a problem, but probably not the worst problem.  Moving the cache to a different filesystem should be investigated.  The worst problem is that <a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a> can’t be mounted.  The problem cannot be related to yesterday’s changes to that repository, because they’re happening before it is mounted; the contents are irrelevant.<br/>
<span style="color: #73769d"><span style="font-size: small">(12:26:03)</span> <b>tim.theisen:</b></span> The warning about free space shows up in all our test runs. So, definitely not the problem.<br/><br/>What is new is "failed to download repository manifest (2 - malformed URL)" and "failed to fetch file catalog at <a href="http://oasis.opensciencegrid.org">oasis.opensciencegrid.org</a>:/"<br/>
<span style="color: #99a949"><span style="font-size: small">(14:02:52)</span> <b>dwd:</b></span> Oh I was wrong.  <a href="http://config-osg.opensciencegrid.org">config-osg.opensciencegrid.org</a> did get mounted.  It gave warnings about the local caches not working, but it mounted through the fallback proxy at CERN.  That’s another weird thing, it should have used an FNAL fallback proxy.  I’ll try to reproduce that scenario.  It’s very unusual for a proxy to use port 8001; usually it is port 3128.  That may be the reason why the local proxies failed to work.<br/>
<span style="color: #99a949"><span style="font-size: small">(14:05:48)</span> <b>dwd:</b></span> @tim.theisen Can you give me the contents of the /etc/cvmfs directory tree from that machine?<br/>
<span style="color: #73769d"><span style="font-size: small">(14:10:16)</span> <b>tim.theisen:</b></span> @dwd I'll have to run another test run. It shouldn't take too long.<br/>
<span style="color: #99a949"><span style="font-size: small">(14:41:24)</span> <b>dwd:</b></span> ok that would be good<br/>
<span style="color: #73769d"><span style="font-size: small">(15:01:06)</span> <b>tim.theisen:</b></span> Ugh, my run did not capture the necessary files. I'll try again. OSG 3.4 has cvmfs 2.7.0 and osg-oasis 16-1. Would those older versions cause this trouble?<br/>
<span style="color: #99a949"><span style="font-size: small">(15:22:58)</span> <b>dwd:</b></span> No I don’t think there’s an issue with older versions different from newer versions that could cause these symptoms<br/>
<span style="color: #73769d"><span style="font-size: small">(15:23:00)</span> <b>tim.theisen:</b></span> @dwd: I grabbed the files from a running job<br/>
<span style="color: #73769d"><span style="font-size: small">(15:23:10)</span> <b>tim.theisen:</b></span> what do you want to see?<br/>
<span style="color: #99a949"><span style="font-size: small">(15:23:32)</span> <b>dwd:</b></span> Send me a tarball, by email I suppose.<br/>
<span style="color: #73769d"><span style="font-size: small">(15:23:36)</span> <b>tim.theisen:</b></span> OK<br/>
<span style="color: #99a949"><span style="font-size: small">(15:24:50)</span> <b>dwd:</b></span> I did just figure out why it was using the CERN fallback proxies, applied a workaround for all but the config repo into the config repo, and made a ticket for a permanent fix.<br/>
<span style="color: #73769d"><span style="font-size: small">(15:25:26)</span> <b>tim.theisen:</b></span> I just sent the tarball. Let me know that you got it. Sometimes mailers like to strip things like that.<br/>
<span style="color: #73769d"><span style="font-size: small">(15:28:07)</span> <b>tim.theisen:</b></span> Here is a link to the tarball if that helps: <a href="https://drive.google.com/file/d/1PocRjJTaRlP4XlPny7-oH2WdxP0Tn0ey/view?usp=sharing">https://drive.google.com/file/d/1PocRjJTaRlP4XlPny7-oH2WdxP0Tn0ey/view?usp=sharing</a><br/>
<span style="color: #99a949"><span style="font-size: small">(15:40:22)</span> <b>dwd:</b></span> I got it.  The first thing I notice is that CVMFS_HTTP_PROXY=“<a href="http://squid-cs-2360.chtc.wisc.edu:3128">http://squid-cs-2360.chtc.wisc.edu:3128</a>” but that doesn’t match the behavior we saw in /var/log/messages.  It was trying <a href="http://cache01.hep.wisc.edu:8001">cache01.hep.wisc.edu:8001</a> and <a href="http://cache02.hep.wisc.edu:8001">cache02.hep.wisc.edu:8001</a>.  Do you have any idea why the discrepency?<br/>
<span style="color: #73769d"><span style="font-size: small">(15:48:17)</span> <b>tim.theisen:</b></span> I don't know off hand. Maybe @blin has an idea?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:48:36)</span> <b>blin:</b></span> yeah, i think that's just a hack for the tests<br/>
<span style="color: #99a949"><span style="font-size: small">(15:48:52)</span> <b>dwd:</b></span> Can you point me to the source code?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:50:19)</span> <b>blin:</b></span> ya, <a href="https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_180_cvmfs.py#L41">https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_180_cvmfs.py#L41</a><br/>
<span style="color: #43761b"><span style="font-size: small">(15:50:37)</span> <b>blin:</b></span> i think this stems from the fact that we don't set up our own squid in the tests<br/>
<span style="color: #43761b"><span style="font-size: small">(15:50:42)</span> <b>blin:</b></span> we can certainly replace the pproxies we use<br/>
<span style="color: #99a949"><span style="font-size: small">(15:51:46)</span> <b>dwd:</b></span> It also sets up a bogus <a href="http://cern.ch">cern.ch</a>.local<br/>
<span style="color: #43761b"><span style="font-size: small">(15:51:58)</span> <b>blin:</b></span> not sure i understand why this would only be failing for EL6, though<br/>
<span style="color: #43761b"><span style="font-size: small">(15:52:25)</span> <b>blin:</b></span> yeah, i'm not really sure why we do that<br/>
<span style="color: #99a949"><span style="font-size: small">(15:53:02)</span> <b>dwd:</b></span> This doesn’t yet explain the failure, but it could certainly be improved<br/>
<span style="color: #43761b"><span style="font-size: small">(15:53:54)</span> <b>blin:</b></span> writing out <tt><a href="http://cern.ch">cern.ch</a>.local</tt> has been in the codebase for over 8 years now :laughing:<br/>
<span style="color: #99a949"><span style="font-size: small">(15:55:03)</span> <b>dwd:</b></span> That was probably the recommended config 8 years ago but has long since been obsolete.<br/>
<span style="color: #43761b"><span style="font-size: small">(15:55:53)</span> <b>blin:</b></span> i imagine we can get rid of most of this config and just specify the squids to use?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:56:48)</span> <b>blin:</b></span> ah nvm<br/>
<span style="color: #99a949"><span style="font-size: small">(16:05:37)</span> <b>dwd:</b></span> I will give you a recommendation, after I figure out the root cause here.  I see that <a href="http://cms.cern.ch">cms.cern.ch</a> actually mounted, the problem was with the <a href="http://opensciencegrid.org">opensciencegrid.org</a> repositories.  So the contents of <a href="http://cern.ch">cern.ch</a>.local is definitely not the main problem.<br/>
<span style="color: #99a949"><span style="font-size: small">(16:07:27)</span> <b>dwd:</b></span> The failure is in the other cvmfs test, which is doing a funky mount into /tmp <a href="https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_380_cvmfs.py#L16">https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_380_cvmfs.py#L16</a><br/>
<span style="color: #43761b"><span style="font-size: small">(16:09:13)</span> <b>blin:</b></span> i vaguely remember writing that. the mount is only done to try to differentiate automount failures vs a cvmfs failure<br/>
<span style="color: #43761b"><span style="font-size: small">(16:10:22)</span> <b>blin:</b></span> separately, cool new GitHub feature! you can click on a function name and show the definitions/references<br/>
<span style="color: #43761b"><span style="font-size: small">(16:11:23)</span> <b>blin:</b></span> OSG 3.3 :disappointed: <a href="https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_380_cvmfs.py#L10">https://github.com/opensciencegrid/osg-test/blob/master/osgtest/tests/test_380_cvmfs.py#L10</a><br/>
<span style="color: #99a949"><span style="font-size: small">(16:12:20)</span> <b>dwd:</b></span> Ok I see it first attempting a regular mount and that fails.  The manual mount does succeed, which doesn’t make much sense<br/>
<span style="color: #43761b"><span style="font-size: small">(16:13:43)</span> <b>blin:</b></span> past me seems to think that indicated an autofs issue<br/>
<span style="color: #99a949"><span style="font-size: small">(16:17:14)</span> <b>dwd:</b></span> Well that would be the most likely explanation, for example if autofs wasn’t running, but that’s not the case here.  In fact the troubleshooting help on the cvmfs install page still says to try a manual mount if autofs mount doesn’t do it.  However, the failure when going through automount was malformed URL, and right now I can’t think of a plausible explanation why that would happen when under autofs but not with a manual mount.<br/>
<span style="color: #99a949"><span style="font-size: small">(16:20:50)</span> <b>dwd:</b></span> How can I run just one or two tests of osg-test on my own interactive machine?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:24:30)</span> <b>blin:</b></span> it's best to do it on a clean VM<br/>
<span style="color: #99a949"><span style="font-size: small">(16:25:08)</span> <b>dwd:</b></span> Yes, got it<br/>
<span style="color: #43761b"><span style="font-size: small">(16:25:16)</span> <b>blin:</b></span> boy i haven't done this by hand in a while, but after you get osg-test installed (git clone + make install should work)<br/>
<span style="color: #43761b"><span style="font-size: small">(16:26:08)</span> <b>blin:</b></span> then modify the test-sequence and remove all lines after <tt>test_380_cvmfs</tt><br/>
<span style="color: #99a949"><span style="font-size: small">(16:27:22)</span> <b>dwd:</b></span> Can I remove all lines except the cvmfs lines?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:27:41)</span> <b>blin:</b></span> then run <tt>osg-test -nmvad -i osg-oasis -i singularity</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(16:28:03)</span> <b>blin:</b></span> nah, it does some setup. tests get skipped if the packages aren't installed anyway<br/>
<span style="color: #99a949"><span style="font-size: small">(16:28:33)</span> <b>dwd:</b></span> Why -i singularity?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:33:30)</span> <b>blin:</b></span> that's what our CVMFS nightlies install ¯\_(ツ)_/¯<br/>
<span style="color: #43761b"><span style="font-size: small">(16:34:22)</span> <b>blin:</b></span> we depend on CVMFS to test singularity but it doesn't hurt to make sure your setup is close to our nightlies as possible<br/>
<span style="color: #73769d"><span style="font-size: small">(16:35:46)</span> <b>tim.theisen:</b></span> I chose the CVMFS + Singularity test because it completes slightly faster than osg-tested-internal. Both failed the nightlies.<br/>
<span style="color: #73769d"><span style="font-size: small">(16:36:25)</span> <b>tim.theisen:</b></span> osg-tested-internal has more tests to run.<br/>
<span style="color: #99a949"><span style="font-size: small">(16:38:07)</span> <b>dwd:</b></span> Darn, it didn’t reproduce the error<br/>
<span style="color: #43761b"><span style="font-size: small">(16:38:46)</span> <b>blin:</b></span> ugh, classic<br/>
<span style="color: #43761b"><span style="font-size: small">(16:39:19)</span> <b>blin:</b></span> there must be something specific to our VMs. i'll try to do some digging. What were your next steps for troubleshooting? we can add them as temporary tests<br/>
<span style="color: #99a949"><span style="font-size: small">(16:41:24)</span> <b>dwd:</b></span> I would probably put CVMFS_DEBUGLOG=/tmp/cvmfsdebug.log into /etc/cvmfs/domain.d/opensciencegrid.org.local, then look at the created debug log.<br/>
<span style="color: #73769d"><span style="font-size: small">(16:42:48)</span> <b>tim.theisen:</b></span> If you put that file in /var/log. The tests are setup to copy it out automatically.<br/>
<span style="color: #99a949"><span style="font-size: small">(16:43:31)</span> <b>dwd:</b></span> To make it a little smaller you could instead put it in /etc/cvmfs/config.d/oasis.opensciencegrid.org.local<br/>
<span style="color: #43761b"><span style="font-size: small">(17:08:34)</span> <b>blin:</b></span> @dwd did you mean <tt>CVMFS_DEBUGFILE</tt>?<br/>
<span style="color: #43761b"><span style="font-size: small">(17:08:50)</span> <b>blin:</b></span> that's what upstream says <a href="https://cvmfs.readthedocs.io/en/2.7/cpt-configure.html#debug-logs">https://cvmfs.readthedocs.io/en/2.7/cpt-configure.html#debug-logs</a><br/>
<span style="color: #99a949"><span style="font-size: small">(17:09:57)</span> <b>dwd:</b></span> No.  That looks like a bug in the doc, unless both are supported.  I always use CVMFS_DEBUGLOG.  There is another hit for that in the doc too<br/>
<span style="color: #99a949"><span style="font-size: small">(17:10:33)</span> <b>dwd:</b></span> I don’t see CVMFS_DEBUGFILE in the cvmfs source code<br/>
<span style="color: #43761b"><span style="font-size: small">(17:28:10)</span> <b>blin:</b></span> ok, i've kicked off tests and if i didn't screw anything up, their results should show up in <a href="https://osg-sw-submit.chtc.wisc.edu/tests/20201007-1720/results.html">https://osg-sw-submit.chtc.wisc.edu/tests/20201007-1720/results.html</a><br/>
<span style="color: #43761b"><span style="font-size: small">(17:29:16)</span> <b>blin:</b></span> i've updated the <tt>debug_cvmfs</tt> function to dump the debug log so it should show up in the (lengthy) results<br/>
<span style="color: #99a949"><span style="font-size: small">(17:29:38)</span> <b>dwd:</b></span> @dweitzel Is there a plan to introduce a docker pro account this month for the docker pulls to <a href="http://singularity.opensciencegrid.org">singularity.opensciencegrid.org</a> ?<br/>
<span style="color: #99a949"><span style="font-size: small">(17:41:25)</span> <b>dwd:</b></span> Has it been discussed in the software team?  <a href="https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/">https://www.docker.com/blog/scaling-docker-to-serve-millions-more-developers-network-egress/</a><br/>
<span style="color: #43761b"><span style="font-size: small">(17:42:53)</span> <b>blin:</b></span> we weren't too concerned with distribution/consumption of grid services<br/>
<span style="color: #43761b"><span style="font-size: small">(17:43:21)</span> <b>blin:</b></span> the only places that may get bit are folks using the WN containers that are behind a NAT<br/>
<span style="color: #43761b"><span style="font-size: small">(17:43:33)</span> <b>blin:</b></span> though that makes the OSG VO pilot container more interesting @bbockelm ^^<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:44:35)</span> <b>bbockelm:</b></span> If we hit the limits, we’ll get a pro account.  It’s not clear whether we will hit the limit though?<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(17:46:56)</span> <b>blin:</b></span> i was thinking if a site starts up a bunch of OSG VO pilot containers and they're behind a NAT -- that may be a lot of pulls<br/>
</blockquote>
<span style="color: #99a949"><span style="font-size: small">(17:44:36)</span> <b>dwd:</b></span> But they should all be reading from cvmfs.  I think the concern should be that populating /cvmfs/singularity.opensciencegrid.org will be more than 200 pulls per 6 hours from one IP address<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:45:17)</span> <b>bbockelm:</b></span> Does it count if it doesn’t actually pull?<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:45:30)</span> <b>bbockelm:</b></span> E.g., no changes are made.<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:45:50)</span> <b>andrew.melo:</b></span> &gt;  Because we are limiting on manifest requests, the number of layers (blob requests) related to a pull is unlimited at this time.<br/>
<span style="color: #99a949"><span style="font-size: small">(17:45:50)</span> <b>dwd:</b></span> I’m not sure<br/>
<span style="color: #99a949"><span style="font-size: small">(17:46:32)</span> <b>dwd:</b></span> It may be doing the manifest requests every time it runs<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:46:55)</span> <b>andrew.melo:</b></span> &gt;  There is a small tradeoff – if you pull an image you already have, this is still counted even if you don’t download the layers.<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:48:59)</span> <b>andrew.melo:</b></span> It seems like exactly the thing that'd trip us up<br/>
<span style="color: #99a949"><span style="font-size: small">(18:02:12)</span> <b>dwd:</b></span> The <a href="https://github.com/opensciencegrid/cvmfs-singularity-sync/blob/master/cvmfs-singularity-sync#L117">code</a> has an option to “doauth” but it looks like it is ignored, so it probably will take some development, not just getting an account and configuring.  On the other hand, it also looks like the code is first looking for new “tags” before it attempts to do any publishing, so maybe as long as there’s no new tag it won’t pull and be counted.<br/>
<span style="color: #235e5b"><span style="font-size: small">(18:36:37)</span> <b>dweitzel:</b></span> We have not hit the limit yet, as far as I know. Indeed, the code is designed to inject credentials if we have them.  We have monitoring if the pull fails, so we should see the errors right away. <br/>
</body>
</html>
