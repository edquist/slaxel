<!DOCTYPE html>
<html>
<head>
<title>Thu May 7, 2020 : #software (osg)</title>
</head>
<body>
<h3>Thu May 7, 2020 : #software (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(08:42:29)</span> <b>stanfiem:</b></span> no emails this morning about failures due to the AddTrust CA removal<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:42:46)</span> <b>stanfiem:</b></span> taking that as a positive sign<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:42:54)</span> <b>bbockelm:</b></span> right - wasn't expecting anything TBH.  Still a good sign!<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:43:24)</span> <b>bbockelm:</b></span> (certainly we fixed the "known bug"...)<br/>
<span style="color: #43761b"><span style="font-size: small">(08:45:20)</span> <b>blin:</b></span> yeah, we did some testing on monday with all combos of EL6 vs EL7 and new vs old CA certs package to be sure, too<br/>
<span style="color: #16569E"><span style="font-size: small">(08:47:03)</span> <b>edquist:</b></span> anybody aware of why dns stopped resolving <a href="http://repo.opensciencegrid.org">repo.opensciencegrid.org</a> and <a href="http://repo-itb.opensciencegrid.org">repo-itb.opensciencegrid.org</a> ?<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:47:15)</span> <b>bbockelm:</b></span> works for me...<br/>
<span style="color: #16569E"><span style="font-size: small">(08:47:18)</span> <b>edquist:</b></span> apparently sometime this morning<br/>
<span style="color: #16569E"><span style="font-size: small">(08:47:25)</span> <b>edquist:</b></span> well that's lucky<br/>
<span style="color: #16569E"><span style="font-size: small">(08:47:44)</span> <b>edquist:</b></span> oh sure now it does<br/>
<span style="color: #16569E"><span style="font-size: small">(08:47:55)</span> <b>edquist:</b></span> well it wasn't for a while earlier, no idea why<br/>
<span style="color: #43761b"><span style="font-size: small">(08:47:58)</span> <b>blin:</b></span> *carl begins to question his own sanity*<br/>
<span style="color: #16569E"><span style="font-size: small">(08:48:27)</span> <b>edquist:</b></span> well, that is always a question, but my terminal windows are still open<br/><br/><pre><br/>[edquist@mystras ~]$ resolve <a href="http://repo.opensciencegrid.org">repo.opensciencegrid.org</a><br/>&lt;not-found&gt;<br/>[edquist@mystras ~]$ resolve <a href="http://repo.opensciencegrid.org">repo.opensciencegrid.org</a><br/>129.93.175.52<br/></pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(08:48:32)</span> <b>dweitzel:</b></span> I got another report from Dave about dns issues isolated to UNL DNS<br/>
<span style="color: #16569E"><span style="font-size: small">(08:48:36)</span> <b>edquist:</b></span> also the website was timing out<br/>
<span style="color: #16569E"><span style="font-size: small">(08:48:44)</span> <b>edquist:</b></span> ssh wasn't working <br/>
<span style="color: #16569E"><span style="font-size: small">(08:48:45)</span> <b>edquist:</b></span> etc<br/>
<span style="color: #235e5b"><span style="font-size: small">(08:48:51)</span> <b>dweitzel:</b></span> He is now reporting it fixed as well. Temporary glitch?<br/>
<span style="color: #16569E"><span style="font-size: small">(08:48:58)</span> <b>edquist:</b></span> but yes just a minute ago dns seems to be working again<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:49:58)</span> <b>bbockelm:</b></span> I got one failure from 8.8.8.8 but it went away pretty quickly.<br/>
<span style="color: #9e3997"><span style="font-size: small">(08:50:19)</span> <b>bbockelm:</b></span> I believe strongly in CloudFlare and am willing to blame UNL :slightly_smiling_face:<br/>
<span style="color: #73769d"><span style="font-size: small">(09:00:57)</span> <b>tim.theisen:</b></span> I was not able to resolve repo or repo-itb this moring. I was about to post the slack and then it started working.<br/>
<span style="color: #73769d"><span style="font-size: small">(09:01:21)</span> <b>tim.theisen:</b></span> <pre>$ host <a href="http://repo.opensciencegrid.org">repo.opensciencegrid.org</a><br/>Host <a href="http://repo.opensciencegrid.org">repo.opensciencegrid.org</a> not found: 2(SERVFAIL)</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:55:37)</span> <b>didavila:</b></span> Hey <b>@here</b>, at UCSD we are having authentication issues in our condor pool:<br/><pre>05/07/20 13:48:11 Condor GSI authentication failure<br/>GSS Major Status: Authentication Failed<br/>GSS Minor Status Error Chain:<br/>globus_gss_assist: Error during context initialization<br/>OpenSSL Error: s3_clnt.c:1188: in library: SSL routines, function SSL3_GET_SERVER_CERTIFICATE: certificate verify failed<br/>globus_gsi_callback_module: Could not verify credential<br/>globus_gsi_callback_module: Can't get the local trusted CA certificate: Untrusted self-signed certificate in chain with hash 157753a5<br/><br/>05/07/20 13:48:11 SECMAN: required authentication with collector <a href="http://glidein-collector.t2.ucsd.edu">glidein-collector.t2.ucsd.edu</a> failed, so aborting command UPDATE_MASTER_AD.</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:56:30)</span> <b>didavila:</b></span> could this be related to the the update in the osg-ca-certs?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:57:06)</span> <b>blin:</b></span> possibly but i wouldn't think so. what's <tt>openssl x509 -in /etc/grid-security/hostcert.pem -noout -subject -issuer</tt> give you?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:57:18)</span> <b>blin:</b></span> what version of <tt>osg-ca-certs</tt> do you have installed?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:57:28)</span> <b>didavila:</b></span> [1357] root@uaf-8 ~# openssl x509 -in /etc/grid-security/hostcert.pem -noout -subject -issuer<br/>subject= /DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://uaf-8.t2.ucsd.edu">uaf-8.t2.ucsd.edu</a><br/>issuer= /C=US/O=Internet2/OU=InCommon/CN=InCommon IGTF Server CA<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:57:44)</span> <b>didavila:</b></span> <pre>1357] root@uaf-8 ~# rpm -qa | grep osg-ca-cert<br/>osg-ca-certs-1.88-1.osg34.el6.noarch</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:57:51)</span> <b>didavila:</b></span> this was on the schedd side<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(15:59:02)</span> <b>didavila:</b></span> on the collector side, we haven’t updated it:<br/><pre>[1343] root@glidein-collector /etc/condor/config.d# rpm -qa | grep osg-ca-cert<br/>osg-ca-certs-1.77-1.osg34.el7.noarch</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(15:59:19)</span> <b>blin:</b></span> yeah, that hash does correspond to the AddTrust CA that  was removed<br/>
<span style="color: #43761b"><span style="font-size: small">(15:59:34)</span> <b>blin:</b></span> oh yeah, i think that needs to be updated<br/>
<span style="color: #43761b"><span style="font-size: small">(16:00:35)</span> <b>blin:</b></span> you need to have a bundle that contains the cross-signed replacement CA, and I think that was added in like 1.87 or 1.86<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:17:37)</span> <b>didavila:</b></span> after updating osg-ca-certs in the collector now I see that the FE can authenticate with it, but the schedds, wich have already the latest version of osg-ca-certs, still can’t  authenticate with the collector<br/>
<span style="color: #43761b"><span style="font-size: small">(16:21:39)</span> <b>blin:</b></span> that may be because of a GSI auth cache. if you can, i'd restart condor on the schedd's<br/>
<span style="color: #e85d72"><span style="font-size: small">(17:59:01)</span> <b>cnweaver:</b></span> I have solved the first layer of my xrootd problem from last week: The file injected into the container as /etc/xrootd/config.d/10-my-site-variables.cfg must *not* for any reason have its executable bit set, as xrootd will then skip reading it (this is documented at <a href="https://xrootd.slac.stanford.edu/doc/dev49/Syntax_config.htm#_Toc520499864">https://xrootd.slac.stanford.edu/doc/dev49/Syntax_config.htm#_Toc520499864</a>, but I never thought to look for it, since it's a pretty bizzare requirement). This causes directives in a couple of the OSG supplied config files to become invalid, like <tt>oss.localroot $(rootdir)</tt> since <tt>rootdir</tt> is not defined. Since xrootd neither stops processing when an error occurs, nor keeps track of where errors occur, this was very tricky to track down. (I suspect that it it's very idiosyncratic error reporting will also report the _last_ error encountered, unlike basically any other parser ever written.)<br/>
<span style="color: #e85d72"><span style="font-size: small">(18:00:10)</span> <b>cnweaver:</b></span> This seems to be entirely a combination of QOI issues and questionable features in xrootd, so unfortunately, I can't suggest anything that could be done in the OSG packaging to make it less bad.<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:01:06)</span> <b>bbockelm:</b></span> I think it’s worthwhile to report upstream.<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:01:34)</span> <b>bbockelm:</b></span> I don’t understand why the xrootd parsing is so much more difficult than any other configuration language <br/>
<span style="color: #e85d72"><span style="font-size: small">(18:03:44)</span> <b>cnweaver:</b></span> My best guess is because the parser is designed rather oddly, like having what might normally be the lexer and the parser stirred together.<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:03:48)</span> <b>bbockelm:</b></span> As a plug-in writer, I can report the consumer API is extremely low-level, not much more than strong parsing in C++.  That leads each individual to write their own parsing code - which is why each plugin config is so different.<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:04:21)</span> <b>bbockelm:</b></span> Of the 8-10 plugins that I know of, you can probably tell who wrote it based on the similarities in config style...<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:04:54)</span> <b>bbockelm:</b></span> (Or, at least, who copy/pasted from where...)<br/>
</body>
</html>
