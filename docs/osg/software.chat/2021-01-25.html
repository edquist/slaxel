<!DOCTYPE html>
<html>
<head>
<title>Mon Jan 25, 2021 : #software (osg)</title>
</head>
<body>
<h3>Mon Jan 25, 2021 : #software (osg)</h3>
<span style="color: #e96699"><span style="font-size: small">(12:36:12)</span> <b>lincoln:</b></span> hey all, for what it's worth. we again see the issue with certs/CRLs from OASIS seemingly not up to date on our servers. this has cropped up again with our FTS server now, which is getting replaced with a normal <tt>fetch-crl</tt> / <tt>osg-ca-certs</tt> installation. i do wonder if this is some cache issue or something :confused:<br/>
<span style="color: #c386df"><span style="font-size: small">(12:40:05)</span> <b>matyas:</b></span> hmm. looks fine on <tt>oasis-login</tt><br/>
<span style="color: #e96699"><span style="font-size: small">(12:41:23)</span> <b>lincoln:</b></span> im not sure theres anything actionable without a reliable way to reproduce the issue, just expressing our frustration :wink:<br/>
<span style="color: #a63024"><span style="font-size: small">(12:45:16)</span> <b>paschos:</b></span> the background here for fts is as follows:<br/>Ligo was transferring files to Melbourne and in the past few days was getting the following error:<br/><pre>gfal-copy error: 13 (Permission denied) - globus_ftp_control: gss_init_sec_context failed globus_gsi_callback_module: Could not verify credential globus_gsi_callback_module: Could not verify credential globus_gsi_callback_module: The certificate has been revoked: Serial number = -1 (0xFFFFFFFFFFFFFFFF) Subject=/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2</pre><br/>That certificate has been revoked as of <tt>osg-ca-certs-1.89-1.osg35.el7.noarch</tt>. Using versions 1.92 for those certts works. But should be getting those from oasis anyway but it doesn’t work. But a local install of 1.92-1.osg35.el7 fixed the issue and transfers continued successfully<br/>
<span style="color: #43761b"><span style="font-size: small">(13:02:26)</span> <b>blin:</b></span> i think this is generally why we recommend sites use the RPM install for CA certs<br/>
<span style="color: #43761b"><span style="font-size: small">(13:03:21)</span> <b>blin:</b></span> and unfortunately, I don't have any ideas for how we can track this down or what logging to preemptively enable to help us debug it if it crops up in the future<br/>
<span style="color: #43761b"><span style="font-size: small">(13:06:02)</span> <b>blin:</b></span> maybe @dwd has some thoughts but i'm coming up empty<br/>
<span style="color: #99a949"><span style="font-size: small">(13:08:33)</span> <b>dwd:</b></span> Can you point to specific files that are out of date on a specific client?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:10:00)</span> <b>dwd:</b></span> You can see cvmfs revision on a client as an unprivileged user with <tt>attr -qg revision /cvmfs/oasis.opensciencegrid.org</tt>  I see currently 16046 on my client<br/>
<span style="color: #99a949"><span style="font-size: small">(13:18:31)</span> <b>dwd:</b></span> @lincoln @paschos<br/>
<span style="color: #e96699"><span style="font-size: small">(13:19:45)</span> <b>lincoln:</b></span> Not sure we have it mounted on that host any longer since we just wanted to fix the user facing issue. But will definitely scan through on our other hosts<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:35:53)</span> <b>bbockelm:</b></span> One thing to note is that the error message above references _revocation_ (i.e., CRLs) which should be independent of the CA package version.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:36:35)</span> <b>bbockelm:</b></span> So, if you install <tt>osg-ca-certs-1.92</tt> and switch to that, it might start working until the first time <tt>fetch-crl</tt> is run.<br/>
<span style="color: #e96699"><span style="font-size: small">(16:37:06)</span> <b>lincoln:</b></span> well, we weren't running fetch-crl before since OASIS has the CRLs, as well :slightly_smiling_face:<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:37:07)</span> <b>bbockelm:</b></span> (Recall that missing CRLs are ignored, so if you setup a fresh RPM-based CA area you may not have CRLs)<br/>
<span style="color: #e96699"><span style="font-size: small">(16:37:38)</span> <b>lincoln:</b></span> but yeah, we've swapped to, AFAIK, using the latest osg-ca-certs + fetch-crl on that particular host<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:38:32)</span> <b>bbockelm:</b></span> That's more interesting if you get different behavior on an up-to-date install.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:38:49)</span> <b>bbockelm:</b></span> what's the hash for <tt>/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2</tt>?<br/>
<span style="color: #e96699"><span style="font-size: small">(16:41:59)</span> <b>lincoln:</b></span> just grepping around I see a few possibilities..:<br/><pre>633dc6a4.signing_policy:access_id_CA      X509     '/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2'<br/>7a819ef2.namespaces:  PERMIT Subject "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2"<br/>7a819ef2.namespaces:TO Issuer "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2" \<br/>7a819ef2.signing_policy:cond_subjects     globus   '"/C=BM/O=QuoVadis Limited/CN=QuoVadis Root CA 2" "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2"'<br/>d7e8dc79.namespaces:  PERMIT Subject "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2"<br/>d7e8dc79.namespaces:TO Issuer "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2" \<br/>d7e8dc79.signing_policy:cond_subjects     globus   '"/C=BM/O=QuoVadis Limited/CN=QuoVadis Root CA 2" "/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2"'<br/>e91bd360.signing_policy:access_id_CA      X509     '/C=BM/O=QuoVadis Limited/CN=QuoVadis Grid ICA G2'</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:58:59)</span> <b>bbockelm:</b></span> Alright, I see what happened.  QuoVadis revoked it's intermediate CA and reissued it (same CA, different serial number).  However, the revocation occurred on January 14 and OSG didn't release the update until January 21.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:59:38)</span> <b>bbockelm:</b></span> @lincoln - when precisely did you see the errors occur?<br/>
<span style="color: #e96699"><span style="font-size: small">(17:00:01)</span> <b>lincoln:</b></span> We can prob check the FTS logs-<br/>
<span style="color: #e96699"><span style="font-size: small">(17:00:20)</span> <b>lincoln:</b></span> @jlstephen @paschos any idea when users complained?<br/>
<span style="color: #e96699"><span style="font-size: small">(17:00:28)</span> <b>lincoln:</b></span> I thought it was this morning<br/>
<span style="color: #e96699"><span style="font-size: small">(17:00:33)</span> <b>lincoln:</b></span> So.. after the 21st<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:00:39)</span> <b>bbockelm:</b></span> Basically, I would expect an up-to-date certificate stack on OSG to have broken through the 21st.<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:00:46)</span> <b>bbockelm:</b></span> Oh!  An FTS error log would be useful.<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:01:47)</span> <b>bbockelm:</b></span> The error message strongly suggests the problematic set of CAs is on the client side.<br/>
<span style="color: #a63024"><span style="font-size: small">(17:59:33)</span> <b>paschos:</b></span> ok --- we will look for log info  --- but user submitted the transfers between Jan 14 - 21 and see them fail …  He had to look into issues with the end points first before reaching out.<br/>
</body>
</html>
