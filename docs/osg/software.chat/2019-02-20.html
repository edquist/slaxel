<!DOCTYPE html>
<html>
<head>
<title>Wed Feb 20, 2019 : #software (osg)</title>
</head>
<body>
<h3>Wed Feb 20, 2019 : #software (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(13:04:07)</span> <b>bbockelm:</b></span> <b>@edquist</b> - why does osgbot have a cool logo but not <a href="https://github.com/opensciencegrid">https://github.com/opensciencegrid</a> ?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:05:19)</span> <b>blin:</b></span> i think it was using a gravatar based out of IU or something<br/>
<span style="color: #16569E"><span style="font-size: small">(13:28:42)</span> <b>edquist:</b></span> i have no idea why the old opensciencegrid org logo disappeared<br/>
<span style="color: #16569E"><span style="font-size: small">(13:28:56)</span> <b>edquist:</b></span> but as for osg-bot having a cool one,<br/>
<span style="color: #16569E"><span style="font-size: small">(13:29:04)</span> <b>edquist:</b></span> well, let's just say it was commissioned..!<br/>
<span style="color: #16569E"><span style="font-size: small">(14:11:03)</span> <b>edquist:</b></span> also i don't think i have admin access for the opensciencegrid github org<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:21:39)</span> <b>bbockelm:</b></span> <b>@edquist</b> - speaking of OSG-Bot, where's the love here: <a href="https://github.com/opensciencegrid/topology/pull/468">https://github.com/opensciencegrid/topology/pull/468</a> ?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:24:45)</span> <b>edquist:</b></span> looks like it was approved for automatic merge (in the email i got anyway), not sure why it wasn't merged, i can take a peek<br/>
<span style="color: #16569E"><span style="font-size: small">(14:26:06)</span> <b>edquist:</b></span> interesting -<br/>
<span style="color: #16569E"><span style="font-size: small">(14:26:14)</span> <b>edquist:</b></span> i wonder if github changed the rules<br/>
<span style="color: #16569E"><span style="font-size: small">(14:26:19)</span> <b>edquist:</b></span> <pre><br/>[Wed Feb 20 14:10:44.355839 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826] Output was:<br/>[Wed Feb 20 14:10:44.355842 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826] remote: error: GH006: Protected branch update failed for refs/heads/master.        <br/>[Wed Feb 20 14:10:44.355844 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826] remote: error: At least 1 approving review is required by reviewers with write access.        <br/>[Wed Feb 20 14:10:44.355846 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826] To git@github.com:opensciencegrid/topology<br/>[Wed Feb 20 14:10:44.355848 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826]  ! [remote rejected] 20833f26e32751004596d0961524cb119b79094e -&gt; master (protected branch hook declined)<br/>[Wed Feb 20 14:10:44.355850 2019] [wsgi:error] [pid 21232] [remote 192.30.252.41:44826] error: failed to push some refs to 'git@github.com:opensciencegrid/topology'<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:26:46)</span> <b>bbockelm:</b></span> &gt; remote: error: At least 1 approving review is required by reviewers with write access<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:26:51)</span> <b>bbockelm:</b></span> I don't see any approving review?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:26:56)</span> <b>edquist:</b></span> correct<br/>
<span style="color: #16569E"><span style="font-size: small">(14:27:04)</span> <b>edquist:</b></span> but this didn't stop things before<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:27:08)</span> <b>bbockelm:</b></span> Is OSG-bot supposed to do a review?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:27:35)</span> <b>edquist:</b></span> the version currently on itb does,<br/>
<span style="color: #16569E"><span style="font-size: small">(14:27:51)</span> <b>edquist:</b></span> along with leaving github comments on the pr<br/>
<span style="color: #16569E"><span style="font-size: small">(14:28:07)</span> <b>edquist:</b></span> but the production version has always worked to push a merge commit without a review<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:28:17)</span> <b>bbockelm:</b></span> ah.  So, the branch protection definitely requires a review.<br/>
<span style="color: #16569E"><span style="font-size: small">(14:28:21)</span> <b>edquist:</b></span> this seemed to work according to the rules previously<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:28:22)</span> <b>bbockelm:</b></span> I haven't touched those rules recently.<br/>
<span style="color: #16569E"><span style="font-size: small">(14:28:36)</span> <b>edquist:</b></span> no i mean i wonder if github changed the way those rules work<br/>
<span style="color: #16569E"><span style="font-size: small">(14:28:54)</span> <b>edquist:</b></span> it's true that hitting the merge button always required a review previously<br/>
<span style="color: #16569E"><span style="font-size: small">(14:29:32)</span> <b>edquist:</b></span> and protected branches prevented force-pushing non-ff commits<br/>
<span style="color: #16569E"><span style="font-size: small">(14:30:39)</span> <b>edquist:</b></span> but there was something in the definition (call it a loophole if you want, or just design) that allowed pushing a merge commit that would close the PR if it was a ff push, after the CI checks passed, without hitting the merge button and without a PR review<br/>
<span style="color: #16569E"><span style="font-size: small">(14:30:54)</span> <b>edquist:</b></span> so this behavior of it getting blocked is also definitely new<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:30:57)</span> <b>bbockelm:</b></span> ah, interesting.  That might have been tightened.<br/>
<span style="color: #16569E"><span style="font-size: small">(14:31:35)</span> <b>edquist:</b></span> i can show you multiple examples of PRs that were automatically merged into master this way without a PR review<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:32:21)</span> <b>bbockelm:</b></span> here's what I see:<br/>
<span style="color: #16569E"><span style="font-size: small">(14:32:23)</span> <b>edquist:</b></span> anyway yeah my off-the-cuff guess is they may have changed their rules (or interpretation of the rules) slightly on the github end<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:32:31)</span> <b>bbockelm:</b></span> <br/>
<span style="color: #9e3997"><span style="font-size: small">(14:32:44)</span> <b>bbockelm:</b></span> OH LOOK THERES A BUTTON THAT REQUIRES SIGNED COMMITS<br/>
<span style="color: #16569E"><span style="font-size: small">(14:33:36)</span> <b>edquist:</b></span> so,<br/>
<span style="color: #16569E"><span style="font-size: small">(14:33:40)</span> <b>edquist:</b></span> re your image<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:33:40)</span> <b>bbockelm:</b></span> Anyhow, seems that we discovered a bug in their code and they fixed it?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:33:51)</span> <b>edquist:</b></span> mmmmmmmm<br/>
<span style="color: #16569E"><span style="font-size: small">(14:34:00)</span> <b>edquist:</b></span> i don't know if i'd call it a bug necessarily<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:34:27)</span> <b>bbockelm:</b></span> :slightly_smiling_face: While we consider the zen of bugs ... is the ITB version ready for production?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:34:27)</span> <b>edquist:</b></span> i distinctly remember reading the protected branch rules and saying to myself, "hmm, i guess there is nothing that says this is disallowed"<br/>
<span style="color: #16569E"><span style="font-size: small">(14:34:44)</span> <b>edquist:</b></span> if you look at your screenshot,<br/>
<span style="color: #16569E"><span style="font-size: small">(14:34:48)</span> <b>edquist:</b></span> this is for status checks<br/>
<span style="color: #16569E"><span style="font-size: small">(14:34:52)</span> <b>edquist:</b></span> ie travis<br/>
<span style="color: #16569E"><span style="font-size: small">(14:35:00)</span> <b>edquist:</b></span> not for PR reviews, i think<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:35:10)</span> <b>bbockelm:</b></span> ah, yes, I took a screenshot of the wrong thing because I got distracted by requiring signed commits.<br/>
<span style="color: #16569E"><span style="font-size: small">(14:35:20)</span> <b>edquist:</b></span> i bet you did ;)<br/>
<span style="color: #16569E"><span style="font-size: small">(14:36:06)</span> <b>edquist:</b></span> &gt; Require pull request reviews before merging         <br/>&gt;           When enabled, all commits must be made to a non-protected  branch and submitted via a pull request with the required number of  approving reviews and no changes requested before it can be merged into a  branch that matches this rule.         <br/>
<span style="color: #16569E"><span style="font-size: small">(14:36:15)</span> <b>edquist:</b></span> i feel like the wording has changed somehow here<br/>
<span style="color: #16569E"><span style="font-size: small">(14:36:27)</span> <b>edquist:</b></span> but anyway<br/>
<span style="color: #16569E"><span style="font-size: small">(14:37:28)</span> <b>edquist:</b></span> the stuff in itb is working but there was some ongoing discussion about how best to present comments - just nitpicky stuff at this point<br/>
<span style="color: #16569E"><span style="font-size: small">(14:37:43)</span> <b>edquist:</b></span> it was not high prio as the current system was working<br/>
<span style="color: #16569E"><span style="font-size: small">(14:38:01)</span> <b>edquist:</b></span> but given this apparently new behavior it seems more important now<br/>
<span style="color: #16569E"><span style="font-size: small">(14:40:47)</span> <b>edquist:</b></span> example PR auto-merged without PR review<br/><a href="https://github.com/opensciencegrid/topology/pull/409">https://github.com/opensciencegrid/topology/pull/409</a><br/>
<span style="color: #16569E"><span style="font-size: small">(14:42:22)</span> <b>edquist:</b></span> ah, look at this:<br/>
<span style="color: #16569E"><span style="font-size: small">(14:42:50)</span> <b>edquist:</b></span> &gt;When enabled, all  commits must be made to a non-protected branch *and submitted via a pull  request* with the required number of approving reviews<br/>
<span style="color: #16569E"><span style="font-size: small">(14:43:09)</span> <b>edquist:</b></span> i think that bit about submitted via pull request is new<br/>
<span style="color: #16569E"><span style="font-size: small">(14:43:15)</span> <b>edquist:</b></span> which would explain the new behavior<br/>
<span style="color: #43761b"><span style="font-size: small">(15:11:17)</span> <b>blin:</b></span> booo<br/>
<span style="color: #43761b"><span style="font-size: small">(16:47:07)</span> <b>blin:</b></span> <b>@edquist</b> help me remember how to write code<br/>
<span style="color: #43761b"><span style="font-size: small">(16:47:27)</span> <b>blin:</b></span> what's the new-fangled way of getting an exception's message if not <tt>BaseException.message</tt>?<br/>
<span style="color: #16569E"><span style="font-size: small">(16:47:48)</span> <b>edquist:</b></span> lol<br/>
<span style="color: #16569E"><span style="font-size: small">(16:48:00)</span> <b>edquist:</b></span> sorry<br/>
<span style="color: #16569E"><span style="font-size: small">(16:48:09)</span> <b>edquist:</b></span> python just likes to complain<br/>
<span style="color: #16569E"><span style="font-size: small">(16:48:51)</span> <b>edquist:</b></span> <a href="https://stackoverflow.com/questions/1272138/baseexception-message-deprecated-in-python-2-6">https://stackoverflow.com/questions/1272138/baseexception-message-deprecated-in-python-2-6</a><br/>
<span style="color: #16569E"><span style="font-size: small">(16:50:23)</span> <b>edquist:</b></span> basically i think you just pass the exception object <tt>exc</tt> instead of <tt>exc.message</tt><br/>
<span style="color: #16569E"><span style="font-size: small">(16:51:18)</span> <b>edquist:</b></span> ```<br/>try:<br/>    something()<br/>except SomeExc as exc:<br/>    raise SomeOtherExc(exc)<br/>
<span style="color: #43761b"><span style="font-size: small">(16:53:58)</span> <b>blin:</b></span> gotcha<br/>
<span style="color: #c386df"><span style="font-size: small">(17:05:00)</span> <b>matyas:</b></span> also just use <tt>sys.exit(...)</tt> instead of <tt>raise SystemExit</tt><br/>
<span style="color: #c386df"><span style="font-size: small">(17:05:45)</span> <b>matyas:</b></span> <tt>sys.exit("string")</tt> prints string and exits 1<br/>
<span style="color: #c386df"><span style="font-size: small">(17:06:52)</span> <b>matyas:</b></span> does argparse really raise ValueError for usage errors? that seems wrong to me...<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(17:14:36)</span> <b>blin:</b></span> i raise them when validating state/country values<br/>
<span style="color: #43761b"><span style="font-size: small">(17:14:43)</span> <b>blin:</b></span> that's reasonable, right?<br/>
<span style="color: #c386df"><span style="font-size: small">(19:40:04)</span> <b>matyas:</b></span> ValueError is typically used for program errors -- one function calls another function with the wrong arguments. For usage errors, use <a href="https://docs.python.org/2.7/library/argparse.html#argparse.ArgumentParser.error">https://docs.python.org/2.7/library/argparse.html#argparse.ArgumentParser.error</a><br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(17:08:05)</span> <b>blin:</b></span> ugh i liked it better when you guys didn't look at my code<br/>
<span style="color: #43761b"><span style="font-size: small">(17:08:07)</span> <b>blin:</b></span> :stuck_out_tongue:<br/>
<span style="color: #c386df"><span style="font-size: small">(17:08:40)</span> <b>matyas:</b></span> lol<br/>
<span style="color: #c386df"><span style="font-size: small">(17:08:57)</span> <b>matyas:</b></span> we should switch back to svn<br/>no code reviews there :-P<br/>
<span style="color: #16569E"><span style="font-size: small">(17:09:59)</span> <b>edquist:</b></span> sorry brian<br/>
<span style="color: #16569E"><span style="font-size: small">(17:10:12)</span> <b>edquist:</b></span> feel free to make a new requirement for PRs to get merged<br/>
<span style="color: #16569E"><span style="font-size: small">(17:10:22)</span> <b>edquist:</b></span> number of reviews &lt; 1<br/>
<span style="color: #43761b"><span style="font-size: small">(17:11:31)</span> <b>blin:</b></span> lol, i think that's what it is for this repo :smile:<br/>
<span style="color: #16569E"><span style="font-size: small">(17:13:33)</span> <b>edquist:</b></span> yeah but i mean, you've gotta find a way to disallow reviews somehow<br/>
<span style="color: #43761b"><span style="font-size: small">(17:13:46)</span> <b>blin:</b></span> oh i gotcha<br/>
<span style="color: #43761b"><span style="font-size: small">(17:13:47)</span> <b>blin:</b></span> lol<br/>
<span style="color: #16569E"><span style="font-size: small">(17:13:54)</span> <b>edquist:</b></span> have your fun in a sandbox where no one can bother your cool sandcastles<br/>
<span style="color: #16569E"><span style="font-size: small">(17:22:19)</span> <b>edquist:</b></span> seems reasonable to me<br/>
<span style="color: #16569E"><span style="font-size: small">(17:22:48)</span> <b>edquist:</b></span> (to raise ValueError when there's something wrong with the value)<br/>
<span style="color: #43761b"><span style="font-size: small">(17:23:40)</span> <b>blin:</b></span> ok cool<br/>
<span style="color: #a63024"><span style="font-size: small">(17:53:02)</span> <b>efajardo:</b></span> Anyone here knows why I am gettign this error<br/>
<span style="color: #a63024"><span style="font-size: small">(17:53:05)</span> <b>efajardo:</b></span> <pre>----------- OSG Test --------------<br/>+ osg-test --extra-repo osg-testing -vad --hostcert --no-cleanup --install xrootd --install xrootd-client --install xrootd-scitokens --install globus-proxy-utils --install lcmaps --install lcmaps-db-templates --install xrootd-lcmaps --install vo-client --install vo-client-lcmaps-voms<br/>Traceback (most recent call last):<br/>  File "/usr/sbin/osg-test", line 243, in &lt;module&gt;<br/>    if run_tests(TESTS).wasSuccessful():<br/>  File "/usr/sbin/osg-test", line 198, in run_tests<br/>    test_suite = osgunittest.OSGTestLoader().loadTestsFromNames(a_argv)<br/>  File "/usr/lib64/python2.7/unittest/loader.py", line 128, in loadTestsFromNames<br/>    suites = [self.loadTestsFromName(name, module) for name in names]<br/>  File "/usr/lib64/python2.7/unittest/loader.py", line 100, in loadTestsFromName<br/>    parent, obj = obj, getattr(obj, part)<br/>AttributeError: 'module' object has no attribute 'test_465_xrootd_tpc'<br/>The command "travis-ci/setup_tests.sh" exited with 1.</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(17:53:25)</span> <b>efajardo:</b></span> the file is there <a href="https://github.com/opensciencegrid/osg-test/pull/155/files#diff-3d9786244429cd90f6c74bbaa894d044">https://github.com/opensciencegrid/osg-test/pull/155/files#diff-3d9786244429cd90f6c74bbaa894d044</a><br/>
<span style="color: #43761b"><span style="font-size: small">(18:04:35)</span> <b>blin:</b></span> Did you add the test to <tt>files/test_sequence</tt>?<br/>
<span style="color: #a63024"><span style="font-size: small">(18:05:22)</span> <b>efajardo:</b></span> yea <a href="https://github.com/opensciencegrid/osg-test/pull/155/files#diff-4465287c621a94e2d359a8b014677448">https://github.com/opensciencegrid/osg-test/pull/155/files#diff-4465287c621a94e2d359a8b014677448</a><br/>
<span style="color: #43761b"><span style="font-size: small">(18:11:41)</span> <b>blin:</b></span> one sec<br/>
<span style="color: #43761b"><span style="font-size: small">(18:16:14)</span> <b>blin:</b></span> yeah that's weird...<br/>
<span style="color: #43761b"><span style="font-size: small">(18:16:21)</span> <b>blin:</b></span> hrmmmmm<br/>
<span style="color: #43761b"><span style="font-size: small">(18:35:55)</span> <b>blin:</b></span> @efajardo there are a lot of python errors in 465<br/>
<span style="color: #43761b"><span style="font-size: small">(18:36:02)</span> <b>blin:</b></span> run it through pylint and maybe that'll fix things?<br/>
<span style="color: #43761b"><span style="font-size: small">(18:36:26)</span> <b>blin:</b></span> that's the best i've got<br/>
<span style="color: #43761b"><span style="font-size: small">(18:44:05)</span> <b>blin:</b></span> nope, that's not it<br/>
<span style="color: #43761b"><span style="font-size: small">(18:53:56)</span> <b>blin:</b></span> looks like <a href="https://travis-ci.org/brianhlin/osg-test/builds/496276893">https://travis-ci.org/brianhlin/osg-test/builds/496276893</a> somehow worked<br/>
<span style="color: #43761b"><span style="font-size: small">(18:56:14)</span> <b>blin:</b></span> so something in here fixed it: <a href="https://github.com/brianhlin/osg-test/commit/eae2f184aede27646675f0a3904273d64c5faf44">https://github.com/brianhlin/osg-test/commit/eae2f184aede27646675f0a3904273d64c5faf44</a><br/>
<span style="color: #43761b"><span style="font-size: small">(18:56:16)</span> <b>blin:</b></span> i'm not really sure what<br/>
<span style="color: #43761b"><span style="font-size: small">(18:56:53)</span> <b>blin:</b></span> ok that's enough of that, good luck<br/>
<span style="color: #a63024"><span style="font-size: small">(19:14:02)</span> <b>efajardo:</b></span> Thanks boss<br/>
<span style="color: #a63024"><span style="font-size: small">(20:30:11)</span> <b>efajardo:</b></span> ITâ€™s getting late here I will deal with the rest tomorrow<br/>
</body>
</html>
