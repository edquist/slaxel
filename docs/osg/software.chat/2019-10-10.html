<!DOCTYPE html>
<html>
<head>
<title>Thu Oct 10, 2019 : #software (osg)</title>
</head>
<body>
<h3>Thu Oct 10, 2019 : #software (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(08:42:38)</span> <b>bockjoo:</b></span> @blin With my new htcondor-ce 4.0.1, condor_ce_run works but condor_submit fails with "AUTHENTICATE:1003:Failed to authenticate with any method|AUTHENTICATE:1004:Failed to authenticate using FS"<br/>
<span style="color: #43761b"><span style="font-size: small">(08:49:13)</span> <b>blin:</b></span> @bockjoo do you mean <tt>condor_ce_submit</tt> or are you running <tt>condor_submit</tt> remotely?<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:02:40)</span> <b>bockjoo:</b></span> condor_submit remotely like condor_ce_run is run remotely.<br/>
<span style="color: #43761b"><span style="font-size: small">(09:11:13)</span> <b>blin:</b></span> could you give me the full command you're running + the submit file?<br/>
<span style="color: #e96699"><span style="font-size: small">(09:13:08)</span> <b>lincoln:</b></span> (I'd like to understand this too, I ran into similar issues when submitting locally via condor_submit + grid cert to a CE on the same machine :disappointed: )<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(09:18:08)</span> <b>blin:</b></span> do you mean <tt>condor_ce_submit</tt>?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:19:51)</span> <b>blin:</b></span> <tt>condor_ping</tt> or <tt>condor_ce_ping</tt> are useful here to figure out what auth methods you're presenting and what was actually used<br/>
<span style="color: #e96699"><span style="font-size: small">(11:58:31)</span> <b>lincoln:</b></span> <tt>condor_submit</tt><br/>
<span style="color: #e96699"><span style="font-size: small">(11:59:08)</span> <b>lincoln:</b></span> I'll ping you about it sometime soon :slightly_smiling_face: Mostly lack of understanding on my part I expect!<br/>
</blockquote>
<span style="color: #7d414c"><span style="font-size: small">(09:13:37)</span> <b>bockjoo:</b></span> ${bockjoo@new:<a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a>} more check_site_slurm.sub<br/>universe = grid<br/>grid_resource = condor <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> <a href="http://cms.rc.ufl.edu:9619">cms.rc.ufl.edu:9619</a><br/><br/>executable = check_site_slurm.sh<br/>output = check_site_slurm.out<br/>error = check_site_slurm.err<br/>log = check_site_slurm.log<br/><br/>ShouldTransferFiles = YES<br/>WhenToTransferOutput = ON_EXIT<br/><br/>use_x509userproxy = true<br/><br/>queue<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:14:03)</span> <b>bockjoo:</b></span> check_site_slurm.sh can be anything<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:14:18)</span> <b>bockjoo:</b></span> then condor_submit check_site_slurm.sub<br/>
<span style="color: #43761b"><span style="font-size: small">(09:17:50)</span> <b>blin:</b></span> what's the output from <tt>grid-proxy-info</tt> or <tt>voms-proxy-info</tt>? and is your cert mapped in the grid-mapfile or have the appropriate voms attributes?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:19:00)</span> <b>blin:</b></span> it'd be useful to run <tt>condor_ping -name <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> -pool <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> <a href="http://cms.rc.ufl.edu:9619">cms.rc.ufl.edu:9619</a> -verbose WRITE</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(09:24:29)</span> <b>blin:</b></span> Huh, cool GitHub feature<br/>&gt; Template repository<br/>&gt;<br/>&gt; Template repositories let users generate new repositories with the same directory structure and files. Indicate if opensciencegrid/osg-vo-config can be used as a template for creating other repositories.<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:29:55)</span> <b>bockjoo:</b></span> All authentication methods:  FS,SCITOKENS,GSI<br/>Remote Mapping:              <a href="mailto:cmspilot@users.htcondor.org">cmspilot@users.htcondor.org</a><br/>Authorized:                  TRUE<br/><br/>Information about authentication methods that were attempted but failed:<br/>AUTHENTICATE:1004:Failed to authenticate using FS<br/>at condor_ce_ping<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:32:01)</span> <b>bockjoo:</b></span> ${bockjoo@new:~} condor_ce_run -lr <a href="http://cms.rc.ufl.edu:9619">cms.rc.ufl.edu:9619</a> whoami<br/>cmspilot<br/>
<span style="color: #43761b"><span style="font-size: small">(09:33:14)</span> <b>blin:</b></span> could you run <tt>condor_ping</tt> instead of <tt>condor_ce_ping</tt>? and could you show me the full command + output?<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:35:43)</span> <b>bockjoo:</b></span> ${bockjoo@new:~} condor_ping -name <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> -pool <a href="http://cms.rc.ufl.edu:9619">cms.rc.ufl.edu:9619</a> -verbose WRITE<br/>WRITE failed!<br/>AUTHENTICATE:1003:Failed to authenticate with any method<br/>AUTHENTICATE:1004:Failed to authenticate using FS<br/>
<span style="color: #43761b"><span style="font-size: small">(09:38:56)</span> <b>blin:</b></span> try <tt>_condor_SEC_CLIENT_AUTHENTICATION_METHODS=GSI condor_ping -name <a href="http://cms.rc.ufl.edu">cms.rc.ufl.edu</a> -pool <a href="http://cms.rc.ufl.edu:9619">cms.rc.ufl.edu:9619</a> -verbose WRITE</tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(10:23:23)</span> <b>bockjoo:</b></span> That worked!<br/>
<span style="color: #43761b"><span style="font-size: small">(10:24:17)</span> <b>blin:</b></span> i'd be surprised if the htcondor-ce update was the culprit here<br/>
<span style="color: #43761b"><span style="font-size: small">(10:24:44)</span> <b>blin:</b></span> because the client needs to be configured to request GSI authentication<br/>
<span style="color: #43761b"><span style="font-size: small">(10:25:29)</span> <b>blin:</b></span> htcondor-ce still presents GSI auth as an option, that hasn't changed, but if the client doesn't request it then the CE can't do anything about it ¯\_(ツ)_/¯<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:26:38)</span> <b>bockjoo:</b></span> How do I present it with the submit file?<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:27:20)</span> <b>bockjoo:</b></span> pilots are running though.<br/>
<span style="color: #43761b"><span style="font-size: small">(10:28:53)</span> <b>blin:</b></span> htcondor doesn't get that info from the submit file, it has to be configured in HTCondor<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:29:23)</span> <b>bockjoo:</b></span> Another thing is that I have a dynamic worker node temp direcotry. There had been no other way to set it dynamic but to hack it.<br/>
<span style="color: #43761b"><span style="font-size: small">(10:29:28)</span> <b>blin:</b></span> set <tt>SEC_CLIENT_AUTHENTICATION_METHODS = $(SEC_CLIENT_AUTHENTICATION_METHODS), GSI</tt> somewhere in <tt>/etc/condor/config.d/</tt> on your client host<br/>
<span style="color: #43761b"><span style="font-size: small">(10:30:22)</span> <b>blin:</b></span> the dynamic WN dir has to be configured on the CE<br/>
<span style="color: #43761b"><span style="font-size: small">(10:30:26)</span> <b>blin:</b></span> are you using it for OSG_WN_TMP?<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:30:34)</span> <b>bockjoo:</b></span> Yes<br/>
<span style="color: #43761b"><span style="font-size: small">(10:30:44)</span> <b>blin:</b></span> you should be able to do that via osg-configure<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:32:13)</span> <b>bockjoo:</b></span> The OSG_WN_TMP changes depending on the jobid. I don't see how it can be done in 10-storage.ini<br/>
<span style="color: #43761b"><span style="font-size: small">(10:32:32)</span> <b>blin:</b></span> <a href="https://opensciencegrid.org/docs/other/configuration-with-osg-configure/#local-settings">https://opensciencegrid.org/docs/other/configuration-with-osg-configure/#local-settings</a><br/>
<span style="color: #43761b"><span style="font-size: small">(10:33:19)</span> <b>blin:</b></span> i think somehow we lost the documenation on this...<br/>
<span style="color: #43761b"><span style="font-size: small">(10:34:41)</span> <b>blin:</b></span> but if each worker node has an env var <tt>$DNYAMIC_WN_TMP</tt>, then you should be able to set<br/><pre><br/>[Storage]<br/>worker_node_temp = $DYNAMIC_WN_TMP<br/></pre><br/>
<span style="color: #7d414c"><span style="font-size: small">(10:39:41)</span> <b>bockjoo:</b></span> OK I will try that. Thanks!<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:24:44)</span> <b>bbockelm:</b></span> @blin - I think that is possibly an overlooked issue in the updated HTCondor-CE 4.<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:25:00)</span> <b>bbockelm:</b></span> Probably <tt>GSI</tt> got knocked off the list and <tt>FS</tt> is only allowed for daemon-like things.<br/>
<span style="color: #43761b"><span style="font-size: small">(11:26:55)</span> <b>blin:</b></span> yeah, for submission on the CE host it looks like we dropped a line<br/>
<span style="color: #43761b"><span style="font-size: small">(11:28:56)</span> <b>blin:</b></span> <a href="https://opensciencegrid.atlassian.net/browse/SOFTWARE-3856">https://opensciencegrid.atlassian.net/browse/SOFTWARE-3856</a><br/>
<span style="color: #43761b"><span style="font-size: small">(11:44:27)</span> <b>blin:</b></span> @bbockelm <a href="https://github.com/htcondor/htcondor-ce/pull/257">https://github.com/htcondor/htcondor-ce/pull/257</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(11:46:19)</span> <b>andrew.melo:</b></span>  None of this changes that osg-configure is writing config files that are later parsed by different packages. If you want to do X w/o osg-configure, then you can just check to see which confit files are changed. I had some issues with osg-configure early on when trying to put the CEs into config management directly, so I just ran it once, uploaded the resulting configs to CFE, and distribute the resulting configs to our hosts instead of running osg-configure on the production hosts themselves<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(2019-10-10 08:50:51)</span> <b>blin:</b></span> @andrew.melo osg-configure sets vars and exports in <tt>/var/lib/osg/osg-job-environment.conf</tt>, which HTCondor-CE parses and passes onto the underlying batch system<br/>
<span style="color: #43761b"><span style="font-size: small">(2019-10-10 08:51:58)</span> <b>blin:</b></span> that being said, i'm curious if they have the same missing PATH problem with manual submission. Because HTCondor-CE shouldn't override the PATH if it's not set in the <tt>osg-job-environment.conf</tt><br/>
<span style="color: #a72f79"><span style="font-size: small">(2019-10-10 11:46:19)</span> <b>andrew.melo:</b></span>  None of this changes that osg-configure is writing config files that are later parsed by different packages. If you want to do X w/o osg-configure, then you can just check to see which confit files are changed. I had some issues with osg-configure early on when trying to put the CEs into config management directly, so I just ran it once, uploaded the resulting configs to CFE, and distribute the resulting configs to our hosts instead of running osg-configure on the production hosts themselves<br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(11:47:18)</span> <b>blin:</b></span> @matyas ^^ that osg-configure dry run idea sounds like a popular one :smile:<br/>
<span style="color: #7d414c"><span style="font-size: small">(12:01:54)</span> <b>bockjoo:</b></span> @blin SEC_CLIENT_AUTHENTICATION_METHODS = $(SEC_CLIENT_AUTHENTICATION_METHODS), GSI causes AUTH failure:<br/>
<span style="color: #7d414c"><span style="font-size: small">(12:02:13)</span> <b>bockjoo:</b></span> [root@newberry ~]# cat /etc/condor/config.d/99-local.conf<br/>#SEC_CLIENT_AUTHENTICATION_METHODS = GSI<br/>SEC_CLIENT_AUTHENTICATION_METHODS = $(SEC_CLIENT_AUTHENTICATION_METHODS), GSI<br/>[root@newberry ~]# systemctl restart condor<br/>[root@newberry ~]# sleep 1m ; condor_q<br/><br/>-- Failed to fetch ads from: &lt;128.227.221.6:10374&gt; : <a href="http://newberry.ihepa.ufl.edu">newberry.ihepa.ufl.edu</a><br/>AUTHENTICATE:1003:Failed to authenticate with any method<br/>
<span style="color: #43761b"><span style="font-size: small">(12:02:57)</span> <b>blin:</b></span> hrm, that's a little bizarre. what's <tt>condor_config_val -v SEC_CLIENT_AUTHENTICATION_METHODS</tt> give you?<br/>
<span style="color: #7d414c"><span style="font-size: small">(12:08:45)</span> <b>bockjoo:</b></span> [root@newberry ~]# condor_config_val -v SEC_CLIENT_AUTHENTICATION_METHODS<br/>SEC_CLIENT_AUTHENTICATION_METHODS = , GSI<br/> # at: /etc/condor/config.d/99-local.conf, line 2<br/> # raw: SEC_CLIENT_AUTHENTICATION_METHODS = , GSI<br/>
<span style="color: #7d414c"><span style="font-size: small">(12:09:06)</span> <b>bockjoo:</b></span> Do I need a default SEC_CLIENT_AUTHENTICATION_METHODS?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:15:29)</span> <b>blin:</b></span> could you try setting the following instead?<br/><pre><br/>SEC_CLIENT_AUTHENTICATION_METHODS = $(SEC_CLIENT_AUTHENTICATION_METHODS) FS GSI<br/></pre><br/>
<span style="color: #7d414c"><span style="font-size: small">(12:21:22)</span> <b>bockjoo:</b></span> That worked!<br/>
<span style="color: #43761b"><span style="font-size: small">(12:26:44)</span> <b>blin:</b></span> :thumbsup:<br/>
</body>
</html>
