<!DOCTYPE html>
<html>
<head>
<title>Wed Aug 22, 2018 : #software (osg)</title>
</head>
<body>
<h3>Wed Aug 22, 2018 : #software (osg)</h3>
<span style="color: #235e5b"><span style="font-size: small">(08:06:09)</span> <b>dweitzel:</b></span> @efajardo the error on the client will be in /var/log/messages<br/>
<span style="color: #235e5b"><span style="font-size: small">(08:06:28)</span> <b>dweitzel:</b></span> And there will probably be an error on the server. <br/>
<span style="color: #a63024"><span style="font-size: small">(11:14:55)</span> <b>efajardo:</b></span> The error in <tt>/var/log/messages</tt> in the client was<br/>
<span style="color: #a63024"><span style="font-size: small">(11:14:59)</span> <b>efajardo:</b></span> <pre>96.gwf (hash: ab77ebb5dc717fcfcc9b3f9109013579a04f4daa, error 7 [host connection problem])<br/>Aug 21 16:12:44 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 21 16:12:44 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 21 16:12:44 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) failed to fetch Part of /frames/O2/hoft_C02_clean/L1/L-L1_CLEANED_HOFT_C02-11877/L-L1_CLEANED_HOFT_C02-1187716053-4096.gwf (hash: ab77ebb5dc717fcfcc9b3f9109013579a04f4daa, error 7 [host connection problem])</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(11:19:23)</span> <b>efajardo:</b></span> @dweitzel<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:59:35)</span> <b>dweitzel:</b></span> so the client doesn't trust the cert on the cache.<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:59:48)</span> <b>dweitzel:</b></span> is osg-ca-certs installed?<br/>
<span style="color: #a63024"><span style="font-size: small">(12:27:06)</span> <b>efajardo:</b></span> yep<br/>
<span style="color: #a63024"><span style="font-size: small">(12:27:10)</span> <b>efajardo:</b></span> on both the client and th<br/>
<span style="color: #a63024"><span style="font-size: small">(12:36:45)</span> <b>efajardo:</b></span> On the server side everything looks good<br/>
<span style="color: #a63024"><span style="font-size: small">(12:36:47)</span> <b>efajardo:</b></span> <pre>180822 17:36:02 038 XrdProtocol: matched protocol http<br/>INFO in AuthzFun: Lookup with key /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu::osg:/osg/ligo,::<br/>lcmaps[25]    LOG_INFO: 2018-08-22.17:36:02Z: Starting policy: xrootd_policy<br/>lcmaps[25]    LOG_INFO: 2018-08-22.17:36:02Z: lcmaps_gridmapfile: Found mapping ligo for "/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu" (line 706)<br/>lcmaps[25]    LOG_INFO: 2018-08-22.17:36:02Z: lcmaps_localaccount-plugin_run(): localaccount plugin succeeded<br/>lcmaps[25]    LOG_INFO: 2018-08-22.17:36:02Z: lcmaps_dummy_good-plugin_run(): good plugin succeeded<br/>lcmaps[25]  LOG_NOTICE: 2018-08-22.17:36:02Z: LCMAPS CRED FINAL: DN:"/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu"-&gt;mapped uid:'1000',pgid:'1000',sgid:'1000'<br/>INFO in AuthzFun: Got uid 1000<br/>180822 17:36:02 065 XrdProtocol: matched protocol http<br/>180822 17:36:02 789 XrdProtocol: matched protocol http<br/>INFO in AuthzFun: Lookup with key /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu::osg:/osg/ligo,::<br/>INFO in AuthzFun: Using cached entity with username ligo<br/>180822 17:36:04 788 XrdProtocol: matched protocol http</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(12:37:17)</span> <b>blin:</b></span> how about CRLs?<br/>
<span style="color: #a63024"><span style="font-size: small">(12:38:18)</span> <b>efajardo:</b></span> ran it<br/>
<span style="color: #a63024"><span style="font-size: small">(12:38:26)</span> <b>efajardo:</b></span> in both service an cleint<br/>
<span style="color: #a63024"><span style="font-size: small">(12:38:38)</span> <b>efajardo:</b></span> And the cert looks good<br/>
<span style="color: #a63024"><span style="font-size: small">(12:38:40)</span> <b>efajardo:</b></span> <pre>[root@xcache-11 xrd]# openssl x509 -in xrdcert.pem -noout -subject -enddate<br/>subject= /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=<a href="http://test-012.t2.ucsd.edu">test-012.t2.ucsd.edu</a><br/>notAfter=Oct 25 20:30:34 2018 GMT</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(12:40:57)</span> <b>efajardo:</b></span> I wonder<br/>
<span style="color: #a63024"><span style="font-size: small">(12:41:15)</span> <b>efajardo:</b></span> @dwd Can CVMFS complain cause the hostname and the hostcer do not match<br/>
<span style="color: #a63024"><span style="font-size: small">(12:41:21)</span> <b>efajardo:</b></span> <pre>Aug 22 10:40:10 osg-ligo-1 kernel: type=1400 audit(1534959610.665:216): avc:  denied  { sys_chroot } for  pid=2074906 comm="cvmfs_x509_help" capability=18  scontext=unconfined_u:system_r:mount_t:s0 tcontext=unconfined_u:system_r:mount_t:s0 tclass=capability<br/>Aug 22 10:40:10 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 22 10:40:11 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 22 10:40:11 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) failed to fetch Part of /frames/O2/hoft_C02_clean/L1/L-L1_CLEANED_HOFT_C02-11877/L-L1_CLEANED_HOFT_C02-1187716053-4096.gwf (hash: ab77ebb5dc717fcfcc9b3f9109013579a04f4daa, error 7 [host connection problem])<br/>Aug 22 10:40:11 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 22 10:40:12 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) invalid SSL certificate of remote host. X509_CERT_DIR might point to the wrong directory.<br/>Aug 22 10:40:12 osg-ligo-1 cvmfs2: (<a href="http://ligo.osgstorage.org">ligo.osgstorage.org</a>) failed to fetch Part of /frames/O2/hoft_C02_clean/L1/L-L1_CLEANED_HOFT_C02-11877/L-L1_CLEANED_HOFT_C02-1187716053-4096.gwf (hash: ab77ebb5dc717fcfcc9b3f9109013579a04f4daa, error 7 [host connection problem])</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(12:41:26)</span> <b>efajardo:</b></span> Is there a way to make this more verbose?<br/>
<span style="color: #99a949"><span style="font-size: small">(12:45:31)</span> <b>dwd:</b></span> Certainly the hostname and hostcert have to match.  That’s a requirement on all SSL clients<br/>
<span style="color: #99a949"><span style="font-size: small">(12:46:36)</span> <b>dwd:</b></span> You can get more details out of the cvmfs client by setting CVMFS_DEBUGLOG=/tmp/cvmfsdebug.log in config.d/ligo.osgstorage.org.local and remounting /cvmfs/ligo.osgstorage.org<br/>
<span style="color: #99a949"><span style="font-size: small">(12:47:31)</span> <b>dwd:</b></span> The hostcert may have multiple Subject Alternate Names (SANs), but clients have to check that the name they requested matches one of them.<br/>
<span style="color: #a63024"><span style="font-size: small">(12:54:08)</span> <b>efajardo:</b></span> Ahh ok<br/>
<span style="color: #a63024"><span style="font-size: small">(12:54:36)</span> <b>efajardo:</b></span> thank you @dwd how can you add  Subject Alternate Names to an existing hostcert?<br/>
<span style="color: #99a949"><span style="font-size: small">(12:55:18)</span> <b>dwd:</b></span> You can’t, they have to be issued by a CA<br/>
<span style="color: #a63024"><span style="font-size: small">(12:55:25)</span> <b>efajardo:</b></span> ahh ok<br/>
<span style="color: #99a949"><span style="font-size: small">(12:56:36)</span> <b>dwd:</b></span> Some SSL clients have ways for you to tell it to expect a different hostcert than the one requested, but I don’t think cvmfs has that feature<br/>
<span style="color: #a63024"><span style="font-size: small">(12:57:11)</span> <b>efajardo:</b></span> hmm ok then I will have to think what to do since I was planning to reuse same cert for lots of caches deployed with k8s<br/>
<span style="color: #99a949"><span style="font-size: small">(12:57:26)</span> <b>dwd:</b></span> And of course the OSG CA is shut down …<br/>
<span style="color: #a63024"><span style="font-size: small">(12:57:31)</span> <b>efajardo:</b></span> Yea<br/>
<span style="color: #99a949"><span style="font-size: small">(12:57:45)</span> <b>dwd:</b></span> The recommended replacement I believe is letsencrypt<br/>
<span style="color: #a63024"><span style="font-size: small">(13:01:08)</span> <b>efajardo:</b></span> Terrence told me he has being using inCoommon at UCSD<br/>
<span style="color: #a63024"><span style="font-size: small">(13:01:21)</span> <b>efajardo:</b></span> I will try to see if he can order one hostcert for me<br/>
<span style="color: #a63024"><span style="font-size: small">(13:01:25)</span> <b>efajardo:</b></span> with SAN<br/>
<span style="color: #a63024"><span style="font-size: small">(13:01:29)</span> <b>efajardo:</b></span> for all of it<br/>
<span style="color: #43761b"><span style="font-size: small">(14:11:29)</span> <b>blin:</b></span> @efajardo shawn just mentioned on the AC call that they're using let's encrypt for certs with SANs for perfsonar stuff<br/>
<span style="color: #a63024"><span style="font-size: small">(14:11:41)</span> <b>efajardo:</b></span> yea<br/>
<span style="color: #a63024"><span style="font-size: small">(14:11:55)</span> <b>efajardo:</b></span> I think I have to contact John at Internet 2<br/>
<span style="color: #a63024"><span style="font-size: small">(14:11:59)</span> <b>efajardo:</b></span> to deal with that<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:14:55)</span> <b>andrew.melo:</b></span> oh hell yeah, MATLAB load time went from ~3 minutes to 10 secs by going to CVMFS<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:14:58)</span> <b>andrew.melo:</b></span> xo, thanks guys<br/>
</body>
</html>
