<!DOCTYPE html>
<html>
<head>
<title>Wed Jan 29, 2020 : #software (osg)</title>
</head>
<body>
<h3>Wed Jan 29, 2020 : #software (osg)</h3>
<span style="color: #b14cbc"><span style="font-size: small">(11:52:35)</span> <b>tmartin:</b></span> So, I am getting the following error on one of my gridftp doors. As far as I can tell the software is identical to other systems and it just kind of went funny. Restarts have no effect.<br/><br/><pre>[0948] tmartin@uaf-7 ~$ gfal-copy -v -f /home/users/tmartin/test.file gsi<a href="ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root">ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root</a><br/>Copying 419430400 bytes file:///home/users/tmartin/test.file =&gt; gsi<a href="ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root">ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root</a><br/>event: [1580320262999] BOTH   GFAL2:CORE:COPY	LIST:ENTER	<br/>event: [1580320262999] BOTH   GFAL2:CORE:COPY	LIST:ITEM	file:///home/users/tmartin/test.file =&gt; gsi<a href="ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root">ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root</a><br/>event: [1580320262999] BOTH   GFAL2:CORE:COPY	LIST:EXIT	<br/>event: [1580320263077] DEST   GFAL2:CORE:COPY:LOCAL	OVERWRITE	Deleted gsi<a href="ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root">ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root</a><br/>event: [1580320263077] BOTH   GFAL2:CORE:COPY:LOCAL	TRANSFER:ENTER	file:///home/users/tmartin/test.file =&gt; gsi<a href="ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root">ftp://gftp-3.t2.ucsd.edu:2811/cms/store/user/tmartin/test-77.root</a><br/>event: [1580320263077] BOTH   GFAL2:CORE:COPY:LOCAL	TRANSFER:TYPE	streamed<br/>gfal-copy error: 70 (Communication error on send) - globus_xio: System error in send: Connection reset by peer globus_xio: A system call failed: Connection reset by peer </pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(11:52:42)</span> <b>tmartin:</b></span> That is the client side<br/>
<span style="color: #b14cbc"><span style="font-size: small">(11:54:17)</span> <b>tmartin:</b></span> Server<br/>
<span style="color: #b14cbc"><span style="font-size: small">(11:54:36)</span> <b>tmartin:</b></span> <pre>ed: ignored.<br/>Jan 29 09:53:45 gftp-3 gridftp-server-llgt[24538]: lcmaps: verify_log: Warning:    Deprecated signature algorithm: sha1WithRSAEncryption (=1.2.840.113549.1.1.5)<br/>Jan 29 09:53:45 gftp-3 gridftp-server-llgt[24538]: Callout to "LCMAPS" returned local user (service file): "uscms"<br/>Jan 29 09:53:45 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 09:53:45 gftp-3 gridftp-server-llgt[24543]: lcmaps: verify_log: Warning:    Deprecated signature algorithm: sha1WithRSAEncryption (=1.2.840.113549.1.1.5)<br/>Jan 29 09:53:45 gftp-3 gridftp-server-llgt[24543]: Callout to "LCMAPS" returned local user (service file): "uscms"<br/>Jan 29 09:53:46 gftp-3 gridftp-server-llgt[24559]: lcmaps: verify_log: Warning:    Deprecated signature algorithm: sha1WithRSAEncryption (=1.2.840.113549.1.1.5)<br/>Jan 29 09:53:46 gftp-3 gridftp-server-llgt[24559]: Callout to "LCMAPS" returned local user (service file): "uscms"<br/>Jan 29 09:53:47 gftp-3 globus-gridftp-server-start: SEGV triggered in native code.<br/>Jan 29 09:53:47 gftp-3 globus-gridftp-server-start: /usr/lib64/libglobus_gridftp_server_hdfs.so(segv_handler+0x3e)[0x7fee142d741e]<br/>Jan 29 09:53:47 gftp-3 globus-gridftp-server-start: /lib64/libc.so.6(+0x363b0)[0x7fee1a6423b0]<br/>Jan 29 09:53:47 gftp-3 globus-gridftp-server-start: [0x7fee0c389b5b]<br/>Jan 29 09:53:49 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(12:01:33)</span> <b>matyas:</b></span> we're investigating an issue with the latest CA cert bundle. Try downgrading your ca certs package?<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:09:24)</span> <b>tmartin:</b></span> I tried copying the certs over from another host that is working, but I guess I can do that.<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:12:04)</span> <b>tmartin:</b></span> What version?<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:12:14)</span> <b>tmartin:</b></span> I downgraded once, no help, still get the error<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:12:22)</span> <b>tmartin:</b></span> <pre>gfal-copy error: 70 (Communication error on send) - globus_xio: System error in send: Connection reset by peer globus_xio: A system call failed: Connection reset by peer </pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:12:47)</span> <b>tmartin:</b></span> <pre>Jan 29 10:12:36 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:12:36 gftp-3 gridftp-server-llgt[11464]: Callout to "LCMAPS" returned local user (service file): "tmartin"<br/>Jan 29 10:12:38 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:12:39 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:12:39 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:12:39 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:12:40 gftp-3 globus-gridftp-server-start: SEGV triggered in native code.<br/>Jan 29 10:12:40 gftp-3 globus-gridftp-server-start: /usr/lib64/libglobus_gridftp_server_hdfs.so(segv_handler+0x3e)[0x7f0c8236741e]<br/>Jan 29 10:12:40 gftp-3 globus-gridftp-server-start: /lib64/libc.so.6(+0x363b0)[0x7f0c886d23b0]<br/>Jan 29 10:12:40 gftp-3 globus-gridftp-server-start: [0x7f0c7510ac1b]</pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:12:50)</span> <b>tmartin:</b></span> Has to be something with that<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:15:10)</span> <b>andrew.melo:</b></span> I think jsig.so is just a library that helps catch signals (like SIGSEGV), the error probably happened beforehand<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:17:48)</span> <b>tmartin:</b></span> <pre>Jan 29 10:17:27 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:17:28 gftp-3 gridftp-server-llgt[11618]: Callout to "LCMAPS" returned local user (service file): "tmartin"<br/>Jan 29 10:17:28 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:17:29 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:17:29 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:17:29 gftp-3 globus-gridftp-server-start: ERROR: ld.so: object 'libjsig.so' from LD_PRELOAD cannot be preloaded: ignored.<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: SEGV triggered in native code.<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: /usr/lib64/libglobus_gridftp_server_hdfs.so(segv_handler+0x3e)[0x7f521ec3541e]<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: /lib64/libc.so.6(+0x363b0)[0x7f5224fa03b0]<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: /usr/lib/jvm/java/jre/lib/amd64/server/libjvm.so(+0x611d91)[0x7f521e1dbd91]<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: /usr/lib/jvm/java/jre/lib/amd64/server/libjvm.so(+0x60a551)[0x7f521e1d4551]<br/>Jan 29 10:17:31 gftp-3 globus-gridftp-server-start: [0x7f5211020af5]</pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:17:57)</span> <b>tmartin:</b></span> That is the entire log when I attempted a transfer<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:18:25)</span> <b>jthiltges:</b></span> Which version of gridftp-hdfs are you running?<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:18:40)</span> <b>tmartin:</b></span> <pre>gridftp-hdfs-1.1.1-1.2.osg34.el7.x86_64<br/>globus-gridftp-osg-extensions-0.4-1.osg34.el7.x86_64<br/>globus-gridftp-server-13.11-1.1.osg34.el7.x86_64<br/>gfal2-plugin-gridftp-2.17.1-1.el7.x86_64<br/>globus-gridftp-server-control-8.0-1.osg34.el7.x86_64<br/>osg-gridftp-hdfs-3.4-3.osg34.el7.x86_64<br/>globus-gridftp-server-progs-13.11-1.1.osg34.el7.x86_64<br/>gratia-probe-gridftp-transfer-1.20.12-1.osg34.el7.x86_64<br/>osg-se-hadoop-gridftp-3.4-6.osg34.el7.x86_64</pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:19:43)</span> <b>tmartin:</b></span> exact same as my other doors<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:25:06)</span> <b>jthiltges:</b></span> Thanks. And also, which version of glibc?  It seems to be the same function each time. <tt>libc.so.6(+0x363b0)</tt><br/>Knowing which one might be a clue. Probably something unhelpful like <tt>free()</tt>. :stuck_out_tongue_closed_eyes:<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:25:58)</span> <b>tmartin:</b></span> <pre>glibc-debuginfo-2.17-292.el7.x86_64<br/>glibc-headers-2.17-292.el7.x86_64<br/>glibc-common-2.17-292.el7.x86_64<br/>glibc-debuginfo-common-2.17-292.el7.x86_64<br/>glibc-2.17-292.el7.x86_64<br/>glibc-devel-2.17-292.el7.x86_64<br/>glibc-2.17-292.el7.i686</pre><br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:26:07)</span> <b>tmartin:</b></span> Same as the others<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:26:15)</span> <b>tmartin:</b></span> though the debuginfo is on this host<br/>
<span style="color: #b14cbc"><span style="font-size: small">(12:30:06)</span> <b>tmartin:</b></span> It is just really weird this one host went bad.<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:32:28)</span> <b>jthiltges:</b></span> Assuming I'm looking at the right thing (<tt>objdump -d /lib64/libc.so.6</tt>), the result is unhelpful.<br/><pre>00000000000363b0 &lt;__restore_rt&gt;:</pre><br/>If it was me, I'd run <tt>rpm -Va</tt> to look for any damaged binaries. And then next try to run it under valgrind, assuming there's something causing memory corruption.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:21:55)</span> <b>bbockelm:</b></span> @blin - have you been able to reproduce the CA cert issue?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:22:03)</span> <b>bbockelm:</b></span> (or @matyas if you're looking at it...)<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:22:20)</span> <b>bbockelm:</b></span> @jbasney has been testing things and noted that OpenSSL 1.0.2 seems fine and 1.0.1 doesn't.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:23:25)</span> <b>bbockelm:</b></span> We have a potential fix - take the "new" CA bundle and add the old trust root back to it - that I'd like to have OSG-Software test.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:23:33)</span> <b>andrew.melo:</b></span> oh terriffic, so there's an openssl update in the mix too?<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:23:49)</span> <b>bbockelm:</b></span> Nah, I think it's just subtle behavior differences.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:24:20)</span> <b>andrew.melo:</b></span> My understanding of x509 is that the whole thing is just subtle differences piled on top of each other<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:24:58)</span> <b>andrew.melo:</b></span> when I was first looking into it this morning, I was convinced the problem was that the cert expired after the root's expiration. turns out, nobody actually knows if that's valid or not<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:25:02)</span> <b>bbockelm:</b></span> Andrew, have you been able to reproduce the problem?  You could probably also test the "fix" (if it's a fix...) in that case.<br/>
<span style="color: #43761b"><span style="font-size: small">(13:25:10)</span> <b>blin:</b></span> no luck reproducing it at all<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:25:24)</span> <b>andrew.melo:</b></span> @bbockelm <a href="https://lcgfts01.gridpp.rl.ac.uk:8449/var/log/fts3/2020-01-29/srm-cms.cern.ch__gridftp-vanderbilt.sites.opensciencegrid.org/2020-01-29-1754__srm-cms.cern.ch__gridftp-vanderbilt.sites.opensciencegrid.org__1795755643__66d1371a-42c0-11ea-8310-001dd8b71ccc">https://lcgfts01.gridpp.rl.ac.uk:8449/var/log/fts3/2020-01-29/srm-cms.cern.ch__gridftp-vanderbilt.sites.opensciencegrid.org/2020-01-29-1754__srm-cms.cern.ch__gridftp-vanderbilt.sites.opensciencegrid.org__1795755643__66d1371a-42c0-11ea-8310-001dd8b71ccc</a><br/>
<span style="color: #43761b"><span style="font-size: small">(13:26:00)</span> <b>blin:</b></span> just got off the phone with @stanfiem /@jteheran and we were planning on sending an announcement warning people of the issue<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:26:00)</span> <b>bbockelm:</b></span> @blin - try this combination:<br/>• Hostcert signed by InCommon IGTF CA<br/>• client with new bundle<br/>• server with old bundle<br/>• client on RHEL6 user environment.<br/>
<span style="color: #43761b"><span style="font-size: small">(13:26:13)</span> <b>blin:</b></span> but if we've got a fix, that's even better<br/>
<span style="color: #43761b"><span style="font-size: small">(13:26:24)</span> <b>blin:</b></span> roger taht<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:26:55)</span> <b>andrew.melo:</b></span> fwiw, @bbockelm -- this conversation got split to #uscms as well<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:26:57)</span> <b>bbockelm:</b></span> If we can reproduce, the "fix" would be adding the old AddTrust root CA back to the <tt>osg-ca-certs</tt> bundle.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:27:52)</span> <b>andrew.melo:</b></span> Well, doesn't help RAL...<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:28:12)</span> <b>andrew.melo:</b></span> and I still have AddTrust on my machines because i've not upgraded to the new bundle (outside of the one machine I bumped)<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:28:51)</span> <b>bbockelm:</b></span> Right - but if we can confirm the fix, then the IGTF folks can do a release -- and that would help the RAL case.<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:29:07)</span> <b>andrew.melo:</b></span> and the gWMS factories<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:30:08)</span> <b>bbockelm:</b></span> Ah - the gWMS factories are broken too?  @jdost321 - are those on RHEL6?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:30:43)</span> <b>blin:</b></span> only the CERN factories are having issues<br/>
<span style="color: #43761b"><span style="font-size: small">(13:30:58)</span> <b>blin:</b></span> OSG factories still have the old bundle and i believe they're on EL7 now<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:31:19)</span> <b>bbockelm:</b></span> Do you know the CERN factory hostname?  I can see if I have a login...<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:31:33)</span> <b>andrew.melo:</b></span> Yeah all the pilots from there are held<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:31:34)</span> <b>andrew.melo:</b></span> I don't<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:31:50)</span> <b>bbockelm:</b></span> @marco.mascheroni @marian ^^^<br/>
<span style="color: #bc3663"><span style="font-size: small">(13:32:17)</span> <b>dmason:</b></span> Or hop over to the SI slack? ;)<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:34:08)</span> <b>bbockelm:</b></span> I'm about to board a plane ... I don't think I have the SI slack on my phone.<br/>
<span style="color: #bc3663"><span style="font-size: small">(13:35:31)</span> <b>dmason:</b></span> I see you logged in there :wink:  But I will ask and see if FNAL people know anything<br/>
<span style="color: #53b759"><span style="font-size: small">(13:36:44)</span> <b>marian:</b></span> I can login to CERN factory ... what's going on? i.e. what to check?<br/>
<span style="color: #53b759"><span style="font-size: small">(13:38:03)</span> <b>marian:</b></span> (I saw email ping-pong about CA stuff, but remind me what you wanna see from CERN, held reason of  pilots for Vandy or something else?)<br/>
<span style="color: #43761b"><span style="font-size: small">(13:38:16)</span> <b>blin:</b></span> what version of openssl do they have installed?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:38:45)</span> <b>blin:</b></span> and do they have <tt>/etc/grid-security/certificates/AddTrust-External-CA-Root.pem</tt>?<br/>
<span style="color: #bc3663"><span style="font-size: small">(13:38:46)</span> <b>dmason:</b></span> From antonio:  yes and no<br/><br/>[1:38 PM]<br/>pilots from the CERN factory are not working in US sites<br/><br/>*new messages*<br/>[1:38 PM]<br/>however, they are being served by pilots coming from the other factories<br/>
<span style="color: #53b759"><span style="font-size: small">(14:05:09)</span> <b>marian:</b></span> <pre>[root@vocms0206 ~]# rpm -qa | grep openssl<br/>openssl-1.0.1e-58.el6_10.x86_64<br/>globus-gsi-openssl-error-4.1-1.el6.x86_64<br/>globus-openssl-module-5.1-1.el6.x86_64<br/>[root@vocms0206 ~]# rpm -qf /etc/grid-security/certificates/AddTrust-External-CA-Root.pem<br/>error: file /etc/grid-security/certificates/AddTrust-External-CA-Root.pem: No such file or directory</pre><br/>
<span style="color: #53b759"><span style="font-size: small">(14:05:16)</span> <b>marian:</b></span> ^^ @blin, CERN production factory, SLC 6.10<br/>
<span style="color: #43761b"><span style="font-size: small">(14:06:11)</span> <b>blin:</b></span> thanks. and yup, that's the exact combination we're seeing to reproduce the issue<br/>
<span style="color: #43761b"><span style="font-size: small">(14:06:22)</span> <b>blin:</b></span> openssl 1.0.1, missing the AddTrust CA<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:06:40)</span> <b>burt:</b></span> Is this the desired behavior to reproduce?<br/><pre>error: globus_ftp_client: the server responded with an error<br/>530 530-globus_xio: Authentication Error<br/>530-OpenSSL Error: s3_srvr.c:3327: in library: SSL routines, function ssl3_get_client_certificate: certificate verify failed<br/>530-globus_gsi_callback_module: Could not verify credential<br/>530-globus_gsi_callback_module: Can't get the local trusted CA certificate: Cannot find trusted CA certificate with hash 1b5d333 in /etc/grid-security/certificates<br/>530 End.</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(14:07:16)</span> <b>blin:</b></span> nope, that's an issue with verifying your client cert<br/>
<span style="color: #43761b"><span style="font-size: small">(14:07:38)</span> <b>blin:</b></span> 1b5d333 is the hash for the cilogon-silver cert<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:07:47)</span> <b>burt:</b></span> Ah nm.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:18:58)</span> <b>didavila:</b></span> I think I’ve hit the issue when trying to copy a file through xrootd to UCSD:<br/>curl --verbose --connect-timeout 60 -D /tmp/tmp.CMxnhdXAFd -L --capath /etc/grid-security/certificates -H ‘X-No-Delegate: true’ --cacert /tmp/x509up_u31717 -E /tmp/x509up_u31717 -H ‘Credential: none’ --speed-time 15 --speed-limit 1024 -T /bin/bash <a href="https://redirector.t2.ucsd.edu:1094//store/user/ddavila/hello-0909">https://redirector.t2.ucsd.edu:1094//store/user/ddavila/hello-0909</a><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:19:30)</span> <b>didavila:</b></span> the Error I get is the following:<br/><pre>*   CAfile: /tmp/x509up_u31717<br/>  CApath: /etc/grid-security/certificates<br/>* NSS error -8054 (SEC_ERROR_REUSED_ISSUER_AND_SERIAL)<br/>* You are attempting to import a cert with the same issuer/serial as an existing cert, but that is not the same cert.<br/>* Closing connection 0<br/>curl: (35) You are attempting to import a cert with the same issuer/serial as an existing cert, but that is not the same cert.</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:19:36)</span> <b>didavila:</b></span> is that the same issue?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:21:12)</span> <b>burt:</b></span> That looks like the other issue we saw last summer with NSS (where it read some bytes from a CRL and decided it was a CA)<br/>
<span style="color: #43761b"><span style="font-size: small">(14:22:04)</span> <b>blin:</b></span> so if you are running into an issue, it can be fixed by updating the CA bundle on the server<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:24:08)</span> <b>didavila:</b></span> the thing is that If I execute the same command from 2 different hosts, both with ‘*osg-ca*-certs-1.85-1’ and both centos 7, in one it works and in the other it doesn’t<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:24:43)</span> <b>didavila:</b></span> then, if I copy the /etc/grid-security/certificates from the failing node into the working one, I get the same error in the working one<br/>
<span style="color: #43761b"><span style="font-size: small">(14:25:47)</span> <b>blin:</b></span> are either of the hosts on EL6?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:25:54)</span> <b>didavila:</b></span> nop, both el7<br/>
<span style="color: #43761b"><span style="font-size: small">(14:27:45)</span> <b>blin:</b></span> ok, i don't think it's the same problem we're running into<br/>
<span style="color: #43761b"><span style="font-size: small">(14:28:00)</span> <b>blin:</b></span> it's kinda weird. i'd look into what the actual diffs are between the two certificate dirs<br/>
<span style="color: #43761b"><span style="font-size: small">(14:28:10)</span> <b>blin:</b></span> maybe an <tt>rpm -q --verify osg-ca-certs</tt><br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:28:15)</span> <b>burt:</b></span> Diego: If that 8054 is the error I'm thinking of it, it's (1) not related and (2) dependent on the ordering of the files in the directory that the system returns.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:28:48)</span> <b>blin:</b></span> oh, that's right<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:31:00)</span> <b>burt:</b></span> <tt>globus_gsi_callback_module: Can't get the local trusted CA certificate: Untrusted self-signed certificate in chain with hash 157753a5</tt> ?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:32:48)</span> <b>burt:</b></span> @blin: confirming (again) that this happens with an SL6 client with <tt>igtf-ca-certs-1.103-1.osg34.el6.noarch</tt> and an SL7 server with <tt>igtf-ca-certs-1.102-1.osg34.el7.noarch</tt>  and that upgrading to 103 on the server does fix the problem.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:33:36)</span> <b>blin:</b></span> hooray!<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:38:44)</span> <b>andrew.melo:</b></span> So, trying to keep up on all the things people have tested .... it seems like really the only issue is sl6 clients in this whole thing?<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:39:08)</span> <b>andrew.melo:</b></span> (Specifically because of the OpenSSL packaged in there)<br/>
<span style="color: #43761b"><span style="font-size: small">(14:46:00)</span> <b>blin:</b></span> well that + new CA bundle vs a server with an old bundle<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:53:24)</span> <b>andrew.melo:</b></span> Right, but it seems like it's only sl6 hosts so everything on sl7 is safe<br/>
<span style="color: #df3dc0"><span style="font-size: small">(14:53:51)</span> <b>burt:</b></span> SL6 clients. So things like the current FNAL FTS3 server is a problem (until the servers update, anyway).<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:54:17)</span> <b>andrew.melo:</b></span> And saying it out loud I realized there's still a shitload of CMS jobs running in sl6 containers, who probably can't stage out because they get their grid-security from CVMFS<br/>
<span style="color: #bc3663"><span style="font-size: small">(14:55:08)</span> <b>dmason:</b></span> well there we go time to finally move to SL7<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:56:15)</span> <b>andrew.melo:</b></span> It's a bit worse even, CMSSW builds and links its own OpenSSL, so even if you're on an SL7 build, it might be a not great OpenSSL<br/>
<span style="color: #43761b"><span style="font-size: small">(14:59:55)</span> <b>blin:</b></span> which certs are being used out of CVMFS. the IGTF bundle or the OSG bundle?<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:01:57)</span> <b>andrew.melo:</b></span> I'm 99.9% sure it comes from IGTF, let me look in a bit<br/>
<span style="color: #43761b"><span style="font-size: small">(15:03:19)</span> <b>blin:</b></span> hrm, we could "fix" the igft ca bundle but i'm hesitant to muck with it<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:03:26)</span> <b>andrew.melo:</b></span> I say that because i hit the problem of trying to use some other CA last summer when the OSG certs expires and I was scrambling to get Vanderbilt working<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:05:14)</span> <b>andrew.melo:</b></span> Ah yes, I tried LE certs and it bombed, so it must be the non-OSG distribution<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:24:10)</span> <b>justas.balcas:</b></span> Seems multiple issues at once. not sure if this helps, but ca-certificates update helped (for us) to get ral fts working and also cms pilot to arrive from cern factories. All our nodes are CC7 with latest openssl, latest kernel if this helps<br/>
<span style="color: #43761b"><span style="font-size: small">(16:06:41)</span> <b>blin:</b></span> @matyas test servers are ready. 399/391 are on 1.85 and 398/384 are on 1.86<br/>
<span style="color: #43761b"><span style="font-size: small">(16:10:32)</span> <b>blin:</b></span> i would expect clients of all versions to work with the above<br/>
<span style="color: #c386df"><span style="font-size: small">(16:11:10)</span> <b>matyas:</b></span> yeah everything worked<br/>
<span style="color: #43761b"><span style="font-size: small">(16:11:41)</span> <b>blin:</b></span> could you try downgrading some clients to 1.84 and giving that a swing, too?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:12:57)</span> <b>blin:</b></span> (we probably should have el6/el7 + 1.84/1.85/1.86 combos)<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:53:40)</span> <b>burt:</b></span> @blin: Same effect. SL6 1.84 client -&gt; SL7 1.85 server fails; 1.85 client is fine. (oh, you were probably asking Mat.)<br/>
<span style="color: #43761b"><span style="font-size: small">(16:54:37)</span> <b>blin:</b></span> that's really interesting, actually. how are you testing it?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:55:02)</span> <b>burt:</b></span> I :heart: docker<br/>
<span style="color: #43761b"><span style="font-size: small">(16:55:03)</span> <b>blin:</b></span> because @matyas and I have seen 1.84 EL6 clients work with 1.85 servers<br/>
<span style="color: #43761b"><span style="font-size: small">(16:55:19)</span> <b>blin:</b></span> we're testing via condor_ping atm<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:55:26)</span> <b>burt:</b></span> I'm doing a g-u-c<br/>
<span style="color: #bc3663"><span style="font-size: small">(16:57:03)</span> <b>dmason:</b></span> OK — its not just RAL FTS — I see a failing Vandy to FNAL tape fail via FNAL FTS now that our tape instance is back up again<br/>
<span style="color: #bc3663"><span style="font-size: small">(16:57:14)</span> <b>dmason:</b></span> <a href="https://cmsftssrv1.fnal.gov:8449/var/log/fts3/2020-01-29/gridftp-vanderbilt.sites.opensciencegrid.org__cmsdcatape.fnal.gov/2020-01-29-2210__gridftp-vanderbilt.sites.opensciencegrid.org__cmsdcatape.fnal.gov__78157127__1e6d525a-42e4-11ea-9ed3-a0369f23d0c0">https://cmsftssrv1.fnal.gov:8449/var/log/fts3/2020-01-29/gridftp-vanderbilt.sites.opensciencegrid.org__cmsdcatape.fnal.gov/2020-01-29-2210__gridftp-vanderbilt.sites.opensciencegrid.org__cmsdcatape.fnal.gov__78157127__1e6d525a-42e4-11ea-9ed3-a0369f23d0c0</a><br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:57:16)</span> <b>burt:</b></span> FNAL FTS is still SL6 :disappointed:<br/>
<span style="color: #bc3663"><span style="font-size: small">(16:57:28)</span> <b>dmason:</b></span> yes it is<br/>
<span style="color: #43761b"><span style="font-size: small">(16:57:40)</span> <b>blin:</b></span> is it using igtf or osg ca certs?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:57:46)</span> <b>burt:</b></span> The FNAL FTS?<br/>
<span style="color: #43761b"><span style="font-size: small">(16:57:56)</span> <b>blin:</b></span> ya<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:58:56)</span> <b>burt:</b></span> Neither<br/>
<span style="color: #43761b"><span style="font-size: small">(16:59:10)</span> <b>blin:</b></span> ah, do you guys pick and choose your CAs?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(16:59:12)</span> <b>burt:</b></span> ah wait, worng box<br/>
<span style="color: #bc3663"><span style="font-size: small">(16:59:24)</span> <b>dmason:</b></span> cmsftssrv1 is production<br/>
<span style="color: #43761b"><span style="font-size: small">(17:00:45)</span> <b>blin:</b></span> burt could you try the following on your el7 server:<br/><a href="http://koji.chtc.wisc.edu/kojifiles/work/tasks/8773/308773/osg-ca-certs-1.86-0.1.rc1.osg35.el7.noarch.rpm">http://koji.chtc.wisc.edu/kojifiles/work/tasks/8773/308773/osg-ca-certs-1.86-0.1.rc1.osg35.el7.noarch.rpm</a> or<br/><a href="http://koji.chtc.wisc.edu/kojifiles/work/tasks/8777/308777/osg-ca-certs-1.86-0.1.rc1.osg34.el7.noarch.rpm">http://koji.chtc.wisc.edu/kojifiles/work/tasks/8777/308777/osg-ca-certs-1.86-0.1.rc1.osg34.el7.noarch.rpm</a><br/>
<span style="color: #43761b"><span style="font-size: small">(17:00:53)</span> <b>blin:</b></span> for your EL6 client vs EL7 tests?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:01:49)</span> <b>burt:</b></span> sure one sec<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:02:35)</span> <b>burt:</b></span> Both 1.84 and 1.85 work to 1.86<br/>
<span style="color: #43761b"><span style="font-size: small">(17:02:49)</span> <b>blin:</b></span> ok, great<br/>
<span style="color: #43761b"><span style="font-size: small">(17:03:28)</span> <b>blin:</b></span> i wonder what globus-url-copy is doing differently compared to condor_ping in the 1.84 client/1.85 server scenario but ¯\_(ツ)_/¯<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:05:07)</span> <b>burt:</b></span> The FNAL FTS is at 1.85 as of 9:11 this morning AFAICT.<br/>
<span style="color: #43761b"><span style="font-size: small">(17:06:49)</span> <b>blin:</b></span> and it's acting as the client in this case?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:07:22)</span> <b>burt:</b></span> Yeah.  @dmason, I see successful transfers to Vanderbilt from cmsftssrv1...<br/>
<span style="color: #bc3663"><span style="font-size: small">(17:11:06)</span> <b>dmason:</b></span> I’m looking at from<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:11:36)</span> <b>burt:</b></span> Actually.. maybe these are 3rd party xfers?<br/>
<span style="color: #df3dc0"><span style="font-size: small">(17:17:37)</span> <b>burt:</b></span> So it's a bit of a mystery to me why the FNAL FTS server is still getting errors. But it's past 5 and I'm headed home.<br/>
<span style="color: #df3dc0"><span style="font-size: small">(18:03:20)</span> <b>burt:</b></span> So this is really weird. Trying the LCG utilities (<tt>gfal-ls</tt>, for example), I get failures going from SL6 1.85 to Vanderbilt, but 1.84 is OK.<br/>
<span style="color: #43761b"><span style="font-size: small">(18:04:39)</span> <b>blin:</b></span> we have 1.86 available in osg-minefield<br/>
<span style="color: #43761b"><span style="font-size: small">(18:05:05)</span> <b>blin:</b></span> that should work for any combo of other cert versions<br/>
<span style="color: #df3dc0"><span style="font-size: small">(18:09:55)</span> <b>burt:</b></span> Confirmed - SL6 1.86 gfal-ls to Vanderbilt works.<br/>
<span style="color: #df3dc0"><span style="font-size: small">(18:12:44)</span> <b>burt:</b></span> Ah, this guy is running <tt>osg-update-certs</tt> as a cron job.<br/>
<span style="color: #9e3997"><span style="font-size: small">(18:30:17)</span> <b>bbockelm:</b></span> Hi all - are we ready to declare victory to David Groep?  That'll get the 1.104 release out the door faster.<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:06:08)</span> <b>andrew.melo:</b></span> to be clear -- :2812 is the new osg-ca-cert<br/>
<span style="color: #df3dc0"><span style="font-size: small">(20:10:59)</span> <b>burt:</b></span> So maybe I had some versions crossed earlier. Now I see consistent failures from a 1.85 client to a 1.84 server (no matter if I'm running g-u-c or gfal-ls). And 1.86 is the cure. So @bbockelm I think we should get that moving ..<br/>
<span style="color: #9e3997"><span style="font-size: small">(20:11:55)</span> <b>bbockelm:</b></span> @burt - I see it in the OSG release repo.<br/>
<span style="color: #43761b"><span style="font-size: small">(20:12:17)</span> <b>blin:</b></span> Maybe it hasn't hit the mirrors yet?<br/>
<span style="color: #bc3663"><span style="font-size: small">(20:39:50)</span> <b>dmason:</b></span> I see it<br/>
<span style="color: #bc3663"><span style="font-size: small">(20:39:50)</span> <b>dmason:</b></span> Updated:<br/>  osg-ca-certs.noarch 0:1.86-1.osg34.el7<br/>
<span style="color: #bc3663"><span style="font-size: small">(20:43:29)</span> <b>dmason:</b></span> Is there an announcement in the works?<br/>
<span style="color: #43761b"><span style="font-size: small">(20:57:38)</span> <b>blin:</b></span> I believe so<br/>
<span style="color: #9e3997"><span style="font-size: small">(20:58:03)</span> <b>bbockelm:</b></span> judging by mail list traffic, the release announcement is getting fine-tuned.<br/>
<span style="color: #73769d"><span style="font-size: small">(21:11:16)</span> <b>tim.theisen:</b></span> Just sent it out<br/>
<span style="color: #bc3663"><span style="font-size: small">(21:39:53)</span> <b>dmason:</b></span> yes saw it thanks!<br/>
</body>
</html>
