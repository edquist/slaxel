<!DOCTYPE html>
<html>
<head>
<title>Fri Mar 27, 2020 : #software (osg)</title>
</head>
<body>
<h3>Fri Mar 27, 2020 : #software (osg)</h3>
<span style="color: #e96699"><span style="font-size: small">(10:45:48)</span> <b>lincoln:</b></span> yeah, this is for internal MWT2 stuff, nothing user-facing :slightly_smiling_face:<br/>
<span style="color: #de5f24"><span style="font-size: small">(11:53:01)</span> <b>justas.balcas:</b></span> Hi Folks, another issue with newest condor (8.8.8-0) (or maybe just coincidence and issue is in old release too, have not checked):<br/>We pushed latest htcondor 8.8.8-0 and also 1 small change to all cluster:<br/><pre>use feature : gpus<br/>GPU_DISCOVERY_EXTRA = -extra -dynamic<br/>MACHINE_RESOURCE_INVENTORY_GPUs = $(LIBEXEC)/condor_gpu_discovery -properties -extra -dynamic</pre><br/>After this update, STARTD_CRONs  (below) are not running anymore and not setting any ClassAds.<br/><pre># Job 'LOCALCHECK'<br/>STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) LOCALCHECK<br/>STARTD_CRON_LOCALCHECK_EXECUTABLE = $(MODULES)/condor_cron_script.sh<br/>STARTD_CRON_LOCALCHECK_PREFIX = LOCALCHECK_<br/>STARTD_CRON_LOCALCHECK_MODE = Periodic<br/>STARTD_CRON_LOCALCHECK_PERIOD = 10m<br/>STARTD_CRON_LOCALCHECK_JOB_LOAD = 0.2</pre><br/> If I comment out <tt>use feature: gpus</tt>, CRONS start to run and set the ClassAds. Is this know?<br/>
<span style="color: #de5f24"><span style="font-size: small">(11:54:13)</span> <b>justas.balcas:</b></span> or just I miss something in config …<br/>
<span style="color: #de5f24"><span style="font-size: small">(11:57:01)</span> <b>justas.balcas:</b></span> <pre>condor_config_val -dump ...<br/>STARTD_CRON_AUTOPUBLISH =<br/>STARTD_CRON_CONFIG_VAL = $(RELEASE_DIR)/bin/condor_config_val<br/>STARTD_CRON_GPUs_MONITOR_EXECUTABLE = $(LIBEXEC)/condor_gpu_utilization<br/>STARTD_CRON_GPUs_MONITOR_METRICS = SUM:GPUs, PEAK:GPUsMemory<br/>STARTD_CRON_GPUs_MONITOR_MODE = WaitForExit<br/>STARTD_CRON_GPUs_MONITOR_PERIOD = 1<br/>STARTD_CRON_JOBLIST =  LOCALCHECK GPUs_MONITOR GPUs_MONITOR<br/>STARTD_CRON_LOCALCHECK_EXECUTABLE = $(MODULES)/condor_cron_script.sh<br/>STARTD_CRON_LOCALCHECK_JOB_LOAD = 0.2<br/>STARTD_CRON_LOCALCHECK_MODE = Periodic<br/>STARTD_CRON_LOCALCHECK_PERIOD = 10m<br/>STARTD_CRON_LOCALCHECK_PREFIX = LOCALCHECK_<br/>STARTD_CRON_MAX_JOB_LOAD = 0.2<br/>STARTD_CRON_NAME =</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(12:05:43)</span> <b>marco.mascheroni:</b></span> Have the GWMS cron been overwritten?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:23:38)</span> <b>blin:</b></span> @matyas can you check the above with TJ?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:23:48)</span> <b>blin:</b></span> @justas.balcas what version did you upgrade from?<br/>
<span style="color: #c386df"><span style="font-size: small">(12:26:05)</span> <b>matyas:</b></span> What's the output of <tt>condor_config_val use feature:gpus</tt> ?<br/>
<span style="color: #43761b"><span style="font-size: small">(12:28:10)</span> <b>blin:</b></span> also if this turns into an actual issue let's make a GGUS ticket this time :slightly_smiling_face:<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:32:50)</span> <b>justas.balcas:</b></span> from 8.6.12 to 8.8.8<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:33:19)</span> <b>justas.balcas:</b></span> <pre>[root@blade-20 ~]# condor_config_val use feature:gpus<br/>use FEATURE:GPUs is<br/>	MACHINE_RESOURCE_INVENTORY_GPUs=$(LIBEXEC)/condor_gpu_discovery -properties $(GPU_DISCOVERY_EXTRA)<br/>	ENVIRONMENT_FOR_AssignedGPUs=GPU_DEVICE_ORDINAL=/(CUDA|OCL)//  CUDA_VISIBLE_DEVICES<br/>	ENVIRONMENT_VALUE_FOR_UnAssignedGPUs=10000<br/><br/>	use feature : GPUsMonitor</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(12:35:46)</span> <b>matyas:</b></span> what about <tt>condor_config_val use feature:GPUsMonitor</tt>?<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:36:48)</span> <b>justas.balcas:</b></span> <pre>[root@blade-20 ~]# condor_config_val use feature:GPUsMonitor<br/>use FEATURE:GPUsMonitor is<br/>	use feature : Monitor( GPUs, WaitForExit, 1, $(LIBEXEC)/condor_gpu_utilization, SUM:GPUs, PEAK:GPUsMemory )</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(12:38:15)</span> <b>matyas:</b></span> use feature's all the way down...<br/>
<span style="color: #c386df"><span style="font-size: small">(12:38:24)</span> <b>matyas:</b></span> what about <tt>condor_config_val use feature:monitor</tt>?<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:45:13)</span> <b>justas.balcas:</b></span> <pre>[root@blade-20 ~]# condor_config_val use feature:monitor<br/>use FEATURE:Monitor is<br/>	if ! $(5?)<br/>		error: use feature : monitor requires five or more arguments<br/>	endif<br/><br/>	STARTD_CRON_JOBLIST = $(STARTD_CRON_JOBLIST) $(1)_MONITOR<br/>	STARTD_CRON_$(1)_MONITOR_MODE = $(2)<br/>	STARTD_CRON_$(1)_MONITOR_PERIOD = $(3)<br/>	STARTD_CRON_$(1)_MONITOR_EXECUTABLE = $(4)<br/>	STARTD_CRON_$(1)_MONITOR_METRICS = $(5+)</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(12:53:54)</span> <b>matyas:</b></span> what happens if you comment out <tt>use feature:GPUS</tt>  and replace it with this:<br/><pre>MACHINE_RESOURCE_INVENTORY_GPUs=$(LIBEXEC)/condor_gpu_discovery -properties $(GPU_DISCOVERY_EXTRA)<br/>ENVIRONMENT_FOR_AssignedGPUs=GPU_DEVICE_ORDINAL=/(CUDA|OCL)//  CUDA_VISIBLE_DEVICES<br/>ENVIRONMENT_VALUE_FOR_UnAssignedGPUs=10000</pre><br/>(i.e. same thing but without <tt>use feature : GPUsMonitor</tt>)<br/>
<span style="color: #de5f24"><span style="font-size: small">(13:10:48)</span> <b>justas.balcas:</b></span> yes, it works once I disable <tt>all use feature…</tt><br/>
<span style="color: #de5f24"><span style="font-size: small">(13:11:14)</span> <b>justas.balcas:</b></span> let me test this on gpu machine<br/>
<span style="color: #de5f24"><span style="font-size: small">(13:13:26)</span> <b>justas.balcas:</b></span> all good, startd crons are running and adds classads, same as for gpu. So what is the issue here? use feature deadlock?<br/>
<span style="color: #c386df"><span style="font-size: small">(13:14:59)</span> <b>matyas:</b></span> I'll have to experiment.<br/>
<span style="color: #c386df"><span style="font-size: small">(14:45:24)</span> <b>matyas:</b></span> Can you do <tt>condor_config_val -dump | grep -i cron</tt> ?<br/>
<span style="color: #de5f24"><span style="font-size: small">(14:50:52)</span> <b>justas.balcas:</b></span> <pre>[root@blade-20 ~]# condor_config_val -dump | grep -i cron<br/>SCHEDD_CRON_NAME =<br/>STARTD_CRON_AUTOPUBLISH =<br/>STARTD_CRON_CONFIG_VAL = $(RELEASE_DIR)/bin/condor_config_val<br/>STARTD_CRON_GPUs_MONITOR_EXECUTABLE = $(LIBEXEC)/condor_gpu_utilization<br/>STARTD_CRON_GPUs_MONITOR_METRICS = SUM:GPUs, PEAK:GPUsMemory<br/>STARTD_CRON_GPUs_MONITOR_MODE = WaitForExit<br/>STARTD_CRON_GPUs_MONITOR_PERIOD = 1<br/>STARTD_CRON_JOBLIST =  LOCALCHECK GPUs_MONITOR GPUs_MONITOR<br/>STARTD_CRON_LOCALCHECK_EXECUTABLE = $(MODULES)/condor_cron_script.sh<br/>STARTD_CRON_LOCALCHECK_JOB_LOAD = 0.2<br/>STARTD_CRON_LOCALCHECK_MODE = Periodic<br/>STARTD_CRON_LOCALCHECK_PERIOD = 10m<br/>STARTD_CRON_LOCALCHECK_PREFIX = LOCALCHECK_<br/>STARTD_CRON_MAX_JOB_LOAD = 0.2<br/>STARTD_CRON_NAME =<br/>#	/etc/condor/config.d/25-cron.config</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(14:53:07)</span> <b>matyas:</b></span> I wonder why GPUs_MONITOR is in there twice<br/>
<span style="color: #c386df"><span style="font-size: small">(14:53:44)</span> <b>matyas:</b></span> and this is the working config?<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:27:02)</span> <b>justas.balcas:</b></span> No, that is not working config.<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:27:32)</span> <b>justas.balcas:</b></span> this below is working one:<br/><pre>[root@blade-20 condor]# condor_config_val -dump | grep -i cron<br/>SCHEDD_CRON_NAME =<br/>STARTD_CRON_AUTOPUBLISH =<br/>STARTD_CRON_CONFIG_VAL = $(RELEASE_DIR)/bin/condor_config_val<br/>STARTD_CRON_JOBLIST =  LOCALCHECK<br/>STARTD_CRON_LOCALCHECK_EXECUTABLE = $(MODULES)/condor_cron_script.sh<br/>STARTD_CRON_LOCALCHECK_JOB_LOAD = 0.2<br/>STARTD_CRON_LOCALCHECK_MODE = Periodic<br/>STARTD_CRON_LOCALCHECK_PERIOD = 10m<br/>STARTD_CRON_LOCALCHECK_PREFIX = LOCALCHECK_<br/>STARTD_CRON_MAX_JOB_LOAD = 0.2<br/>STARTD_CRON_NAME =<br/>#	/etc/condor/config.d/25-cron.config</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(15:30:48)</span> <b>matyas:</b></span> OK. I'm on a meeting right now, but I'll ask one of the condor developers if he has any ideas.<br/>
<span style="color: #c386df"><span style="font-size: small">(16:18:26)</span> <b>matyas:</b></span> check /var/log/condor/StartLog, see if there's any indication why the job didn't run<br/>
<span style="color: #c386df"><span style="font-size: small">(16:25:44)</span> <b>matyas:</b></span> maybe condor doesn't start the job because the load crossed its threshold. Try setting <tt>STARTD_CRON_LOCALCHECK_JOB_LOAD=1.0</tt> and <tt>STARTD_CRON_MAX_JOB_LOAD=1.0</tt><br/>
<span style="color: #c386df"><span style="font-size: small">(16:37:41)</span> <b>matyas:</b></span> can you just send me the StartLog on one of the affected machines?<br/>
</body>
</html>
