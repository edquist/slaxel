<!DOCTYPE html>
<html>
<head>
<title>Mon Feb 10, 2020 : #software (osg)</title>
</head>
<body>
<h3>Mon Feb 10, 2020 : #software (osg)</h3>
<span style="color: #c386df"><span style="font-size: small">(09:43:19)</span> <b>matyas:</b></span> @bbockelm turned out to be the lack of a trailing newline<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:43:33)</span> <b>bbockelm:</b></span> eek<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:43:39)</span> <b>bbockelm:</b></span> well that's a bug!<br/>
<span style="color: #c386df"><span style="font-size: small">(09:43:52)</span> <b>matyas:</b></span> it's in good company<br/>
<span style="color: #c386df"><span style="font-size: small">(09:44:03)</span> <b>matyas:</b></span> it's 2020 and openssl still barfs on DOS line endings<br/>
<span style="color: #43761b"><span style="font-size: small">(09:45:34)</span> <b>blin:</b></span> didn't we already fix this bug or was that just for scitokens?<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:45:41)</span> <b>bbockelm:</b></span> did you get a chance to file a condor ticket?<br/>
<span style="color: #c386df"><span style="font-size: small">(09:46:08)</span> <b>matyas:</b></span> I think Mats said he did<br/>
<span style="color: #c386df"><span style="font-size: small">(09:46:12)</span> <b>matyas:</b></span> or at least emailed the devs<br/>
<span style="color: #73769d"><span style="font-size: small">(10:31:31)</span> <b>tim.theisen:</b></span> Mats said the he would email the devs. The HTCondor team hasn't seen anything. So, it would probably be best to create a ticket.<br/>
<span style="color: #43761b"><span style="font-size: small">(10:33:10)</span> <b>blin:</b></span> before we do that, let's just make sure it's not just sitting in @rynge's drafts<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:57:14)</span> <b>rynge:</b></span> I did email<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:57:42)</span> <b>rynge:</b></span> <pre>[htcondor-admin #99599]</pre><br/><br/>
<span style="color: #a63024"><span style="font-size: small">(14:38:26)</span> <b>paschos:</b></span> <b>@here</b> we have a question from an admin that is in the process of configuring squid for a machine in europe.. see below:<br/>I have to set this configuration parameter:<br/><br/>CVMFS_HTTP_PROXY="&lt;SQUID URL&gt;:&lt;SQUID PORT&gt;"<br/><br/>Can I put the LNGS proxy one? If so, it would be:<br/><br/>CVMFS_HTTP_PROXY="<a href="http://wwwcache.lngs.infn.it:80">http://wwwcache.lngs.infn.it:80</a>"<br/><br/>Alternatively, it suggests me to install squid from OSG, but I would<br/>avoid it if the LNGS one works.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:39:03)</span> <b>blin:</b></span> is the lngs squid local to the site?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:40:32)</span> <b>paschos:</b></span> it's local to their local infrastructure if that what you mean by site<br/>
<span style="color: #a63024"><span style="font-size: small">(14:40:53)</span> <b>efajardo:</b></span> Use one from OSG if you can get away with it<br/>
<span style="color: #a63024"><span style="font-size: small">(14:41:01)</span> <b>efajardo:</b></span> less pain in the fuutrue belive me<br/>
<span style="color: #a63024"><span style="font-size: small">(14:41:22)</span> <b>paschos:</b></span> i hear you --- any specific reason i can quote back?<br/>
<span style="color: #99a949"><span style="font-size: small">(15:21:33)</span> <b>dwd:</b></span> @paschos CVMFS alone does not generally stress squids very much so they might be able to get away with using an existing one on their local infrastructure.  I am suspicious however that it might not even be a squid since he suggests using port 80.  Squids normally run on port 3128.  It needs to be a forward web cache proxy.  If they ever want to support CMS or ATLAS jobs, that stresses squids much more and they’re definitely better off with frontier-squid.  There’s also much better monitoring available from the WLCG if frontier-squid is used.<br/>
<span style="color: #99a949"><span style="font-size: small">(15:24:29)</span> <b>dwd:</b></span> If I google for “<a href="http://wwwcache.lngs.inf.it">wwwcache.lngs.inf.it</a>” it shows up on a web page of anonymous proxies available to anyone there on port 80.  However the name is not in the public DNS so I think that’s out of date.<br/>
<span style="color: #a63024"><span style="font-size: small">(15:25:11)</span> <b>paschos:</b></span> it's for dedicated experiment (xenon) and will only be used for that. I will relay the info... Thanks Dave.<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:29:16)</span> <b>cnweaver:</b></span> I have new dumb question about condor auth, if anyone has the time. Here's what I hope is the relevant bit of my collector's log when it refuses to talk to my startd:<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:30:38)</span> <b>cnweaver:</b></span> I'm confused by the <tt>client sent (methods == 0)</tt> bit; that sounds like the client (startd) doesn't want to use any atuh methods, while I have tried to configure it in every way I can think of to use TOKEN auth.<br/>
<span style="color: #43761b"><span style="font-size: small">(15:31:40)</span> <b>blin:</b></span> it does try token auth in lines 79-96 but fails<br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:10)</span> <b>blin:</b></span> it's weird that in subsequent lines that it still lists TOKEN auth as an available method, though<br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:15)</span> <b>blin:</b></span> that strikes me as a bug<br/>
<span style="color: #43761b"><span style="font-size: small">(15:33:04)</span> <b>blin:</b></span> &gt;  02/07/20 23:53:01 Error from client.<br/>the client here i imagine is your startd. do you see any security errors/warnings on the startd side?<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:33:47)</span> <b>cnweaver:</b></span> Sorry which lines? (I only have 73)<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:34:56)</span> <b>cnweaver:</b></span> Ah, that's my old log again, I think.<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:35:02)</span> <b>cnweaver:</b></span> Not sure how I got the wrong file.<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:35:14)</span> <b>cnweaver:</b></span> <br/>
<span style="color: #e85d72"><span style="font-size: small">(15:35:24)</span> <b>cnweaver:</b></span> Sorry, I meant this one.<br/>
<span style="color: #43761b"><span style="font-size: small">(15:37:26)</span> <b>blin:</b></span> weird, what's the <tt>condor_config_val -dump SEC*</tt> output for both hosts?<br/>
<span style="color: #e85d72"><span style="font-size: small">(15:39:49)</span> <b>cnweaver:</b></span> Manager:<br/><pre># condor_config_val -dump | grep '^SEC'<br/>SEC_CLAIMTOBE_INCLUDE_DOMAIN = false<br/>SEC_CLAIMTOBE_USER = <br/>SEC_CLIENT_AUTHENTICATION_METHODS = TOKEN,FS<br/>SEC_CREDENTIAL_REFRESH_INTERVAL = -1<br/>SEC_DEBUG_PRINT_KEYS = false<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = TOKEN,FS<br/>SEC_DEFAULT_AUTHENTICATION_TIMEOUT = 20<br/>SEC_DEFAULT_ENCRYPTION = REQUIRED<br/>SEC_ENABLE_IMPERSONATION_TOKENS = false<br/>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = true<br/>SEC_IMPERSONATION_TOKEN_LIMITS = <br/>SEC_INVALIDATE_SESSIONS_VIA_TCP = true<br/>SEC_ISSUED_TOKEN_EXPIRATION = <br/>SEC_PASSWORD_DIRECTORY = /etc/condor/passwords.d<br/>SEC_PASSWORD_DOMAIN = <br/>SEC_PASSWORD_FILE = /etc/condor/password<br/>SEC_SESSION_DURATION_SLOP = 20<br/>SEC_TCP_SESSION_TIMEOUT = 20<br/>SEC_TOKEN_DIRECTORY = <br/>SEC_TOKEN_ISSUER_KEY = POOL<br/>SEC_TOKEN_MAX_AGE = <br/>SEC_TOKEN_SYSTEM_DIRECTORY = /etc/condor/tokens.d<br/>SEC_USE_FAMILY_SESSION = true<br/>SECURE_JOB_ATTRS = </pre><br/>Worker:<br/><pre># condor_config_val -dump | grep '^SEC'<br/>SEC_CLAIMTOBE_INCLUDE_DOMAIN = false<br/>SEC_CLAIMTOBE_USER = <br/>SEC_CLIENT_AUTHENTICATION = OPTIONAL<br/>SEC_CLIENT_AUTHENTICATION_METHODS = TOKEN<br/>SEC_CLIENT_INTEGRITY = OPTIONAL<br/>SEC_CREDENTIAL_DIRECTORY = /var/lib/condor/credentials<br/>SEC_CREDENTIAL_REFRESH_INTERVAL = -1<br/>SEC_DAEMON_AUTHENTICATION_METHODS = TOKEN<br/>SEC_DAEMON_ENCRYPTION = required<br/>SEC_DEBUG_PRINT_KEYS = false<br/>SEC_DEFAULT_AUTHENTICATION = PREFERRED<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = TOKEN<br/>SEC_DEFAULT_AUTHENTICATION_TIMEOUT = 20<br/>SEC_DEFAULT_ENCRYPTION = REQUIRED<br/>SEC_DEFAULT_INTEGRITY = REQUIRED<br/>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = true<br/>SEC_INVALIDATE_SESSIONS_VIA_TCP = true<br/>SEC_NEGOTIATOR_AUTHENTICATION_METHODS = TOKEN<br/>SEC_PASSWORD_DOMAIN = <br/>SEC_PASSWORD_FILE = /etc/condor/passwords.d/POOL<br/>SEC_READ_AUTHENTICATION = OPTIONAL<br/>SEC_READ_INTEGRITY = OPTIONAL<br/>SEC_SESSION_DURATION_SLOP = 20<br/>SEC_TCP_SESSION_TIMEOUT = 20<br/>SECURE_JOB_ATTRS = </pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:10:20)</span> <b>bbockelm:</b></span> @cnweaver - this is probably the relevant clue:<br/><pre>TrustDomain = "condor-manager-db6f6cdf4-kqlzm"</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:10:38)</span> <b>bbockelm:</b></span> What's the <tt>iss</tt> field on the client token?<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:14:25)</span> <b>cnweaver:</b></span> <tt>"iss":"condor-manager-db6f6cdf4-kqlzm"</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:15:15)</span> <b>bbockelm:</b></span> hm.  So, if the client thinks it doesn't have a compatible token, it'll intentionally not auth -- even after advertising it in the handshake.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:15:37)</span> <b>bbockelm:</b></span> This mystery will be solved by the client log: do we happen to have that?<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:16:48)</span> <b>cnweaver:</b></span> Which part of it? None of it had seemed very explanatory at a glance.<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:17:18)</span> <b>andrew.melo:</b></span> lol, it's Condor, so that's the baseline :slightly_smiling_face:<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:17:30)</span> <b>bbockelm:</b></span> I'd assume the failure is in the <tt>StartLog</tt>  -- you are picking from the <tt>CollectorLog</tt> , I think.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:18:26)</span> <b>cnweaver:</b></span> What I posted previously is indeed the CollectorLog side.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:19:14)</span> <b>cnweaver:</b></span> The StartLog has only <tt>02/10/20 22:15:17 SECMAN: required authentication with collector 10.98.26.32 failed, so aborting command UPDATE_STARTD_AD.<br/>02/10/20 22:15:17 ERROR: AUTHENTICATE:1003:Failed to authenticate with any method</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:19:38)</span> <b>bbockelm:</b></span> Ah - so <tt>D_SECURITY|D_FULLDEBUG</tt> isn't set on the StartLog, eh?  Is that an option?<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:20:17)</span> <b>cnweaver:</b></span> I can set it; I had previosuly tried <tt>STARTD_DEBUG = $(STARTD_DEBUG) D_FULLDEBUG:2<br/>  SHARED_PORT_DEBUG = $(SHARED_PORT_DEBUG) D_FULLDEBUG:2</tt> but didn't seem to get enything more useful in those logs.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:21:05)</span> <b>bbockelm:</b></span> Try: <tt>STARTD_DEBUG = $(STARTD_DEBUG) D_FULLDEBUG D_SECURITY</tt><br/>
<span style="color: #e85d72"><span style="font-size: small">(16:25:29)</span> <b>cnweaver:</b></span> Thanks, I had my debug settings a little mixed up before.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:25:47)</span> <b>cnweaver:</b></span> However, that mostly just confirms what the central manager claimed:<br/><pre>02/10/20 22:24:21 SECMAN: new session, doing initial authentication.<br/>02/10/20 22:24:21 SECMAN: Auth methods: TOKEN<br/>02/10/20 22:24:21 AUTHENTICATE: setting timeout for &lt;10.98.26.32:9618&gt; to 20.<br/>02/10/20 22:24:21 HANDSHAKE: in handshake(my_methods = 'TOKEN')<br/>02/10/20 22:24:21 HANDSHAKE: handshake() - i am the client<br/>02/10/20 22:24:21 HANDSHAKE: sending (methods == 0) to server<br/>02/10/20 22:24:21 HANDSHAKE: server replied (method = 0)<br/>02/10/20 22:24:21 SECMAN: required authentication with collector 10.98.26.32 failed, so aborting command UPDATE_STARTD_AD.<br/>02/10/20 22:24:21 ERROR: AUTHENTICATE:1003:Failed to authenticate with any method</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:32:15)</span> <b>bbockelm:</b></span> Can you send the full client session?<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:38:00)</span> <b>cnweaver:</b></span> You mean the full StartLog?<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:39:23)</span> <b>cnweaver:</b></span> <br/>
<span style="color: #9e3997"><span style="font-size: small">(16:41:34)</span> <b>bbockelm:</b></span> @cnweaver (sorry, also trying to run a meeting...) -- looks like it's missing the <tt>D_FULLDEBUG</tt> but has <tt>D_SECURITY</tt><br/>
<span style="color: #e85d72"><span style="font-size: small">(16:43:12)</span> <b>cnweaver:</b></span> <tt>condor_config_val STARTD_DEBUG<br/> D_SECURITY D_FULLDEBUG:2</tt><br/>Maybe the <tt>:2</tt> is an issue?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:43:27)</span> <b>bbockelm:</b></span> Perhaps?  I don't fully understand the <tt>:</tt> syntax<br/>
<span style="color: #43761b"><span style="font-size: small">(16:43:48)</span> <b>blin:</b></span> i don't think it has any meaning for D_FULLDEBUG<br/>
<span style="color: #43761b"><span style="font-size: small">(16:44:20)</span> <b>blin:</b></span> iirc, D_FULLDEBUG basically turns on <tt>:2</tt> for all other enabled debug levels, i.e. it raises their verbosity<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:46:37)</span> <b>cnweaver:</b></span> Apparently it does interfere somehow, as my log is now twice as long.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:46:50)</span> <b>bbockelm:</b></span> :slightly_smiling_face: Now _that_ is HTCondor for you!<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:47:06)</span> <b>cnweaver:</b></span> <br/>
<span style="color: #c386df"><span style="font-size: small">(16:48:14)</span> <b>matyas:</b></span> If you use the <tt>:</tt> syntax on one of the symbols, you should use it on all of them<br/>
<span style="color: #c386df"><span style="font-size: small">(16:49:15)</span> <b>matyas:</b></span> having the <tt>:</tt> on that line changes how the line is interpreted<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:49:16)</span> <b>cnweaver:</b></span> Okay, I guess I will bear that in mind.<br/>
<span style="color: #c386df"><span style="font-size: small">(16:49:30)</span> <b>matyas:</b></span> (I asked TJ about it; his response made my head hurt)<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:51:03)</span> <b>bbockelm:</b></span> @cnweaver - sigh.  To see that, I need to access it from webapp.  To access the webapp, I need to login.  To login, I need to reset the 2FA app.... one moment<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:51:44)</span> <b>cnweaver:</b></span> Is it possible that the client (8.8.7) is too old, but because up until <tt>sec_char_to_auth_method</tt> the auth methods are just carried around as strings, it doesn't object to "TOKEN" right up until silently turning it into a zero?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:52:21)</span> <b>bbockelm:</b></span> Ah - yes, I should have noticed that.  Tokens were introduced in 8.9.2.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:53:47)</span> <b>cnweaver:</b></span> It seem to be in some weird, quasi-recognized state. If I specifiy a made-up auth method, that gets thrown out before the handshake process.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:54:13)</span> <b>cnweaver:</b></span> Anyway, the obvious solution is to get a newer version.<br/>
<span style="color: #e85d72"><span style="font-size: small">(16:59:27)</span> <b>cnweaver:</b></span> As a related question, my current container is based on <tt>opensciencegrid/osg-wn:3.5-el7</tt>. I've also tried the <tt>-devel</tt> variant, but it seems to be about the same. Is there a published worker node container with condor 8.9?<br/>
<span style="color: #c386df"><span style="font-size: small">(16:59:47)</span> <b>matyas:</b></span> the worker node container doesn't contain condor<br/>
<span style="color: #c386df"><span style="font-size: small">(17:00:02)</span> <b>matyas:</b></span> ... I think<br/>
<span style="color: #e85d72"><span style="font-size: small">(17:00:29)</span> <b>cnweaver:</b></span> Hm!<br/>
<span style="color: #e85d72"><span style="font-size: small">(17:00:42)</span> <b>cnweaver:</b></span> Well, at least then I can potentially fix it myself. :)<br/>
<span style="color: #c386df"><span style="font-size: small">(17:01:22)</span> <b>matyas:</b></span> The pilot installs whatever version of condor it's configured to install<br/>
<span style="color: #e85d72"><span style="font-size: small">(17:03:07)</span> <b>cnweaver:</b></span> I see, and indeed, Lincoln's Dockerfile was installing condor in a later step. Is <tt>--enablerepo=osg-upcoming</tt> a suitable incantation to get v8.9?<br/>
<span style="color: #9e3997"><span style="font-size: small">(17:04:14)</span> <b>bbockelm:</b></span> @cnweaver -&gt; the client sends the (string) list of methods it supports in the order it wants, then the server filters it with the methods it supports.  So if the client send garbage, the server will filter it out.  In this case, for some reason, the HTCondor client itself doesn't check to see if the configured method string is recognized as a valid method.<br/>
<span style="color: #c386df"><span style="font-size: small">(17:04:15)</span> <b>matyas:</b></span> yep<br/>
<span style="color: #e85d72"><span style="font-size: small">(17:17:43)</span> <b>cnweaver:</b></span> Thanks, gentlemen, my demons are now authenticating successfully with each other. I've set something else in my permissions incorrectly, so the startd doesn't appear to be allowed to do its job, but that's my fault and something to hack on more later.<br/>
<span style="color: #9e3997"><span style="font-size: small">(20:39:37)</span> <b>bbockelm:</b></span> @cnweaver - so the two 'lessons learned' here are the newlines issue (<a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=7499">https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=7499</a>) and the issue with the client suggesting authentication methods it doesn't understand?<br/>
<span style="color: #16569E"><span style="font-size: small">(20:41:24)</span> <b>edquist:</b></span> A slightly adapted Biff Tannen quote from BTTF -<br/>
<span style="color: #16569E"><span style="font-size: small">(20:41:41)</span> <b>edquist:</b></span> "Newlines!  I hate Mu'newlines!"<br/>
<span style="color: #9e3997"><span style="font-size: small">(20:43:48)</span> <b>bbockelm:</b></span> <a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=7500">https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=7500</a> here's a ticket for the second issue<br/>
</body>
</html>
