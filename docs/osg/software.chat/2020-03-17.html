<!DOCTYPE html>
<html>
<head>
<title>Tue Mar 17, 2020 : #software (osg)</title>
</head>
<body>
<h3>Tue Mar 17, 2020 : #software (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(07:54:47)</span> <b>bockjoo:</b></span> gridmanager log shows this:<br/>
<span style="color: #7d414c"><span style="font-size: small">(07:54:48)</span> <b>bockjoo:</b></span> 03/17/20 07:50:32 [439905] (667033.0) blah_job_status() failed: Error parsing classad or job not found<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:04:02)</span> <b>bockjoo:</b></span> <pre>I have restarted the CE and rebooted the CE.<br/>It did not help.<br/>I have also updated the blahp to see if it helps.</pre><br/><br/>
<span style="color: #43761b"><span style="font-size: small">(08:12:55)</span> <b>blin:</b></span> @bockjoo could you give some lines before/after?<br/>
<span style="color: #43761b"><span style="font-size: small">(08:13:18)</span> <b>blin:</b></span> i'd also consider turning on <tt>ALL_DEBUG = D_CAT D_ALWAYS:2</tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(08:29:41)</span> <b>bockjoo:</b></span> 03/17/20 07:50:32 [439905] GAHP[439916] &lt;- 'RESULTS'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; 'R'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; 'S' '1'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; '18' '1' 'Error parsing classad or job not found' '0' 'N/A'<br/>03/17/20 07:50:32 [439905] (667033.0) doEvaluateState called: gmState GM_POLL_ACTIVE, remoteState 2<br/>03/17/20 07:50:32 [439905] (667033.0) blah_job_status() failed: Error parsing classad or job not found<br/>03/17/20 07:50:32 [439905] (667033.0) gm state change: GM_POLL_ACTIVE -&gt; GM_HOLD<br/>03/17/20 07:50:32 [439905] (667033.0) gm state change: GM_HOLD -&gt; GM_DELETE<br/>03/17/20 07:50:35 [439905] BaseResource::UpdateResource:<br/>
<span style="color: #43761b"><span style="font-size: small">(08:33:45)</span> <b>blin:</b></span> how about a few lines before that?<br/>
<span style="color: #43761b"><span style="font-size: small">(08:37:32)</span> <b>blin:</b></span> could you touch "/var/tmp/slurm_cache_&lt;USERNAME&gt;/slurm_<a href="http://status.de">status.debug"?</a><br/>
<span style="color: #43761b"><span style="font-size: small">(08:39:07)</span> <b>blin:</b></span> once you do that, there should be logs in <tt>/var/tmp/slurm_cache_&lt;USERNAME&gt;/slurm_status.log</tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(08:40:05)</span> <b>bockjoo:</b></span> 03/17/20 07:50:00 [439905]    ExitCode = 0<br/>03/17/20 07:50:00 [439905]    GridJobStatus = "IDLE"<br/>03/17/20 07:50:00 [439905]    LastRemoteStatusUpdate = 1584445800<br/>03/17/20 07:50:00 [439905] leaving doContactSchedd()<br/>03/17/20 07:50:30 [439905] (667033.0) doEvaluateState called: gmState GM_SUBMITTED, remoteState 2<br/>03/17/20 07:50:30 [439905] (667033.0) gm state change: GM_SUBMITTED -&gt; GM_POLL_ACTIVE<br/>03/17/20 07:50:30 [439905] GAHP[439916] &lt;- 'BLAH_JOB_STATUS 18 slurm/20200317/48794627'<br/>03/17/20 07:50:30 [439905] GAHP[439916] -&gt; 'S'<br/>03/17/20 07:50:32 [439905] Received CHECK_LEASES signal<br/>03/17/20 07:50:32 [439905] in doContactSchedd()<br/>03/17/20 07:50:32 [439905] querying for renewed leases<br/>03/17/20 07:50:32 [439905] querying for removed/held jobs<br/>03/17/20 07:50:32 [439905] Using constraint ((Owner=?="lcg"&amp;&amp;JobUniverse==9)) &amp;&amp; ((Managed =!= "ScheddDone")) &amp;&amp; (JobStatus == 3 || JobStatus == 4 || (JobStatus == 5 &amp;&amp; Managed =?= "External"))<br/>03/17/20 07:50:32 [439905] Fetched 0 job ads from schedd<br/>03/17/20 07:50:32 [439905] leaving doContactSchedd()<br/>03/17/20 07:50:32 [439905] GAHP[439916] &lt;- 'RESULTS'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; 'R'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; 'S' '1'<br/>03/17/20 07:50:32 [439905] GAHP[439916] -&gt; '18' '1' 'Error parsing classad or job not found' '0' 'N/A'<br/>03/17/20 07:50:32 [439905] (667033.0) doEvaluateState called: gmState GM_POLL_ACTIVE, remoteState 2<br/>03/17/20 07:50:32 [439905] (667033.0) blah_job_status() failed: Error parsing classad or job not found<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:41:16)</span> <b>bockjoo:</b></span> Done: touch /var/tmp/slurm_cache_lcg/slurm_status.debug<br/>
<span style="color: #43761b"><span style="font-size: small">(08:41:29)</span> <b>blin:</b></span> try running slurm_status manually: <tt>/usr/libexec/blahp/slurm_status slurm/20200317/48794627</tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(08:41:32)</span> <b>bockjoo:</b></span> Do you still have access to <a href="http://cslrm.rc.ufl.edu">cslrm.rc.ufl.edu</a>?<br/>
<span style="color: #43761b"><span style="font-size: small">(08:41:52)</span> <b>blin:</b></span> i don't recall off-hand<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:42:44)</span> <b>bockjoo:</b></span> [root@cslrm ~]#  /usr/libexec/blahp/slurm_status.py slurm/20200317/48794627<br/>0[RemoteUserCpu=154; ImageSize=580824; BatchJobId="48794627"; RemoteSysCpu=76; JobStatus=4; ExitCode=0; ]<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:43:14)</span> <b>bockjoo:</b></span> It might have been that slurm status command had been overlwhemld?<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:43:19)</span> <b>bockjoo:</b></span> idk<br/>
<span style="color: #43761b"><span style="font-size: small">(08:44:44)</span> <b>blin:</b></span> anything in /var/tmp/slurm_cache_lcg/slurm_status.log?<br/>
<span style="color: #7d414c"><span style="font-size: small">(08:45:24)</span> <b>bockjoo:</b></span> Not yet. Be right back in 30 minutes.<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:08:08)</span> <b>bockjoo:</b></span> Can you try condor_ce_run against the CE and the log, /var/tmp/slurm_cache_lcg/slurm_status.log ?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:10:55)</span> <b>blin:</b></span> the host is <a href="http://cslrm.rc.ufl.edu">cslrm.rc.ufl.edu</a>?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:13:26)</span> <b>blin:</b></span> i just pinged the host and i don't have access: <tt>/DC=org/DC=cilogon/C=US/O=University of Wisconsin-Madison/CN=Brian Lin A2266246</tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(09:31:06)</span> <b>bockjoo:</b></span> Yes, that's the host. Can you ping it again?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:34:29)</span> <b>blin:</b></span> same issue:<br/><pre>[<a href="mailto:blin@fermicloud068.fnal.gov">blin@fermicloud068.fnal.gov</a> ~]$ ce=<a href="http://cslrm.rc.ufl.edu">cslrm.rc.ufl.edu</a><br/>[<a href="mailto:blin@fermicloud068.fnal.gov">blin@fermicloud068.fnal.gov</a> ~]$ _condor_SEC_CLIENT_AUTHENTICATION_METHODS=GSI condor_ping -name $ce -pool $ce:9619 -verbose WRITE<br/>WRITE failed!<br/>SECMAN:2010:Received "DENIED" from server for user gsi@unmapped using method GSI.</pre><br/>
<span style="color: #7d414c"><span style="font-size: small">(09:37:41)</span> <b>bockjoo:</b></span> Anyway, the slurm status log looks something like this:<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:37:42)</span> <b>bockjoo:</b></span> 03/17/20 10:16:40 604300 0[BatchJobId="48807070"; WorkerNode="c25a-s25"; JobStatus=2; ExitCode= 0; ]<br/>03/17/20 10:17:40 605135 Checking cache for jobid 48807070<br/>03/17/20 10:17:40 605135 Job in in remote cluster<br/>03/17/20 10:17:40 605135 Jobid 48807070 in cache.<br/>03/17/20 10:17:40 605135 0[BatchJobId="48807070"; WorkerNode="c25a-s25"; JobStatus=2; ExitCode= 0; ]<br/>03/17/20 10:18:40 605693 Checking cache for jobid 48807070<br/>03/17/20 10:18:40 605693 Job in in remote cluster<br/>03/17/20 10:18:40 605693 Starting query to fill cache.<br/>03/17/20 10:18:40 605693 Starting scontrol.<br/>03/17/20 10:18:42 605693 Finished scontrol (time=1.935175).<br/>03/17/20 10:18:42 605693 Finished query to fill cache.<br/>03/17/20 10:18:42 605693 Jobid 48807070 in cache.<br/>03/17/20 10:18:42 605693 0[BatchJobId="48807070"; WorkerNode="c25a-s25"; JobStatus=4; ExitCode= 0; ]<br/>03/17/20 10:18:42 605693 Querying sacct for completed job for jobid: 48807070<br/>
<span style="color: #43761b"><span style="font-size: small">(09:39:44)</span> <b>blin:</b></span> that looks successful to me. can you cross-check the time vs what shows up in the GridmanagerLog.lcg? is it still failing?<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:39:57)</span> <b>bockjoo:</b></span> Now, the holdreason changed to 'HoldReason = "The system macro SYSTEM_PERIODIC_HOLD expression '( JobStatus =!= 5 &amp;&amp; JobStatus =!= 3 &amp;&amp; ( CurrentTime - GridResourceUnavailableTime ) &gt; 3600 )' evaluated to TRUE"'<br/>
<span style="color: #43761b"><span style="font-size: small">(09:40:59)</span> <b>blin:</b></span> yeah that looks like there were issues communicating with Slurm for an hour<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:51:55)</span> <b>bockjoo:</b></span> A different question for @blin: Is Requirements = (Owner != "lcg"); correct in the htcondor ce config? I see Requirements = (Owner =!= "lcg"); in other condor examples. What's the difference between != and =!=?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:53:30)</span> <b>blin:</b></span> <tt>=!=</tt> handles cases where the attribute is undefined<br/>
<span style="color: #43761b"><span style="font-size: small">(09:53:57)</span> <b>blin:</b></span> the condor team recommends using <tt>!=</tt> and <tt>==</tt> instead of <tt>=!=</tt> and <tt>=?=</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(09:54:19)</span> <b>blin:</b></span> (the <tt>Owner</tt> attribute is always going to be defined so in this case, they're functionally the same)<br/>
<span style="color: #8d4b84"><span style="font-size: small">(09:56:09)</span> <b>kherner:</b></span> @blin "isnt" is still supported, right? As in <tt>Owner isnt "kherner"</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(09:56:32)</span> <b>blin:</b></span> yup, it should be<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:29:25)</span> <b>andrew.melo:</b></span> Brian -- I think that hold condition can also mean that the job was idle for an hour?<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:29:30)</span> <b>andrew.melo:</b></span> (if I can read right)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:32:33)</span> <b>blin:</b></span> true!<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:33:33)</span> <b>andrew.melo:</b></span> I get that sometimes when I screw up the reservation for the lcgadmin user and theres nowhere for the jobs to run<br/>
</body>
</html>
