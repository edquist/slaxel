<!DOCTYPE html>
<html>
<head>
<title>Tue Apr 28, 2020 : #software (osg)</title>
</head>
<body>
<h3>Tue Apr 28, 2020 : #software (osg)</h3>
<span style="color: #c386df"><span style="font-size: small">(08:55:13)</span> <b>matyas:</b></span> I'll look into it<br/>
<span style="color: #c386df"><span style="font-size: small">(10:14:08)</span> <b>matyas:</b></span> OK, should be fixed<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:57:03)</span> <b>marco.mascheroni:</b></span> Hi guys, a little problem with the <tt>update-all-remote-wn-clients</tt>script. Edgar reported the Comet CRLs expired, and I confirmed they were last updated on April the 10th last time. I run `<tt>update-all-remote-wn-clients</tt>`   by hand and it worked. This is what I see in the CE:<br/><br/><pre>[root@hosted-ce34 ~]# systemctl status update-all-remote-wn-clients<br/>● update-all-remote-wn-clients.service - Update WN client installations on remote hosts<br/>   Loaded: loaded (/usr/lib/systemd/system/update-all-remote-wn-clients.service; disabled; vendor preset: disabled)<br/>   Active: activating (start) since Fri 2020-04-10 23:17:35 CDT; 2 weeks 3 days ago<br/> Main PID: 34636 (python2)<br/>   CGroup: /system.slice/update-all-remote-wn-clients.service<br/>           └─34636 python2 /usr/bin/update-all-remote-wn-clients</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:57:13)</span> <b>marco.mascheroni:</b></span> And if I do ps auxf I see the process hanging there:<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:57:29)</span> <b>marco.mascheroni:</b></span> <pre>root       34636  0.0  0.6 157124  6848 ?        Ss   Apr10   0:00 python2 /usr/bin/update-all-remote-wn-clients<br/>root       34637  0.0  0.3 241224  3520 ?        S    Apr10   0:00  \_ sudo -H -u osg04 /usr/bin/update-remote-wn-client <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a> --upstream-url=<a href="https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz">https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz</a> --remote-user=uscms --remote-dir=/home/uscms/osg-wn-client<br/>osg04      34640  0.0  1.2 208932 12336 ?        S    Apr10   0:00      \_ python2 /usr/bin/update-remote-wn-client <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a> --upstream-url=<a href="https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz">https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz</a> --remote-user=uscms --remote-dir=/home/uscms/osg-wn-client</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:59:11)</span> <b>marco.mascheroni:</b></span> This is the logfile:<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:59:14)</span> <b>marco.mascheroni:</b></span> <pre>*** rsyncing WN client changes to <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a>:/home/uscms/osg-wn-client~new~<br/>*** Moving /home/uscms/osg-wn-client~new~ to /home/uscms/osg-wn-client<br/>-------------------------------------------------------------------------------<br/>Started at 2020-04-10 11:06:23.311566<br/>User: osg04<br/>Command: ['/usr/bin/update-remote-wn-client', '<a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a>', '--upstream-url=<a href="https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz">https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz</a>', '--remote-user=uscms', '--remote-dir=/home/uscms/osg-wn-client']<br/><br/>*** Downloading WN tarball<br/>*** Downloading WN tarball<br/>tar: osg-wn-client/usr/share/doc/pugixml-1.8/readme.txt: implausibly old time stamp 1969-12-31 18:00:00<br/>tar: osg-wn-client/usr/share/doc/pugixml-1.8/readme.txt: implausibly old time stamp 1969-12-31 18:00:00<br/>*** Setting up tarball dirs<br/>Staging dir not specified; trying '/tmp/tmp8dayMS/deploy/osg-wn-client'...ok<br/>Final OSG_LOCATION specified as '/home/uscms/osg-wn-client'<br/>Creating environment setup files...<br/>Creating 'setup.sh'[ OK ]<br/>Creating 'setup.csh'[ OK ]<br/>Creating 'osgrun'[ OK ]<br/>Creating 'setup-local.sh'[ OK ]<br/>Creating 'setup-local.csh'[ OK ]<br/>Updating fetch-crl config file(s)[ OK ]<br/>Staging dir not specified; trying '/tmp/tmp8dayMS/fetch/osg-wn-client'...ok<br/>Final OSG_LOCATION not specified. Using staging dir ('/tmp/tmp8dayMS/fetch/osg-wn-client').<br/>Creating environment setup files...<br/>Creating 'setup.sh'[ OK ]<br/>Creating 'setup.csh'[ OK ]<br/>Creating 'osgrun'[ OK ]<br/>Creating 'setup-local.sh'[ OK ]<br/>Creating 'setup-local.csh'[ OK ]<br/>Updating fetch-crl config file(s)[ OK ]<br/>*** Fetching CAs<br/>Setting up CA Certificates for OSG installation<br/>CA Certificates will be installed into /tmp/tmp8dayMS/deploy/osg-wn-client/etc/grid-security/certificates<br/>osg-update-certs<br/>  Log file: /tmp/tmp8dayMS/fetch/osg-wn-client/var/log/osg-update-certs.log<br/>  Updates from: <a href="https://repo.opensciencegrid.org/cadist/ca-certs-version-new">https://repo.opensciencegrid.org/cadist/ca-certs-version-new</a><br/><br/>Will update CA certificates from version unknown to version 1.86NEW.<br/>Update successful.<br/><br/>NOTE: '/tmp/tmp8dayMS/deploy/osg-wn-client/etc/grid-security' did not contain CA files using '/tmp/tmp8dayMS/deploy/osg-wn-client/etc/grid-security/certificates' dir instead.<br/>Creating symlink '/tmp/tmp8dayMS/fetch/osg-wn-client/etc/grid-security/certificates'...<br/><br/>Setup completed successfully.<br/>*** Fetching CRLs<br/>*** ERROR CRL verification failed for BG-ACAD-CA/0 (BG-ACAD-CA)<br/><br/>*** Uploading<br/>*** rsyncing WN client changes to <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a>:/home/uscms/osg-wn-client~new~<br/>*** Moving /home/uscms/osg-wn-client~new~ to /home/uscms/osg-wn-client<br/>-------------------------------------------------------------------------------<br/>Started at 2020-04-28 10:47:28.552184<br/>User: osg04<br/>Command: ['/usr/bin/update-remote-wn-client', '<a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a>', '--upstream-url=<a href="https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz">https://repo.opensciencegrid.org/tarball-install/3.4/osg-wn-client-latest.el7.x86_64.tar.gz</a>', '--remote-user=uscms', '--remote-dir=/home/uscms/osg-wn-client']</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(11:02:46)</span> <b>marco.mascheroni:</b></span> It seems it is waiting on a non-existant socket (the <tt>/proc/34640/fd/4</tt> symlink is red and blinks):<br/><br/><pre>[root@hosted-ce34 ~]# strace -p 34640<br/>strace: Process 34640 attached<br/>read(4, ^Cstrace: Process 34640 detached<br/> &lt;detached ...&gt;<br/>[root@hosted-ce34 ~]# ls -altr /proc/34640/fd/4<br/>lrwx------. 1 osg04 osg 64 Apr 28 11:01 /proc/34640/fd/4 -&gt; socket:[58727192]<br/>[root@hosted-ce34 ~]# </pre><br/>
<span style="color: #c386df"><span style="font-size: small">(11:06:57)</span> <b>matyas:</b></span> That's new. I'll look into it.<br/>
<span style="color: #c386df"><span style="font-size: small">(11:11:31)</span> <b>matyas:</b></span> Is this happening every time?<br/>
<span style="color: #e23f99"><span style="font-size: small">(11:13:00)</span> <b>marco.mascheroni:</b></span> first time<br/>
<span style="color: #e23f99"><span style="font-size: small">(11:13:26)</span> <b>marco.mascheroni:</b></span> but it went un noticed for 18 days, we should put a workaround in place imho<br/>
<span style="color: #e23f99"><span style="font-size: small">(11:14:32)</span> <b>marco.mascheroni:</b></span> something like running <tt>timeout 3600 python2 /usr/bin/update-remote-wn-client <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a> --upstream-url=...</tt> instead of just <tt>python2 /usr/bin/update-remote-wn-client <a href="http://comet-ln2.sdsc.edu">comet-ln2.sdsc.edu</a> --upstream-url=...</tt><br/>
<blockquote>
<span style="color: #e23f99"><span style="font-size: small">(2020-04-29 10:55:01)</span> <b>marco.mascheroni:</b></span> @matyas @blin Any comment on adding a workaround like this one?<br/>
<span style="color: #c386df"><span style="font-size: small">(2020-04-29 10:55:40)</span> <b>matyas:</b></span> I made a ticket for it: <a href="https://opensciencegrid.atlassian.net/browse/SOFTWARE-4081">https://opensciencegrid.atlassian.net/browse/SOFTWARE-4081</a><br/>
<span style="color: #e23f99"><span style="font-size: small">(2020-04-29 10:56:54)</span> <b>marco.mascheroni:</b></span> Great, thanks!<br/>
<span style="color: #e23f99"><span style="font-size: small">(2020-04-29 10:58:11)</span> <b>marco.mascheroni:</b></span> Where can I manually add it?<br/>
<span style="color: #c386df"><span style="font-size: small">(2020-04-29 11:05:10)</span> <b>matyas:</b></span> You might be able to add something to the systemd timer, but it might just be easiest to try out my branch (<a href="https://github.com/matyasselmeci/hosted-ce-tools/tree/pr/addtimeout">https://github.com/matyasselmeci/hosted-ce-tools/tree/pr/addtimeout</a>) -- clone it and run <tt>make install-noconfig</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(2020-04-30 08:51:42)</span> <b>blin:</b></span> i don't expect to make other hosted ce tool changes any time soon, @matyas can we just cut a build for marco instead?<br/>
<span style="color: #c386df"><span style="font-size: small">(2020-04-30 08:52:19)</span> <b>matyas:</b></span> Sure, I can do that soon.<br/>
<span style="color: #43761b"><span style="font-size: small">(2020-04-30 09:41:38)</span> <b>blin:</b></span> thanks!<br/>
</blockquote>
<span style="color: #e23f99"><span style="font-size: small">(11:17:50)</span> <b>marco.mascheroni:</b></span> ( Also @blin, that would have been hard to find out in the slate HostedCEs :slightly_smiling_face: )<br/>
<span style="color: #43761b"><span style="font-size: small">(12:40:30)</span> <b>blin:</b></span> that's a good point but i think you'd just restart the instance and get new CRLs that way :slightly_smiling_face:<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:20:25)</span> <b>dweitzel:</b></span> @blin say I have an automated email that needs to go out.  I want to have a way for people to "sign up" for this email.  Is comanage an option?  Is it close to providing that type of functionality?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:22:00)</span> <b>blin:</b></span> i'm not sure if that's possible<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:23:20)</span> <b>dweitzel:</b></span> For example, all members of some group get this automated email?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:23:59)</span> <b>blin:</b></span> i don't know what the email capabilities of comanage are<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:24:25)</span> <b>dweitzel:</b></span> oh, I don't mean for co-manage to do the emailing.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:24:59)</span> <b>dweitzel:</b></span> I just want co-manage to manage the list of recipients.  Then whatever mailing service can query and get the list of "To's" and send the mail.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:25:40)</span> <b>blin:</b></span> ah ok<br/>
<span style="color: #43761b"><span style="font-size: small">(14:26:14)</span> <b>blin:</b></span> i'm not sure what group self sign-up looks like<br/>
<span style="color: #43761b"><span style="font-size: small">(14:26:25)</span> <b>blin:</b></span> maybe we should just use a fnal mailing list?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:26:37)</span> <b>dweitzel:</b></span> :slightly_smiling_face:<br/>
</body>
</html>
