<!DOCTYPE html>
<html>
<head>
<title>Wed Aug 11, 2021 : #software (osg)</title>
</head>
<body>
<h3>Wed Aug 11, 2021 : #software (osg)</h3>
<span style="color: #50a0cf"><span style="font-size: small">(11:12:16)</span> <b>dschultz:</b></span> is there a reason to advertise both <tt>HAS_SINGULARITY</tt> and <tt>HasSingularity</tt> in OSG glideins?  it's especially problematic when they are different values.  (note that the condor manual only references <tt>HasSingularity</tt>, so that's what our users use)<br/>
<span style="color: #5a4592"><span style="font-size: small">(11:21:04)</span> <b>lmichael:</b></span> @rynge may know, not that others wouldn’t<br/>
<span style="color: #43761b"><span style="font-size: small">(11:35:14)</span> <b>blin:</b></span> @dschultz <tt>HasSingularity</tt> is condor's check for Singularity while <tt>HAS_SINGULARITY</tt> is the OSG's (and maybe it's built into gwms at this point?) which tests for more things, such as being able to run a singularity image out of <tt>/cvmfs/singularity.opensciencegrid.org</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(11:39:50)</span> <b>bbockelm:</b></span> Why not duplicate it to both?<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:40:33)</span> <b>rynge:</b></span> You mean OSG could override HasSingularity?<br/>
<span style="color: #43761b"><span style="font-size: small">(11:41:44)</span> <b>blin:</b></span> i think it provides some helpful info when they don't match, though<br/>
<span style="color: #43761b"><span style="font-size: small">(11:42:39)</span> <b>blin:</b></span> because the process by which we set <tt>HAS_SINGULARITY</tt> is opaque when looking at the startd ad so if <tt>HAS_SINGULARITY = False</tt>  but <tt>HasSingularity = True</tt>, we know more about what actually does/doesn't work<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:43:27)</span> <b>bbockelm:</b></span> <tt>HasSingularity</tt> looks like it's only set when <tt>SINGULARITY</tt> is detected by HTCondor.   You could disable it in the condor config and advertise it by hand.  (Maybe?)<br/>
<span style="color: #43761b"><span style="font-size: small">(11:43:47)</span> <b>blin:</b></span> ultimately, though, it'd be nicest if <tt>HAS_SINGULARITY</tt> (and <tt>HasSingularity</tt> ?) were expressions so we know exactly what's wrong with the startd when it's false<br/>
<span style="color: #50a0cf"><span style="font-size: small">(12:13:56)</span> <b>dschultz:</b></span> I thought <tt>SINGULARITY_COMMENT</tt> was where your debugging went, for why <tt>HAS_SINGULARITY = False</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(12:31:54)</span> <b>blin:</b></span> yeah but i think it could use some refinement<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:34:15)</span> <b>rynge:</b></span> Yes for sure!<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:42:29)</span> <b>bbockelm:</b></span> @blin - watch yourself, the answer might be "PRs are accepted"!<br/>
<span style="color: #50a0cf"><span style="font-size: small">(12:55:14)</span> <b>dschultz:</b></span> yeah, could definitely use some refinement.  I'm testing out <tt>osgvo-docker-pilot</tt>, and running into singularity issues.  is there a way to provide extra flags to singularity?  adding <tt>-u</tt> would be helpful<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:02:07)</span> <b>bbockelm:</b></span> You can set <tt>GLIDEIN_DEBUG_OUTPUT=true</tt> in the job to get <tt>-vvv -d</tt> passed.  Additionally, <tt>GLIDEIN_SINGULARITY_GLOBAL_OPTS</tt> passes CLI options directly.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(13:17:32)</span> <b>dschultz:</b></span> I think my problem is deeper than that, since condor_status reports<br/><pre>HAS_CVMFS_singularity_opensciencegrid_org = true<br/>HAS_SINGULARITY = false<br/>HasSingularity = true</pre><br/>and if <tt>HAS_SINGULARITY = false</tt> then it won't even try to start a container.  so I need to do something on the startd side<br/>
<span style="color: #674b1b"><span style="font-size: small">(13:17:43)</span> <b>rynge:</b></span> Hmm, that will not work for the container - it has the old scripts<br/>
<span style="color: #674b1b"><span style="font-size: small">(13:23:11)</span> <b>rynge:</b></span> @dschultz Can you show me the start up log?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(13:23:16)</span> <b>dschultz:</b></span> specifically, this is failing:<br/><pre>INFO   /usr/bin/singularity exec --bind /tmp/osgvo-node-advertise.work:/srv --bind /cvmfs --no-home --contain --ipc --pid /cvmfs/singularity.opensciencegrid.org/opensciencegrid/osgvo-el7:latest echo Hello World | grep Hello World<br/>ERROR  : No setuid installation found, for unprivileged installation use: ./mconfig --without-suid<br/>INFO   Simple singularity exec inside /cvmfs/singularity.opensciencegrid.org/opensciencegrid/osgvo-el7:latest failed.</pre><br/>
<span style="color: #674b1b"><span style="font-size: small">(13:23:47)</span> <b>rynge:</b></span> Did you run docker with --privileged or all the CAP flags?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(13:24:32)</span> <b>dschultz:</b></span> all the CAP flags:<br/><pre>docker run -it --rm --user osg \<br/>       --cap-add=DAC_OVERRIDE --cap-add=SETUID --cap-add=SETGID \<br/>       --cap-add=CAP_DAC_READ_SEARCH \<br/>       --cap-add=SYS_ADMIN --cap-add=SYS_CHROOT --cap-add=SYS_PTRACE \<br/>       -v /cvmfs:/cvmfs:shared \</pre><br/>
<span style="color: #674b1b"><span style="font-size: small">(13:25:41)</span> <b>rynge:</b></span> <tt>docker run -it --rm --user osg  --privileged -v /cvmfs:/cvmfs:shared ...</tt><br/>
<span style="color: #674b1b"><span style="font-size: small">(13:25:47)</span> <b>rynge:</b></span> Try that please<br/>
<span style="color: #50a0cf"><span style="font-size: small">(13:26:10)</span> <b>dschultz:</b></span> though I'd actually prefer if I could use singularity with userns, since I think there will be places where I can't use docker, so would like to run singularity inside singularity (where available, at least)<br/>
<span style="color: #674b1b"><span style="font-size: small">(13:27:01)</span> <b>rynge:</b></span> We have some people trying singularity inside singularity - Works with at least unpriv singularity inside singularity<br/>
<span style="color: #43761b"><span style="font-size: small">(13:49:15)</span> <b>blin:</b></span> isn't the problem here that advertise script isn't using the unpriv singularity?<br/>
<span style="color: #43761b"><span style="font-size: small">(13:50:36)</span> <b>blin:</b></span> if we set the PATH so that the unpriv singularity was used, i'm pretty sure that all the cap adds will work instead of <tt>--privileged</tt><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:22:07)</span> <b>dbox:</b></span> Hey I could use some osg-build or koji advice -- I am trying to build some software on <a href="http://moria.cs.wisc.edu">moria.cs.wisc.edu</a> and it is failing in koji as it cannot download <a href="https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-rpm-macros-7-30.noarch.rpm">https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-rpm-macros-7-30.noarch.rpm</a>  .  I looked and fedora has upgraded that package to 7-31.noarch.rpm.   What should I do?<br/>
<span style="color: #c386df"><span style="font-size: small">(14:22:46)</span> <b>matyas:</b></span> ah, we'll need to do a regen-repo on the el7 build repos<br/>
<span style="color: #c386df"><span style="font-size: small">(14:22:59)</span> <b>matyas:</b></span> I'll take care of it and let you know when you can resubmit your build<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:24:11)</span> <b>dbox:</b></span> Thanks!<br/>
<span style="color: #c386df"><span style="font-size: small">(15:07:52)</span> <b>matyas:</b></span> you can go ahead and build now<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:40:37)</span> <b>dbox:</b></span> Thanks I will give it a go<br/>
<span style="color: #de5f24"><span style="font-size: small">(17:51:52)</span> <b>justas.balcas:</b></span> Hi, I have condor-ce failing (crashing with core dump) - anyone could take a look what’s wrong?<br/><pre>08/11/21 22:49:56 ChildAliveMsg: failed to send DC_CHILDALIVE to parent daemon at &lt;198.32.44.15:9619&gt; (try 3 of 3): SECMAN:2010:Received "DENIED" from server for user <a href="mailto:condor@users.opensciencegrid.org">condor@users.opensciencegrid.org</a> using method GSI.<br/>08/11/21 22:49:56 ERROR "FAILED TO SEND INITIAL KEEP ALIVE TO OUR PARENT &lt;198.32.44.15:9619?addrs=198.32.44.15-9619&amp;noUDP&amp;sock=192115_4f06&gt;" at line 241 in file /builddir/build/BUILD/condor-8.8.15/src/condor_daemon_core.V6/daemon_keep_alive.cpp<br/>08/11/21 22:49:56 ERROR "Assertion ERROR on (m_ref_count &gt; 0)" at line 102 in file /builddir/build/BUILD/condor-8.8.15/src/condor_utils/classy_counted_ptr.h<br/>Caught signal 6: si_code=4294967290, si_pid=192510, si_uid=0, si_addr=0x2EFFE<br/>Stack dump for process 192510 at timestamp 1628722196 (16 frames)<br/>/lib64/libcondor_utils_8_8_15.so(dprintf_dump_stack+0x24)[0x7fdc2414c6d4]<br/>/lib64/libcondor_utils_8_8_15.so(_Z17unix_sig_coredumpiP9siginfo_tPv+0x69)[0x7fdc242fa4f9]<br/>/lib64/libpthread.so.0(+0xf630)[0x7fdc1f4cd630]<br/>/lib64/libc.so.6(gsignal+0x37)[0x7fdc1f126387]<br/>/lib64/libc.so.6(abort+0x148)[0x7fdc1f127a78]<br/>/lib64/libc.so.6(+0x78f67)[0x7fdc1f168f67]<br/>/lib64/libc.so.6(+0x81329)[0x7fdc1f171329]<br/>/lib64/libcondor_utils_8_8_15.so(_ZN9HashTableI8MyStringS0_ED1Ev+0x40)[0x7fdc241c6650]<br/>/lib64/libc.so.6(+0x39ce9)[0x7fdc1f129ce9]<br/>/lib64/libc.so.6(+0x39d37)[0x7fdc1f129d37]<br/>/lib64/libcondor_utils_8_8_15.so(__wrap_exit+0x65)[0x7fdc243031b5]<br/>/lib64/libcondor_utils_8_8_15.so(_EXCEPT_+0x13f)[0x7fdc241583bf]<br/>/lib64/libcondor_utils_8_8_15.so(+0x10e6ca)[0x7fdc241226ca]<br/>/lib64/libcondor_utils_8_8_15.so(+0x2a0afe)[0x7fdc242b4afe]<br/>/lib64/libc.so.6(__cxa_finalize+0x9a)[0x7fdc1f12a05a]<br/>/lib64/libcondor_utils_8_8_15.so(+0x1102e3)[0x7fdc241242e3]</pre><br/>
</body>
</html>
