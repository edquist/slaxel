<!DOCTYPE html>
<html>
<head>
<title>Mon Mar 30, 2020 : #software (osg)</title>
</head>
<body>
<h3>Mon Mar 30, 2020 : #software (osg)</h3>
<span style="color: #a63024"><span style="font-size: small">(21:07:35)</span> <b>efajardo:</b></span> <b>@here</b> I need some help. I see no LIGO pilots running in OSG. They are running fine on EGI. I tried this against one of the UCSD CE:<br/><br/><br/>
<span style="color: #a63024"><span style="font-size: small">(21:07:35)</span> <b>efajardo:</b></span> <pre>X509_USER_PROXY=/tmp/pilot_proxy condor_ce_trace --debug <a href="http://osg-gw-7.t2.ucsd.edu">osg-gw-7.t2.ucsd.edu</a><br/>03/30/20 19:05:03 Result of reading /etc/issue:  CentOS release 6.9 (Final)<br/> <br/>03/30/20 19:05:03 Using processor count: 4 processors, 4 CPUs, 0 HTs<br/>03/30/20 19:05:03 Enumerating interfaces: lo 127.0.0.1 up<br/>03/30/20 19:05:03 Enumerating interfaces: eth0 169.228.130.104 up<br/>03/30/20 19:05:03 Enumerating interfaces: lo ::1 up<br/>03/30/20 19:05:03 Enumerating interfaces: eth0 2607:f720:1700:1b30::68 up<br/>03/30/20 19:05:03 Enumerating interfaces: eth0 fe80::5054:ff:fef4:a549 up<br/>03/30/20 19:05:03 Will use TCP to update collector <a href="http://osg-gw-7.t2.ucsd.edu">osg-gw-7.t2.ucsd.edu</a> &lt;169.228.130.20:9619&gt;<br/>03/30/20 19:05:03 Trying to query collector &lt;169.228.130.20:9619&gt;<br/>03/30/20 19:05:03 Trying to query collector &lt;169.228.130.20:9619&gt;<br/>Testing HTCondor-CE authorization...<br/>03/30/20 19:05:03 SharedPortClient: sent connection request to daemon at &lt;169.228.130.20:9619&gt; for shared port id collector<br/>Verified READ access for collector daemon at &lt;169.228.130.20:9619?addrs=169.228.130.20-9619&amp;noUDP&amp;sock=collector&gt;<br/>***** Ping response ClassAd ***** <br/>    [<br/>        Command = 60040; <br/>        AuthMethodsList = "GSI"; <br/>        Subsystem = "TOOL"; <br/>        ValidCommands = "60007,457,60020,68,5,6,7,9,12,43,20,46,78,50,56,48,71,74"; <br/>        OutgoingNegotiation = "PREFERRED"; <br/>        Encryption = "NO"; <br/>        AuthCommand = 60020; <br/>        UseSession = "YES"; <br/>        SessionLease = 3600; <br/>        MyRemoteUserName = "unauthenticated@unmapped"; <br/>        RemoteVersion = "$CondorVersion: 8.8.8 Mar 20 2020 PackageID: 8.8.8-1 $"; <br/>        Sid = "osg-gw-7:1084543:1585620303:10361"; <br/>        CryptoMethods = "BLOWFISH,3DES"; <br/>        AuthMethods = "GSI"; <br/>        SessionDuration = "60"; <br/>        User = "unauthenticated@unmapped"; <br/>        Authentication = "NO"; <br/>        Integrity = "NO"; <br/>        Enact = "YES"; <br/>        AuthorizationSucceeded = true<br/>    ]<br/>********************<br/>03/30/20 19:05:03 SharedPortClient: sent connection request to daemon at &lt;169.228.130.20:9619&gt; for shared port id 1084488_5759_3<br/>03/30/20 19:05:03 This process has a valid certificate &amp; key<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='.*,/[/A-Za-z0-9\.]*/Role=[A-Za-z0-9\.]*/Capability=NULL$' canonicalization='GSS_ASSIST_GRIDMAP'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/DC\=com\/DC\=DigiCert-Grid\/O=Open Science Grid\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/DC\=DigiCert-Grid\/DC\=com\/O=Open Science Grid\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/DC\=org\/DC\=opensciencegrid\/O=Open Science Grid\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^/DC=org/DC=incommon/.*/CN=([a-zA-Z0-9\.-]+)$' canonicalization='\<a href="mailto:1@daemon.opensciencegrid.org">1@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/C\=RU\/O\=RDIG\/OU\=hosts\/OU=.*\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/C\=BR\/O\=ANSP\/OU\=ANSPGrid\ CA\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/DC\=org\/DC\=terena\/DC\=tcs.*\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@daemon.opensciencegrid.org">2@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^\/DC\=ch\/DC\=cern\/OU\=computers\/CN\=(host\/)?([A-Za-z0-9.\-]*)$' canonicalization='\<a href="mailto:2@cern.ch">2@cern.ch</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='^/CN=([-.A-Za-z0-9/= ]+)$' canonicalization='\<a href="mailto:1@daemon.opensciencegrid.org">1@daemon.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='(.*)' canonicalization='GSS_ASSIST_GRIDMAP'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='GSI' principal='(/CN=[-.A-Za-z0-9/= ]+)' canonicalization='\<a href="mailto:1@unmapped.opensciencegrid.org">1@unmapped.opensciencegrid.org</a>'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='CLAIMTOBE' principal='.*' canonicalization='anonymous@claimtobe'<br/>03/30/20 19:05:03 MapFile: Canonicalization File: method='FS' principal='(.*)' canonicalization='\1'<br/>03/30/20 19:05:03 ZKM: successful mapping to <a href="mailto:osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org">osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org</a><br/>03/30/20 19:05:03 SECMAN: FAILED: Received "DENIED" from server for user <a href="mailto:osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a> using method GSI.<br/>********************************************************************************<br/>2020-03-30 19:05:03 ERROR: WRITE access failed for scheduler daemon at<br/>&lt;169.228.130.20:9619?addrs=169.228.130.20-9619&amp;noUDP&amp;sock=1084488_5759_3&gt;.<br/>WRITE failed!<br/>SECMAN:2010:Received "DENIED" from server for user osg-<br/><a href="mailto:ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a> using method GSI.<br/>AUTHENTICATE:1004:Failed to authenticate using FS</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(21:08:03)</span> <b>efajardo:</b></span> On the factory all I see is the same<br/>
<span style="color: #a63024"><span style="font-size: small">(21:08:06)</span> <b>efajardo:</b></span> <pre>entry_q CMSHTPC_T2_US_UCSD_gw7 -l 1802984.0 | grep reason -i<br/>HoldReason = "Error connecting to schedd <a href="http://osg-gw-7.t2.ucsd.edu">osg-gw-7.t2.ucsd.edu</a>: SECMAN:2010:Received \"DENIED\" from server for user <a href="mailto:osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a> using method GSI.|AUTHENTICATE:1004:Failed to authenticate using FS"<br/>HoldReasonCode = 0<br/>HoldReasonSubCode = 0<br/>ReleaseReason = undefined</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(21:08:49)</span> <b>efajardo:</b></span> And the CE SchedLog says only:<br/>
<span style="color: #a63024"><span style="font-size: small">(21:08:50)</span> <b>efajardo:</b></span> <pre>03/30/20 19:08:23 TransferQueueManager download 1m I/O load: 0 bytes/s  0.000 disk load  0.000 net load<br/>03/30/20 19:08:24 PERMISSION DENIED to <a href="mailto:osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a> from host 169.228.38.43 for command 1112 (QMGMT_WRITE_CMD), access level WRITE: reason: WRITE authorization policy contains no matching ALLOW entry for this request; identifiers used for this host: 169.228.38.43, hostname size = 0, original ip address = 169.228.38.43<br/>03/30/20 19:08:24 (cid:10) Command=QMGMT_WRITE_CMD, peer=&lt;169.228.38.43:25086&gt;<br/>03/30/20 19:08:24 (cid:10) AuthMethod=GSI, AuthId=/DC=org/DC=incommon/C=US/ST=CA/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a>, <a href="mailto:CondorId=osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">CondorId=osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a><br/>03/30/20 19:08:24 (cid:10) Authorization Denied</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(21:09:09)</span> <b>bbockelm:</b></span> what's <tt>condor_ce_config_val ALLOW_WRITE</tt> say/<br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:10)</span> <b>efajardo:</b></span> <pre>condor_ce_config_val ALLOW_WRITE</pre><br/><br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:11)</span> <b>efajardo:</b></span> <a href="mailto:osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org">osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org</a>/osg-gw-7.t2.ucsd.edu <a href="mailto:condor@users.opensciencegrid.org">condor@users.opensciencegrid.org</a>/osg-gw-7.t2.ucsd.edu condor@child/osg-gw-7.t2.ucsd.edu<br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:19)</span> <b>efajardo:</b></span> but this is not specific ot UCSD<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:10:30)</span> <b>bbockelm:</b></span> The UCSD ALLOW_WRITE doesn't look ... right.<br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:30)</span> <b>efajardo:</b></span> I did change the VOMS cer for the voms fake with the new one<br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:54)</span> <b>efajardo:</b></span> As far as I see that comes from the default one<br/>
<span style="color: #a63024"><span style="font-size: small">(21:10:56)</span> <b>efajardo:</b></span> <pre>ondor_ce_config_val ALLOW_WRITE -v<br/>ALLOW_WRITE = <a href="mailto:osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org">osg-gw-7.t2.ucsd.edu@daemon.opensciencegrid.org</a>/osg-gw-7.t2.ucsd.edu <a href="mailto:condor@users.opensciencegrid.org">condor@users.opensciencegrid.org</a>/osg-gw-7.t2.ucsd.edu condor@child/osg-gw-7.t2.ucsd.edu<br/> # at: /etc/condor-ce/config.d/01-ce-auth.conf, line 27</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(21:11:02)</span> <b>dweitzel:</b></span> How new of a VOMS cert?<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:11:11)</span> <b>bbockelm:</b></span> ah, that could also do it.  It might be dropping off the VOMS extension and mapping as something else.<br/>
<span style="color: #235e5b"><span style="font-size: small">(21:11:14)</span> <b>dweitzel:</b></span> Is this a new update with the state change?<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:11:53)</span> <b>bbockelm:</b></span> In fact, all pilots are supposed to map to <tt><a href="mailto:something@users.opensciencegrid.org">something@users.opensciencegrid.org</a></tt> while you're seeing `<br/><pre><a href="mailto:osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org">osg-ligo-1.t2.ucsd.edu@daemon.opensciencegrid.org</a></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(21:12:17)</span> <b>bbockelm:</b></span> That strongly suggests a VOMS extension is considered invalid and being silently dropped.<br/>
<span style="color: #a63024"><span style="font-size: small">(21:12:36)</span> <b>efajardo:</b></span> ahh I foudn the problem<br/>
<span style="color: #a63024"><span style="font-size: small">(21:12:43)</span> <b>efajardo:</b></span> thanks for poitingi me to Brian<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:12:50)</span> <b>bbockelm:</b></span> VOMS validation is very sensitive to the DN of the VOMS signing certificate.  Did that change?<br/>
<span style="color: #a63024"><span style="font-size: small">(21:12:52)</span> <b>efajardo:</b></span> so I had a <tt>voms-proxy-fake</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(21:13:16)</span> <b>efajardo:</b></span> I created it like this<br/>
<span style="color: #a63024"><span style="font-size: small">(21:13:18)</span> <b>efajardo:</b></span> <pre>voms-proxy-fake -debug \<br/>    -cert $PILOT_CERT_DIR/pilot-cert.pem \<br/>    -key $PILOT_CERT_DIR/pilot-key.pem \<br/>    -out /tmp/pilot_proxy.new \<br/>    -hours 72 \<br/>    -rfc \<br/>    -fqan /osg/ligo/Role=NULL/Capability=NULL \<br/>    -uri <a href="http://voms.opensciencegrid.org:15027">voms.opensciencegrid.org:15027</a> \<br/>    -hostcert $VOMS_CERT_DIR/vomscert.pem \<br/>    -hostkey $VOMS_CERT_DIR/vomskey.pem   \<br/>    -voms osg</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(21:13:36)</span> <b>efajardo:</b></span> it turns out the vomskey was not the corresponing private part for vomscert<br/>
<span style="color: #a63024"><span style="font-size: small">(21:13:47)</span> <b>efajardo:</b></span> but <tt>voms-proxy-fake</tt> was not complaining<br/>
<span style="color: #a63024"><span style="font-size: small">(21:16:07)</span> <b>efajardo:</b></span> in fact it does not complain at all neither the CE it is just silently being dropped<br/>
<span style="color: #a63024"><span style="font-size: small">(21:16:14)</span> <b>efajardo:</b></span> ok thanks @bbockelm<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:16:41)</span> <b>bbockelm:</b></span> I believe we already have a HTCondor fix that logs clearly when it is dropped.  Let me find the ticket.<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:18:03)</span> <b>bbockelm:</b></span> <a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=5916">https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=5916</a> Fixed in 8.9.3 it appears.<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:18:26)</span> <b>bbockelm:</b></span> Trust me, the only reason why I knew to suggest this is because of how many hours I've lost tracking down similar cases.<br/>
</body>
</html>
