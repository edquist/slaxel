<!DOCTYPE html>
<html>
<head>
<title>Mon Mar 8, 2021 : #software (osg)</title>
</head>
<body>
<h3>Mon Mar 8, 2021 : #software (osg)</h3>
<span style="color: #de5f24"><span style="font-size: small">(12:29:47)</span> <b>justas.balcas:</b></span> Hi, OSG 3.6 and condor - any hints on this error:<br/><pre>03/08/21 10:26:34 config Macros = 120, Sorted = 120, StringBytes = 3870, TablesBytes = 4432<br/>03/08/21 10:26:34 CLASSAD_CACHING is OFF<br/>03/08/21 10:26:34 Daemon Log is logging: D_ALWAYS D_ERROR<br/>03/08/21 10:26:35 SECMAN: failed to create non-negotiated security session family:52c00d888b132ca8125a6a301eb0a3cdd45a5188e61a52f4 becauseReconcileSecurityPolicyAds() failed.<br/>03/08/21 10:26:35 ERROR: Failed to create family security session.<br/>03/08/21 10:26:35 SharedPortEndpoint: waiting for connections to named socket master_2234817_2807<br/>03/08/21 10:26:35 SharedPortEndpoint: failed to open /var/lock/condor/shared_port_ad: No such file or directory<br/>03/08/21 10:26:35 SharedPortEndpoint: did not successfully find SharedPortServer address. Will retry in 60s.<br/>03/08/21 10:26:35 DaemonCore: private command socket at &lt;10.3.11.30:0?alias=blade-20.tier2&amp;sock=master_2234817_2807&gt;<br/>03/08/21 10:26:35 Adding SHARED_PORT to DAEMON_LIST, because USE_SHARED_PORT=true (to disable this, set AUTO_INCLUDE_SHARED_PORT_IN_DAEMON_LIST=False)<br/>03/08/21 10:26:35 Master restart (GRACEFUL) is watching /usr/sbin/condor_master (mtime:1614040481)<br/>03/08/21 10:26:35 Cannot remove wait-for-startup file /var/lock/condor/shared_port_ad<br/>03/08/21 10:26:35 Starting shared port with port: 9618<br/>03/08/21 10:26:35 SECMAN: failed to create non-negotiated security session 899f74ea040e9d3a9f765c125ed0dc65e1e7528193e5bbcd becauseReconcileSecurityPolicyAds() failed.<br/>03/08/21 10:26:35 ERROR: Create_Process failed to create security session for child daemon.<br/>03/08/21 10:26:35 ERROR: Create_Process failed trying to start /usr/libexec/condor/condor_shared_port<br/>03/08/21 10:26:35 restarting /usr/libexec/condor/condor_shared_port in 10 seconds</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(13:00:42)</span> <b>bbockelm:</b></span> @justas.balcas -<br/><pre>03/08/21 10:26:35 SECMAN: failed to create non-negotiated security session family:52c00d888b132ca8125a6a301eb0a3cdd45a5188e61a52f4 becauseReconcileSecurityPolicyAds() failed.</pre><br/>That's condor's strange way of saying that something in the condor config resulted in an impossible configuration (e.g., AUTHENTICATION set to NEVER but ENCRYPTION set to REQUIRED).<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:01:03)</span> <b>bbockelm:</b></span> I _might_ be able to spot the problem from a <tt>condor_config_val -dump SEC_</tt> output<br/>
<span style="color: #de5f24"><span style="font-size: small">(13:57:10)</span> <b>justas.balcas:</b></span> <pre>[root@blade-20 ~]# condor_config_val -dump SEC_<br/># Configuration from machine: blade-20.tier2<br/><br/># Parameters with names that match SEC_:<br/>SEC_CLAIMTOBE_INCLUDE_DOMAIN = false<br/>SEC_CLAIMTOBE_USER =<br/>SEC_CREDENTIAL_REFRESH_INTERVAL = -1<br/>SEC_CREDENTIAL_SWEEP_DELAY = 3600<br/>SEC_CREDENTIAL_SWEEP_INTERVAL = 300<br/>SEC_DEBUG_PRINT_KEYS = false<br/>SEC_DEFAULT_AUTHENTICATION = REQUIRED<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = GSI<br/>SEC_DEFAULT_AUTHENTICATION_TIMEOUT = 20<br/>SEC_DEFAULT_INTEGRITY = REQUIRED<br/>SEC_ENABLE_IMPERSONATION_TOKENS = false<br/>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = true<br/>SEC_IMPERSONATION_TOKEN_LIMITS =<br/>SEC_INVALIDATE_SESSIONS_VIA_TCP = true<br/>SEC_ISSUED_TOKEN_EXPIRATION =<br/>SEC_PASSWORD_DIRECTORY = /etc/condor/passwords.d<br/>SEC_PASSWORD_DOMAIN =<br/>SEC_PASSWORD_FILE = $(SEC_PASSWORD_DIRECTORY)/POOL<br/>SEC_SCITOKENS_ALLOW_EXTRA_SLASH = false<br/>SEC_SESSION_DURATION_SLOP = 20<br/>SEC_TCP_SESSION_TIMEOUT = 20<br/>SEC_TOKEN_BLACKLIST_EXPR =<br/>SEC_TOKEN_DIRECTORY =<br/>SEC_TOKEN_ISSUER_KEY = POOL<br/>SEC_TOKEN_MAX_AGE =<br/>SEC_TOKEN_REQUEST_LIMITS =<br/>SEC_TOKEN_SYSTEM_DIRECTORY = /etc/condor/tokens.d<br/>SEC_USE_FAMILY_SESSION = true</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:39:25)</span> <b>bbockelm:</b></span> @justas.balcas - thanks!  Unfortunately, nothing too obvious.  Can you set <tt>MASTER_DEBUG=D_FULLDEBUG,D_SECURITY</tt>, restart the condor service, and paste the log (may need to do a GitHub gist) with the more verbose settings?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:40:03)</span> <b>bbockelm:</b></span> (what condor version is this?)<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:28:58)</span> <b>justas.balcas:</b></span> <a href="https://gist.github.com/juztas/b81db8ea7659c2f9f0d251aa1e4b34a0">https://gist.github.com/juztas/b81db8ea7659c2f9f0d251aa1e4b34a0</a><br/><pre>[root@blade-20 condor]# yum list  installed | grep condor<br/>condor.x86_64                        8.9.11-1.3.osg36.el7             @osg<br/>condor-classads.x86_64               8.9.11-1.3.osg36.el7             @osg<br/>condor-procd.x86_64                  8.9.11-1.3.osg36.el7             @osg<br/>python2-condor.x86_64                8.9.11-1.3.osg36.el7             @osg<br/>python3-condor.x86_64                8.9.11-1.3.osg36.el7             @vince_osg </pre><br/>
<span style="color: #674b1b"><span style="font-size: small">(15:47:00)</span> <b>rynge:</b></span> Testing out 3.6. Smaller typo on <a href="https://opensciencegrid.org/docs/release/updating-to-osg-36/">https://opensciencegrid.org/docs/release/updating-to-osg-36/</a> <tt>systemctl start htcondor-ce</tt> should be <tt>systemctl start condor-ce</tt><br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(2021-03-09 08:55:07)</span> <b>blin:</b></span> fixed! PRs always welcome in the future :wink:<br/>
</blockquote>
<span style="color: #9e3997"><span style="font-size: small">(16:22:12)</span> <b>bbockelm:</b></span> @justas.balcas ha!  I bet it's this one:<br/><pre>03/08/21 13:26:41 Filtering authentication methods (GSI) prior to offering them remotely.<br/>03/08/21 13:26:41 Ignoring GSI method because it is not available to this build of HTCondor.</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:22:31)</span> <b>bbockelm:</b></span> OSG 3.6 -&gt; no GSI!<br/><br/>Might I interest you in an IDTOKEN?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:22:51)</span> <b>bbockelm:</b></span> @blin ^^^ I know you're vacationing today but bookmark for tomorrow.<br/>
<span style="color: #de5f24"><span style="font-size: small">(16:35:08)</span> <b>justas.balcas:</b></span> Sure - what it needs? US-CMS added requirement for WN/Squids to be under 3.6  (not CE, GridFTP yet)  - so wanted to find out what is needed. HTCondor Hosts documentation is very limited (not mentioning anything about idtokens ;)): <a href="https://opensciencegrid.org/docs/release/updating-to-osg-36/">https://opensciencegrid.org/docs/release/updating-to-osg-36/</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:35:46)</span> <b>bbockelm:</b></span> Ah - let me find some upstream docs.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:36:36)</span> <b>bbockelm:</b></span> To transition to this, I would suggest first updating the collector to the 8.9.x series (enable osg-upcoming).  That can speak both GSI + IDTOKENS.<br/>
<span style="color: #de5f24"><span style="font-size: small">(16:41:26)</span> <b>justas.balcas:</b></span> that is a bit more fragile test :)) I will need to test it on a separate pool, not to break main one<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:49:28)</span> <b>bbockelm:</b></span> Sure.  But you definitely need to do collector first then the worker nodes so you always have a mutual working method.<br/>
<span style="color: #de5f24"><span style="font-size: small">(18:13:19)</span> <b>justas.balcas:</b></span> @bbockelm how do I ensure GSI and Tokens are enabled?<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:23:28)</span> <b>andrew.melo:</b></span> OSG 3.6 drops GSI alltogether, so you need to OSG3.5 + osg-upcoming to be able to do both<br/>
<span style="color: #de5f24"><span style="font-size: small">(19:36:14)</span> <b>justas.balcas:</b></span> There should be then a clear documentation how to update to 3.6. It also requires to update Collector, Negotiator, get tokens working, means also all schedds (behind CE) need to be updated. So I miss the point how we can achieve Update WN/Squid to 3.6 :slightly_smiling_face:<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:40:57)</span> <b>andrew.melo:</b></span> Well, this slack probably has the highest density per-capita of people knowledgable about how to migrate to the new OSG release, so you're on the right track :slightly_smiling_face:<br/>
<span style="color: #de5f24"><span style="font-size: small">(19:41:27)</span> <b>justas.balcas:</b></span> Or requirement for everything  3.6(except CE, Condor, gridftp)?<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:42:38)</span> <b>bbockelm:</b></span> Actually the schedd’s don’t need to be updated to 3.6 - they can be in 3.5 + upcoming (which supports GSI and TOKENS)<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:43:14)</span> <b>bbockelm:</b></span> In fact, if your collector is on 3.5 + upcoming, the schedd doesn’t need to update at all.<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:44:50)</span> <b>bbockelm:</b></span> (Schedd needs to auth with collector, collector and worker need to auth.  3.5 supports GSI, 3.5 + upcoming supports GSI+IDTOKENS, 3.6 supports IDTOKENS.  I think we can build a 3D compatibility matrix from that?)<br/>
<span style="color: #de5f24"><span style="font-size: small">(19:46:16)</span> <b>justas.balcas:</b></span> cha! that is the catch - collector/neg - 3.5 upcoming, while WN 3.6, schedds - can be also 3.5 upcoming<br/>
<span style="color: #de5f24"><span style="font-size: small">(19:47:28)</span> <b>justas.balcas:</b></span> by collector 3.5 + upcoming - you mean from 3.6 upcoming?<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:48:17)</span> <b>bbockelm:</b></span> Yup. Because the schedd doesn’t need to auth with the WN directly (collector helps set this up), the schedd can be on 3.5 plain if collector is on 3.5 + upcoming<br/>
<span style="color: #de5f24"><span style="font-size: small">(19:53:26)</span> <b>justas.balcas:</b></span> that is what I tried to update collector from: 8.8.12-1.1.osg35.el7 to 8.9.11-1.3.osg36.el7 and it failed with same error as WN.<br/>
<span style="color: #de5f24"><span style="font-size: small">(20:18:32)</span> <b>justas.balcas:</b></span> I got 8.9.11 Collector running from 3.5-upcoming (while schedds and WNs are 8.8.x) I think I miss now some kind of configuration. Now WN keeps failing:<br/><pre>03/08/21 18:13:47 Filtering authentication methods (GSI) prior to offering them remotely.<br/>03/08/21 18:13:47 Ignoring GSI method because it is not available to this build of HTCondor.<br/>03/08/21 18:13:47 SECMAN: no auth methods, but a feature was required! failing...<br/>03/08/21 18:13:47 SECMAN: ERROR: The security policy is invalid.<br/>03/08/21 18:13:47 ERROR: SECMAN:2002:Configuration Problem: The security policy is invalid.<br/>03/08/21 18:13:47 Failed to start non-blocking update to &lt;10.3.10.124:9618&gt;.<br/>03/08/21 18:14:37 Getting monitoring info for pid 2295864</pre><br/>
</body>
</html>
