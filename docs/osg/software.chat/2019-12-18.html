<!DOCTYPE html>
<html>
<head>
<title>Wed Dec 18, 2019 : #software (osg)</title>
</head>
<body>
<h3>Wed Dec 18, 2019 : #software (osg)</h3>
<span style="color: #235e5b"><span style="font-size: small">(09:55:37)</span> <b>dweitzel:</b></span> I need help debugging a hosted ce.  The # of processors is not being picked up correctly.<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:55:47)</span> <b>dweitzel:</b></span> picked up correctly by gratia.<br/>
<span style="color: #43761b"><span style="font-size: small">(09:56:37)</span> <b>blin:</b></span> is this the one where we updated the gratia probe?<br/>
<span style="color: #43761b"><span style="font-size: small">(09:56:40)</span> <b>blin:</b></span> hosted ce 13?<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:56:44)</span> <b>dweitzel:</b></span> yes, <a href="http://hosted-ce13.grid.uchicago.edu">hosted-ce13.grid.uchicago.edu</a><br/>
<span style="color: #43761b"><span style="font-size: small">(09:57:24)</span> <b>blin:</b></span> are you still getting records with the processor field set to the classad expr?<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:59:08)</span> <b>dweitzel:</b></span> nope<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:59:13)</span> <b>dweitzel:</b></span> now it's set to 1, should be 28<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:01:56)</span> <b>dweitzel:</b></span> I don't see that the factory is requesting 28 cores.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:02:13)</span> <b>dweitzel:</b></span> @marco.mascheroni any idea how the request is translated to slurm?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:02:31)</span> <b>dweitzel:</b></span> Is there some local submit file that adds some slurm lines?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:02:45)</span> <b>blin:</b></span> 28? dayum<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:02:46)</span> <b>marco.mascheroni:</b></span> I can check, I have not reinstalled Bosco, maybe Suchandra put something in place<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:03:42)</span> <b>marco.mascheroni:</b></span> uhm..<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:03:44)</span> <b>dweitzel:</b></span> From a job, it looks like the factory is setting <tt>RequestCpus=1</tt><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:03:45)</span> <b>marco.mascheroni:</b></span> <pre>#!/bin/bash<br/># SLURM job wrapper generated by slurm_submit.sh<br/># on Wed Dec 18 09:28:25 EST 2019<br/>#<br/># stgcmd = no<br/># proxy_string = /home/uscms/bosco/sandbox/8d19/8d19dad1/hosted-ce13.grid.uchicago.edu_9619_<a href="http://hosted-ce13.grid.uchicago.edu#57414.0#1576679288/credential_HEPCloud-cmsde01-fnal-gov.cms_xsede_passthrough_701093">hosted-ce13.grid.uchicago.edu#57414.0#1576679288/credential_HEPCloud-cmsde01-fnal-gov.cms_xsede_passthrough_701093</a><br/># proxy_local_file = /home/uscms/bosco/sandbox/8d19/8d19dad1/hosted-ce13.grid.uchicago.edu_9619_<a href="http://hosted-ce13.grid.uchicago.edu#57414.0#1576679288/credential_HEPCloud-cmsde01-fnal-gov.cms_xsede_passthrough_701093">hosted-ce13.grid.uchicago.edu#57414.0#1576679288/credential_HEPCloud-cmsde01-fnal-gov.cms_xsede_passthrough_701093</a><br/>#<br/># SLURM directives:<br/>#SBATCH -o /dev/null<br/>#SBATCH -e /dev/null<br/>#SBATCH -C EGRESS<br/>#SBATCH -N 1<br/>#SBATCH -p RM<br/>#SBATCH -t 48:00:00<br/>#SBATCH --ntasks-per-node 1<br/>#SBATCH -A ph561hp</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:04:06)</span> <b>dweitzel:</b></span> ok, let me look up slurm directives.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:04:12)</span> <b>dweitzel:</b></span> I think the -N 1 is nodes=1<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:04:38)</span> <b>marco.mascheroni:</b></span> the factory has:<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:04:41)</span> <b>marco.mascheroni:</b></span> <pre>&lt;submit_attr name="+NodeNumber" value="1"/&gt;</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:04:44)</span> <b>marco.mascheroni:</b></span> but<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:04:52)</span> <b>marco.mascheroni:</b></span> <pre>&lt;attr name="GLIDEIN_CPUS" const="True" glidein_publish="False" job_publish="True" parameter="True" publish="True" type="string" value="28"/&gt;</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:05:18)</span> <b>marco.mascheroni:</b></span> the second is only used by condor in the user pool, not by the batch system at the syte<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:05:30)</span> <b>dweitzel:</b></span> yes, -N=1<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:05:43)</span> <b>dweitzel:</b></span> I think what's happening is that bridges is all 28 core nodes.  And you are requesting 1 node.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:06:02)</span> <b>dweitzel:</b></span> but in the htcondor-ce submission from the factory, it's just requesting 1 core, but giving the glidein different information.<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:06:09)</span> <b>marco.mascheroni:</b></span> I assume that it is a whole node configuraiton<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:06:28)</span> <b>dweitzel:</b></span> where is the osg glideinwms factory config github repo?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:06:39)</span> <b>dweitzel:</b></span> The FNAL factory probably needs to copy at least 1 line.<br/>
<span style="color: #43761b"><span style="font-size: small">(10:06:41)</span> <b>blin:</b></span> <a href="https://github.com/opensciencegrid/osg-gfactory">https://github.com/opensciencegrid/osg-gfactory</a><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:07:05)</span> <b>marco.mascheroni:</b></span> xcount ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:07:57)</span> <b>dweitzel:</b></span> This looks right:<br/><pre>&lt;submit_attrs&gt;&lt;submit_attr name="RequestCpus" value="28"/&gt;               &lt;/submit_attrs&gt;</pre>```<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:08:06)</span> <b>dweitzel:</b></span> man that formatted baddly<br/>
<span style="color: #43761b"><span style="font-size: small">(10:08:13)</span> <b>blin:</b></span> i imagine forcing <tt>-N 1</tt> was due to the old version of Bosco, which didn't handle node number properly<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:08:26)</span> <b>dweitzel:</b></span> <pre>&lt;submit_attrs&gt;<br/>     &lt;submit_attr name="RequestCpus" value="28"/&gt;<br/>&lt;/submit_attrs&gt;</pre><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:09:00)</span> <b>marco.mascheroni:</b></span> ok. We usually use xcount instead of RequestCpus<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:09:35)</span> <b>dweitzel:</b></span> whichever, probably.<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:09:46)</span> <b>marco.mascheroni:</b></span> I should probably reinstall bosco, but it does not feel good to do it on a Friday before a long break<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:09:56)</span> <b>dweitzel:</b></span> (today is wed.)<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:10:30)</span> <b>marco.mascheroni:</b></span> ok, maybe there is hope then :smile:<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:10:53)</span> <b>marco.mascheroni:</b></span> I can do it tomorrow morning, should be fine<br/>
<span style="color: #43761b"><span style="font-size: small">(10:10:53)</span> <b>blin:</b></span> i wouldn't change RequestCpus -&gt; xcount unless you update Bosco<br/>
<span style="color: #43761b"><span style="font-size: small">(10:11:13)</span> <b>blin:</b></span> i think with the old Bosco, setting xcount would result in <tt>-N 28</tt><br/>
<span style="color: #e23f99"><span style="font-size: small">(10:11:14)</span> <b>marco.mascheroni:</b></span> in the factory they are not wtting either<br/>
<span style="color: #43761b"><span style="font-size: small">(10:11:17)</span> <b>blin:</b></span> but i'd have to double-check that<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:11:22)</span> <b>marco.mascheroni:</b></span> ok<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:12:10)</span> <b>marco.mascheroni:</b></span> So next steps:<br/>1. Reinstall bosco<br/>2. Set xcount to 28 instead of NodeNumber<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:12:27)</span> <b>dweitzel:</b></span> do you have to contact FNAL for the xcount change?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:12:48)</span> <b>dweitzel:</b></span> I can do the corrections in gracc at any time.<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:13:06)</span> <b>marco.mascheroni:</b></span> yes<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:28:42)</span> <b>dweitzel:</b></span> ok, I was wrong.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:28:55)</span> <b>dweitzel:</b></span> I can't do the corrections at any time.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:29:43)</span> <b>dweitzel:</b></span> Marco, could you set the xcount or whatever manually in the CE config.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:30:17)</span> <b>dweitzel:</b></span> I'm not entirely sure how to do that on incoming jobs.<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:30:35)</span> <b>dweitzel:</b></span> and you probably want to qedit existing jobs as well.<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:57:27)</span> <b>marco.mascheroni:</b></span> BTW, which version of bosco is being isntalled now, and from where?<br/>
<span style="color: #e23f99"><span style="font-size: small">(10:57:38)</span> <b>marco.mascheroni:</b></span> Steve Timm asked me about it<br/>
<span style="color: #43761b"><span style="font-size: small">(11:04:50)</span> <b>blin:</b></span> any recent HTCondor version installed from the OSG will be using Bosco 1.3, the OSG/HTCondor unified version<br/>
<span style="color: #43761b"><span style="font-size: small">(11:05:08)</span> <b>blin:</b></span> if they're getting HTCondor from the CHTC yum repos, I believe that's only the case for HTCondor 8.9.x<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:47:52)</span> <b>marco.mascheroni:</b></span> Any suggestion on how to force requestcpus in the ce? Should I just add to the JOB_ROUTER_ENTRIES requestCpus=28 ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(12:48:26)</span> <b>dweitzel:</b></span> I think gratia looks at the pre-routed job (not 100 sure though)<br/>
<span style="color: #e23f99"><span style="font-size: small">(13:07:12)</span> <b>marco.mascheroni:</b></span> I qedited the one in queue for the time being<br/>
<span style="color: #e23f99"><span style="font-size: small">(13:07:58)</span> <b>marco.mascheroni:</b></span> Anyway, steve just said he should be able to change the attr in the factory before the end of the day<br/>
</body>
</html>
