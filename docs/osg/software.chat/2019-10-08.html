<!DOCTYPE html>
<html>
<head>
<title>Tue Oct 8, 2019 : #software (osg)</title>
</head>
<body>
<h3>Tue Oct 8, 2019 : #software (osg)</h3>
<span style="color: #a72f79"><span style="font-size: small">(14:08:08)</span> <b>andrew.melo:</b></span> Hmmm. I have the following set in the xrootd config:<br/><pre><br/>sec.protocol /usr/lib64 gsi -certdir:/etc/grid-security/certificates -cert:/etc/grid-security/hostcert-xrootd.pem -key:/etc/grid-security/hostkey-xrootd.pem -crl:1 -moninfo -authzfunparms:--lcmapscfg=/etc/lcmaps.db,--loglevel=5 -gmapopt:10 -gmapto:0<br/></pre><br/>and then the corresponding opts in /etc/lcmaps.db<br/><pre><br/>xrootd_policy:<br/>verifyproxynokey -&gt; banfile<br/>banfile -&gt; banvomsfile | bad<br/>banvomsfile -&gt; gridmapfile | bad<br/>gridmapfile -&gt; good | vomsmapfile<br/>vomsmapfile -&gt; good | defaultmapfile<br/>defaultmapfile -&gt; good | bad<br/></pre><br/>But adding a user's DN to /etc/grid-mapfile/banmapfile doesn't actually get them banned<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:10:25)</span> <b>jthiltges:</b></span> Any chance that the <tt>LCMAPS_POLICY_NAME</tt> env var is being set somewhere for the xrootd daemon, and is not <tt>xrootd_policy</tt>?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:15:06)</span> <b>blin:</b></span> @andrew.melo what version of xrootd-lcmaps are you running?<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:15:30)</span> <b>andrew.melo:</b></span> 1.7.0-1.osg34.el7<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:15:37)</span> <b>andrew.melo:</b></span> @jthiltges I don't think so<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:15:55)</span> <b>andrew.melo:</b></span> (btw Brian, I didn't forget about the CE. I was hoping to work on it today but got caught up in some other fires)<br/>
<span style="color: #43761b"><span style="font-size: small">(14:18:46)</span> <b>blin:</b></span> i think our documentation is wrong and you should have:<br/><tt>-authzfunparms:lcmapscfg=/etc/lcmaps.db,loglevel=5</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(14:18:59)</span> <b>blin:</b></span> from <a href="https://github.com/opensciencegrid/xrootd-lcmaps/tree/master#configuration">https://github.com/opensciencegrid/xrootd-lcmaps/tree/master#configuration</a><br/>
<span style="color: #e06b56"><span style="font-size: small">(14:21:18)</span> <b>jthiltges:</b></span> I think both old and new authzfunparms styles should work. <a href="https://github.com/opensciencegrid/xrootd-lcmaps/commit/9eaf4498">https://github.com/opensciencegrid/xrootd-lcmaps/commit/9eaf4498</a><br/>
<span style="color: #43761b"><span style="font-size: small">(14:22:24)</span> <b>blin:</b></span> i think what andrew has is a mix of the two, though<br/>
<span style="color: #43761b"><span style="font-size: small">(14:22:41)</span> <b>blin:</b></span> i think the old style would be <tt>-authzfunparms:--lcmapscfg,/etc/lcmaps.db,--loglevel,5</tt><br/>
<span style="color: #e06b56"><span style="font-size: small">(14:23:57)</span> <b>jthiltges:</b></span> Ah, yes! I think you're right.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:30:40)</span> <b>andrew.melo:</b></span> Ahhhh, thanks! One last Q -- We've got quite a bit of xrootd load (for whatever reason), and the log has a lot of<br/><pre><br/>191008 14:29:11 22429 cmsprod.273:826@red-c2331.unl.edu XrootdProtocol: endsess 32697:762.92765<br/>191008 14:29:11 22429 cmsprod.273:826@red-c2331.unl.edu XrootdProtocol: endsess 32697:762.92765 rc=6 (Resource temporarily unavailable)<br/></pre><br/>Which resource is unavailable? Filehandles? nproc? I'd like to bump whatever the limit is since this box has plenty of headroom, but I don't know what to do<br/>
<span style="color: #43761b"><span style="font-size: small">(14:32:19)</span> <b>blin:</b></span> hrm i'm not sure offhand. try asking in #xcache<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:35:40)</span> <b>jthiltges:</b></span> We're running with <tt>LimitNOFILE=65536</tt> fwiw.<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:37:38)</span> <b>andrew.melo:</b></span> what's your nproc limit like?<br/><pre><br/>[root@xrootd1 lfs_roots]# cat /proc/32697/limits <br/>Limit                     Soft Limit           Hard Limit           Units     <br/>Max cpu time              unlimited            unlimited            seconds   <br/>Max file size             unlimited            unlimited            bytes     <br/>Max data size             unlimited            unlimited            bytes     <br/>Max stack size            8388608              unlimited            bytes     <br/>Max core file size        unlimited            unlimited            bytes     <br/>Max resident set          unlimited            unlimited            bytes     <br/>Max processes             30000                256971               processes <br/>Max open files            65536                65536                files     <br/>Max locked memory         65536                65536                bytes     <br/>Max address space         unlimited            unlimited            bytes     <br/>Max file locks            unlimited            unlimited            locks     <br/>Max pending signals       256971               256971               signals   <br/>Max msgqueue size         819200               819200               bytes     <br/>Max nice priority         0                    0                    <br/>Max realtime priority     0                    0                    <br/>Max realtime timeout      unlimited            unlimited            us        <br/></pre><br/>
<span style="color: #e06b56"><span style="font-size: small">(14:39:37)</span> <b>jthiltges:</b></span> That looks nearly identical to ours:<br/><pre>[root@red-gridftp1 ~]# cat /proc/<tt>pgrep xrootd</tt>/limits<br/>Limit                     Soft Limit           Hard Limit           Units     <br/>Max cpu time              unlimited            unlimited            seconds   <br/>Max file size             unlimited            unlimited            bytes     <br/>Max data size             unlimited            unlimited            bytes     <br/>Max stack size            8388608              unlimited            bytes     <br/>Max core file size        unlimited            unlimited            bytes     <br/>Max resident set          unlimited            unlimited            bytes     <br/>Max processes             30000                257536               processes <br/>Max open files            65536                65536                files     <br/>Max locked memory         65536                65536                bytes     <br/>Max address space         unlimited            unlimited            bytes     <br/>Max file locks            unlimited            unlimited            locks     <br/>Max pending signals       257536               257536               signals   <br/>Max msgqueue size         819200               819200               bytes     <br/>Max nice priority         0                    0                    <br/>Max realtime priority     0                    0                    <br/>Max realtime timeout      unlimited            unlimited            us        </pre><br/>
<span style="color: #e96699"><span style="font-size: small">(15:22:23)</span> <b>lincoln:</b></span> &gt;You have been removed from the owners team within the organization: opensciencegrid by an organization administrator.<br/><br/>I assume this was intentional?<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:22:43)</span> <b>bbockelm:</b></span> I think @blin is doing some clean-ups<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:23:00)</span> <b>bbockelm:</b></span> there were some, erm, very crufty entries.<br/>
<span style="color: #43761b"><span style="font-size: small">(15:23:02)</span> <b>blin:</b></span> yeah, if you need access to some of the repos we can add you back<br/>
<span style="color: #e96699"><span style="font-size: small">(15:23:17)</span> <b>lincoln:</b></span> OK, would appreciate some heads up next time :slightly_smiling_face:<br/>
<span style="color: #43761b"><span style="font-size: small">(15:23:32)</span> <b>blin:</b></span> sure thing, sorry!<br/>
</body>
</html>
