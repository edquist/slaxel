<!DOCTYPE html>
<html>
<head>
<title>Wed Aug 7, 2019 : #software (osg)</title>
</head>
<body>
<h3>Wed Aug 7, 2019 : #software (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(13:38:03)</span> <b>bbockelm:</b></span> @didavila - from the build log for your 8.9.2 build:<br/><pre><br/>-- external skipped (SciTokens)<br/></pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(13:59:20)</span> <b>didavila:</b></span> I think I found the problem, Iâ€™m building again now<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:59:37)</span> <b>bbockelm:</b></span> (I also dropped a hint into the ticket; dunno if that helped)<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:03:50)</span> <b>bbockelm:</b></span> @didavila @dweitzel<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:04:06)</span> <b>bbockelm:</b></span> Looks like the build failed due to a change in <tt>scitokens.h</tt><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:04:21)</span> <b>dweitzel:</b></span> there's a change?  What ticket?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:04:35)</span> <b>bbockelm:</b></span> It was this (<a href="https://github.com/scitokens/scitokens-cpp/commit/ac0b2f0679488fa91c14ed781268efbcdb69ed3c">https://github.com/scitokens/scitokens-cpp/commit/ac0b2f0679488fa91c14ed781268efbcdb69ed3c</a>) -- v0.3.0.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:04:48)</span> <b>bbockelm:</b></span> best approach would be to patch HTCondor for Diego's build, I think.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(14:08:08)</span> <b>didavila:</b></span> the error I got was:<br/><pre>/builddir/build/BUILD/condor-8.9.2/src/condor_io/condor_auth_ssl.cpp: In static member function 'static bool Condor_Auth_SSL::Initialize()':<br/>/builddir/build/BUILD/condor-8.9.2/src/condor_io/condor_auth_ssl.cpp:330:27: error: invalid conversion from 'int (*)(const char*, void**, const char* const*, char**)' to 'int (*)(const char*, void**, const char**, char**)' [-fpermissive]<br/>  scitoken_deserialize_ptr = scitoken_deserialize;<br/>                           ^<br/>[ 52%] Building CXX object src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_ckpt_server/network2.cpp.o<br/>[ 52%] Building CXX object src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_ckpt_server/server_interface.cpp.o<br/>[ 52%] Building CXX object src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_daemon_client/dc_transfer_queue.cpp.o<br/>[ 52%] Building CXX object src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_daemon_client/dc_annexd.cpp.o<br/>[ 52%] make[2]: *** [src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_io/condor_auth_ssl.cpp.o] Error 1<br/>make[2]: *** Waiting for unfinished jobs....<br/>Building CXX object src/condor_utils/CMakeFiles/condor_utils_s.dir/__/condor_daemon_client/dc_schedd.cpp.o<br/>make[1]: *** [src/condor_utils/CMakeFiles/condor_utils.dir/all] Error 2<br/>make[1]: *** Waiting for unfinished jobs....<br/>make[1]: *** [src/condor_utils/CMakeFiles/condor_utils_s.dir/all] Error 2<br/>make: *** [all] Error 2<br/>error: Bad exit status from /var/tmp/rpm-tmp.7DL7iF (%build)<br/>RPM build errors:<br/>    Bad exit status from /var/tmp/rpm-tmp.7DL7iF (%build)<br/>Child return code was: 1<br/>EXCEPTION: [Error()]<br/>Traceback (most recent call last):<br/>  File "/usr/lib/python2.6/site-packages/mockbuild/trace_decorator.py", line 89, in trace<br/>    result = func(*args, **kw)<br/>  File "/usr/lib/python2.6/site-packages/mockbuild/util.py", line 578, in do<br/>    raise exception.Error("Command failed. See logs for output.\n # %s" % (command,), child.returncode)<br/>Error: Command failed. See logs for output.<br/> # bash --login -c /usr/bin/rpmbuild -bb --target x86_64 --nodeps /builddir/build/SPECS/condor.spec<br/></pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:09:21)</span> <b>dweitzel:</b></span> ah, passing function pointers around, fun.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:14:14)</span> <b>bbockelm:</b></span> Yup.  Should be a simple, one-line patch... upgrading <tt>scitokens-cpp</tt> locally and rebuilding.<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:21:15)</span> <b>bbockelm:</b></span> @didavila - OK, it's actually two lines:<br/><pre><br/>--- a/src/condor_io/condor_auth_ssl.cpp<br/>+++ b/src/condor_io/condor_auth_ssl.cpp<br/>@@ -157,7 +157,7 @@ static SSL_METHOD *(*SSL_method_ptr)() = NULL;<br/> static const SSL_METHOD *(*SSL_method_ptr)() = NULL;<br/> #endif<br/> #ifdef HAVE_EXT_SCITOKENS<br/>-static int (*scitoken_deserialize_ptr)(const char *value, SciToken *token, const char **allowed_issuers, char **err_msg) = nullptr;<br/>+static int (*scitoken_deserialize_ptr)(const char *value, SciToken *token, const char * const*allowed_issuers, char **err_msg) = nullptr;<br/> static int (*scitoken_get_claim_string_ptr)(const SciToken token, const char *key, char **value, char **err_msg) = nullptr;<br/> static void (*scitoken_destroy_ptr)(SciToken token) = nullptr;<br/> static Enforcer (*enforcer_create_ptr)(const char *issuer, const char **audience, char **err_msg) = nullptr;<br/>@@ -281,7 +281,7 @@ bool Condor_Auth_SSL::Initialize()<br/>        dl_hdl = nullptr;<br/>        if (<br/>                !(dl_hdl = dlopen(LIBSCITOKENS_SO, RTLD_LAZY)) ||<br/>-               !(scitoken_deserialize_ptr = (int (*)(const char *value, SciToken *token, const char **allowed_issuers, char **err_msg))dlsym(dl_hdl, "scitoken_deserialize")) ||<br/>+               !(scitoken_deserialize_ptr = (int (*)(const char *value, SciToken *token, const char * const*allowed_issuers, char **err_msg))dlsym(dl_hdl, "scitoken_deserialize")) ||<br/>                !(scitoken_get_claim_string_ptr = (int (*)(const SciToken token, const char *key, char **value, char **err_msg))dlsym(dl_hdl, "scitoken_get_claim_string")) ||<br/>                !(scitoken_destroy_ptr = (void (*)(SciToken token))dlsym(dl_hdl, "scitoken_destroy")) ||<br/>                !(enforcer_create_ptr = (Enforcer (*)(const char *issuer, const char **audience, char **err_msg))dlsym(dl_hdl, "enforcer_create")) ||<br/></pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(14:26:01)</span> <b>bbockelm:</b></span> (might need to adjust whitespace there too)<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:27:29)</span> <b>dweitzel:</b></span> that <tt>const* const*</tt> syntax is odd for C++, but from what I read, it's the correct way to have a constant array of constant strings.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(16:07:32)</span> <b>didavila:</b></span> sorry it took me so long, I had weird problems with the patch, the new built is here:<br/><a href="https://koji.chtc.wisc.edu/koji/taskinfo?taskID=297172">https://koji.chtc.wisc.edu/koji/taskinfo?taskID=297172</a><br/>
</body>
</html>
