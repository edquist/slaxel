<!DOCTYPE html>
<html>
<head>
<title>Thu Nov 15, 2018 : #software (osg)</title>
</head>
<body>
<h3>Thu Nov 15, 2018 : #software (osg)</h3>
<span style="color: #43761b"><span style="font-size: small">(09:15:49)</span> <b>blin:</b></span> @andrew.melo yeah, i'd definitely be interested in checking that out<br/>
<span style="color: #e96699"><span style="font-size: small">(11:09:31)</span> <b>lincoln:</b></span> <a href="https://www.redhat.com/en/blog/powering-its-future-while-preserving-present-introducing-red-hat-enterprise-linux-8-beta">https://www.redhat.com/en/blog/powering-its-future-while-preserving-present-introducing-red-hat-enterprise-linux-8-beta</a> yay<br/>
<span style="color: #c386df"><span style="font-size: small">(11:22:26)</span> <b>matyas:</b></span> fina. fucking. ly.<br/>
<span style="color: #c386df"><span style="font-size: small">(11:22:36)</span> <b>matyas:</b></span> slowpokes!<br/>
<span style="color: #965d1b"><span style="font-size: small">(12:59:55)</span> <b>briedel:</b></span> @dwd I can't seem to import the repository to a new cvmfs origin server<br/><pre><br/>[root@cvmfs-origin ~]# cvmfs_server import -o connect <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a><br/>The repository <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a> already exists<br/></pre><br/>
<span style="color: #99a949"><span style="font-size: small">(13:02:08)</span> <b>dwd:</b></span> Right, import creates the /etc/cvmfs configuration for a repository.  It should already be there if you copied everything<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:03:02)</span> <b>briedel:</b></span> i did<br/>
<span style="color: #99a949"><span style="font-size: small">(13:03:16)</span> <b>dwd:</b></span> so there should be no need to run import<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:03:24)</span> <b>briedel:</b></span> <pre><br/>[connect@cvmfs-origin ~]$ cvmfs_server transaction <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a><br/>Autofs on /cvmfs has to be disabled<br/></pre><br/>
<span style="color: #99a949"><span style="font-size: small">(13:03:36)</span> <b>dwd:</b></span> True<br/>
<span style="color: #99a949"><span style="font-size: small">(13:03:45)</span> <b>dwd:</b></span> Why is autofs enabled on /cvmfs<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:04:54)</span> <b>briedel:</b></span> not sure<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:04:58)</span> <b>briedel:</b></span> i can disable<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:07:11)</span> <b>briedel:</b></span> closer<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:07:14)</span> <b>briedel:</b></span> <pre><br/>[connect@cvmfs-origin root]$ cvmfs_server transaction <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a><br/>/var/spool/cvmfs/connect.opensciencegrid.org/rdonly is not mounted properly.<br/>/cvmfs/connect.opensciencegrid.org is not mounted properly.<br/>Note: Trying to mount /var/spool/cvmfs/connect.opensciencegrid.org/rdonly... Failed to start var-spool-cvmfs-connect.opensciencegrid.org-rdonly.mount: Unit not found.<br/>fail<br/></pre><br/>
<span style="color: #965d1b"><span style="font-size: small">(13:17:49)</span> <b>briedel:</b></span> @dwd what am i doing wrong now?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:19:02)</span> <b>dwd:</b></span> Oh, there’s also /etc/fstab entries to copy<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:22:37)</span> <b>briedel:</b></span> <pre><br/>[root@cvmfs-origin ~]# mount -a -v<br/>/                        : ignored<br/>/var/spool/cvmfs         : already mounted<br/>/srv/cvmfs               : already mounted<br/>/home                    : already mounted<br/>/var/spool/cvmfs/spt.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/spt.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/xenon.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/xenon.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/veritas.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/veritas.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/nexo.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/nexo.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/spack.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/spack.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/example.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/example.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/bnl.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/bnl.opensciencegrid.org: ignored<br/>/var/spool/cvmfs/connect.opensciencegrid.org/rdonly: ignored<br/>/cvmfs/connect.opensciencegrid.org: ignored<br/>[root@cvmfs-origin ~]# exit<br/>logout<br/>[18-11-15@13:22:16] <a href="mailto:briedel@cvmfs-origin.grid.uchicago.edu">briedel@cvmfs-origin.grid.uchicago.edu</a> /home/briedel<br/>2 $ sudo su -<br/>Last login: Thu Nov 15 12:47:00 CST 2018 on pts/0<br/>[root@cvmfs-origin ~]# su connect<br/>/usr/bin/id: cannot find name for group ID 30031<br/>[connect@cvmfs-origin root]$ cvmfs_server transaction <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a><br/>/var/spool/cvmfs/connect.opensciencegrid.org/rdonly is not mounted properly.<br/>/cvmfs/connect.opensciencegrid.org is not mounted properly.<br/>Note: Trying to mount /var/spool/cvmfs/connect.opensciencegrid.org/rdonly... Failed to start var-spool-cvmfs-connect.opensciencegrid.org-rdonly.mount: Unit not found.<br/>fail<br/></pre><br/>
<span style="color: #99a949"><span style="font-size: small">(13:23:39)</span> <b>dwd:</b></span> I don’t know what those “ignored” things mean.  umount them if you can, and make sure the /etc/fstab entries are copied from the original machine<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:27:16)</span> <b>briedel:</b></span> same issue<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:27:40)</span> <b>briedel:</b></span> the <tt>/etc/fstab</tt> are the same when it comes to cvmfs stuff<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:28:58)</span> <b>briedel:</b></span> <br/>
<span style="color: #965d1b"><span style="font-size: small">(13:29:25)</span> <b>briedel:</b></span> <br/>
<span style="color: #99a949"><span style="font-size: small">(13:35:05)</span> <b>dwd:</b></span> What happens when you do “mount /var/spool/cvmfs/connect.opensciencegrid.org/rdonly”<br/>
<span style="color: #99a949"><span style="font-size: small">(13:35:26)</span> <b>dwd:</b></span> Oh wait, I see the problem<br/>
<span style="color: #99a949"><span style="font-size: small">(13:35:43)</span> <b>dwd:</b></span> You moved from EL6 to EL7, where you now have overlayfs instead of aufs<br/>
<span style="color: #99a949"><span style="font-size: small">(13:37:12)</span> <b>dwd:</b></span> Those /etc/fstab entries look different, for example<br/>cvmfs2#<a href="http://fermilab.opensciencegrid.org">fermilab.opensciencegrid.org</a>	/var/spool/cvmfs/fermilab.opensciencegrid.org/rdonly	fuse	allow_other,config=/etc/cvmfs/repositories.d/fermilab.opensciencegrid.org/client.conf:/var/spool/cvmfs/fermilab.opensciencegrid.org/client.local,cvmfs_suid,noauto	0	0	#	added	by	CernVM-FS	for	<a href="http://fermilab.opensciencegrid.org">fermilab.opensciencegrid.org</a><br/><a href="http://overlay_fermilab.opensciencegrid.org">overlay_fermilab.opensciencegrid.org</a>	/cvmfs/fermilab.opensciencegrid.org	overlay	upperdir=/var/spool/cvmfs/fermilab.opensciencegrid.org/scratch/current,lowerdir=/var/spool/cvmfs/fermilab.opensciencegrid.org/rdonly,workdir=/var/spool/cvmfs/fermilab.opensciencegrid.org/ofs_workdir,noauto,ro	0	0	#added	by	CernVM-FS	for	<a href="http://fermilab.opensciencegrid.org">fermilab.opensciencegrid.org</a><br/>
<span style="color: #99a949"><span style="font-size: small">(13:38:58)</span> <b>dwd:</b></span> There’s probably a way to get cvmfs to make the switch for you by using import, but at this point I think it might be easier to edit the /etc/fstab entries to look like these two lines<br/>
<span style="color: #965d1b"><span style="font-size: small">(13:39:09)</span> <b>briedel:</b></span> yeah<br/>
<span style="color: #99a949"><span style="font-size: small">(13:40:03)</span> <b>dwd:</b></span> I also just remembered entries in /etc/httpd/conf.d.  Those are also slightly different between EL6 &amp; EL7<br/>
<span style="color: #99a949"><span style="font-size: small">(13:41:00)</span> <b>dwd:</b></span> Oh and there’s probably some differences also in the layout of /var/spool/cvmfs.  So I was probably wrong, I probably should have steered you to import<br/>
<span style="color: #99a949"><span style="font-size: small">(13:43:12)</span> <b>dwd:</b></span> So I change the advice to clean out /etc/fstab, remove /var/spool/cvmfs, and /etc/cvmfs/repositories.d.  Leave the keys in /etc/cvmfs/keys though.  Then do the cvmfs_server import for each of the repositories in /srv/cvmfs<br/>
<span style="color: #99a949"><span style="font-size: small">(13:46:32)</span> <b>dwd:</b></span> It looks like import also wants you to add -k /etc/cvmfs/keys<br/>
<span style="color: #99a949"><span style="font-size: small">(13:50:31)</span> <b>dwd:</b></span> There are also per-repository options you’ll need to add in each /etc/cvmfs/repositories.d/repo.name/server.conf as in the install instructions <a href="http://opensciencegrid.org/docs/data/external-oasis-repos/#creating-a-repository">http://opensciencegrid.org/docs/data/external-oasis-repos/#creating-a-repository</a><br/>
<span style="color: #99a949"><span style="font-size: small">(13:51:16)</span> <b>dwd:</b></span> And don’t forget the cron entries for updating the whitelist each day<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:58:14)</span> <b>andrew.melo:</b></span> FWIW, I had to migrate between hosts, so on the new host, I just acted like I was making a brand new repo (so it would set up all the weird OS things), then replaced the keys, spool and srv paths with the ones from the old host and rebooted<br/>
<span style="color: #99a949"><span style="font-size: small">(14:02:09)</span> <b>dwd:</b></span> Was that between EL6 &amp; EL7?  I think more would need to change in /var/spool/cvmfs then<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:03:45)</span> <b>andrew.melo:</b></span> hmm. don't quite remember. I set it up on a throwaway VM the first time around<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:03:48)</span> <b>bbockelm:</b></span> [soooo much CIO-speak in that RHEL press release!  "In the four years since Red Hat Enterprise Linux 7 redefined the operating system..."]<br/>
<span style="color: #a72f79"><span style="font-size: small">(14:04:17)</span> <b>andrew.melo:</b></span> Is the IBM sale done? Or is it the sorta thing that they announced it, but they gotta do the small stuff still<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:04:52)</span> <b>bbockelm:</b></span> ah, Stratis made it into RHEL8.  Good on them.<br/>
<span style="color: #e96699"><span style="font-size: small">(14:06:41)</span> <b>lincoln:</b></span> the podman stuff seems interesting, too. no daemon to launch containers<br/>
<span style="color: #e96699"><span style="font-size: small">(14:08:06)</span> <b>lincoln:</b></span> I guess Openshift will be switching to using podman by default. perhaps it will assuage some fears about container security for services<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:09:25)</span> <b>bbockelm:</b></span> &gt; Neither the default python package nor the unversioned /usr/bin/python executable is distributed with RHEL 8. Customers are advised to use python3 or python2 directly. Alternatively, administrators can configure the unversioned python command using the alternatives command.<br/>
<blockquote>
<span style="color: #c386df"><span style="font-size: small">(14:17:45)</span> <b>matyas:</b></span> oh yeah alternatives for selecting python version that won't cause any problems<br/>
</blockquote>
<span style="color: #9e3997"><span style="font-size: small">(14:09:36)</span> <b>bbockelm:</b></span> :guitar:<br/>
<span style="color: #c386df"><span style="font-size: small">(14:09:57)</span> <b>matyas:</b></span> podman would be nice if it had documentation<br/>
<span style="color: #e96699"><span style="font-size: small">(14:10:36)</span> <b>lincoln:</b></span> its self-documenting!<br/>
<span style="color: #c386df"><span style="font-size: small">(14:10:47)</span> <b>matyas:</b></span> "read these blog posts"<br/>
<span style="color: #e96699"><span style="font-size: small">(14:11:41)</span> <b>lincoln:</b></span> removing /usr/bin/python ftw. i cant wait to see how many apps break<br/>
<span style="color: #43761b"><span style="font-size: small">(14:16:14)</span> <b>blin:</b></span> huh, i thought rhel8 would use dnf<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:16:26)</span> <b>bbockelm:</b></span> It is "Yum 4 based on DNF technology!"<br/>
<span style="color: #c386df"><span style="font-size: small">(14:16:44)</span> <b>matyas:</b></span> I think that means <tt>alias yum=dnf</tt><br/>
<span style="color: #965d1b"><span style="font-size: small">(14:31:41)</span> <b>briedel:</b></span> @dwd will having the a different temporary DNS name an issue?<br/>
<blockquote>
<span style="color: #99a949"><span style="font-size: small">(14:54:27)</span> <b>dwd:</b></span> A different temporary DNS name should not affect anything.<br/>
</blockquote>
<span style="color: #c386df"><span style="font-size: small">(14:36:38)</span> <b>matyas:</b></span> @andrew.melo if I read it right, the IBM sale still needs to go through the regulatory agencies; don't expect anything until 2019<br/>
<span style="color: #965d1b"><span style="font-size: small">(14:40:21)</span> <b>briedel:</b></span> @dwd<br/><pre><br/>[root@cvmfs-origin ~]# cvmfs_server import -p <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a><br/>The repository <a href="http://connect.opensciencegrid.org">connect.opensciencegrid.org</a> already exists<br/></pre><br/>so <tt>/var/spool/cvmfs</tt> and <tt>/srv/cvmfs</tt> are empty<br/>
<span style="color: #99a949"><span style="font-size: small">(14:41:24)</span> <b>dwd:</b></span> No, leave all the /srv/cvmfs data, but remove /etc/cvmfs/repositories.d<br/>
<span style="color: #965d1b"><span style="font-size: small">(14:42:32)</span> <b>briedel:</b></span> okay i will replace <tt>/srv/cvmfs</tt><br/>
<span style="color: #99a949"><span style="font-size: small">(14:45:35)</span> <b>dwd:</b></span> I don’t think you want option -p either.  You’ll want -o connect -k /etc/cvmfs/keys<br/>
<span style="color: #df3dc0"><span style="font-size: small">(15:22:17)</span> <b>burt:</b></span> @andrew.melo: watch the stock price. The closer it gets to 190, the more likely it is for the deal to go through.<br/>
<span style="color: #99a949"><span style="font-size: small">(16:20:18)</span> <b>dwd:</b></span> @bbockelm do you know what exactly Redhat means by “rootless containers”?  The RHEL 8 beta release notes say they’re a technology preview <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8-beta/html-single/8.0_beta_release_notes/index#notable_changes_to_containers">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8-beta/html-single/8.0_beta_release_notes/index#notable_changes_to_containers</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(16:21:24)</span> <b>bbockelm:</b></span> I assume that has to do with the namespaces being fully supported?  Maybe rootless FUSE?<br/>
<span style="color: #c386df"><span style="font-size: small">(16:21:43)</span> <b>matyas:</b></span> I think they're talking about podman again?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:21:52)</span> <b>bbockelm:</b></span> I made a mental note to learn more about podman since that’s daemon-less<br/>
<span style="color: #99a949"><span style="font-size: small">(16:22:32)</span> <b>dwd:</b></span> Technology preview does not mean full support, it sounds like a step backwards from RHEL 7.6<br/>
<span style="color: #99a949"><span style="font-size: small">(16:23:52)</span> <b>dwd:</b></span> Maybe they mean something that’s not in the kernel<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:24:42)</span> <b>bbockelm:</b></span> Possibly. The non-root FUSE is definitely not in 7.6<br/>
<span style="color: #99a949"><span style="font-size: small">(16:25:33)</span> <b>dwd:</b></span> rootless FUSE as a technology preview would be great, but it seems too soon after kernel 4.18 added it<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:27:52)</span> <b>andrew.melo:</b></span> user namespaces - will be nice to not need setuid binaries at all<br/>
<span style="color: #99a949"><span style="font-size: small">(16:34:41)</span> <b>dwd:</b></span> Oh but Andrew, that’s already in 7.6<br/>
<span style="color: #99a949"><span style="font-size: small">(16:40:14)</span> <b>dwd:</b></span> Probably podman support of rootless containers is the technology preview<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:53:03)</span> <b>andrew.melo:</b></span> I wasn't aware they actually got it "right" yet<br/>
<span style="color: #99a949"><span style="font-size: small">(17:05:25)</span> <b>dwd:</b></span> Yes with 7.6 we’ll be able to use singularity completely unprivileged, with images in cvmfs.  The only privileged operation that some people will need is to use image files as opposed to images unpacked in directory trees (singularity calls it sandbox mode).  When unprivileged FUSE becomes available, even that will be able to be done unprivileged.<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:30:31)</span> <b>andrew.melo:</b></span> Well right, it's not quite "right" if you can't do certain operations w/o privs<br/>
<span style="color: #99a949"><span style="font-size: small">(17:31:07)</span> <b>dwd:</b></span> I still consider it right if you don’t need those operations<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:31:28)</span> <b>andrew.melo:</b></span> heh, ok<br/>
<span style="color: #99a949"><span style="font-size: small">(17:32:35)</span> <b>dwd:</b></span> Not to mention the fact that some people have objected to singularity’s setuid-based support for mounting image files at all, because they’re doing something that the kernel refused to do for fear of security issues.  Singularity ignored all that and did it anyway.<br/>
<span style="color: #99a949"><span style="font-size: small">(17:34:22)</span> <b>dwd:</b></span> This is why the OSG install instructions recommends setting  max loop devices = 0<br/>
</body>
</html>
