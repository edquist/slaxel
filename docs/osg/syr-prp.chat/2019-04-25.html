<!DOCTYPE html>
<html>
<head>
<title>Thu Apr 25, 2019 : #syr-prp (osg)</title>
</head>
<body>
<h3>Thu Apr 25, 2019 : #syr-prp (osg)</h3>
<span style="color: #a72f79"><span style="font-size: small">(11:16:07)</span> <b>dfinstad:</b></span> @dabrown is there a way we can troubleshoot the connection from sugwg-condor?<br/><pre><br/>[daniel.finstad@sugwg-condor osg_test]$ condor_status -wide -pool <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a> -const 'Glidein_SITE is "SDSC-PRP"'<br/></pre><br/>shows nothing<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:25:58)</span> <b>dabrown:</b></span> @dfinstad <tt>sugwg-condor</tt> isn't configured for flocking:<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:26:04)</span> <b>dabrown:</b></span> <pre><br/>[dbrown@sugwg-condor ~]$ grep osg /etc/condor/config.d/*<br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/90_gwms_dns.config:GSI_DAEMON_NAME=$(GSI_DAEMON_NAME),/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/>/etc/condor/config.d/92_flocking_osg_ligo.config:#FLOCK_TO = <a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a><br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:26:35)</span> <b>dabrown:</b></span> You need to use <tt>sugwg-scitokens</tt>:<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:26:39)</span> <b>dabrown:</b></span> <pre><br/>[dbrown@sugwg-scitokens ~]$ grep -i osg /etc/condor/config.d/*<br/>/etc/condor/config.d/80-osg-flocking.conf:# OSG VO flocking host<br/>/etc/condor/config.d/80-osg-flocking.conf:OSG_FLOCK = <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a><br/>/etc/condor/config.d/80-osg-flocking.conf:OSG_FLOCK_DN = /DC=org/DC=incommon/C=US/postalCode=53706/ST=WI/L=Madison/street=1210 West Dayton Street/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a><br/>/etc/condor/config.d/80-osg-flocking.conf:FLOCK_TO = $(FLOCK_TO) $(OSG_FLOCK)<br/>/etc/condor/config.d/80-osg-flocking.conf:GSI_DAEMON_NAME = $(GSI_DAEMON_NAME), $(OSG_FLOCK_DN)<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:26:45)</span> <b>dabrown:</b></span> Sorry, should have mentioned that.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:28:51)</span> <b>dfinstad:</b></span> Ah, okay. Well I’m seeing the same thing on sugwg-scitokens:<br/><pre><br/>[daniel.finstad@sugwg-scitokens ~]$ condor_status -wide -pool <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a> -const 'Glidein_SITE is "SDSC-PRP"'<br/></pre><br/>should that be the case?<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:29:59)</span> <b>dabrown:</b></span> Yes, the glideins only appear if there are jobs in the queue that want them. Right now:<br/><pre><br/>[dbrown@sugwg-scitokens condor-test]$ condor_q -allusers<br/><br/><br/>-- Schedd: <a href="http://sugwg-scitokens.phy.syr.edu">sugwg-scitokens.phy.syr.edu</a> : &lt;10.5.2.45:9618?... @ 04/25/19 12:29:31<br/> ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD<br/><br/>Total for query: 0 jobs; 0 completed, 0 removed, 0 idle, 0 running, 0 held, 0 suspended <br/>Total for all users: 0 jobs; 0 completed, 0 removed, 0 idle, 0 running, 0 held, 0 suspended<br/></pre><br/>
<span style="color: #a72f79"><span style="font-size: small">(11:30:08)</span> <b>dfinstad:</b></span> great, makes sense<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:30:10)</span> <b>dabrown:</b></span> If you look in <a href="https://github.com/sugwg/prp/tree/master/condor-test">https://github.com/sugwg/prp/tree/master/condor-test</a><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:30:33)</span> <b>dabrown:</b></span> I added a simple test job that you can use to check that glideins are working without having to run a whole workflow.<br/>
<span style="color: #a72f79"><span style="font-size: small">(11:30:58)</span> <b>dfinstad:</b></span> perfect. I’ll run the test and then launch a trial pp-test workflow this afternoon<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:31:00)</span> <b>dabrown:</b></span> <pre><br/>[dbrown@sugwg-scitokens condor-test]$ condor_status -wide -pool <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a> -tot<br/><br/>             Machines Owner Claimed Unclaimed Matched Preempting  Drain<br/><br/>X86_64/LINUX    16868     0   16144       684       0         40      0<br/><br/>       Total    16868     0   16144       684       0         40      0<br/></pre><br/>shows that this machine is seeing OSG machines<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(11:31:04)</span> <b>dabrown:</b></span> Great.<br/>
<span style="color: #a63024"><span style="font-size: small">(13:07:39)</span> <b>efajardo:</b></span> @dabrown<br/>
<span style="color: #a63024"><span style="font-size: small">(13:07:48)</span> <b>efajardo:</b></span> can I get an account on <tt>sugwg-scitokens</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(13:08:09)</span> <b>efajardo:</b></span> never mind I have one<br/>
<span style="color: #a63024"><span style="font-size: small">(13:08:16)</span> <b>efajardo:</b></span> <pre>[efajardo@sugwg-scitokens ~]$ hostname<br/><a href="http://sugwg-scitokens.phy.syr.edu">sugwg-scitokens.phy.syr.edu</a></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(13:09:05)</span> <b>efajardo:</b></span> I will poke around<br/>
<span style="color: #a63024"><span style="font-size: small">(13:09:09)</span> <b>efajardo:</b></span> and find out what is going on<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(13:09:15)</span> <b>dabrown:</b></span> I just gave you root as well.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(13:09:41)</span> <b>dabrown:</b></span> I don't think there's a problem. Daniel just submitted from the wrong machine, as I forgot to tell him to use scitokens.<br/>
<span style="color: #a63024"><span style="font-size: small">(13:10:00)</span> <b>efajardo:</b></span> ahh ok<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(13:10:19)</span> <b>dabrown:</b></span> sugwg-condor was plumbed into the old LIGO collector. I never switched it to OSG.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(13:10:29)</span> <b>dabrown:</b></span> (<a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a>)<br/>
<span style="color: #a63024"><span style="font-size: small">(13:12:22)</span> <b>efajardo:</b></span> but<br/>
<span style="color: #a63024"><span style="font-size: small">(13:12:26)</span> <b>efajardo:</b></span> yes<br/>
<span style="color: #a63024"><span style="font-size: small">(13:12:32)</span> <b>efajardo:</b></span> but should we plumb it to OSG?<br/>
<span style="color: #a63024"><span style="font-size: small">(13:12:46)</span> <b>efajardo:</b></span> or you would prefer it not o?<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(13:13:29)</span> <b>dabrown:</b></span> Yes, <tt>sugwg-osg</tt> and <tt>sugwg-condor</tt> should be switched to <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a>.<br/>
<span style="color: #a63024"><span style="font-size: small">(13:15:14)</span> <b>efajardo:</b></span> ok<br/>
<span style="color: #a63024"><span style="font-size: small">(13:15:28)</span> <b>efajardo:</b></span> I have access to <tt><a href="http://sugwg-condor.phy.syr.edu">sugwg-condor.phy.syr.edu</a></tt><br/>
<span style="color: #a63024"><span style="font-size: small">(13:15:48)</span> <b>efajardo:</b></span> But not root<br/>
<span style="color: #a63024"><span style="font-size: small">(13:15:51)</span> <b>efajardo:</b></span> do you want me to do it<br/>
<span style="color: #a63024"><span style="font-size: small">(13:16:03)</span> <b>efajardo:</b></span> or do  you want to follow our newly minted instructions?<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:35:28)</span> <b>dfinstad:</b></span> @dabrown from <tt>sugwg-scitokens</tt> now, trying to run your example, I’m seeing:<br/><pre><br/>-- Schedd: <a href="http://sugwg-scitokens.phy.syr.edu">sugwg-scitokens.phy.syr.edu</a> : &lt;10.5.2.45:9618?...<br/>The Requirements expression for job 6509805.000 is<br/><br/>    ((TARGET.Glidein_SITE isnt undefined) &amp;&amp; (TARGET.Glidein_SITE is "SDSC-PRP")) &amp;&amp; ((((TARGET.IsSUGWGNode is true)) || ((MY.OrangeGrid is true)) ||<br/>        ((MY.OpenScienceGrid is true) &amp;&amp; ((((TARGET.vm_name is "ITS-C6-OSG-20160824") || (TARGET.vm_name is "its-c6-osg-20160824")) is true) ||<br/>            (TARGET.GLIDEIN_Site isnt undefined))))) &amp;&amp; (TARGET.Arch == "X86_64") &amp;&amp; (TARGET.OpSys == "LINUX") &amp;&amp; (TARGET.Disk &gt;= RequestDisk) &amp;&amp;<br/>    (TARGET.Memory &gt;= RequestMemory) &amp;&amp; (TARGET.Cpus &gt;= RequestCpus) &amp;&amp; (TARGET.HasFileTransfer)<br/><br/>Job 6509805.000 defines the following attributes:<br/><br/>    DiskUsage = 2<br/>    ImageSize = 1<br/>    OpenScienceGrid = true<br/>    RequestCpus = 8<br/>    RequestDisk = DiskUsage<br/>    RequestMemory = ifthenelse(MemoryUsage =!= undefined,MemoryUsage,(ImageSize + 1023) / 1024)<br/><br/>The Requirements expression for job 6509805.000 reduces to these conditions:<br/><br/>         Slots<br/>Step    Matched  Condition<br/>-----  --------  ---------<br/>[0]           0  TARGET.Glidein_SITE isnt undefined<br/>[1]           0  TARGET.Glidein_SITE is "SDSC-PRP"<br/>[3]         171  TARGET.IsSUGWGNode is true<br/>[8]         208  TARGET.vm_name is "its-c6-osg-20160824"<br/>[10]        208  ((TARGET.vm_name is "ITS-C6-OSG-20160824") || (TARGET.vm_name is "its-c6-osg-20160824")) is true<br/><br/>No successful match recorded.<br/></pre><br/>anything stand out as incorrect?<br/>
<span style="color: #53b759"><span style="font-size: small">(13:37:16)</span> <b>isfiligoi:</b></span> It takes a few minutes for pilots to start up<br/>
<span style="color: #53b759"><span style="font-size: small">(13:37:31)</span> <b>isfiligoi:</b></span> I see them starting in the PRP CE queue<br/>
<span style="color: #a72f79"><span style="font-size: small">(13:38:02)</span> <b>dfinstad:</b></span> ah, great, thanks!<br/>
<span style="color: #53b759"><span style="font-size: small">(14:48:39)</span> <b>isfiligoi:</b></span> Your jobs should have run… Did things work?<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:21:09)</span> <b>dfinstad:</b></span> the test jobs did run okay, but the workflow failed so I still need to debug that a bit<br/>
<span style="color: #a72f79"><span style="font-size: small">(15:24:43)</span> <b>dfinstad:</b></span> @dabrown I’m seeing an error on the initial <tt>create_dir</tt> job:<br/><pre><br/>2019-04-25 16:21:34,089    INFO:  Starting transfers - attempt 1<br/>2019-04-25 16:21:36,174    INFO:  Tool found: gfal-mkdir   Version: 2.14.2   Path: /usr/bin/gfal-mkdir<br/>2019-04-25 16:21:36,174   ERROR:  X509 proxy file /tmp/x509up_u50001 does not exist. Maybe you forgot to initialize the proxy, or the submit host might be configured with MOUNT_UNDER_SCRATCH which can hide directories for local universe jobs.<br/></pre><br/>though I see<br/><pre><br/>[daniel.finstad@sugwg-scitokens sampler_comparison]$ ls /tmp/x509up_u50001<br/>/tmp/x509up_u50001<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:25:01)</span> <b>dabrown:</b></span> Ah. Crap.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:25:22)</span> <b>dabrown:</b></span> scitokens has a broken <tt>gfal-mkdir</tt>, but it's the only machine plumbed into osg right now...<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:25:32)</span> <b>dabrown:</b></span> Let me see if I can connect sugwg-osg to the pool<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:27:56)</span> <b>dabrown:</b></span> OK, that was easy, looks like Mats already authorized it.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:28:34)</span> <b>dabrown:</b></span> I submitted some test jobs.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:29:14)</span> <b>dabrown:</b></span> If that doesn't work, @efajardo or @rynge will need to check that<br/><pre><br/>/DC=org/DC=incommon/C=US/postalCode=13244-5040/ST=NY/L=Syracuse/street=900 South Crouse Ave/O=Syracuse University/OU=AS PHY/CN=<a href="http://sugwg-osg.phy.syr.edu">sugwg-osg.phy.syr.edu</a><br/></pre><br/>is authorized to write into the OSG pool.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:29:59)</span> <b>dabrown:</b></span> I set it up with<br/><pre><br/>[dbrown@sugwg-osg condor-test]$ cat /etc/condor/config.d/80-osg-flocking.conf <br/>#--  With glideins, there is nothing shared<br/>CONDOR_HOST=$(FULL_HOSTNAME)<br/>UID_DOMAIN=$(FULL_HOSTNAME)<br/>FILESYSTEM_DOMAIN=$(FULL_HOSTNAME)<br/><br/>#-- Authentication settings<br/>SEC_DEFAULT_AUTHENTICATION = REQUIRED<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = FS,GSI<br/>SEC_READ_AUTHENTICATION    = OPTIONAL<br/>SEC_CLIENT_AUTHENTICATION  = OPTIONAL<br/>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = TRUE<br/>DENY_WRITE         = anonymous@*<br/>DENY_ADMINISTRATOR = anonymous@*<br/>DENY_DAEMON        = anonymous@*<br/>DENY_NEGOTIATOR    = anonymous@*<br/>DENY_CLIENT        = anonymous@*<br/><br/>#--  Privacy settings<br/>SEC_DEFAULT_ENCRYPTION = OPTIONAL<br/>SEC_DEFAULT_INTEGRITY = REQUIRED<br/>SEC_READ_INTEGRITY = OPTIONAL<br/>SEC_CLIENT_INTEGRITY = OPTIONAL<br/>SEC_READ_ENCRYPTION = OPTIONAL<br/>SEC_CLIENT_ENCRYPTION = OPTIONAL<br/><br/>#-- With strong security, do not use IP based controls<br/>HOSTALLOW_WRITE = *<br/><br/># OSG VO flocking host<br/>OSG_FLOCK = <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a><br/>OSG_FLOCK_DN = /DC=org/DC=incommon/C=US/postalCode=53706/ST=WI/L=Madison/street=1210 West Dayton Street/O=University of Wisconsin-Madison/OU=OCIS/CN=<a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a><br/><br/># submitters/campus factories to flock to<br/>FLOCK_TO = $(FLOCK_TO) $(OSG_FLOCK)<br/><br/># Who to trust?  Inlucde the &lt;VO&gt;_DN to trust the submitter<br/>GSI_DAEMON_NAME = $(GSI_DAEMON_NAME), $(OSG_FLOCK_DN)<br/><br/># This host's certificates<br/># These are needed if you are flocking to a glideinwms host<br/>GSI_DAEMON_CERT = /etc/grid-security/hostcert.pem<br/>GSI_DAEMON_KEY = /etc/grid-security/hostkey.pem<br/></pre><br/>
<span style="color: #53b759"><span style="font-size: small">(15:45:27)</span> <b>isfiligoi:</b></span> no pilots in PRP queues yet :disappointed:<br/>
<span style="color: #a63024"><span style="font-size: small">(15:51:40)</span> <b>efajardo:</b></span> @dabrown the best way to set it up<br/>
<span style="color: #a63024"><span style="font-size: small">(15:51:41)</span> <b>efajardo:</b></span> is to<br/>
<span style="color: #a63024"><span style="font-size: small">(15:51:49)</span> <b>efajardo:</b></span> <tt>yum install osg-flock</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(15:52:10)</span> <b>efajardo:</b></span> see <a href="https://opensciencegrid.org/docs/submit/osg-flock/">https://opensciencegrid.org/docs/submit/osg-flock/</a><br/>
<span style="color: #a63024"><span style="font-size: small">(15:52:24)</span> <b>efajardo:</b></span> <pre>[efajardo@sugwg-condor ~]$ condor_config_val FLOCK_TO<br/>Not defined: FLOCK_TO<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:52:32)</span> <b>dabrown:</b></span> I'm on sugwg-osg<br/>
<span style="color: #a63024"><span style="font-size: small">(15:52:36)</span> <b>efajardo:</b></span> ahh<br/>
<span style="color: #a63024"><span style="font-size: small">(15:52:37)</span> <b>efajardo:</b></span> ok<br/>
<span style="color: #a63024"><span style="font-size: small">(15:53:54)</span> <b>efajardo:</b></span> This is the subject<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:53:55)</span> <b>dabrown:</b></span> @efajardo I have to leave to pick up my daughter, but I've given you root@sugwg-osg<br/>
<span style="color: #a63024"><span style="font-size: small">(15:53:56)</span> <b>efajardo:</b></span> right<br/>
<span style="color: #a63024"><span style="font-size: small">(15:54:00)</span> <b>efajardo:</b></span> <tt>subject= /DC=org/DC=incommon/C=US/postalCode=13244-5040/ST=NY/L=Syracuse/street=900 South Crouse Ave/O=Syracuse University/OU=AS PHY/CN=<a href="http://sugwg-osg.phy.syr.edu">sugwg-osg.phy.syr.edu</a><br/></tt><br/>
<span style="color: #a63024"><span style="font-size: small">(15:54:03)</span> <b>efajardo:</b></span> I will take care of it<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:54:04)</span> <b>dabrown:</b></span> yes<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(15:54:06)</span> <b>dabrown:</b></span> thanks!<br/>
<span style="color: #a63024"><span style="font-size: small">(15:59:56)</span> <b>efajardo:</b></span> I created a PR <a href="https://github.com/opensciencegrid/osg-flock/pull/21">https://github.com/opensciencegrid/osg-flock/pull/21</a><br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:05)</span> <b>efajardo:</b></span> waiting for @rynge to merge<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:00:43)</span> <b>dabrown:</b></span> Thanks!<br/>
<span style="color: #a63024"><span style="font-size: small">(17:41:36)</span> <b>efajardo:</b></span> Opps I realized I could merge mysaelf<br/>
<span style="color: #53b759"><span style="font-size: small">(19:10:34)</span> <b>isfiligoi:</b></span> @efajardo I still don’t see any pilots<br/>
<span style="color: #a63024"><span style="font-size: small">(19:23:02)</span> <b>efajardo:</b></span> We just started requesting<br/>
<span style="color: #53b759"><span style="font-size: small">(19:39:54)</span> <b>isfiligoi:</b></span> See them now<br/>
</body>
</html>
