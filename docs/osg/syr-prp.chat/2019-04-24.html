<!DOCTYPE html>
<html>
<head>
<title>Wed Apr 24, 2019 : #syr-prp (osg)</title>
</head>
<body>
<h3>Wed Apr 24, 2019 : #syr-prp (osg)</h3>
<span style="color: #8f4a2b"><span style="font-size: small">(14:06:18)</span> <b>dabrown:</b></span> <pre><br/>universe = vanilla<br/>executable = hostname.sh<br/>output = test-osg-$ENV(HOSTNAME)-$(cluster).$(process).out<br/>error = test-osg-$ENV(HOSTNAME)-$(cluster).$(process).err<br/>log = test-osg-$ENV(HOSTNAME)-$(cluster).log<br/>arguments = hostname-osg-$ENV(HOSTNAME)-$(cluster).$(process).txt chris.dat<br/>should_transfer_files = Yes<br/>transfer_output_files = hostname-osg-$ENV(HOSTNAME)-$(cluster).$(process).txt<br/>transfer_input_files = chris.dat<br/>+OpenScienceGrid = True<br/>+ProjectName = "sugwg"<br/>requirements = (TARGET.Glidein_SITE isnt undefined) &amp;&amp; (TARGET.Glidein_SITE is "SDSC-PRP")<br/>request_cpus = 8<br/>queue 10<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:09:28)</span> <b>dabrown:</b></span> To put a specific executable on the OSG, use the following workflow <tt>--config-overrides</tt><br/><pre><br/>"pegasus_profile-inference:pycbc|site:osg"<br/>"pegasus_profile-inference:hints|<a href="http://execution.site:osg">execution.site:osg</a>"<br/>"pegasus_profile-inference:pycbc|installed:False"<br/>"workflow-${WORKFLOW_NAME}-main:staging-site:osg=local"<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:12:22)</span> <b>dabrown:</b></span> When you submit the workflow:<br/><pre><br/>--append-site-profile 'osg:condor|Requirements:IS_GLIDEIN is True' --append-site-profile 'osg:condor|Requirements:Glidein_SITE is "SDSC-PRP"' --append-site-profile 'osg:condor|+ProjectName:"sugwg"'<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:12:32)</span> <b>dabrown:</b></span> The site template you pull in for the site osg is <a href="https://github.com/gwastro/pycbc/blob/master/pycbc/workflow/pegasus_files/osg-site-template.xml">https://github.com/gwastro/pycbc/blob/master/pycbc/workflow/pegasus_files/osg-site-template.xml</a><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:14:28)</span> <b>dabrown:</b></span> Generally follow <a href="http://pycbc.org/pycbc/latest/html/workflow/pycbc_make_coinc_search_workflow.html#running-on-the-open-science-grid">http://pycbc.org/pycbc/latest/html/workflow/pycbc_make_coinc_search_workflow.html#running-on-the-open-science-grid</a><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:20:28)</span> <b>dabrown:</b></span> That should be <tt>"pegasus_profile-inference:pycbc|installed:True"</tt><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(14:20:59)</span> <b>dabrown:</b></span> <a href="https://github.com/sugwg/prp">https://github.com/sugwg/prp</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(15:47:50)</span> <b>dfinstad:</b></span> @dabrown in case you know offhand what this problem is, my current stumbling block is this error when the workflow tries to initialize the subdax<br/><pre><br/>2019.04.24 16:43:25.109 EDT: [DEBUG]  Setting up site mapping for job inference-L1_ID1_ID0000002 <br/>2019.04.24 16:43:25.109 EDT: [DEBUG]  Job was mapped to inference-L1_ID1_ID0000002 to site osg <br/>2019.04.24 16:43:25.109 EDT: [DEBUG]  Trying to get TCEntries for inference-L1_ID1 on resource ALL of type ALL <br/>2019.04.24 16:43:25.110 EDT: [FATAL ERROR]  java.lang.RuntimeException: Site selector mapped job inference-L1_ID1 to pool osg for which no mapping exists in transformation mapper.<br/></pre><br/>The workflow directory for this test run is at:<br/><tt>/home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test</tt><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:21:43)</span> <b>dabrown:</b></span> That's strange. If I look at your transformation catalog in <tt>/home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test/local-site-scratch/work/./osg_test-main.tc.txt</tt> I see<br/><pre><br/>tr inference-L1_ID1 {<br/>        profile condor "+OpenScienceGrid" "True"<br/>        profile dagman "retry" "4"<br/>        profile condor "request_memory" "1G"<br/>        profile condor "universe" "vanilla"<br/>        profile condor "Requirements" "(IS_GLIDEIN is True) &amp;&amp; (Glidein_SITE is SDSC-PRP)"<br/>        profile condor "request_cpus" "8"<br/>        profile hints "<a href="http://execution.site">execution.site</a>" "osg"<br/>        profile condor "+ProjectName" "sugwg"<br/>        site osg {<br/>                pfn "/home/daniel.finstad/opt/pycbc-dev/bin/pycbc_inference"<br/>                arch "x86_64"<br/>                os "linux"<br/>                type "INSTALLED"<br/>        }<br/>}<br/></pre><br/>so there's a site mapping for osg.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:23:50)</span> <b>dabrown:</b></span> Although the <tt>pfn</tt> is incorrect.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:24:49)</span> <b>dabrown:</b></span> But the incorrect pfn would cause the job to fail at run time, not planning.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:25:17)</span> <b>dabrown:</b></span> Ah, the problem is in <tt>/home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test/site-catalog.xml</tt><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:25:27)</span> <b>dabrown:</b></span> <pre><br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;sitecatalog xmlns="<a href="http://pegasus.isi.edu/schema/sitecatalog">http://pegasus.isi.edu/schema/sitecatalog</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>"<br/>xsi:schemaLocation="<a href="http://pegasus.isi.edu/schema/sitecatalog">http://pegasus.isi.edu/schema/sitecatalog</a> <a href="http://pegasus.isi.edu/schema/sc-4.0.xsd">http://pegasus.isi.edu/schema/sc-4.0.xsd</a>" version="4.0"&gt;<br/>  &lt;site handle="local" arch="x86_64" os="LINUX"&gt;<br/>    &lt;directory  path="/home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test/local-site-scratch" type="shared-scratch" free-size="null" total-size="null"&gt;<br/>        &lt;file-server  operation="all" url="file:///home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test/local-site-scratch"&gt;<br/>        &lt;/file-server&gt;<br/>    &lt;/directory&gt;<br/>    &lt;directory  path="/home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test" type="shared-storage" free-size="null" total-size="null"&gt;<br/>        &lt;file-server  operation="all" url="file:///home/daniel.finstad/projects/pp_tests/sampler_comparison/osg_test"&gt;<br/>        &lt;/file-server&gt;<br/>    &lt;/directory&gt;<br/>    &lt;profile namespace="pegasus" key="style"&gt;condor&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="getenv"&gt;True&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="should_transfer_files"&gt;YES&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="when_to_transfer_output"&gt;ON_EXIT_OR_EVICT&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="+DESIRED_Sites"&gt;&amp;quot;nogrid&amp;quot;&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="+IS_GLIDEIN"&gt;&amp;quot;False&amp;quot;&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="accounting_group"&gt;sugwg.astro&lt;/profile&gt;<br/>    &lt;profile namespace="condor" key="accounting_group_user"&gt;&lt;/profile&gt;<br/>  &lt;/site&gt;<br/>&lt;/sitecatalog&gt;<br/></pre><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:25:31)</span> <b>dabrown:</b></span> It's missing the OSG site.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:26:28)</span> <b>dabrown:</b></span> What were the arguments you used to run <tt>pycbc_submit_dax</tt>? It's that code's job to copy the relevant site catalogs into the file it builds.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:28:16)</span> <b>dabrown:</b></span> To fix the PFN for the executable you need to add<br/><pre><br/>'executables:inference:/usr/bin/pycbc_inference'<br/></pre><br/>to your <tt>--config-overrides</tt> when making the workflow.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:28:30)</span> <b>dabrown:</b></span> (I think it's in <tt>/usr/bin</tt> in the Docker image, but you can check that)<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:29:20)</span> <b>dabrown:</b></span> The OSG section in the site catalog should be populated if you use <tt>--execution-sites osg</tt> when you run <tt>pycbc_submit_dax</tt>. If you included that argument, then there's a bug.<br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:30:07)</span> <b>dabrown:</b></span> <tt>pycbc_submit_dax</tt> should automatically add the <tt>local</tt> site: <a href="https://github.com/gwastro/pycbc/blob/master/bin/pycbc_submit_dax#L318">https://github.com/gwastro/pycbc/blob/master/bin/pycbc_submit_dax#L318</a><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:30:31)</span> <b>dabrown:</b></span> And then concatenate the relevant site templates: <a href="https://github.com/gwastro/pycbc/blob/master/bin/pycbc_submit_dax#L372">https://github.com/gwastro/pycbc/blob/master/bin/pycbc_submit_dax#L372</a><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:31:18)</span> <b>dabrown:</b></span> If you told it to use <tt>osg</tt> (case sensitive) and it didn't find the osg site template, it *should* throw an error: <tt>echo "Error: Could not find site catalog template for site ${s}"</tt><br/>
<span style="color: #8f4a2b"><span style="font-size: small">(16:31:41)</span> <b>dabrown:</b></span> More details are here <a href="http://pycbc.org/pycbc/latest/html/workflow/pycbc_make_coinc_search_workflow.html#running-the-workflow">http://pycbc.org/pycbc/latest/html/workflow/pycbc_make_coinc_search_workflow.html#running-the-workflow</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(17:01:15)</span> <b>dfinstad:</b></span> ah, that was my mistake, I hadn’t included <tt>--execution-sites osg</tt><br/>now it’s complaining about a remote staging server:<br/><pre><br/>Attempt to use a remote site but --remote-staging-server not specified<br/></pre><br/>
<span style="color: #a72f79"><span style="font-size: small">(17:05:54)</span> <b>dfinstad:</b></span> Actually that might be a typo in the documentation. Changing <tt>--local-staging-server</tt> to <tt>--remote-staging-server</tt> may have fixed it<br/>
<span style="color: #a72f79"><span style="font-size: small">(17:54:36)</span> <b>dfinstad:</b></span> Now everything seems to run except the inference job, where it looks like it’s not finding the PRP nodes:<br/><pre><br/>The Requirements expression for job 6087851.000 reduces to these conditions:<br/><br/>         Slots<br/>Step    Matched  Condition<br/>-----  --------  ---------<br/>[0]           0  Glidein_SITE is "SDSC-PRP"<br/>[1]         148  TARGET.IsSUGWGNode is true<br/>[6]         185  TARGET.vm_name is "its-c6-osg-20160824"<br/>[8]         185  ((TARGET.vm_name is "ITS-C6-OSG-20160824") || (TARGET.vm_name is "its-c6-osg-20160824")) is true<br/><br/>No successful match recorded.<br/></pre><br/>
<span style="color: #53b759"><span style="font-size: small">(18:02:14)</span> <b>isfiligoi:</b></span> The factory is not seeing any requests:<br/><a href="http://gfactory-1.t2.ucsd.edu/factory/monitor/factoryStatus.html?entry=Glow_US_UCSD_xcache&amp;frontend=total&amp;infoGroup=running&amp;elements=StatusRunningCores,ClientCoresTotal,ClientCoresRunning,ClientCoresIdle,ClientJobsIdle,ReqIdle,&amp;rra=0&amp;window_min=0&amp;window_max=0&amp;timezone=-7">http://gfactory-1.t2.ucsd.edu/factory/monitor/factoryStatus.html?entry=Glow_US_UCSD_xcache&amp;frontend=total&amp;infoGroup=running&amp;elements=StatusRunningCores,ClientCoresTotal,ClientCoresRunning,ClientCoresIdle,ClientJobsIdle,ReqIdle,&amp;rra=0&amp;window_min=0&amp;window_max=0&amp;timezone=-7</a><br/>
<span style="color: #a63024"><span style="font-size: small">(18:58:09)</span> <b>efajardo:</b></span> @dabrown any chance of me getting an account on the syracus submit host<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:08:23)</span> <b>dfinstad:</b></span> I’ve tweaked the classads to what I think should be correct, but something’s still not right:<br/><pre><br/>-- Schedd: <a href="http://sugwg-condor.phy.syr.edu">sugwg-condor.phy.syr.edu</a> : &lt;10.5.2.4:9615?...<br/>The Requirements expression for job 6087891.000 is<br/><br/>    ((TARGET.GLIDEIN_Site isnt undefined) &amp;&amp; (TARGET.GLIDEIN_Site is "SDSC-PRP")) &amp;&amp; ((((TARGET.IsSUGWGNode is true)) || ((MY.OrangeGrid is true)) ||<br/>        ((MY.OpenScienceGrid is true) &amp;&amp; ((((TARGET.vm_name is "ITS-C6-OSG-20160824") || (TARGET.vm_name is "its-c6-osg-20160824")) is true) ||<br/>            (TARGET.GLIDEIN_Site isnt undefined))))) &amp;&amp; (TARGET.Arch == "X86_64") &amp;&amp; (TARGET.OpSys == "LINUX") &amp;&amp; (TARGET.Disk &gt;= RequestDisk) &amp;&amp;<br/>    (TARGET.Memory &gt;= RequestMemory) &amp;&amp; (TARGET.Cpus &gt;= RequestCpus) &amp;&amp; (TARGET.HasFileTransfer)<br/><br/>Job 6087891.000 defines the following attributes:<br/><br/>    OpenScienceGrid = true<br/>    RequestCpus = 8<br/>    RequestDisk = 1<br/>    RequestMemory = 1024<br/><br/>The Requirements expression for job 6087891.000 reduces to these conditions:<br/><br/>         Slots<br/>Step    Matched  Condition<br/>-----  --------  ---------<br/>[0]           0  TARGET.GLIDEIN_Site isnt undefined<br/>[1]           0  TARGET.GLIDEIN_Site is "SDSC-PRP"<br/>[3]         148  TARGET.IsSUGWGNode is true<br/>[8]         196  TARGET.vm_name is "its-c6-osg-20160824"<br/>[10]        196  ((TARGET.vm_name is "ITS-C6-OSG-20160824") || (TARGET.vm_name is "its-c6-osg-20160824")) is true<br/><br/>No successful match recorded.<br/></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(20:04:47)</span> <b>efajardo:</b></span> Indeed<br/>
<span style="color: #a63024"><span style="font-size: small">(20:04:56)</span> <b>efajardo:</b></span> I do not see the FE requesting<br/>
<span style="color: #a63024"><span style="font-size: small">(20:08:16)</span> <b>efajardo:</b></span> I do see this<br/>
<span style="color: #a63024"><span style="font-size: small">(20:08:18)</span> <b>efajardo:</b></span> <pre>RuntimeError: Schedd '<a href="mailto:Q1@login01.osgconnect.net">Q1@login01.osgconnect.net</a>' not found<br/>[2019-04-24 07:38:52,746] ERROR: Runtime Error. Failed to talk to schedd <a href="http://sugwg-condor.phy.syr.edu">sugwg-condor.phy.syr.edu</a></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(20:12:42)</span> <b>efajardo:</b></span> the problem probably lies on <tt><a href="http://sugwg-condor.phy.syr.edu">sugwg-condor.phy.syr.edu</a></tt><br/>
<span style="color: #a63024"><span style="font-size: small">(20:12:49)</span> <b>efajardo:</b></span> check `/var/log/condor/SchedLog<br/>
</body>
</html>
