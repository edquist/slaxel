<!DOCTYPE html>
<html>
<head>
<title>Mon Jun 1, 2020 : #ligo-rucio (osg)</title>
</head>
<body>
<h3>Mon Jun 1, 2020 : #ligo-rucio (osg)</h3>
<span style="color: #a63024"><span style="font-size: small">(11:25:48)</span> <b>paschos:</b></span> @james.clark the failed transfers in the log: are those from the time the cert is expired ?<br/>
<span style="color: #a63024"><span style="font-size: small">(11:26:31)</span> <b>paschos:</b></span> looks it's today<br/>
<span style="color: #a63024"><span style="font-size: small">(11:26:41)</span> <b>paschos:</b></span> <a href="https://fts.mwt2.org:8449/fts3/ftsmon/#/jobs?source_se=gsiftp:%2F%2Fldas-grid.ligo.caltech.edu&amp;dest_se=gsiftp:%2F%2Fkagra-ldr.icrr.u-tokyo.ac.jp&amp;vo=rucio.ligo.caltech.edu@incommon.org&amp;with_file=FAILED&amp;time_window=6">https://fts.mwt2.org:8449/fts3/ftsmon/#/jobs?source_se=gsiftp:%2F%2Fldas-grid.ligo.caltech.edu&amp;dest_se=gsiftp:%2F%2Fkagra-ldr.icrr.u-tokyo.ac.jp&amp;vo=rucio.ligo.caltech.edu@incommon.org&amp;with_file=FAILED&amp;time_window=6</a><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:27:11)</span> <b>james.clark:</b></span> hmm, no, i've just been working through email and have info from ICRR: there's a gridftp problem:<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:27:32)</span> <b>james.clark:</b></span> They state the following<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:27:36)</span> <b>james.clark:</b></span> <pre>I checked processes and logs.<br/>I found 'GFork error'. Is it something wrong ?<br/>Oohara-sama, can you help us?<br/><br/>[ll@pegasus-01 ~]$ ps -ef|grep grid |grep -v twgrid<br/>ll        3133 30553  0 17:29 pts/8    00:00:00 grep --color=auto grid<br/>root     10309     1  0  5æœˆ14 ?      00:02:47 /usr/sbin/globus-gridftp-server -c /etc/gridftp.conf -C /etc/gridftp.d -pidfile /var/run/globus-gridftp-server.pid<br/><br/>(# When the time I logged-in, transfers to Taiwan were working.)<br/><br/>[ll@pegasus-01 ~]$ tail -n 20 /var/log/gridftp-auth.log<br/>[4031] Sun May 31 17:30:50 2020 :: Configuration read from /etc/gridftp.conf.<br/>[4031] Sun May 31 17:30:50 2020 :: Server started in inetd mode.<br/>[4031] Sun May 31 17:30:50 2020 :: New connection from: <a href="http://fts.mwt2.org:53454">fts.mwt2.org:53454</a><br/>[4031] Sun May 31 17:30:52 2020 :: Closed connection from <a href="http://fts.mwt2.org:53454">fts.mwt2.org:53454</a><br/>[4033] Sun May 31 17:30:51 2020 :: GFork functionality not enabled.:<br/>globus_gfork_lib.c:gfork_l_get_env_fd:458:<br/>GFork error: Env not set<br/><br/>[4033] Sun May 31 17:30:51 2020 :: Configuration read from /etc/gridftp.conf.<br/>[4033] Sun May 31 17:30:51 2020 :: Server started in inetd mode.<br/>[4033] Sun May 31 17:30:51 2020 :: New connection from: <a href="http://fts.mwt2.org:53458">fts.mwt2.org:53458</a><br/>[4033] Sun May 31 17:30:52 2020 :: Closed connection from <a href="http://fts.mwt2.org:53458">fts.mwt2.org:53458</a><br/>[10309] Sun May 31 17:30:49 2020 :: Child process 4024 ended with rc = 0<br/>[10309] Sun May 31 17:30:49 2020 :: Child process 4026 ended with rc = 0<br/>[10309] Sun May 31 17:30:49 2020 :: Child process 4023 ended with rc = 0<br/>[10309] Sun May 31 17:30:49 2020 :: Child process 4025 ended with rc = 0<br/>[10309] Sun May 31 17:30:52 2020 :: Child process 4030 ended with rc = 0<br/>[10309] Sun May 31 17:30:52 2020 :: Child process 4032 ended with rc = 0<br/>[10309] Sun May 31 17:30:52 2020 :: Child process 4031 ended with rc = 0<br/>[10309] Sun May 31 17:30:52 2020 :: Child process 4033 ended with rc = 0</pre><br/><br/>
<span style="color: #a63024"><span style="font-size: small">(11:29:45)</span> <b>paschos:</b></span> <pre>pegasus-01 is in japan? </pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:29:51)</span> <b>james.clark:</b></span> yes<br/>
<span style="color: #a63024"><span style="font-size: small">(11:30:07)</span> <b>paschos:</b></span> so it establilshes the connection and then drops it?<br/>
<span style="color: #a63024"><span style="font-size: small">(11:30:13)</span> <b>paschos:</b></span> if i read this correctly<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:32:00)</span> <b>james.clark:</b></span> i guess that's right, i can see what happens with a manual <tt>gfal-copy</tt> in a second<br/>
<span style="color: #ea2977"><span style="font-size: small">(11:32:38)</span> <b>jlstephen:</b></span> note that there was an intermediate ca cert that expired over the weekend that might be causing storage auth issues<br/>
<span style="color: #ea2977"><span style="font-size: small">(11:32:58)</span> <b>jlstephen:</b></span> <pre>/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External CA Root</pre><br/><br/>
<span style="color: #ea2977"><span style="font-size: small">(11:33:58)</span> <b>jlstephen:</b></span> <a href="https://support.sectigo.com/articles/Knowledge/Sectigo-AddTrust-External-CA-Root-Expiring-May-30-2020">https://support.sectigo.com/articles/Knowledge/Sectigo-AddTrust-External-CA-Root-Expiring-May-30-2020</a><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:41:30)</span> <b>james.clark:</b></span> hm, i think the current issue is unrelated: i cannot even stat pegasus:<br/><pre>(gwrucio) bash-4.2# gfal-stat -v gsi<a href="ftp://kagra-ldr.icrr.u-tokyo.ac.jp:2811/data/proc/C10/O3/K1/K-K1_C10-1268027392-4096.gwf">ftp://kagra-ldr.icrr.u-tokyo.ac.jp:2811/data/proc/C10/O3/K1/K-K1_C10-1268027392-4096.gwf</a><br/>gfal-stat error: 13 (Permission denied) - globus_ftp_client: the server responded with an error 530 530-globus_xio_gssapi_ftp.c:globus_l_xio_gssapi_ftp_decode_adat:856:  530-Authentication Error  530-GSS Major Status: Authentication Failed  530-accept_sec_context.c:gss_accept_sec_context:198:  530-SSL handshake problems  530-globus_i_gsi_gss_utils.c:globus_i_gsi_gss_handshake:1122:  530-Unable to verify remote side's credentials  530-globus_i_gsi_gss_utils.c:globus_i_gsi_gss_handshake:1095:  530-SSL handshake problems: Couldn't do ssl handshake  5</pre><br/>I do have login access to pegasus-01, where i see in the auth log:<br/><pre>[17568] Tue Jun  2 01:40:59 2020 :: GFork functionality not enabled.:<br/>globus_gfork_lib.c:gfork_l_get_env_fd:458:<br/>GFork error: Env not set<br/><br/>[17568] Tue Jun  2 01:40:59 2020 :: Configuration read from /etc/gridftp.conf.<br/>[17568] Tue Jun  2 01:40:59 2020 :: Server started in inetd mode.<br/>[17568] Tue Jun  2 01:40:59 2020 :: New connection from: <a href="http://knuron.calit2.optiputer.net:49046">knuron.calit2.optiputer.net:49046</a><br/>[17568] Tue Jun  2 01:41:00 2020 :: Closed connection from <a href="http://knuron.calit2.optiputer.net:49046">knuron.calit2.optiputer.net:49046</a><br/>[10309] Tue Jun  2 01:41:00 2020 :: Child process 17568 ended with rc = 0</pre><br/>
<span style="color: #ea2977"><span style="font-size: small">(11:50:28)</span> <b>jlstephen:</b></span> ok just noting in case it was related. i know quite a few sites had issues from it over the weekend<br/>
<span style="color: #a63024"><span style="font-size: small">(11:58:59)</span> <b>paschos:</b></span> looks like they went through an update...<br/>
<span style="color: #a63024"><span style="font-size: small">(11:59:32)</span> <b>paschos:</b></span> some services might not have restarted --- you are in contact with them i presume<br/>
<span style="color: #a63024"><span style="font-size: small">(11:59:33)</span> <b>paschos:</b></span> ?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:03:14)</span> <b>james.clark:</b></span> Just email (with a corresponding timezone latency) - do you know which services to check?<br/>
<span style="color: #a63024"><span style="font-size: small">(12:20:02)</span> <b>paschos:</b></span> i am looking at similar incidents onlline... the GFork error seems to come from services that have not started... but no clue yet as to which ones... if i find something i willl post it here<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:21:57)</span> <b>james.clark:</b></span> ok, thanks<br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:07)</span> <b>paschos:</b></span> what is the log-levell in grdftp.conf ?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:31:01)</span> <b>james.clark:</b></span> looks like <tt>ALL</tt><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:31:17)</span> <b>james.clark:</b></span> <pre># globus-gridftp-server configuration file<br/><br/># this is a comment<br/><br/># option names beginning with '$' will be set as environment variables, e.g.<br/>$GLOBUS_ERROR_VERBOSE 1<br/>$GLOBUS_TCP_PORT_RANGE 50000,51000<br/><br/># port<br/>port 2811<br/>#port 15000<br/> <br/>log_level ALL<br/>log_filemode 0644<br/>log_single /var/log/gridftp-auth.log<br/>log_transfer /var/log/gridftp.log<br/>chroot_path /home/GridFTP</pre><br/><br/>
<span style="color: #a63024"><span style="font-size: small">(12:34:41)</span> <b>paschos:</b></span> ok --- so the gfork issue appears to be inconsequential ---<br/>
<span style="color: #a63024"><span style="font-size: small">(12:40:41)</span> <b>paschos:</b></span> james this is an expired cert issue --- and i think judith's comment was relevant... it can't be a coincidence about the intermediate ca cert<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:43:28)</span> <b>james.clark:</b></span> agreed - i thought you meant a cert issue on FTS but i guess this affects everything?<br/>
<span style="color: #a63024"><span style="font-size: small">(12:43:51)</span> <b>paschos:</b></span> <a href="https://twiki.cern.ch/twiki/bin/view/LCG/TheLCGTroubleshootingGuide">https://twiki.cern.ch/twiki/bin/view/LCG/TheLCGTroubleshootingGuide</a><br/>
<span style="color: #a63024"><span style="font-size: small">(12:44:22)</span> <b>paschos:</b></span> yes i think so<br/>
<span style="color: #ea2977"><span style="font-size: small">(12:45:53)</span> <b>jlstephen:</b></span> correct, it's an issue on everything<br/>
<span style="color: #a63024"><span style="font-size: small">(12:46:06)</span> <b>paschos:</b></span> i would send the admin the link judith posted<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(12:46:10)</span> <b>james.clark:</b></span> yeah, i think this is biting us all over the place.  currently trying to help with a totally unrelated RIFT issue which is starting to smell similar<br/>
</body>
</html>
