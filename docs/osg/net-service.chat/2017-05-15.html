<!DOCTYPE html>
<html>
<head>
<title>Mon May 15, 2017 : #net-service (osg)</title>
</head>
<body>
<h3>Mon May 15, 2017 : #net-service (osg)</h3>
<span style="color: #4ec0d6"><span style="font-size: small">(15:13:01)</span> <b>smckee:</b></span> OK, I have a document on the recovery I did on psds0/psds1/psds2.  It is in our Google drive folder at <a href="https://drive.google.com/drive/u/0/folders/0B63jqzjmiVgcfnhoNWVld294NTQtaXc1aENWY2VWX0otemFpZGdHNFRtajN3QzJ1VkVqY0E">https://drive.google.com/drive/u/0/folders/0B63jqzjmiVgcfnhoNWVld294NTQtaXc1aENWY2VWX0otemFpZGdHNFRtajN3QzJ1VkVqY0E</a><br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:13:36)</span> <b>rquick:</b></span> and was it successful? sorry I may have missed it<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:13:43)</span> <b>smckee:</b></span> Summary:<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:13:56)</span> <b>smckee:</b></span> Lots of data missing (will send email with details)<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:14:15)</span> <b>smckee:</b></span> Currently psds0 is running Postgresql 9.6.3 in Master mode (since last Friday)<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:14:48)</span> <b>rquick:</b></span> requested access to that doc<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:15:17)</span> <b>smckee:</b></span> psds1 and psds2 are running Postgresql 9.6.3 as Slaves since last Friday and "hot_standby" (which supports readonly queries) since this morning<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:16:16)</span> <b>smckee:</b></span> The original 9.4 instances are available to startup on psds1 and psds2 for whoever we can find to try to recover the missing data.  (service postgresql-9.4 start; runs on port 5433 instead of default 5432)<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:17:05)</span> <b>smckee:</b></span> There are two documents in that folder FYI:  OSG-postgresql-corruption.rtf and Recover-corrupt-DB.rtf<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:17:40)</span> <b>smckee:</b></span> First one describes the problems found.  Second one describes what I did to get the services updated and back into "production" (but missing lots of older data)<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:18:33)</span> <b>rquick:</b></span> i don't see either of those docs...<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:19:10)</span> <b>rquick:</b></span> i see a check_mk, CHEP, OSG DS Overview and Data LifeCycle docs<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:19:41)</span> <b>smckee:</b></span> Yeah, I only see them on my file explorer but not the Web interface:<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:19:54)</span> <b>rquick:</b></span> ahhh... let me check<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:20:03)</span> <b>smckee:</b></span> @smckee uploaded a file: <a href="https://opensciencegrid.slack.com/files/smckee/F5D88S341/osg-postgresql-corruption.rtf">OSG-postgresql-corruption.rtf</a><br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:20:05)</span> <b>smckee:</b></span> Uploading them here<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:20:14)</span> <b>smckee:</b></span> @smckee uploaded a file: <a href="https://opensciencegrid.slack.com/files/smckee/F5EKMK15M/recover-corrupt-db.rtf">Recover-corrupt-DB.rtf</a><br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:21:44)</span> <b>smckee:</b></span> They should also now be in Google drive and visible from the web interface.<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:27:14)</span> <b>rquick:</b></span> yup, i see them... after reading through the downloads...<br/>
<span style="color: #4bbe2e"><span style="font-size: small">(15:27:27)</span> <b>rquick:</b></span> do you have an estimate of the % of all records missing?<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:38:14)</span> <b>smckee:</b></span> Sort of.  I can run a query that gives me a "histogram" by day of the number of records from that day going back to 2015.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:38:36)</span> <b>smckee:</b></span> You can compare it to the counts since the new Postgresql was put in place last Friday.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(15:38:45)</span> <b>smckee:</b></span> I will email that out next<br/>
</body>
</html>
