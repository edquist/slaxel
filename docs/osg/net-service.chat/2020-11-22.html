<!DOCTYPE html>
<html>
<head>
<title>Sun Nov 22, 2020 : #net-service (osg)</title>
</head>
<body>
<h3>Sun Nov 22, 2020 : #net-service (osg)</h3>
<span style="color: #4ec0d6"><span style="font-size: small">(12:09:40)</span> <b>smckee:</b></span> Sorry about not being clearer...my terminology may need improving :slightly_smiling_face:<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:14:00)</span> <b>dweitzel:</b></span> @smckee psmsu01 stopped pushing to rabbitmq.  I am doing some deep debugging and would like it to continue<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:14:28)</span> <b>smckee:</b></span> Let me check<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:18:40)</span> <b>smckee:</b></span> Looks like something happened around 8:34 am today<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:18:58)</span> <b>smckee:</b></span> Logging in now to debug and restart<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:21:15)</span> <b>smckee:</b></span> Some kind of auth issue.   Rebooting to start clean<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:28:08)</span> <b>smckee:</b></span> The error was<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:28:20)</span> <b>smckee:</b></span> 2020-11-22T14:27:10-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> archiver WARNING  44052996: Failed to archive <a href="https://localhost/pscheduler/tasks/cda150b6-fe42-44b3-904c-ff83bfaad7e1/runs/c2dc4d54-b7ce-4b37-96a5-1c19882a163f">https://localhost/pscheduler/tasks/cda150b6-fe42-44b3-904c-ff83bfaad7e1/runs/c2dc4d54-b7ce-4b37-96a5-1c19882a163f</a> to rabbitmq: Pika error: ProbableAuthenticationError<br/>2020-11-22T14:27:10-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> archiver WARNING  44052996: Gave up archiving <a href="https://localhost/pscheduler/tasks/cda150b6-fe42-44b3-904c-ff83bfaad7e1/runs/c2dc4d54-b7ce-4b37-96a5-1c19882a163f">https://localhost/pscheduler/tasks/cda150b6-fe42-44b3-904c-ff83bfaad7e1/runs/c2dc4d54-b7ce-4b37-96a5-1c19882a163f</a> to rabbitmq<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:28:44)</span> <b>smckee:</b></span> Perhaps the credentials aged out to write to the bus.  I has rebooted now.  Do you see data ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:29:09)</span> <b>dweitzel:</b></span> nope, no new data rolling in.<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:29:14)</span> <b>dweitzel:</b></span> token look ok?<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:29:23)</span> <b>smckee:</b></span> Now things look OK.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:29:32)</span> <b>smckee:</b></span> 2020-11-22T14:29:01-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43469374: Running <a href="https://psmsu01.aglt2.org/pscheduler/tasks/eb5693bc-439f-4a2a-b9d5-c0f24c0cf9cf/runs/ef6a181e-7ff0-42af-92ea-585eac155eb4">https://psmsu01.aglt2.org/pscheduler/tasks/eb5693bc-439f-4a2a-b9d5-c0f24c0cf9cf/runs/ef6a181e-7ff0-42af-92ea-585eac155eb4</a><br/>2020-11-22T14:29:01-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43469374: With traceroute: trace --dest <a href="http://perfsonar-ps-02.desy.de">perfsonar-ps-02.desy.de</a> --ip-version 6 --length 1200 --first-ttl 1 --source <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> --wait PT1M<br/>2020-11-22T14:29:01-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> systemd[1]: Started Session 9 of user root.<br/>2020-11-22T14:29:01-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> systemd[1]: Started Session 8 of user root.<br/>2020-11-22T14:29:02-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43464886: Running <a href="https://psmsu01.aglt2.org/pscheduler/tasks/d7daf989-9400-4386-8a05-a8e63a1bf8b3/runs/bff68b60-f5de-4fdf-8102-ae548af554a8">https://psmsu01.aglt2.org/pscheduler/tasks/d7daf989-9400-4386-8a05-a8e63a1bf8b3/runs/bff68b60-f5de-4fdf-8102-ae548af554a8</a><br/>2020-11-22T14:29:02-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43464886: With traceroute: trace --dest <a href="http://lcg-psbw.uw.computecanada.ca">lcg-psbw.uw.computecanada.ca</a> --ip-version 4 --length 1200 --probe-type udp --first-ttl 1 --source <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> --wait PT1M<br/>2020-11-22T14:29:07-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43466382: Running <a href="https://psmsu01.aglt2.org/pscheduler/tasks/cf2da2b0-32c8-4b5f-abd4-2ab61115b45d/runs/b24c1e09-726e-4341-999e-d1275f7cc9b9">https://psmsu01.aglt2.org/pscheduler/tasks/cf2da2b0-32c8-4b5f-abd4-2ab61115b45d/runs/b24c1e09-726e-4341-999e-d1275f7cc9b9</a><br/>2020-11-22T14:29:07-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43466382: With traceroute: trace --dest <a href="http://perfsonar1.roma1.infn.it">perfsonar1.roma1.infn.it</a> --ip-version 6 --length 1200 --first-ttl 1 --source <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> --wait PT1M<br/>2020-11-22T14:29:09-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43467662: Running <a href="https://psmsu01.aglt2.org/pscheduler/tasks/d0a442fd-e887-4f24-b60e-fca8b0a0866f/runs/380bc61e-1e97-42c5-906c-8bed1e2338b6">https://psmsu01.aglt2.org/pscheduler/tasks/d0a442fd-e887-4f24-b60e-fca8b0a0866f/runs/380bc61e-1e97-42c5-906c-8bed1e2338b6</a><br/>2020-11-22T14:29:09-05:00 <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> runner INFO     43467662: With traceroute: trace --dest <a href="http://psl.hpc.utfsm.cl">psl.hpc.utfsm.cl</a> --ip-version 6 --length 1200 --first-ttl 1 --source <a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a> --wait PT1M<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:30:41)</span> <b>dweitzel:</b></span> nope, nothing on the rabbitmq side<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:32:01)</span> <b>smckee:</b></span> Looks like psconfig-itb is not responding :disappointed:<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:32:38)</span> <b>smckee:</b></span> [root@psmsu01 ~]# curl -k <a href="https://psconfig-itb.opensciencegrid.org/pub/auto/psmsu01.aglt2.org">https://psconfig-itb.opensciencegrid.org/pub/auto/psmsu01.aglt2.org</a><br/>{"message":"connection timed out","reason":{"type":"Single","setName":null,"maxSetVersion":null,"maxElectionId":null,"servers":{},"stale":false,"compatible":true,"compatibilityError":null,"logicalSessionTimeoutMinutes":null,"heartbeatFrequencyMS":10000,"localThresholdMS":15,"commonWireVersion":8}}[root@psmsu01 ~]#<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:33:27)</span> <b>dweitzel:</b></span> yup, getting same thing...<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:36:17)</span> <b>smckee:</b></span> nginx_1       | 2020/11/22 19:31:55 [info] 19#19: *115200 epoll_wait() reported that client prematurely closed connection, so upstream connection is closed too while connecting to upstream, client: 2001:48a8:68f7:1:192:41:230:60, server: , request: "GET /pub/auto/psum02.aglt2.org HTTP/1.1", upstream: "<a href="http://172.20.0.3:8080/auto/psum02.aglt2.org">http://172.20.0.3:8080/auto/psum02.aglt2.org</a>", host: "<a href="http://psconfig-itb.opensciencegrid.org">psconfig-itb.opensciencegrid.org</a>"<br/>nginx_1       | 2001:48a8:68f7:8001:192:41:236:31(-) - - [22/Nov/2020:19:32:09 +0000] "GET /pub/auto/psmsu01.aglt2.org HTTP/1.1" 500 298 "-" "curl/7.29.0" "-"<br/>nginx_1       | 2020/11/22 19:32:09 [info] 19#19: *115202 client 2001:48a8:68f7:8001:192:41:236:31 closed keepalive connection<br/>nginx_1       | 2001:48a8:68f7:8001:192:41:236:31(-) - - [22/Nov/2020:19:33:00 +0000] "GET /pub/auto/psmsu01.aglt2.org HTTP/1.1" 500 298 "-" "curl/7.29.0" "-"<br/>nginx_1       | 2020/11/22 19:33:00 [info] 19#19: *115204 client 2001:48a8:68f7:8001:192:41:236:31 closed keepalive connection<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:36:34)</span> <b>smckee:</b></span> Will try to shutdown and restart docker-compose and docker on itb<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:36:37)</span> <b>smckee:</b></span> Just a second<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:39:01)</span> <b>smckee:</b></span> ERROR: for pwa_gocdb2sls_1  UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)<br/><br/>ERROR: for pwa_pwa-admin1_1  UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)<br/><br/>ERROR: for pwa_sca-auth_1  UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)<br/><br/>ERROR: for pwa_pwa-pub2_1  UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)<br/><br/>ERROR: for pwa_pwa-pub1_1  UnixHTTPConnectionPool(host='localhost', port=None): Read timed out. (read timeout=70)<br/>ERROR: An HTTP request took too long to complete. Retry with --verbose to obtain debug information.<br/>If you encounter this issue regularly because of slow network conditions, consider setting COMPOSE_HTTP_TIMEOUT to a higher value (current value: 60).<br/>[root@psconfig-itb pwa]# docker-compose ps<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:39:17)</span> <b>smckee:</b></span> Trying docker-compose down again for mongo and sls<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:39:29)</span> <b>smckee:</b></span> That worked<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:39:40)</span> <b>smckee:</b></span> restarting docker, then will docker-compose up -d<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:41:55)</span> <b>smckee:</b></span> OK, should be working again<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:42:13)</span> <b>dweitzel:</b></span> do you need to kick psmsu?<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:43:50)</span> <b>smckee:</b></span> I just did.   Do you see anything yet?<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:44:57)</span> <b>smckee:</b></span> 2020/11/22 14:42:47 INFO guid=E0DD1FD6-2CFA-11EB-91C2-5119C49FF3EB task_name=WLCG ATLAS Latency config_url=<a href="https://psconfig-itb.opensciencegrid.org/pub/auto/psmsu01.aglt2.org">https://psconfig-itb.opensciencegrid.org/pub/auto/psmsu01.aglt2.org</a> config_src=remote task={"archives":[{"data":{"routing-key":"perfsonar.raw.test","connection-expires":"PT10S","schema":2,"exchange":"ps-push-test-exchange","_url":"<a href="amqps://psmsu01.aglt2.org">amqps://psmsu01.aglt2.org</a>:<a href="mailto:eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InBmLWtleSJ9.eyJzY29wZSI6Im15X3JhYmJpdF9zZXJ2ZXIud3JpdGU6cHMtcHVzaC9wcy1wdXNoLXRlc3QtZXhjaGFuZ2UvcGVyZnNvbmFyLnJhdy4qIiwiZXhwIjoxNjA2MTAyOTY3LCJhdWQiOiJteV9yYWJiaXRfc2VydmVyIiwic3ViIjoicHNtc3UwMS5hZ2x0Mi5vcmciLCJjbGllbnRfaWQiOiJwc21zdTAxLmFnbHQyLm9yZyIsImlhdCI6MTYwNjA3NDE2N30.KLcXtYD5BQLNFinSM4X_SftVbGtG5dufDmsjiK7FBfY9X7iughZDvPSePEz1fxciSi7YNenZj9sNn4LPbLbfQ5iSNGBztldVID5OD8g4ROaQ54DUUmFZkUrWJcJA0LENLSGFKy-tDw2NHxKBMKiOjMP0zjTGsiTAJy5lW2Vu3kPKoZ0w3nK3FO9vjyO36UvfgwQjulU8AOSZBndsssMZ9jN0adD3DqwjjbFV7_oLHGXRABnC1XTi3Vox3UQLzc6Bpj2LhEprsDTA_vn2FAVfgJag-UNcDkHFf4n9wU7YV3oil-ThObtm7w_9m70Ski-qK1Iw27_Hsi8zmkW7azu2pw@clever-turkey.rmq.cloudamqp.com">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InBmLWtleSJ9.eyJzY29wZSI6Im15X3JhYmJpdF9zZXJ2ZXIud3JpdGU6cHMtcHVzaC9wcy1wdXNoLXRlc3QtZXhjaGFuZ2UvcGVyZnNvbmFyLnJhdy4qIiwiZXhwIjoxNjA2MTAyOTY3LCJhdWQiOiJteV9yYWJiaXRfc2VydmVyIiwic3ViIjoicHNtc3UwMS5hZ2x0Mi5vcmciLCJjbGllbnRfaWQiOiJwc21zdTAxLmFnbHQyLm9yZyIsImlhdCI6MTYwNjA3NDE2N30.KLcXtYD5BQLNFinSM4X_SftVbGtG5dufDmsjiK7FBfY9X7iughZDvPSePEz1fxciSi7YNenZj9sNn4LPbLbfQ5iSNGBztldVID5OD8g4ROaQ54DUUmFZkUrWJcJA0LENLSGFKy-tDw2NHxKBMKiOjMP0zjTGsiTAJy5lW2Vu3kPKoZ0w3nK3FO9vjyO36UvfgwQjulU8AOSZBndsssMZ9jN0adD3DqwjjbFV7_oLHGXRABnC1XTi3Vox3UQLzc6Bpj2LhEprsDTA_vn2FAVfgJag-UNcDkHFf4n9wU7YV3oil-ThObtm7w_9m70Ski-qK1Iw27_Hsi8zmkW7azu2pw@clever-turkey.rmq.cloudamqp.com</a>/ps-push"},"archiver":"rabbitmq"},{"data":{"measurement-agent":"<a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a>","url":"<a href="https://psmsu01.aglt2.org/esmond/perfsonar/archive/">https://psmsu01.aglt2.org/esmond/perfsonar/archive/</a>","_auth-token":"9587b369b881432bc31c1e2bfe84d105a85a8f19"},"archiver":"esmond"}],"test":{"spec":{"source":"<a href="http://psmsu01.aglt2.org">psmsu01.aglt2.org</a>","data-ports":{"upper":9960,"lower":8760},"packet-padding":0,"dest":"<a href="http://lcg-lat.sfu.computecanada.ca">lcg-lat.sfu.computecanada.ca</a>","schema":1,"packet-interval":0.1,"bucket-width":0.001,"packet-count":600,"ip-version":4},"type":"latencybg"},"reference":{"psconfig":{"created-by":{"user-agent":"psconfig-pscheduler-agent","uuid":"87182A04-7DA1-11E9-AC4D-CAE63FCA00E4"}}},"schedule":{"until":"2020-11-23T19:42:47Z"}}<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:47:19)</span> <b>dweitzel:</b></span> not seeing anything<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:47:26)</span> <b>dweitzel:</b></span> oh, there we go.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:47:55)</span> <b>smckee:</b></span> Let me know if it stops again.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(13:48:38)</span> <b>smckee:</b></span> I think the issue you saw was from the ITB failing at some point and then the credential the psmsu01 instance had expired.<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:49:15)</span> <b>dweitzel:</b></span> ok, well I guess not ideal behavior, but that was expected with token lifetimes and all.<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:50:56)</span> <b>jthiltges:</b></span> Any clues to the cause? Last time, I couldn't find any issue with iptables rules, and the <tt>net.ipv4.ip_forward</tt> sysctl was my best guess.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(14:04:55)</span> <b>smckee:</b></span> net.ipv4.ip_forward = 1<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(14:05:01)</span> <b>smckee:</b></span> Still set to 1 on psconfig-itb<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(14:05:27)</span> <b>smckee:</b></span> Was unable to have docker-compose down work the first time (see error above)<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(14:05:31)</span> <b>smckee:</b></span> Second pass worked<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:09:19)</span> <b>jthiltges:</b></span> I think docker resets necessary sysctl knobs when the daemon is restarted. It would be interesting to check them before a restart if the issue shows up again.<br/>I'm not sure what to make of the docker-compose error. Disk I/O has been slow sometimes on psconfig-itb. Perhaps that caused the timeout.<br/>
<span style="color: #4ec0d6"><span style="font-size: small">(14:10:45)</span> <b>smckee:</b></span> Yes, maybe.   MSU still needs to upgrade their VMware infrastructure and that might be part of the issue<br/>
</body>
</html>
