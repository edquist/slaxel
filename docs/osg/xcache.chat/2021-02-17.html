<!DOCTYPE html>
<html>
<head>
<title>Wed Feb 17, 2021 : #xcache (osg)</title>
</head>
<body>
<h3>Wed Feb 17, 2021 : #xcache (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(08:52:00)</span> <b>bockjoo:</b></span> Does anyone know if there is any way to exclude a particular xrootd server from a local redirector?<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:40:14)</span> <b>bbockelm:</b></span> If you shutoff the <tt>cmsd</tt> on the desired local xrootd server, it will stop receiving new requests (potentially may take a few minutes for caches to expire - but it's not hours of waiting).<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:10:17)</span> <b>bockjoo:</b></span> I know that. But sometimes, the machine is not accessible due to very high loads or too many zombie processes and ipmi power-cycle does not work during weekends. So I wish there was a handle to control it from the xrootd redirector.<br/>
<span style="color: #a72f79"><span style="font-size: small">(10:58:21)</span> <b>andrew.melo:</b></span> Er, weekends is exactly the time IPMI should be working?<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:25:03)</span> <b>justas.balcas:</b></span> ipmi is hell of fun :smile: especially with SuperMicro<br/>
<span style="color: #a72f79"><span style="font-size: small">(12:26:42)</span> <b>andrew.melo:</b></span> One of our sysadmins performed a dark ritual and figured out the right hex values to send to SM machines to get the IPMI to set up the way we want w/o having to hit the bios<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:44:47)</span> <b>justas.balcas:</b></span> @andrew.melo regarding your comment in Blueprint about HS06. This can be done by sites using machinefeatures (and pilots would take this info and publish to ES). e.g. we use it only for shutdown time to nicely evict all payloads.<br/><pre>#   * Provide information on the disk space available for local usage by the job<br/># More details:  <a href="https://twiki.cern.ch/twiki/bin/view/LCG/MachineJobFeatures">https://twiki.cern.ch/twiki/bin/view/LCG/MachineJobFeatures</a><br/># As of today (26-03-2020) These options are supported. Otherwise double check<br/># with CMS and GlideINWMs team what are other options available.<br/>#  * *total_cpu*<br/>#  Number of processors which may be allocated to jobs. Typically the number of<br/>#  processors seen by the operating system on one worker node (that is the number<br/>#  of "processor :" lines in /proc/cpuinfo on Linux), but potentially set to more<br/>#  or less than this for performance reasons.<br/>#   * *hs06*<br/>#  Total HS06 rating of the full machine in its current setup. HS06 is measured<br/>#  following the HEPiX recommendations, with HS06 benchmarks run in parallel, one<br/>#  for each processor which may be allocated to jobs.<br/>#   * *shutdowntime*<br/>#  Shutdown time for the machine as a UNIX time stamp in seconds. The value is<br/>#  dynamic and optional. If the file is missing, no shutdown is foreseen.<br/>#   * *grace_secs*<br/>#  If the resource provider announces a shutdown time to the jobs on this host,<br/>#  that time will not be less than grace secs seconds after the moment the shutdown<br/>#  time is set. This allows jobs to begin packages of work knowing that there will<br/>#  be sufficient time for them to be completed even if a shutdown time is announced.<br/>#  This value is required if a shutdown time will be set or changed which will affect<br/>#  any jobs which have already started on this host.</pre><br/>
<span style="color: #a72f79"><span style="font-size: small">(12:45:26)</span> <b>andrew.melo:</b></span> I forgot it provided that. I looked at them a long time ago for shutdown and it didn't quite do it right<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:46:23)</span> <b>justas.balcas:</b></span> yep, Marco fixed that :wink: (a year ago)<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:47:57)</span> <b>justas.balcas:</b></span> <a href="https://github.com/glideinWMS/glideinwms/commit/3270ed326aaaa1dff8b0ed63a8748ac21273d5d1">https://github.com/glideinWMS/glideinwms/commit/3270ed326aaaa1dff8b0ed63a8748ac21273d5d1</a><br/>
<span style="color: #a72f79"><span style="font-size: small">(12:51:43)</span> <b>andrew.melo:</b></span> Ah, we just send a SIGKILL and wait 3 mins :slightly_smiling_face:<br/>
<span style="color: #de5f24"><span style="font-size: small">(12:53:35)</span> <b>justas.balcas:</b></span> my issue was with shutdowntime - once set - it kills all right away, without waiting grace period. So future downtimes (e.g. next week) - was not working<br/>
<span style="color: #7d414c"><span style="font-size: small">(16:23:16)</span> <b>bockjoo:</b></span> @andrew.melo I meant " ipmi power-cycle does not work due to the fact that the BMC is too old with most of our xrootd servers and it's during weekend  so HPC people would not go in to manually power-cycle the machine".<br/>
<span style="color: #a72f79"><span style="font-size: small">(16:30:58)</span> <b>andrew.melo:</b></span> Ah, we got rid of any non-IPMI hosts a long long time ago because of exactly that<br/>
<span style="color: #7d414c"><span style="font-size: small">(18:38:23)</span> <b>bockjoo:</b></span> No, they are supposed to be working because they worked before. But at some point, like last night, they stopped working. It's 6.1 years old only. To the USCMS T2 standard, this is still a usable machine.  I just have no idea why controlling servers from the redirector is not possible.<br/>
<span style="color: #a72f79"><span style="font-size: small">(18:46:42)</span> <b>andrew.melo:</b></span> drop it @ iptables then<br/>
<span style="color: #7d414c"><span style="font-size: small">(18:50:15)</span> <b>bockjoo:</b></span> That's not my jurisdiction, so I am not supposed to do that even if I know how to do it.<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:12:13)</span> <b>andrew.melo:</b></span> You don't have root on the redirector?<br/>
<span style="color: #a72f79"><span style="font-size: small">(19:13:21)</span> <b>andrew.melo:</b></span> Just do on the redirector <tt>iptables -I INPUT 1 -p tcp --dport 1213 -s &lt;bad host IP&gt; -j REJECT</tt> and they won't be able to talk<br/>
<span style="color: #7d414c"><span style="font-size: small">(19:23:33)</span> <b>bockjoo:</b></span> I have. I will try that.<br/>
<span style="color: #7d414c"><span style="font-size: small">(20:00:21)</span> <b>bockjoo:</b></span> That did not work. The redirector still lists the server.<br/>
<span style="color: #d1707d"><span style="font-size: small">(20:52:58)</span> <b>gattebury:</b></span> Donâ€™t forget ip6tables if that host has IPv6 as well<br/>
<span style="color: #7d414c"><span style="font-size: small">(23:04:42)</span> <b>bockjoo:</b></span> Ah, that worked. Thanks!<br/>
</body>
</html>
