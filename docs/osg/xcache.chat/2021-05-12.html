<!DOCTYPE html>
<html>
<head>
<title>Wed May 12, 2021 : #xcache (osg)</title>
</head>
<body>
<h3>Wed May 12, 2021 : #xcache (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(09:26:51)</span> <b>bockjoo:</b></span> Does export XRD_NETWORKSTACK=IPv4 work when one reads files within a root macro or CMSSW compiled code?<br/>
<span style="color: #a72f79"><span style="font-size: small">(09:34:19)</span> <b>andrew.melo:</b></span> I think that's picked up by the xrootd shared library<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:30:20)</span> <b>justas.balcas:</b></span> Hi Folks, I hit another xrootd 5.2 issue (not sure yet if related to xrootd version or not)<br/><pre>-bash-4.2$ gfal-ls <a href="davs://xrootd-redir.ultralight.org:1094/store/user/jbalcas/">davs://xrootd-redir.ultralight.org:1094/store/user/jbalcas/</a><br/>core-dumps<br/>18Jan2019_job0_outHist.root<br/>1GB_File<br/>18Jan2019_job0_outHist.root1<br/>for-xrootd-devs<br/>test<br/>-bash-4.2$<br/>-bash-4.2$ gfal-ls <a href="root://xrootd-redir.ultralight.org/store/user/jbalcas/">root://xrootd-redir.ultralight.org/store/user/jbalcas/</a><br/>gfal-ls error: 115 (Operation now in progress) - Failed reading directory: [ERROR] Error response: No such file or directory (Unknown error 400)</pre><br/>It fails to do directory listing via redirector; But if I try other commands:<br/><pre>-bash-4.2$ xrdfs <a href="http://xrootd-redir.ultralight.org">xrootd-redir.ultralight.org</a><br/>[<a href="http://xrootd-redir.ultralight.org:1094">xrootd-redir.ultralight.org:1094</a>] / &gt; ls /store<br/>[!] Some of the requests failed. The result may be incomplete.<br/>[<a href="http://xrootd-redir.ultralight.org:1094">xrootd-redir.ultralight.org:1094</a>] / &gt; ls /store/<br/>/store/.swp<br/>/store/backfill<br/>/store/data<br/>/store/express<br/>/store/group<br/>/store/hidata<br/>/store/himc<br/>/store/mc<br/>/store/relval<br/>/store/results<br/>/store/temp<br/>/store/test<br/>/store/unmerged<br/>/store/user<br/># or list file itself (it works):<br/>-bash-4.2$ gfal-ls <a href="root://xrootd-redir.ultralight.org//store/user/jbalcas/1GB_File">root://xrootd-redir.ultralight.org//store/user/jbalcas/1GB_File</a><br/><a href="root://xrootd-redir.ultralight.org//store/user/jbalcas/1GB_File">root://xrootd-redir.ultralight.org//store/user/jbalcas/1GB_File</a></pre><br/>
<span style="color: #de5f24"><span style="font-size: small">(15:30:46)</span> <b>justas.balcas:</b></span> I do have <tt>cms.dfs lookup distrib mdhold 20m redirect immed</tt>  inside redirector to redirect all to data servers - but it confuses me how it can work with davs but not root.<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:43:27)</span> <b>dweitzel:</b></span> Anything in the XRootD server logs?<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:44:46)</span> <b>justas.balcas:</b></span> I updated hdfs redirector and it is fine. So not 5.2 related. for logs, 1 sec, enabling debug<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:45:37)</span> <b>justas.balcas:</b></span> <pre>210512 20:44:55 25992 sec_getParms: <a href="http://login-1.hep.caltech.edu">login-1.hep.caltech.edu</a> sectoken=&amp;P=gsi,v:10400,c:ssl,ca:ba240aa8.0|f5f0dfc2.0<br/>210512 20:44:55 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0000 sending 61 data bytes; status=0<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0000 req=auth dlen=112<br/>sec_PM: Using gsi protocol, args='v:10400,c:ssl,ca:ba240aa8.0|f5f0dfc2.0'<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0000 more auth requested; sz=3093<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0000 sending 3093 data bytes; status=4002<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0000 req=auth dlen=10065<br/>210512 20:44:56 25992 cryptossl_X509::CertType: certificate has 5 extensions<br/>210512 20:44:56 25992 cryptossl_X509::CertType: certificate has 11 extensions<br/>INFO in AuthzKey: Returning '/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jbalcas/CN=751133/CN=Justas Balcas::cms:/cms,/cms/becms,/cms/dcms,/cms/escms,/cms/itcms,/cms/uscms,::' of l<br/>ength 145 as key.<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0000 sending OK<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Protocol 'gsi'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Name 'jbalcas'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Host '<a href="mailto:login-1.hep.caltech.edu46@login-1.hep.caltech.edu">login-1.hep.caltech.edu46@login-1.hep.caltech.edu</a> Host '<a href="http://login-1.hep.caltech.edu">login-1.hep.caltech.edu</a>'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Vorg 'cms'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Role ''<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Grps '/cms /cms/becms /cms/dcms /cms/escms /cms/itcms /cms/uscms'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Caps ''<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Pidn 'jbalcas.3134036:46@login-1.hep.caltech.edu'<br/>jbalcas.3134036:46@login-1.hep.caltech.edu Crlen 9266<br/>jbalcas.3134036:46@login-1.hep.caltech.edu ueid  10<br/>jbalcas.3134036:46@login-1.hep.caltech.edu uid   0<br/>jbalcas.3134036:46@login-1.hep.caltech.edu gid   0<br/>210512 20:44:56 25992 XrootdMonitor: 367 bytes sent to 169.228.130.91:9930 rc=0<br/>210512 20:44:56 25992 XrootdMonitor: 367 bytes sent to <a href="http://xrootd-mon.unl.edu:9930">xrootd-mon.unl.edu:9930</a> rc=0<br/>210512 20:44:56 25992 XrootdXeq: jbalcas.3134036:46@login-1.hep.caltech.edu pub IPv4 login as jbalcas<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 req=stat dlen=49<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu ofs_stat:  fn=/store/<br/>210512 20:44:56 25973 Receive localhost 30 bytes on 11263<br/>210512 20:44:56 25973 Decode xrootd-redir redirects jbalcas.3134036:46@login-1.hep.caltech.edu to <a href="http://transfer-8.ultralight.org:1094">transfer-8.ultralight.org:1094</a> /store/<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 rc=-256 stat /store/<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 redirecting to transfer-8.ultralight.<br/>org:1094<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0100 sending 29 data bytes; status=4004<br/>210512 20:44:56 25986 cmspilot.269:45@compute-1-21 XrootdProtocol: 0100 request timeout; read 0 of 24 bytes<br/>210512 20:44:56 25986 XrdPoll: Poller 2 enabled cmspilot.269:45@compute-1-21<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 req=stat dlen=49<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu ofs_stat:  fn=/store/<br/>210512 20:44:56 25973 Receive localhost 31 bytes on 12287<br/>210512 20:44:56 25973 Decode xrootd-redir redirects jbalcas.3134036:46@login-1.hep.caltech.edu to <a href="http://transfer-10.ultralight.org:1094">transfer-10.ultralight.org:1094</a> /store/<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 rc=-256 stat /store/<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 redirecting to <a href="http://transfer-10.ultralight.org:1094">transfer-10.ultralight.org:1094</a><br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0100 sending 30 data bytes; status=4004<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdProtocol: 0100 req=dirlist dlen=8<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu ofs_opendir:  fn=/store/<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu oss_Opendir: lcl path /storage/cms/store/ (/store/)<br/>210512 20:44:56 25992 ofs_opendir: jbalcas.3134036:46@login-1.hep.caltech.edu Unable to open directory /store/; no such file or directory<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrootdResponse: 0100 sending err 3011: Unable to open directory /store/; no such file or directory<br/>210512 20:44:56 25992 XrootdXeq: jbalcas.3134036:46@login-1.hep.caltech.edu disc 0:00:01<br/>210512 20:44:56 25992 XrootdMonitor: 56 bytes sent to 169.228.130.91:9930 rc=0<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrdPoll: Poller 0 removing FD 46<br/>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu XrdPoll: FD 46 detached from poller 0; num=2</pre><br/>
<span style="color: #de5f24"><span style="font-size: small">(15:55:29)</span> <b>justas.balcas:</b></span> here looks to be an issue:<br/><pre>210512 20:44:56 25992 jbalcas.3134036:46@login-1.hep.caltech.edu oss_Opendir: lcl path /storage/cms/store/ (/store/</pre><br/>Whenever it is redirected to real server - real server is not doing this mapping anymore, and tries to access /store, while it should /storage/cms/store<br/>If i go directly to real server with /store/ - all works. Any hints?<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:58:08)</span> <b>dweitzel:</b></span> I'm a bit confused, you updated something and now it works?<br/>
<span style="color: #de5f24"><span style="font-size: small">(15:59:24)</span> <b>justas.balcas:</b></span> I have 2 clusters, one under hdfs another under ceph (+multiuser). hdfs works with 5.2 release and dir listing is ok. for Ceph + multiuser - it fails to do directory listing going via redirector, but works if I go to individual server’s<br/>
<span style="color: #de5f24"><span style="font-size: small">(16:00:03)</span> <b>justas.balcas:</b></span> and configs are pretty much == - the only diff is multiuser vs hdfs plugin<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:03:50)</span> <b>dweitzel:</b></span> interesting...<br/>
<span style="color: #235e5b"><span style="font-size: small">(16:04:36)</span> <b>dweitzel:</b></span> Sorry, I don't think I'm gonna be able to help.  Could you open an issue in github, or send to the xrootd mailing list?<br/>
<span style="color: #de5f24"><span style="font-size: small">(17:11:33)</span> <b>justas.balcas:</b></span> <a href="mailto:xrootd-l@slac.stanford.edu">xrootd-l@slac.stanford.edu</a> ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(17:20:45)</span> <b>dweitzel:</b></span> Yup. Or GitHub issues. <br/>
</body>
</html>
