<!DOCTYPE html>
<html>
<head>
<title>Mon May 10, 2021 : #xcache (osg)</title>
</head>
<body>
<h3>Mon May 10, 2021 : #xcache (osg)</h3>
<span style="color: #43761b"><span style="font-size: small">(09:22:10)</span> <b>blin:</b></span> does anyone know where we can find documentation for configuring voms in XRootD 5?<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:10:08)</span> <b>justas.balcas:</b></span> Not sure if this is related, but with with dev release 5.2 and latest multiuser - I get xrootd killed often:<br/><pre>May 10 07:55:36 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 07:57:43 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 07:57:48 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 07:58:16 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 07:58:52 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 07:59:12 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:00:13 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:03:02 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:03:14 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:03:21 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:04:28 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:04:35 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:04:52 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:05:53 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:06:00 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:07:21 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29</pre><br/>
<span style="color: #de5f24"><span style="font-size: small">(10:13:52)</span> <b>justas.balcas:</b></span> @bockjoo did you solved this one: <a href="https://github.com/xrootd/xrootd/issues/1113">https://github.com/xrootd/xrootd/issues/1113</a> ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:15:47)</span> <b>dweitzel:</b></span> Does it run out of memory?<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:17:06)</span> <b>justas.balcas:</b></span> let me check, but I doubt, load is very low<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:18:14)</span> <b>justas.balcas:</b></span> Not memory, max 4gb used from ~100g<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:18:34)</span> <b>dweitzel:</b></span> huh, interesting.  Do you want to poke that xrootd issue?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:18:42)</span> <b>dweitzel:</b></span> Async issues?<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:19:09)</span> <b>justas.balcas:</b></span> Bockjoo was facing same issue<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:19:38)</span> <b>justas.balcas:</b></span> but with async off - was still showing up. Would be nice to have core dump<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:19:47)</span> <b>justas.balcas:</b></span> but somehow â€¦ privileged keeps not doing that<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:19:58)</span> <b>dweitzel:</b></span> I thought you send me a core file before?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:20:04)</span> <b>dweitzel:</b></span> Last week.<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:20:14)</span> <b>justas.balcas:</b></span> yep, and I changed nothing - this crash does not produce core dump<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:20:40)</span> <b>dweitzel:</b></span> ugh.  So async didn't fix it then?<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:21:40)</span> <b>justas.balcas:</b></span> I enabled full xrootd debug mode, will wait for crash, if nothing in logs, will try to get core dump<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:21:50)</span> <b>justas.balcas:</b></span> and also async, will keep posted<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:22:13)</span> <b>dweitzel:</b></span> ok, thanks!  My debug node is still all setup and ready to read core files!<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:24:08)</span> <b>justas.balcas:</b></span> interesting. if I do <tt>service xrootd-privileged@clustered restart</tt>  - it gets error:<br/><pre>May 10 08:22:43 transfer-10 systemd[1]: Stopping XRootD xrootd deamon instance clustered...<br/>May 10 08:22:43 transfer-10 systemd[1]: Stopped XRootD xrootd deamon instance clustered.<br/>May 10 08:22:43 transfer-10 systemd[1]: Started XRootD xrootd deamon instance clustered.<br/>....<br/>May 10 08:22:59 transfer-10 systemd[1]: xrootd-privileged@clustered.service: main process exited, code=killed, status=63/RTMIN+29<br/>May 10 08:22:59 transfer-10 systemd[1]: Unit xrootd-privileged@clustered.service entered failed state.<br/>May 10 08:22:59 transfer-10 systemd[1]: xrootd-privileged@clustered.service failed.<br/>May 10 08:22:59 transfer-10 systemd[1]: xrootd-privileged@clustered.service has no holdoff time, scheduling restart.<br/>May 10 08:22:59 transfer-10 systemd[1]: Stopped XRootD xrootd deamon instance clustered.<br/>May 10 08:22:59 transfer-10 systemd[1]: Started XRootD xrootd deamon instance clustered.</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(10:29:47)</span> <b>bbockelm:</b></span> @justas.balcas - how did you turn off async?  That looks very much like the async issue.<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:30:52)</span> <b>justas.balcas:</b></span> I did not yet, will do now. was checking core dumps issue<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:32:43)</span> <b>justas.balcas:</b></span> But how does it affect xrootd/client with it turned off?<br/>
<span style="color: #de5f24"><span style="font-size: small">(10:38:22)</span> <b>justas.balcas:</b></span> 5 mins with async off - no crash. Seems this is the case. Will see later if repeats<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:53:18)</span> <b>bockjoo:</b></span> Yup, I still have xrootd.async off  in my xrootd-clustered.cfg<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:19:34)</span> <b>dweitzel:</b></span> I asked Andy about this error, especially with Multi-user:<br/>&gt; Likely because your running Globus which uses signals. So, turn async I/O off. As it works out while I was working on async I/O redo I realized that it wouldn't work with multi-user anyway.<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:38:37)</span> <b>dweitzel:</b></span> @matyas @blin so we provide kubernetes yaml for xcache?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:39:28)</span> <b>blin:</b></span> we do not. the SLATE team has an ATLAS helm chart and i think they've been working on a CMS one<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:41:31)</span> <b>dweitzel:</b></span> thanks<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:19:30)</span> <b>bbockelm:</b></span> @dweitzel - in particular, LCMAPS loads Globus which hijacks the signal handlers while in use.  The async libraries _also_ use signals to inform threads that there is data ready.  Hence, the signal meant for the async library is delivered to Globus which had reset the handler to crash the program instead of invoking the callback.  Basically, two libraries battling for the ownership of a process-wide resource (which is exactly why signals are a bad idea for libraries!).<br/><br/>Theoretically, we could do some deep surgery inside Globus and avoid touching this handler.  However, given we need to nudge folks to using VOMS directly anyway -- and apparently async doesn't work with multiuser -- we can just turn this off for now.<br/>
</body>
</html>
