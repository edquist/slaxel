<!DOCTYPE html>
<html>
<head>
<title>Wed Aug 7, 2019 : #xcache (osg)</title>
</head>
<body>
<h3>Wed Aug 7, 2019 : #xcache (osg)</h3>
<span style="color: #a63024"><span style="font-size: small">(10:05:32)</span> <b>efajardo:</b></span> Hi <b>@here</b> was a new stashcache built recently?<br/>
<span style="color: #a63024"><span style="font-size: small">(10:05:40)</span> <b>efajardo:</b></span> I am seeing these errorrs<br/>
<span style="color: #a63024"><span style="font-size: small">(10:06:03)</span> <b>efajardo:</b></span> <pre>lcmaps[629]     LOG_ERR: 2019-08-06.03:13:46Z: lcmaps.mod-PluginInit(): plugin lcmaps_scas_client.mod not found (arguments: -resourcetype wn -actiontype execute-now -capath /etc/grid-security/certificates -cert   /etc/grid-security/xrd/xrdcert.pem -key    /etc/grid-security/xrd/xrdkey.pem --endpoint <a href="https://red-auth.unl.edu:8443/gums/services/GUMSXACMLAuthorizationServicePort)">https://red-auth.unl.edu:8443/gums/services/GUMSXACMLAuthorizationServicePort)</a><br/>lcmaps[629]     LOG_ERR: 2019-08-06.03:13:46Z: lcmaps.mod-lcmaps_startPluginManager(): error initializing plugin: lcmaps_scas_client.mod<br/>lcmaps[629]     LOG_ERR: 2019-08-06.03:13:46Z: lcmaps_init() error: could not start plugin manager<br/>ERROR in xrootd-lcmaps config: Failed to initialize LCMAPS<br/>190806 03:13:46 629 secgsi_LoadAuthzFun: problems executing 'XrdSecgsiAuthzInit()' (rc: -1)<br/>190806 03:13:46 629 secgsi_Init: Secgsi: ErrError: Authz plug-in could not be loaded: libXrdLcmaps.so<br/>Secgsi: ErrError: Authz plug-in could not be loaded: libXrdLcmaps.so<br/>=====&gt; sec.protocol /usr/lib64 gsi -certdir:/etc/grid-security/certificates -cert:/etc/grid-security/xrd/xrdcert.pem -key:/etc/grid-security/xrd/xrdkey.pem -crl:1 -authzfun:libXrdLcmaps.so -authzfunparms:--lcmapscfg,/etc/xrootd/lcmaps.cfg,--no-authz -gmapopt:0 -authzto:3600<br/>190806 03:13:46 629 sec_Config: protbind gsi protocol not previously defined.<br/>=====&gt; sec.protbind * gsi<br/>Config continuing with file /etc/xrootd/config.d/50-stash-cache-paths.cfg ...<br/>Config continuing with file /etc/xrootd/config.d/90-xcache-logging.cfg ...<br/>Config 4 authentication directives processed in /etc/xrootd/xrootd-stash-cache-auth.cfg<br/>------ Authentication system initialization failed.<br/>Config Unable to create security framework via /usr/lib64/libXrdSec.so<br/>190806 03:13:46 629 XrootdConfig: Unable to load security system.<br/>------ xrootd protocol initialization failed.<br/>190806 03:13:46 629 XrdProtocol: Protocol xrootd could not be loaded<br/>------ xrootd <a href="mailto:stash-cache-auth@fiona-r-uva.vlan7.uvalight.net">stash-cache-auth@fiona-r-uva.vlan7.uvalight.net</a>:8443 initialization failed.</pre><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:06:50)</span> <b>dweitzel:</b></span> ah, I forgot the default lcmaps still ships with Nebraska's long gone Gums configured.<br/>
<span style="color: #a63024"><span style="font-size: small">(10:07:20)</span> <b>efajardo:</b></span> yea but this was working fine<br/>
<span style="color: #a63024"><span style="font-size: small">(10:07:28)</span> <b>efajardo:</b></span> something changed in the stashcache image<br/>
<span style="color: #a63024"><span style="font-size: small">(10:13:05)</span> <b>efajardo:</b></span> changing the image from <tt>opensciencegrid/stash-cache:fresh</tt> to <tt>opensciencegrid/stash-cache:stable</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(10:13:09)</span> <b>efajardo:</b></span> seems to work<br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:12)</span> <b>efajardo:</b></span> IT looks like xroot<br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:26)</span> <b>efajardo:</b></span> does not like to overwrite the security configuration<br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:29)</span> <b>efajardo:</b></span> <pre>190807 17:22:08 590 secgsi_InitOpts: *** ------------------------------------------------------------ ***<br/>INFO in xrootd-lcmaps config: XrdLcmaps: Setting LCMAPS config file to /etc/lcmaps.db.<br/>INFO in xrootd-lcmaps config: XrdLcmaps: Setting LCMAPS log level to 0.<br/>INFO in xrootd-lcmaps config: XrdLcmaps: Using LCMAPS policy name xrootd_policy.<br/>lcmaps[590]     LOG_ERR: 2019-08-07.17:22:08Z: /etc/lcmaps.db:165: [warning] expecting rule definitions.<br/>lcmaps[590]     LOG_ERR: 2019-08-07.17:22:08Z: /etc/lcmaps.db:165: [warning] no rules specified for policy: 'glexec' at line 153.<br/>lcmaps[590]     LOG_ERR: 2019-08-07.17:22:08Z: lcmaps.mod-PluginInit(): plugin lcmaps_gums_client.mod not found (arguments: -resourcetype ce -actiontype execute-now -capath /etc/grid-security/certificates -cert   /etc/grid-security/hostcert.pem -key    /etc/grid-security/hostkey.pem --cert-owner root --endpoint <a href="https://yourgums.yourdomain:8443/gums/services/GUMSXACMLAuthorizationServicePort)">https://yourgums.yourdomain:8443/gums/services/GUMSXACMLAuthorizationServicePort)</a><br/>lcmaps[590]     LOG_ERR: 2019-08-07.17:22:08Z: lcmaps.mod-lcmaps_startPluginManager(): error initializing plugin: lcmaps_gums_client.mod<br/>lcmaps[590]     LOG_ERR: 2019-08-07.17:22:08Z: lcmaps_init() error: could not start plugin manager<br/>ERROR in xrootd-lcmaps config: Failed to initialize LCMAPS<br/>190807 17:22:08 590 secgsi_LoadAuthzFun: problems executing 'XrdSecgsiAuthzInit()' (rc: -1)<br/>190807 17:22:08 590 secgsi_Init: Secgsi: ErrError: Authz plug-in could not be loaded: libXrdLcmaps.so<br/>Secgsi: ErrError: Authz plug-in could not be loaded: libXrdLcmaps.so<br/>=====&gt; sec.protocol /usr/lib64 gsi -certdir:/etc/grid-security/certificates -cert:/etc/grid-security/xrd/xrdcert.pem -key:/etc/grid-security/xrd/xrdkey.pem -crl:1 -authzfun:libXrdLcmaps.so -authzfunparms:lcmapscfg=/etc/lcmaps.db,loglevel=0,policy=authorize_only -gmapopt:10 -gmapto:0</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:35)</span> <b>efajardo:</b></span> This is from this file<br/>
<span style="color: #a63024"><span style="font-size: small">(12:29:50)</span> <b>efajardo:</b></span> <tt>/etc/xrootd/config.d/40-xrootd-lcmaps.cfg</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(12:30:40)</span> <b>bbockelm:</b></span> @efajardo - that file isn't from <tt>xrootd</tt> but from <tt>xrootd-lcmaps</tt>.<br/>
<span style="color: #a63024"><span style="font-size: small">(12:30:54)</span> <b>efajardo:</b></span> yes<br/>
<span style="color: #a63024"><span style="font-size: small">(12:30:58)</span> <b>efajardo:</b></span> but the fact is that xrootd<br/>
<span style="color: #a63024"><span style="font-size: small">(12:31:08)</span> <b>efajardo:</b></span> does not like the <tt>sec.protocol</tt> to be overwritten<br/>
<span style="color: #a63024"><span style="font-size: small">(12:31:14)</span> <b>efajardo:</b></span> since I change configuration on this file<br/>
<span style="color: #a63024"><span style="font-size: small">(12:31:44)</span> <b>efajardo:</b></span> <pre>Config continuing with file /etc/xrootd/config.d/50-cms-xcache-authz.cfg ...<br/>Plugin loaded <br/>190807 17:22:08 590 secgsi_InitOpts: *** ------------------------------------------------------------ ***<br/>190807 17:22:08 590 secgsi_InitOpts:  Mode: server<br/>190807 17:22:08 590 secgsi_InitOpts:  Debug: -1<br/>190807 17:22:08 590 secgsi_InitOpts:  CA dir: /etc/grid-security/certificates<br/>190807 17:22:08 590 secgsi_InitOpts:  CA verification level: 1<br/>190807 17:22:08 590 secgsi_InitOpts:  CRL dir: ,/etc/grid-security/certificates/<br/>190807 17:22:08 590 secgsi_InitOpts:  CRL extension: .r0<br/>190807 17:22:08 590 secgsi_InitOpts:  CRL check level: 1<br/>190807 17:22:08 590 secgsi_InitOpts:  CRL refresh time: 86400<br/>190807 17:22:08 590 secgsi_InitOpts:  Certificate: /etc/grid-security/xrd/xrdcert.pem<br/>190807 17:22:08 590 secgsi_InitOpts:  Key: /etc/grid-security/xrd/xrdkey.pem<br/>190807 17:22:08 590 secgsi_InitOpts:  Proxy delegation option: 0<br/>190807 17:22:08 590 secgsi_InitOpts:  GRIDmap file: /etc/grid-security/grid-mapfile<br/>190807 17:22:08 590 secgsi_InitOpts:  GRIDmap option: 10<br/>190807 17:22:08 590 secgsi_InitOpts:  GRIDmap cache entries expiration (secs): 0<br/>190807 17:22:08 590 secgsi_InitOpts:  Authorization function: libXrdLcmaps.so<br/>190807 17:22:08 590 secgsi_InitOpts:  Authorization function parms: lcmapscfg=/etc/xrootd/lcmaps.cfg,loglevel=1,no-authz<br/>190807 17:22:08 590 secgsi_InitOpts:  Authorization cache entries expiration (secs): -1<br/>190807 17:22:08 590 secgsi_InitOpts:  Client proxy availability in XrdSecEntity.endorsement: 0<br/>190807 17:22:08 590 secgsi_InitOpts:  VOMS option: 1<br/>190807 17:22:08 590 secgsi_InitOpts:  MonInfo option: 0<br/>190807 17:22:08 590 secgsi_InitOpts:  Crypto modules: ssl<br/>190807 17:22:08 590 secgsi_InitOpts:  Ciphers: aes-128-cbc:bf-cbc:des-ede3-cbc<br/>190807 17:22:08 590 secgsi_InitOpts:  MDigests: sha1:md5<br/>190807 17:22:08 590 secgsi_InitOpts:  Trusting DNS for hostname checking<br/>190807 17:22:08 590 secgsi_InitOpts: *** ------------------------------------------------------------ ***<br/>INFO in xrootd-lcmaps config: XrdLcmaps: Setting LCMAPS config file to /etc/xrootd/lcmaps.cfg.<br/>INFO in xrootd-lcmaps config: XrdLcmaps: Setting LCMAPS log level to 1.<br/>190807 17:22:08 590 secgsi_LoadAuthzFun: using 'XrdSecgsiAuthzFun()' from libXrdLcmaps.so<br/>=====&gt; sec.protocol /usr/lib64 gsi -certdir:/etc/grid-security/certificates -cert:/etc/grid-security/xrd/xrdcert.pem -key:/etc/grid-security/xrd/xrdkey.pem -crl:1 -authzfun:libXrdLcmaps.so -authzfunparms:lcmapscfg=/etc/xrootd/lcmaps.cfg,loglevel=1,no-authz -gmapopt:10 -gmapto:0<br/>=====&gt; sec.protbind * gsi<br/></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(12:31:51)</span> <b>efajardo:</b></span> <tt>/etc/xrootd/config.d/50-cms-xcache-authz.cfg</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(12:32:25)</span> <b>bbockelm:</b></span> Looking at the git repo, I don't think there is any way provided to turn off the <tt>sec.protocol</tt> line from LCMAPS.<br/>
<span style="color: #a63024"><span style="font-size: small">(12:32:32)</span> <b>efajardo:</b></span> so basically it fails with a configugration in file <tt>40-xrootd-lcmaps.cfg</tt>  altogh it is overwritten in <tt>50-cms-xcache-authz.cfg</tt><br/>
<span style="color: #9e3997"><span style="font-size: small">(12:32:37)</span> <b>bbockelm:</b></span> what's in <tt>/etc/xrootd/config.d/50-cms-xcache-authz.cfg</tt>?<br/>
<span style="color: #a63024"><span style="font-size: small">(12:33:15)</span> <b>efajardo:</b></span> <a href="https://github.com/opensciencegrid/xcache/blob/master/configs/cms-xcache/config.d/50-cms-xcache-authz.cfg">https://github.com/opensciencegrid/xcache/blob/master/configs/cms-xcache/config.d/50-cms-xcache-authz.cfg</a><br/>
<span style="color: #9e3997"><span style="font-size: small">(12:34:44)</span> <b>bbockelm:</b></span> Yeah - for now, you can probably link <tt>/etc/lcmaps.db</tt> to <tt>/etc/xrootd/lcmaps.db</tt> to work around things.<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:35:02)</span> <b>bbockelm:</b></span> but you might want to chime in on <tt>SOFTWARE-3534</tt> and note the new version broke backward compat.<br/>
<span style="color: #a63024"><span style="font-size: small">(12:37:07)</span> <b>efajardo:</b></span> thanks @bbockelm<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:38:46)</span> <b>bbockelm:</b></span> on the upside, at least it isn't released yet!<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:45:20)</span> <b>bbockelm:</b></span> @efajardo - it might also work to move <tt>50-cms-xcache-authz.cfg</tt> to something like <tt>30-cms-xcache-authz.cfg</tt>.  That said, the better route would be to use the same default filename as <tt>xrootd-lcmaps</tt> plans on using.<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:45:32)</span> <b>bbockelm:</b></span> Anyhow, I made a comment in the ticket for you.<br/>
<span style="color: #a63024"><span style="font-size: small">(13:11:14)</span> <b>efajardo:</b></span> thanks<br/>I made a comment<br/>
<span style="color: #a63024"><span style="font-size: small">(13:11:22)</span> <b>efajardo:</b></span> Frank just got into my office<br/>
<span style="color: #a63024"><span style="font-size: small">(13:11:32)</span> <b>efajardo:</b></span> I think moving that to 30 should fix it<br/>
<span style="color: #a63024"><span style="font-size: small">(13:11:36)</span> <b>efajardo:</b></span> so I will try that next<br/>
<span style="color: #a63024"><span style="font-size: small">(13:11:39)</span> <b>efajardo:</b></span> among other changes<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:15:36)</span> <b>bbockelm:</b></span> Sounds good. Do think about my comment that we should align the filenames for lcmaps.db no matter what.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:16:00)</span> <b>bbockelm:</b></span> Also, you are not using no-authz mode — why?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:33:31)</span> <b>efajardo:</b></span> hmm<br/>
<span style="color: #a63024"><span style="font-size: small">(14:33:33)</span> <b>efajardo:</b></span> I htink I was<br/>
<span style="color: #a63024"><span style="font-size: small">(14:33:37)</span> <b>efajardo:</b></span> if I am not that is a bug<br/>
<span style="color: #a63024"><span style="font-size: small">(14:33:42)</span> <b>efajardo:</b></span> I sent a new PR<br/>
<span style="color: #a63024"><span style="font-size: small">(14:33:43)</span> <b>efajardo:</b></span> <a href="https://github.com/opensciencegrid/xcache/pull/71">https://github.com/opensciencegrid/xcache/pull/71</a><br/>
<span style="color: #a63024"><span style="font-size: small">(14:34:44)</span> <b>efajardo:</b></span> We are usint no-auths<br/>
<span style="color: #a63024"><span style="font-size: small">(14:34:45)</span> <b>efajardo:</b></span> <a href="https://github.com/opensciencegrid/xcache/blob/master/configs/cms-xcache/config.d/50-cms-xcache-authz.cfg#L18">https://github.com/opensciencegrid/xcache/blob/master/configs/cms-xcache/config.d/50-cms-xcache-authz.cfg#L18</a><br/>
<span style="color: #a63024"><span style="font-size: small">(14:34:46)</span> <b>efajardo:</b></span> see<br/>
<span style="color: #a63024"><span style="font-size: small">(14:34:54)</span> <b>efajardo:</b></span> @blin made that fix<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:43:00)</span> <b>bbockelm:</b></span> @efajardo - thanks.  Completely overlooked that last argument.  Another reason to dislike the 200 character <tt>sec.protocol</tt> line!<br/>
<span style="color: #a63024"><span style="font-size: small">(15:15:46)</span> <b>efajardo:</b></span> I am running into thsi error<br/>
<span style="color: #a63024"><span style="font-size: small">(15:15:48)</span> <b>efajardo:</b></span> <pre>------ Storage system initialization completed.<br/>190807 20:14:33 844 XrdFileCache_Cache::ConfigParameters(): error obtaining stat info for data space  public<br/>Config Proxy file cache initialization failed.<br/></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(15:20:33)</span> <b>efajardo:</b></span> any idea what the problem is?<br/>
<span style="color: #a63024"><span style="font-size: small">(15:46:00)</span> <b>efajardo:</b></span> nvm I fixed it<br/>
<span style="color: #235e5b"><span style="font-size: small">(15:47:46)</span> <b>dweitzel:</b></span> Is there instructions for CMS cache installation / configuration?<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:17)</span> <b>efajardo:</b></span> Well<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:22)</span> <b>efajardo:</b></span> I am making them as it goes<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:30)</span> <b>efajardo:</b></span> but baiscally it is:<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:34)</span> <b>efajardo:</b></span> 1. Install the rpm<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:42)</span> <b>efajardo:</b></span> 2. cReate file with disks<br/>
<span style="color: #a63024"><span style="font-size: small">(16:00:44)</span> <b>efajardo:</b></span> 3. start services<br/>
<span style="color: #a63024"><span style="font-size: small">(16:01:19)</span> <b>efajardo:</b></span> However I am finding errors here and there so maybe by next week when I am done with all errors I will be in position to write documentation<br/>
<span style="color: #a63024"><span style="font-size: small">(16:01:26)</span> <b>efajardo:</b></span> together with Stefan (Purdue)<br/>
<span style="color: #a63024"><span style="font-size: small">(16:01:32)</span> <b>efajardo:</b></span> Since we are installing a cache ther<br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:14)</span> <b>efajardo:</b></span> We had old instrucionts written here<br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:15)</span> <b>efajardo:</b></span> <a href="http://www.t2.ucsd.edu/twiki2/bin/view/UCSDTier2/XcacheInstall">http://www.t2.ucsd.edu/twiki2/bin/view/UCSDTier2/XcacheInstall</a><br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:26)</span> <b>efajardo:</b></span> but I would not recommend those to anybody I care for<br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:54)</span> <b>efajardo:</b></span> <b>@here</b> I see in the cache images<br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:57)</span> <b>efajardo:</b></span> this was created<br/>
<span style="color: #a63024"><span style="font-size: small">(16:02:59)</span> <b>efajardo:</b></span> <tt>/etc/osg/image-config.d/</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(16:03:06)</span> <b>efajardo:</b></span> What is the pourpose of that ?<br/>
<span style="color: #53b759"><span style="font-size: small">(17:19:23)</span> <b>marian:</b></span> from master tree it looks it has script for stashcache proxy generation, authored by @blin, maybe he can explain better reasoning behind it?<br/>
<span style="color: #a63024"><span style="font-size: small">(18:10:40)</span> <b>efajardo:</b></span> thank @marian I realized it is to esnrue something happesn<br/>
<span style="color: #a63024"><span style="font-size: small">(18:10:55)</span> <b>efajardo:</b></span> before the process start inside a container like the proxyt for the cache<br/>
</body>
</html>
