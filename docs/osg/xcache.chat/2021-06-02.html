<!DOCTYPE html>
<html>
<head>
<title>Wed Jun 2, 2021 : #xcache (osg)</title>
</head>
<body>
<h3>Wed Jun 2, 2021 : #xcache (osg)</h3>
<span style="color: #7d414c"><span style="font-size: small">(09:51:10)</span> <b>bockjoo:</b></span> @bbockelm I am seeing  <tt>TRANSFER [5] DESTINATION MAKE_PARENT HTTP 500 : Unexpected server error: 500  with url <a href="davs://cmsio5.rc.ufl.edu:1094/store/relval/CMSSW_12_0_0_pre2/RelValReggeGribovPartonMC_EposLHC_5TeV_pPb/GEN/113X_mcRun2_asymptotic_v4_gen-v1/00000">davs://cmsio5.rc.ufl.edu:1094/store/relval/CMSSW_12_0_0_pre2/RelValReggeGribovPartonMC_EposLHC_5TeV_pPb/GEN/113X_mcRun2_asymptotic_v4_gen-v1/00000</a></tt><br/>
<span style="color: #7d414c"><span style="font-size: small">(09:51:56)</span> <b>bockjoo:</b></span> This, I think, leaves the director perm at 700 instead of 755. Do you know why?<br/>
<span style="color: #9e3997"><span style="font-size: small">(09:56:20)</span> <b>bbockelm:</b></span> Morning Bockjoo!  Per Derek's above update, it sounds like the umask is not being set correctly in the new multiuser plugin.  @dweitzel - when do you think you'll have time to look at things?<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:57:11)</span> <b>dweitzel:</b></span> I should discuss priorities with you, but I think I could make that update this week.<br/>
<span style="color: #7d414c"><span style="font-size: small">(09:58:37)</span> <b>bockjoo:</b></span> OK, thanks! I didn't know what you meant. Now, I know.<br/>
<span style="color: #235e5b"><span style="font-size: small">(09:59:30)</span> <b>dweitzel:</b></span> Bockjoo, if I send you a scratch RPM build, would you have time to test it this week?<br/>
<span style="color: #7d414c"><span style="font-size: small">(10:06:06)</span> <b>bockjoo:</b></span> Yes, I will be able to find time to test it.<br/>
<span style="color: #dd8527"><span style="font-size: small">(10:52:14)</span> <b>mtadel:</b></span> @bbockelm @jthiltges we are now running SoCal xcache with John's clear_errors PR + other "make-tls-errors-recoverable" hacks. the cacscading errors are gone but we still get quite a lot of auth errors from UNL.<br/>
<span style="color: #dd8527"><span style="font-size: small">(10:53:44)</span> <b>mtadel:</b></span> I got a bit lost in the voms vs openssl vs lcmaps discussion ... is there a way to get it fixed? Andy seems to be saying: a) lcmaps is being kicked out; and b) voms developers should fix their calls but they refuse (some infn people, IIUC)<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:02:08)</span> <b>dweitzel:</b></span> @bockjoo It was easier than I thought, here's a scratch build: <a href="https://kojihub0000.chtc.wisc.edu/kojifiles/work/tasks/9446/339446/xrootd-multiuser-1.1.0-1.osg35up.el7.x86_64.rpm">https://kojihub0000.chtc.wisc.edu/kojifiles/work/tasks/9446/339446/xrootd-multiuser-1.1.0-1.osg35up.el7.x86_64.rpm</a><br/>I think (and @matyas can correct me) that the command to install is:<br/><pre>yum install <a href="https://kojihub0000.chtc.wisc.edu/kojifiles/work/tasks/9446/339446/xrootd-multiuser-1.1.0-1.osg35up.el7.x86_64.rpm">https://kojihub0000.chtc.wisc.edu/kojifiles/work/tasks/9446/339446/xrootd-multiuser-1.1.0-1.osg35up.el7.x86_64.rpm</a></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(13:37:37)</span> <b>matyas:</b></span> I've never tried giving yum a kojifiles URL but it might work<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:46:28)</span> <b>bbockelm:</b></span> @mtadel - haven't caught up with the thread post-vacation but one of my points in the thread is that it's literally impossible for the VOMS folks to make the OpenSSL calls threadsafe.<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:48:27)</span> <b>bbockelm:</b></span> The OpenSSL API that's being invoked can _never_ be called from a threaded application.  So VOMS always will need to be initialized from a single-threaded context (like it is).<br/>
<span style="color: #dd8527"><span style="font-size: small">(13:55:11)</span> <b>mtadel:</b></span> so this looks rather hopeless, no? I mean, xrootd TLS stuff is multi-threaded and even if we slap a lock over voms calls it will still not work because of that, ie. will collide with TLS<br/>
<blockquote>
<span style="color: #e06b56"><span style="font-size: small">(14:27:24)</span> <b>jthiltges:</b></span> I'm on "vacation" this week, but at home and still online here and there. Could you share some of the auth error logs?<br/>
<span style="color: #dd8527"><span style="font-size: small">(15:07:46)</span> <b>mtadel:</b></span> there's not much information:<br/>[2021-06-02 13:04:39.481028 -0700][Error  ][TlsMsg            ] [] TLS error rc=-1 ec=1 (error_ssl) errno=0.<br/>[2021-06-02 13:04:39.482932 -0700][Error  ][TlsMsg            ] Failed to do TLS connect: Unable to connect to <a href="http://red-gridftp5.unl.edu">red-gridftp5.unl.edu</a>; error_ssl<br/>[2021-06-02 13:04:39.484087 -0700][Error  ][AsyncSock         ] [<a href="mailto:u405@red-gridftp5.unl.edu">u405@red-gridftp5.unl.edu</a>:1094.0] Socket error while handshaking: [ERROR] TLS error<br/>[2021-06-02 13:04:39.485328 -0700][Error  ][PostMaster        ] [<a href="mailto:u405@red-gridftp5.unl.edu">u405@red-gridftp5.unl.edu</a>:1094] elapsed = 1, pConnectionWindow = 120 seconds.<br/>
<span style="color: #e06b56"><span style="font-size: small">(15:26:24)</span> <b>jthiltges:</b></span> Assuming this is the matching entry on red-gridftp5, maybe an interesting error:<br/><pre>210602 15:04:39 22660 anon.0:254@xcache-00.t2.ucsd.edu XrootdResponse: sending err 3002: Request argument is too long<br/>210602 15:04:39 22660 XrdLink: Unable to receive from anon.0:254@xcache-00.t2.ucsd.edu; connection reset by peer<br/>210602 15:04:39 22660 XrootdXeq: anon.0:254@xcache-00.t2.ucsd.edu disc 0:00:00 (link read error)</pre><br/>Then right after, some successful looking logs for <tt>u405</tt><br/><pre>210602 15:04:40 21892 u405.28557:122@xcache-00.t2.ucsd.edu XrootdProtocol: more auth requested; sz=2931<br/>INFO in AuthzKey: Returning '/DC=org/DC=incommon/C=US/ST=California/L=La Jolla/O=University of California, San Diego/CN=<a href="http://xrootd-proxy.t2.ucsd.edu::cms:/cms">xrootd-proxy.t2.ucsd.edu::cms:/cms</a>,::' of length 128 as key.<br/>210602 15:04:40 21892 XrootdXeq: u405.28557:122@xcache-00.t2.ucsd.edu pub IP46 TLSv1.2 login as uscmsPool001<br/>210602 15:04:41 21892 acc_Audit: u405.28557:122@xcache-00.t2.ucsd.edu grant gsi <a href="mailto:uscmsPool001@xcache-01.t2.ucsd.edu">uscmsPool001@xcache-01.t2.ucsd.edu</a> read /store/mc/RunIISummer19UL17MiniAODv2/GJets_HT-600ToInf_TuneCP5_13TeV-madgraphMLM-pythia8/MINIAODSIM/106X_mc2017_realistic_v9-v1/40000/3694E9AF-7FE8-F540-BF66-DE3BD6CE3DD0.root</pre><br/>
<span style="color: #9e3997"><span style="font-size: small">(15:30:20)</span> <b>bbockelm:</b></span> <pre>210602 15:04:39 22660 anon.0:254@xcache-00.t2.ucsd.edu XrootdResponse: sending err 3002: Request argument is too long</pre><br/>Oof.  That doesn't look like LCMAPS!<br/>
<span style="color: #dd8527"><span style="font-size: small">(16:21:56)</span> <b>mtadel:</b></span> thank you ... good news, I guess :slightly_smiling_face:<br/>will forward this to Andy<br/>
<span style="color: #e06b56"><span style="font-size: small">(22:13:38)</span> <b>jthiltges:</b></span> No idea if it'll be helpful, but I grabbed a bit of info for one of those errors. It comes from red-gridftp1, which is still running xrootd-5.1.2-0.experimental.2613152.70066fe7.el7.cern.x86_64<br/><br/>Timestamp: 2021-06-02 22:10:10.166688016-05:00<br/><br/><pre>Breakpoint 1, XrdXrootdProtocol::Process (this=0x7f96d4698000, lp=&lt;optimized out&gt;) at /usr/src/debug/xrootd/xrootd/src/XrdXrootd/XrdXrootdProtocol.cc:402<br/>402                   {Response.Send(kXR_ArgTooLong, "Request argument is too long");</pre><br/>Backtrace:<br/><pre>#0  XrdXrootdProtocol::Process (this=0x7f96d4698000, lp=&lt;optimized out&gt;) at /usr/src/debug/xrootd/xrootd/src/XrdXrootd/XrdXrootdProtocol.cc:402<br/>#1  0x00007f9718079b46 in XrdLinkXeq::DoIt (this=0x7f9703c1ff58) at /usr/src/debug/xrootd/xrootd/src/Xrd/XrdLinkXeq.cc:319<br/>#2  0x00007f9718076279 in XrdLink::setProtocol (this=0x7f9703c1ff58, pp=&lt;optimized out&gt;, runit=&lt;optimized out&gt;, push=&lt;optimized out&gt;) at /usr/src/debug/xrootd/xrootd/src/Xrd/XrdLink.cc:435<br/>#3  0x00007f971807ce46 in XrdScheduler::Run (this=0x615b20 &lt;XrdGlobal::Sched&gt;) at /usr/src/debug/xrootd/xrootd/src/Xrd/XrdScheduler.cc:382<br/>#4  0x00007f971807cf99 in XrdStartWorking (carg=&lt;optimized out&gt;) at /usr/src/debug/xrootd/xrootd/src/Xrd/XrdScheduler.cc:88<br/>#5  0x00007f97180228e7 in XrdSysThread_Xeq (myargs=0x7f95fc4ee240) at /usr/src/debug/xrootd/xrootd/src/XrdSys/XrdSysPthread.cc:86<br/>#6  0x00007f9717bbbea5 in start_thread (arg=0x7f96a97fd700) at pthread_create.c:307<br/>#7  0x00007f9716ebc9fd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</pre><br/>Request<br/><pre>$1 = {header = {streamid = "\026\003", requestid = 256, body = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, auth = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207", &lt;incomplete sequence \365&gt;, credtype = "T\264\031\257", dlen = 2117914858}, bind = {streamid = "\026\003", requestid = 256, sessid = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, chkpoint = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", reserved = "z\003\003\303\330\365\207\365T\264\031", opcode = 175 '\257', dlen = 2117914858}, chmod = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264", mode = 44825, dlen = 2117914858}, close = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", reserved = "z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, dirlist = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031", options = "\257", dlen = 2117914858}, endsess = {streamid = "\026\003", requestid = 256, sessid = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, fattr = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", subcode = 122 'z', numattr = 3 '\003', options = 3 '\003', reserved = "\303\330\365\207\365T\264\031\257", dlen = 2117914858, static isNew = 1, static aData = 16}, gpfile = {streamid = "\026\003", requestid = 256, options = 382, reserved = "z\003\003\303\330\365\207", &lt;incomplete sequence \365&gt;, buffsz = -1357269932, dlen = 2117914858}, locate = {streamid = "\026\003", requestid = 256, options = 382, reserved = "\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, login = {streamid = "\026\003", requestid = 256, pid = 382, username = "z\003\003\303\330\365\207", &lt;incomplete sequence \365&gt;, ability2 = 84 'T', ability = 180 '\264', capver = "\031", reserved2 = 175 '\257', dlen = 2117914858}, mkdir = {streamid = "\026\003", requestid = 256, options = "~", reserved = "\001\000\000z\003\003\303\330\365\207\365T\264", mode = 44825, dlen = 2117914858}, mv = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264", arg1len = -20711, dlen = 2117914858}, open = {streamid = "\026\003", requestid = 256, mode = 382, options = 0, reserved = "z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, pgread = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", offset = -754364101227773062, rlen = -1357269932, dlen = 2117914858}, pgwrite = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", offset = -754364101227773062, pathid = 84 'T', reqflags = 180 '\264', reserved = "\031\257", dlen = 2117914858}, ping = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, prepare = {streamid = "\026\003", requestid = 256, options = 126 '~', prty = 1 '\001', port = 0, optionX = 890, reserved = "\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, protocol = {streamid = "\026\003", requestid = 256, clientpv = 382, flags = 122 'z', expect = 3 '\003', reserved = "\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, query = {streamid = "\026\003", requestid = 256, infotype = 382, reserved1 = "\000", fhandle = "z\003", &lt;incomplete sequence \303&gt;, reserved2 = "\330\365\207\365T\264\031\257", dlen = 2117914858}, read = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", offset = -754364101227773062, rlen = -1357269932, dlen = 2117914858}, readv = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031", pathid = 175 '\257', dlen = 2117914858}, rm = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, rmdir = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, set = {streamid = "\026\003", requestid = 256, reserved = "~\001\000\000z\003\003\303\330\365\207\365T\264\031", modifier = 175 '\257', dlen = 2117914858}, sigver = {streamid = "\026\003", requestid = 256, expectrid = 382, version = 0 '\000', flags = 0 '\000', seqno = 17692379972481778554, crypto = 84 'T', rsvd2 = "\264\031\257", dlen = 2117914858}, stat = {streamid = "\026\003", requestid = 256, options = 126 '~', reserved = "\001\000\000z\003\003\303\330\365\207", &lt;incomplete sequence \365&gt;, fhandle = "T\264\031\257", dlen = 2117914858}, sync = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", reserved = "z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858}, truncate = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", offset = -754364101227773062, reserved = "T\264\031\257", dlen = 2117914858}, write = {streamid = "\026\003", requestid = 256, fhandle = "~\001\000", offset = -754364101227773062, pathid = 84 'T', reserved = "\264\031\257", dlen = 2117914858}, writev = {streamid = "\026\003", requestid = 256, options = 126 '~', reserved = "\001\000\000z\003\003\303\330\365\207\365T\264\031\257", dlen = 2117914858, static doSync = 1}}</pre><br/>Nearby log entries:<br/><pre>210602 22:09:58 19360 acc_Audit: uscmsPoo.643883:124@red-c1624 grant https uscmsPool001@[::ffff:129.93.182.148] stat /store/temp/user/bcardwel.cc1b3a590330caabc89940e50a71f703528c5543/lpclonglived/DisplacedLeptons/Sleptons_M_300_100mm_13TeV_2016MC/DigiRawHlt/210602_153531/0000/log<br/>210602 22:09:58 19076 XrootdXeq: uscmsPoo.643883:124@red-c1624 disc 0:00:00 (link SSL read error)<br/>210602 22:10:10 17896 anon.0:42@xrd-cache-2.ultralight.org XrootdResponse: sending err 3002: Request argument is too long<br/>210602 22:10:10 17896 XrdLink: Unable to receive from anon.0:42@xrd-cache-2.ultralight.org; connection reset by peer<br/>210602 22:10:10 17896 XrootdXeq: anon.0:42@xrd-cache-2.ultralight.org disc 0:00:00 (link read error)<br/>210602 22:10:10 24292 XrdLinkXeq: anon.0:44@xrd-cache-2.ultralight.org connection upgraded to TLSv1.2<br/>210602 22:10:10 24292 u227.23372:44@xrd-cache-2.ultralight.org XrootdProtocol: more auth requested; sz=2931<br/>INFO in AuthzKey: Returning '/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jbalcas/CN=751133/CN=Justas Balcas::cms:/cms,/cms/becms,/cms/dcms,/cms/escms,/cms/itcms,/cms/uscms,::' of length 145 as key.<br/>210602 22:10:10 24292 XrootdXeq: u227.23372:44@xrd-cache-2.ultralight.org pub IP46 TLSv1.2 login as uscmsPool001<br/>210602 22:10:10 24292 acc_Audit: u227.23372:44@xrd-cache-2.ultralight.org grant gsi <a href="mailto:uscmsPool001@xrd-cache-2.ultralight.org">uscmsPool001@xrd-cache-2.ultralight.org</a> read /store/mc/RunIISummer19UL17MiniAOD/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/MINIAODSIM/106X_mc2017_realistic_v6-v2/240001/C2162FB4-5771-AA49-A91D-7588D1FE0E3D.root<br/>File we will access: /user/uscms01/pnfs/unl.edu/data4/cms/store/mc/RunIISummer19UL17MiniAOD/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/MINIAODSIM/106X_mc2017_realistic_v6-v2/240001/C2162FB4-5771-AA49-A91D-7588D1FE0E3D.root<br/>INFO in AuthzFun: Lookup with key /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jipeng/CN=833568/CN=Jing Peng::cms:/cms,::<br/>INFO in AuthzFun: Got uid 2204<br/>210602 22:10:14 19076 XrootdBridge: uscmsPoo.643885:42@red-c2207 login as uscmsPool001</pre><br/>
<span style="color: #dd8527"><span style="font-size: small">(2021-06-03 12:45:07)</span> <b>mtadel:</b></span> I see you are also in discussion with Andy on github ... shall we move all discussion there?<br/>
<span style="color: #dd8527"><span style="font-size: small">(2021-06-03 12:47:10)</span> <b>mtadel:</b></span> @abh aka Andy is in principle also on this slack :slightly_smiling_face:<br/>
</blockquote>
<span style="color: #9e3997"><span style="font-size: small">(15:18:23)</span> <b>bbockelm:</b></span> &gt;  so this looks rather hopeless, no? I mean, xrootd TLS stuff is multi-threaded and even if we slap a lock over voms calls it will still not work because of that, ie. will collide with TLS<br/>Ah - but that's the open question.  AFAICT, the VOMS calls for actual verification are all thread safe.<br/>
<span style="color: #9e3997"><span style="font-size: small">(15:18:31)</span> <b>bbockelm:</b></span> Only the initialization is non-thread-safe.<br/>
</body>
</html>
