<!DOCTYPE html>
<html>
<head>
<title>Tue Jun 8, 2021 : #xcache (osg)</title>
</head>
<body>
<h3>Tue Jun 8, 2021 : #xcache (osg)</h3>
<span style="color: #99a949"><span style="font-size: small">(10:03:01)</span> <b>dwd:</b></span> I’m not getting any response from <a href="root://osg-chicago-stashcache.nrp.internet2.edu:1094">root://osg-chicago-stashcache.nrp.internet2.edu:1094</a>, is there someone here to look at it?<br/>
<span style="color: #99a949"><span style="font-size: small">(10:03:37)</span> <b>dwd:</b></span> In particular the command I am trying is <tt>xrdcp -d 2 <a href="root://osg-chicago-stashcache.nrp.internet2.edu:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root">root://osg-chicago-stashcache.nrp.internet2.edu:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</a> /tmp</tt><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:06:45)</span> <b>dweitzel:</b></span> @didavila maintains that.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:25:59)</span> <b>dwd:</b></span> It’s not clear if this is the primary problem with the issue I am investigating, Derek.  Accessing that file /cvmfs/nova.osgstorage.org/analysis/nux/nus20/covmx/mx_modernised.root is failing completely with I/O error, at least at Fermilab.  The osg-chicago-stashcache is just the first problem we run into, I think.  The ticket reporter is saying that other files work, but this one was recently added so he suspects something is wrong with the publishing<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:26:41)</span> <b>dweitzel:</b></span> There is a negative cache on these as well.  Though, that should be max 1 hour.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:27:28)</span> <b>dwd:</b></span> The /var/log/messages are<br/><pre>Jun  8 09:43:58 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) data corruption with no-cache header, try another host<br/>Jun  8 09:43:58 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) switching host from <a href="http://fndca1.fnal.gov:8000">http://fndca1.fnal.gov:8000</a> to <a href="http://osg-chicago-stashcache.nrp.internet2.edu:8000/">http://osg-chicago-stashcache.nrp.internet2.edu:8000/</a> (host returned HTTP error)<br/>Jun  8 09:46:25 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) data corruption with no-cache header, try another host<br/>Jun  8 09:46:25 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) switching host from <a href="http://osg-chicago-stashcache.nrp.internet2.edu:8000/">http://osg-chicago-stashcache.nrp.internet2.edu:8000/</a> to <a href="http://stash-cache.osg.chtc.io:8000/">http://stash-cache.osg.chtc.io:8000/</a> (host returned HTTP error)<br/>Jun  8 09:46:27 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) data corruption with no-cache header, try another host<br/>Jun  8 09:46:27 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) switching host from <a href="http://stash-cache.osg.chtc.io:8000/">http://stash-cache.osg.chtc.io:8000/</a> to <a href="http://mwt2-stashcache.campuscluster.illinois.edu:8000/">http://mwt2-stashcache.campuscluster.illinois.edu:8000/</a> (host returned HTTP error)<br/>Jun  8 09:46:59 dwdosgdev cvmfs2: (<a href="http://nova.osgstorage.org">nova.osgstorage.org</a>) failed to fetch Part of /pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root (hash: d34d6110db2f068228fbe8df443e3b5d67a856f1, error 15 [host serving data too slowly])</pre><br/><br/>
<span style="color: #235e5b"><span style="font-size: small">(10:28:08)</span> <b>dweitzel:</b></span> data corruption...<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:28:10)</span> <b>dweitzel:</b></span> that's odd.<br/>
<span style="color: #99a949"><span style="font-size: small">(10:28:36)</span> <b>dwd:</b></span> In fact my client is configured to first try direct to the dcache origin server<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:29:10)</span> <b>dweitzel:</b></span> I suppose it's possible that the cvmfs hash of the file is incorrect?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:29:16)</span> <b>dweitzel:</b></span> is it possible that the file changed?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:29:27)</span> <b>dweitzel:</b></span> and the cvmfs scanner hasn't picked up the change yet?<br/>
<span style="color: #99a949"><span style="font-size: small">(10:30:28)</span> <b>dwd:</b></span> Do you know how to get the modification time over xrootd?<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:35:05)</span> <b>dweitzel:</b></span> I think something like:<br/>
<span style="color: #235e5b"><span style="font-size: small">(10:35:18)</span> <b>dweitzel:</b></span> <pre>xrdfs &lt;server:port&gt; ls -l &lt;path&gt;</pre><br/>
<span style="color: #99a949"><span style="font-size: small">(10:36:41)</span> <b>dwd:</b></span> <pre>-rw------- xrootd xrootd 152292471 2021-06-05 04:08:00 //pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</pre><br/><br/>
<span style="color: #99a949"><span style="font-size: small">(10:38:33)</span> <b>dwd:</b></span> Interestingly, that’s not the exact size of file I get when I copy it with xrdcp<br/>
<span style="color: #99a949"><span style="font-size: small">(10:43:46)</span> <b>dwd:</b></span> @didavila I am now sometimes getting the file through <a href="http://osg-chicago-stashcache.nrp.internet2.edu:1094">osg-chicago-stashcache.nrp.internet2.edu:1094</a>, and sometimes not.  I believe that address is a redirector, and most likely one of the servers behind it is having problems.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(10:44:13)</span> <b>didavila:</b></span> nop, that is a single server<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(10:44:31)</span> <b>didavila:</b></span> I’m checking the logs right now<br/>
<span style="color: #99a949"><span style="font-size: small">(10:45:31)</span> <b>dwd:</b></span> Hey, this time after a long time it returned to me the file matching that length 152292471<br/>
<span style="color: #99a949"><span style="font-size: small">(10:46:03)</span> <b>dwd:</b></span> The xrdfs command was also on that server, and it may be that it shows the corruption.  When I copy direct from the origin server or other stashcaches, I get a different length<br/>
<span style="color: #99a949"><span style="font-size: small">(10:46:34)</span> <b>dwd:</b></span> <pre>$ xrdfs <a href="root://stash-cache.osg.chtc.io:1094">root://stash-cache.osg.chtc.io:1094</a> ls -l //pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root<br/>-rw------- xrootd xrootd 152330021 2021-05-26 20:49:26 //pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</pre><br/><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(10:49:07)</span> <b>didavila:</b></span> COuld that be that it is showing you the current size of a partially downloaded file?<br/>
<span style="color: #99a949"><span style="font-size: small">(10:49:27)</span> <b>dwd:</b></span> It’s not just truncated, because cmp shows a difference at character 14.  I suspect that the file changed on the source, which is not allowed with stashcache<br/>
<span style="color: #99a949"><span style="font-size: small">(10:50:28)</span> <b>dwd:</b></span> Note that the timestamp on the osg-chicago cache is newer<br/>
<span style="color: #dd8527"><span style="font-size: small">(10:50:33)</span> <b>mtadel:</b></span> yes, that would my guess, too<br/>
<span style="color: #99a949"><span style="font-size: small">(10:54:19)</span> <b>dwd:</b></span> I get authorization failures if I try to use <a href="xroot://fndca1.fnal.gov:1094">xroot://fndca1.fnal.gov:1094</a>, but if I use <a href="http://fndca1.fnal.gov:8000">http://fndca1.fnal.gov:8000</a> I get the file size that’s marked with the older timestamp, which is unexpected.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(10:59:48)</span> <b>didavila:</b></span> what it’s <a href="xroot://fndca1.fnal.gov:1094">xroot://fndca1.fnal.gov:1094</a> ?<br/>
<span style="color: #99a949"><span style="font-size: small">(11:00:13)</span> <b>dwd:</b></span> That’s the origin server, I think<br/>
<span style="color: #99a949"><span style="font-size: small">(11:01:00)</span> <b>dwd:</b></span> It could be via <a href="http://stashcache.fnal.gov">stashcache.fnal.gov</a>, which is actually misnamed, it is a redirector, not a stashcache<br/>
<span style="color: #99a949"><span style="font-size: small">(11:02:13)</span> <b>dwd:</b></span> In fact yes, I can do all the xrd* commands via <a href="root://stashcache.fnal.gov:1094">root://stashcache.fnal.gov:1094</a>, and it also sees<br/><pre>-r-- 2021-05-26 05:46:01   152330021 //pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</pre><br/><br/>
<span style="color: #99a949"><span style="font-size: small">(11:03:16)</span> <b>dwd:</b></span> So I don’t know how <a href="root://stash-cache.osg.chtc.io:1094">root://stash-cache.osg.chtc.io:1094</a> could be seeing a newer timestamp<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:03:17)</span> <b>didavila:</b></span> this is the origin I see for stashcache-chicago: <a href="http://redirector.osgstorage.org:1094">redirector.osgstorage.org:1094</a><br/>
<span style="color: #99a949"><span style="font-size: small">(11:03:44)</span> <b>dwd:</b></span> Yeah, <a href="http://redirector.osgstorage.org">redirector.osgstorage.org</a> directs to <a href="http://stashcache.fnal.gov">stashcache.fnal.gov</a> when the origin path starts with //pnfs/fnal.gov<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:12:04)</span> <b>didavila:</b></span> This is what I see in the stashcache-chicago logs:<br/><pre>210608 15:42:44 4510 XrdPfc_Manager: info Cache::Attach() <a href="root://u1020@redirector.osgstorage.org:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root">root://u1020@redirector.osgstorage.org:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</a><br/>210608 15:42:44 4510 XrdPfc_IO: info IOEntireFile::initCachedStat successfuly read size from info file = 152292471 <a href="root://u1020@redirector.osgstorage.org:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root">root://u1020@redirector.osgstorage.org:1094//pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</a><br/>210608 15:43:19 4574 XrdPfc_File: info 	io_map.size() 1, block_map.size() 0, file /pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root<br/>210608 15:43:19 4574 XrdPfc_File: info ioActive for io 0x141433730 returning False, file /pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root<br/>210608 15:43:27 4836 acc_Audit: dwd.488:1020@dwdosgdev.fnal.gov grant host *@dwdosgdev.fnal.gov read /pnfs/fnal.gov/usr/nova/persistent/analysis/nux/nus20/covmx/mx_modernised.root</pre><br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:12:09)</span> <b>didavila:</b></span> lots of those ^^<br/>
<span style="color: #99a949"><span style="font-size: small">(11:22:38)</span> <b>dwd:</b></span> I was informed that files in that area can be removed and replaced, I will tell them they can’t do that.<br/>
<span style="color: #99a949"><span style="font-size: small">(11:26:39)</span> <b>dwd:</b></span> @dweitzel does it work to use symbolic links to unique file names?  Does the sync/publish process detect those and put them into the metadata so cvmfs will always point to the current file name?<br/>
<span style="color: #235e5b"><span style="font-size: small">(11:28:22)</span> <b>dweitzel:</b></span> That's a good question that I don't know.  The sync process _may_ detect that, but I doubt the caching process will catch that.  For caching, it probably considers a symbolic link as just a normal file, and therefore should be immutable.<br/>
<span style="color: #99a949"><span style="font-size: small">(11:34:22)</span> <b>dwd:</b></span> It depends on if the symbolic link is in the metadata.  If it is, then cvmfs will ask for the different file and the stashcache would never see it.  I guess it depends at least on if the original xroot directory listing showing a symlink and doesn’t immediately follow it.<br/>
<span style="color: #99a949"><span style="font-size: small">(11:40:58)</span> <b>dwd:</b></span> The code in <a href="https://github.com/opensciencegrid/cvmfs-sync/blob/master/bin/cvmfs_sync">https://github.com/opensciencegrid/cvmfs-sync/blob/master/bin/cvmfs_sync</a> does not mention anything about symbolic links, so the answer is probably that it does not get into metadata<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:18:27)</span> <b>dweitzel:</b></span> @dwd that sounds accurate.<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(13:43:22)</span> <b>didavila:</b></span> should I find and remove the file and symlink in the cache?<br/>
<span style="color: #99a949"><span style="font-size: small">(13:52:08)</span> <b>dwd:</b></span> No thanks, they need to be able to cope with the situation and prevent it from happening again.<br/>
</body>
</html>
