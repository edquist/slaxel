<!DOCTYPE html>
<html>
<head>
<title>Tue Mar 3, 2020 : #xcache (osg)</title>
</head>
<body>
<h3>Tue Mar 3, 2020 : #xcache (osg)</h3>
<span style="color: #a63024"><span style="font-size: small">(12:11:51)</span> <b>efajardo:</b></span> Dear <b>@here</b><br/>
<span style="color: #a63024"><span style="font-size: small">(12:11:59)</span> <b>efajardo:</b></span> The authfile generation seems broken<br/>
<span style="color: #a63024"><span style="font-size: small">(12:12:03)</span> <b>efajardo:</b></span> <pre>CACHE_FQDN=<a href="http://osg-chicago-stashcache.nrp.internet2.edu">osg-chicago-stashcache.nrp.internet2.edu</a> sudo -u xrootd /usr/libexec/xcache/authfile-update --cache<br/>Error fetching <a href="https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw">https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw</a><br/>File contents:<br/># No resource registered for stashcache-chicago-78c7d497d6-np6rw<br/># Please check your query or contact <a href="mailto:help@opensciencegrid.org">help@opensciencegrid.org</a><br/>Error fetching <a href="https://topology.opensciencegrid.org/stashcache/authfile-public?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw">https://topology.opensciencegrid.org/stashcache/authfile-public?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw</a><br/>File contents:<br/># No resource registered for stashcache-chicago-78c7d497d6-np6rw<br/># Please check your query or contact <a href="mailto:help@opensciencegrid.org">help@opensciencegrid.org</a></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(12:14:03)</span> <b>blin:</b></span> what if you run this?<br/><tt>sudo -u xrootd CACHE_FQDN=<a href="http://osg-chicago-stashcache.nrp.internet2.edu">osg-chicago-stashcache.nrp.internet2.edu</a> /usr/libexec/xcache/authfile-update --cache</tt><br/>
<span style="color: #a63024"><span style="font-size: small">(12:14:03)</span> <b>efajardo:</b></span> <pre>sudo -u xrootd echo $CACHE_FQDN<br/><a href="http://osg-chicago-stashcache.nrp.internet2.edu">osg-chicago-stashcache.nrp.internet2.edu</a></pre><br/>
<span style="color: #a63024"><span style="font-size: small">(12:14:40)</span> <b>efajardo:</b></span> that one works<br/>
<span style="color: #a63024"><span style="font-size: small">(12:15:22)</span> <b>efajardo:</b></span> Interesting it seems to be ocming and going<br/>
<span style="color: #a63024"><span style="font-size: small">(12:15:29)</span> <b>efajardo:</b></span> I will try to nail it down<br/>
<span style="color: #43761b"><span style="font-size: small">(12:16:06)</span> <b>blin:</b></span> eh, i don't think so. i think it has to do with where you're setting the <tt>CACHE_FQDN</tt> var<br/>
<span style="color: #43761b"><span style="font-size: small">(12:16:25)</span> <b>blin:</b></span> this means that the env var isn't being set properly:<br/>&gt; Error fetching <a href="https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw">https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=stashcache-chicago-78c7d497d6-np6rw</a><br/>
<span style="color: #a63024"><span style="font-size: small">(12:16:51)</span> <b>efajardo:</b></span> well the env var is there<br/>
<span style="color: #a63024"><span style="font-size: small">(12:16:58)</span> <b>efajardo:</b></span> I mean I have not changed anything on this deploytment<br/>
<span style="color: #a63024"><span style="font-size: small">(12:18:14)</span> <b>efajardo:</b></span> Maybe it was a transient error cause I annot reproduce it now after cleaning for a new pod<br/>
<span style="color: #43761b"><span style="font-size: small">(12:18:33)</span> <b>blin:</b></span> if the env var is being set properly, the URL it would be querying would be <a href="https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=osg-chicago-stashcache.nrp.internet2.edu">https://topology.opensciencegrid.org/stashcache/authfile?cache_fqdn=osg-chicago-stashcache.nrp.internet2.edu</a><br/>
<span style="color: #a63024"><span style="font-size: small">(13:54:55)</span> <b>efajardo:</b></span> <b>@here</b> I found another problem that It is boggling my mind. When I Just launch a pod<br/>
<span style="color: #a63024"><span style="font-size: small">(13:55:00)</span> <b>efajardo:</b></span> if I try the authenticated cache<br/>
<span style="color: #a63024"><span style="font-size: small">(13:55:06)</span> <b>efajardo:</b></span> I get a Permition refused<br/>
<span style="color: #a63024"><span style="font-size: small">(13:55:09)</span> <b>efajardo:</b></span> <pre>200303 19:54:24 535 ?:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> XrdPoll: FD 211 attached to poller 0; num=1<br/>INFO in AuthzFun: Lookup with key /DC=org/DC=incommon/C=US/ST=CA/L=La Jolla/O=University of California, San Diego/OU=UCSD/CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a>::osg:/osg/ligo,::<br/>INFO in AuthzFun: Using cached entity with username ba2ba880.0<br/>200303 19:54:24 535 XrootdBridge: ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> login as ba2ba880.0<br/>200303 19:54:24 535 ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> ofs_stat:  fn=/user/ligo/frames/O3/hoft/H1/H-H1_HOFT_C00-12402/H-H1_HOFT_C00-1240227840-4096.gwf<br/>200303 19:54:24 535 ofs_stat: ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> Unable to locate /user/ligo/frames/O3/hoft/H1/H-H1_HOFT_C00-12402/H-H1_HOFT_C00-1240227840-4096.gwf; permission denied<br/>200303 19:54:24 535 ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> XrootdResponse: sending err 3010: Unable to locate /user/ligo/frames/O3/hoft/H1/H-H1_HOFT_C00-12402/H-H1_HOFT_C00-1240227840-4096.gwf; permission denied<br/>200303 19:54:24 535 XrootdXeq: ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> disc 0:00:00 (send failure)<br/>200303 19:54:24 535 ba2ba880.7:<a href="mailto:211@osg-ligo-1.t2.ucsd.edu">211@osg-ligo-1.t2.ucsd.edu</a> XrdPoll: FD 211 detached from poller 0; num=0<br/>^C</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(13:55:40)</span> <b>efajardo:</b></span> If I go ahead and kill the xrootd process of the authenticatined stashcache and let supervisor<br/>
<span style="color: #a63024"><span style="font-size: small">(13:55:46)</span> <b>efajardo:</b></span> revive it<br/>
<span style="color: #a63024"><span style="font-size: small">(13:56:00)</span> <b>efajardo:</b></span> then it suddenly works<br/>
<span style="color: #43761b"><span style="font-size: small">(13:56:12)</span> <b>blin:</b></span> hrm, this is the problem you were seeing when we first updated to 4.11.2, right?<br/>
<span style="color: #a63024"><span style="font-size: small">(13:56:23)</span> <b>efajardo:</b></span> yea<br/>
<span style="color: #43761b"><span style="font-size: small">(13:56:33)</span> <b>blin:</b></span> yeah that's bizarre<br/>
<span style="color: #43761b"><span style="font-size: small">(13:56:38)</span> <b>blin:</b></span> we should ping the xrootd devs on it<br/>
<span style="color: #a63024"><span style="font-size: small">(13:56:55)</span> <b>efajardo:</b></span> ok I will bring it up on thursda<br/>
</body>
</html>
