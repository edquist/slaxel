<!DOCTYPE html>
<html>
<head>
<title>Wed Aug 28, 2019 : #xcache (osg)</title>
</head>
<body>
<h3>Wed Aug 28, 2019 : #xcache (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(08:00:44)</span> <b>bbockelm:</b></span> @isfiligoi - CVMFS works solely via partial downloads, so this is "expected to work".  If you can make aria2 spit out the precise HTTPS request that failed, I'd be quite interested in reporting it as a bug.<br/>
<span style="color: #c386df"><span style="font-size: small">(08:35:01)</span> <b>matyas:</b></span> what's a good way of testing an authenticated stashcache?<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(09:36:53)</span> <b>blin:</b></span> you're going to need to xrdcp with a proxy<br/>
<span style="color: #43761b"><span style="font-size: small">(09:37:35)</span> <b>blin:</b></span> since we use <tt>--no-authz</tt> for xrootd-lcmaps config, i don't think the DN needs to be added to any map files<br/>
<span style="color: #43761b"><span style="font-size: small">(09:39:05)</span> <b>blin:</b></span> however something probably needs to be added to the xrootd authfile...not sure exactly what, though<br/>
</blockquote>
<span style="color: #c386df"><span style="font-size: small">(08:36:06)</span> <b>matyas:</b></span> finally managed to get INFN's xcache 'working' (well, the daemons start up), but I don't know how to test it to see if it's serving files<br/>
<span style="color: #53b759"><span style="font-size: small">(09:24:24)</span> <b>isfiligoi:</b></span> @bbockelm The stashcache is responding with 405<br/><pre><br/>[root@ps-100g shm]# aria2c <a href="http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt">http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt</a><br/><br/>08/28 14:22:21 [NOTICE] Downloading 1 item(s)<br/><br/>08/28 14:22:21 [ERROR] CUID#7 - Download aborted. URI=<a href="http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt">http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt</a><br/>Exception: [<a href="http://AbstractCommand.cc:351">AbstractCommand.cc:351</a>] errorCode=22 URI=<a href="http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt">http://stashcache.t2.ucsd.edu:9001/user/dweitzel/public/bigfile.txt</a><br/>  -&gt; [<a href="http://HttpSkipResponseCommand.cc:240">HttpSkipResponseCommand.cc:240</a>] errorCode=22 The response status is not successful. status=405<br/><br/>08/28 14:22:21 [NOTICE] Download GID#cc5f59c88520675b not complete: <br/></pre><br/>no idea what aria is trying<br/>
<span style="color: #53b759"><span style="font-size: small">(09:25:48)</span> <b>isfiligoi:</b></span> BTW: Using aria from epel<br/>
<span style="color: #53b759"><span style="font-size: small">(09:59:21)</span> <b>isfiligoi:</b></span> Found it;<br/>aria2 whats the file digest<br/><pre><br/>"GET /user/dweitzel/public/bigfile.txt HTTP/1.1\r\nUser-Agent: aria2/1.34.0\r\nAccept: */*,application/metalink4+xml,application/metalink+xml\r\nHost: 169.228.130.97:9001\r\nWant-Digest: SHA-512;q=1, SHA-256;q=1, SHA;q=0.1\r\n<br/>\r\n<br/></pre><br/>
<span style="color: #53b759"><span style="font-size: small">(10:27:15)</span> <b>isfiligoi:</b></span> andâ€¦ found a workaround :slightly_smiling_face:<br/><pre><br/>aria2c --header='Want-Digest: ' <a href="http://169.228.130.97:9001/user/dweitzel/public/bigfile.txt">http://169.228.130.97:9001/user/dweitzel/public/bigfile.txt</a><br/></pre><br/>By default the checksum is not needed, but it still requests it :disappointed:<br/>
<span style="color: #c386df"><span style="font-size: small">(17:46:18)</span> <b>matyas:</b></span> I'm having trouble with some of the caches. We recently opened up the firewall on our origin (<a href="http://sc-origin.chtc.wisc.edu">sc-origin.chtc.wisc.edu</a>), and I wanted to test if other caches could now see our files. So I'm going through each cache and testing it using curl using http to port 8000:<br/><pre><br/>file=/chtc/PUBLIC/matyas/testfiles/2019-08-28-1<br/><br/>while read cache; do<br/>        [[ $cache =~ ^[a-z].* ]] || continue  # skip comments and blank lines<br/>        echo $cache:<br/>        curl http://$cache:8000$file || echo "failed w/ $?"<br/>        echo<br/>done &lt; caches.txt<br/></pre><br/>
<span style="color: #c386df"><span style="font-size: small">(17:47:49)</span> <b>matyas:</b></span> my caches.txt is <pre><br/><a href="http://its-condor-xrootd1.syr.edu">its-condor-xrootd1.syr.edu</a><br/><a href="http://osg-new-york-stashcache.nrp.internet2.edu">osg-new-york-stashcache.nrp.internet2.edu</a><br/><a href="http://osg-kansas-city-stashcache.nrp.internet2.edu">osg-kansas-city-stashcache.nrp.internet2.edu</a><br/><a href="http://osg-chicago-stashcache.nrp.internet2.edu">osg-chicago-stashcache.nrp.internet2.edu</a><br/><a href="http://fiona.uvalight.net">fiona.uvalight.net</a><br/><a href="http://stashcache.t2.ucsd.edu">stashcache.t2.ucsd.edu</a><br/><a href="http://osg-gftp.pace.gatech.edu">osg-gftp.pace.gatech.edu</a><br/></pre><br/>the <a href="http://internet2.edu">internet2.edu</a> and the <a href="http://ucsd.edu">ucsd.edu</a> caches all return blank files (without any error); the other caches return the file I'm expecting<br/>
<span style="color: #c386df"><span style="font-size: small">(17:50:47)</span> <b>matyas:</b></span> the firewall rules look fine but I don't see them in the xrootd.log<br/>
<span style="color: #c386df"><span style="font-size: small">(17:50:49)</span> <b>matyas:</b></span> any ideas?<br/>
<span style="color: #c386df"><span style="font-size: small">(17:55:44)</span> <b>matyas:</b></span> the caches appear to work if I use xrdcp on port 1094<br/>
<span style="color: #43761b"><span style="font-size: small">(18:04:40)</span> <b>blin:</b></span> maybe it's firewall rules on the other end blocking http? or simpler, they're blocking port 8000?<br/>
<span style="color: #c386df"><span style="font-size: small">(18:09:49)</span> <b>matyas:</b></span> I guess? It's surprising that it's just returning a 0-length file instead of failing<br/>
<span style="color: #c386df"><span style="font-size: small">(18:10:31)</span> <b>matyas:</b></span> wait<br/>
<span style="color: #c386df"><span style="font-size: small">(18:10:38)</span> <b>matyas:</b></span> I figured it out<br/>
<span style="color: #c386df"><span style="font-size: small">(18:10:46)</span> <b>matyas:</b></span> curl doesn't follow 302 redirects by default<br/>
<span style="color: #c386df"><span style="font-size: small">(18:11:21)</span> <b>matyas:</b></span> you have to pass <tt>-L</tt><br/>
<span style="color: #c386df"><span style="font-size: small">(18:11:54)</span> <b>matyas:</b></span> mystery solved<br/>
</body>
</html>
