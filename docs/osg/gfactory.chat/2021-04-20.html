<!DOCTYPE html>
<html>
<head>
<title>Tue Apr 20, 2021 : #gfactory (osg)</title>
</head>
<body>
<h3>Tue Apr 20, 2021 : #gfactory (osg)</h3>
<span style="color: #674b1b"><span style="font-size: small">(10:05:15)</span> <b>rynge:</b></span> No, that is for factory-&gt;ce<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:05:39)</span> <b>rynge:</b></span> In my case it doesn't matter, as I do not accept GSI on the CE side<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:20:18)</span> <b>rynge:</b></span> @bbockelm What did you do to enable IDTOKEN for the glideins? Setting <tt>SEC_DEFAULT_AUTHENTICATION_METHODS</tt> ?<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:20:49)</span> <b>rynge:</b></span> I can see the glidein starting up, having both a GSI and IDTOKEN<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:21:00)</span> <b>rynge:</b></span> But still uses GSI<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:21:12)</span> <b>rynge:</b></span> Maybe there is still something wrong with the token<br/>
<span style="color: #43761b"><span style="font-size: small">(10:25:59)</span> <b>blin:</b></span> can you <tt>condor_config_val -dump SEC</tt>?<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:29:00)</span> <b>rynge:</b></span> <pre>SEC_C_GAHP_WORKER_THREAD_DEFAULT_SESSION_DURATION = 1800<br/>SEC_CLAIMTOBE_INCLUDE_DOMAIN = false<br/>SEC_CLAIMTOBE_USER = <br/>SEC_CREDENTIAL_DIRECTORY = /var/lib/condor/execute/dir_107229/glide_qGWDvt/creds<br/>SEC_CREDENTIAL_DIRECTORY_OAUTH = /var/lib/condor/execute/dir_107229/glide_qGWDvt/creds<br/>SEC_CREDENTIAL_REFRESH_INTERVAL = -1<br/>SEC_CREDENTIAL_SWEEP_DELAY = 3600<br/>SEC_CREDENTIAL_SWEEP_INTERVAL = 300<br/>SEC_DAEMON_ENCRYPTION = REQUIRED<br/>SEC_DEBUG_PRINT_KEYS = false<br/>SEC_DEFAULT_AUTHENTICATION = REQUIRED<br/>SEC_DEFAULT_AUTHENTICATION_METHODS = TOKEN,GSI<br/>SEC_DEFAULT_AUTHENTICATION_TIMEOUT = 20<br/>SEC_DEFAULT_ENCRYPTION = OPTIONAL<br/>SEC_DEFAULT_INTEGRITY = REQUIRED<br/>SEC_DEFAULT_SESSION_DURATION = 86077<br/>SEC_ENABLE_IMPERSONATION_TOKENS = false<br/>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = true<br/>SEC_IMPERSONATION_TOKEN_LIMITS = <br/>SEC_INVALIDATE_SESSIONS_VIA_TCP = true<br/>SEC_ISSUED_TOKEN_EXPIRATION = <br/>SEC_PASSWORD_DIRECTORY = $(LOCAL_DIR)<br/>SEC_PASSWORD_DOMAIN = <br/>SEC_PASSWORD_FILE = $(SEC_PASSWORD_DIRECTORY)/POOL<br/>SEC_SCITOKENS_ALLOW_EXTRA_SLASH = false<br/>SEC_SESSION_DURATION_SLOP = 20<br/>SEC_TCP_SESSION_TIMEOUT = 20<br/>SEC_TOKEN_BLACKLIST_EXPR = <br/>SEC_TOKEN_DIRECTORY = $(SEC_TOKEN_SYSTEM_DIRECTORY)<br/>SEC_TOKEN_ISSUER_KEY = POOL<br/>SEC_TOKEN_MAX_AGE = <br/>SEC_TOKEN_POOL_SIGNING_KEY_FILE = $(SEC_PASSWORD_FILE)<br/>SEC_TOKEN_REQUEST_LIMITS = <br/>SEC_TOKEN_SYSTEM_DIRECTORY = $(LOCAL_DIR)/ticket<br/>SEC_USE_FAMILY_SESSION = true</pre><br/><br/>
<span style="color: #674b1b"><span style="font-size: small">(10:29:26)</span> <b>rynge:</b></span> Still trying to get it configured before it starts<br/>
<span style="color: #43761b"><span style="font-size: small">(10:32:22)</span> <b>blin:</b></span> is <tt>TOKEN</tt> equivalent to <tt>IDTOKEN</tt>? also, i wonder if there are daemon specific auth methods that are specified. you could check with a <tt>condor_config_val -dump | grep AUTHENTICATION_METHODS</tt><br/>
<span style="color: #674b1b"><span style="font-size: small">(10:33:43)</span> <b>rynge:</b></span> Yeah, it was renamed<br/>
<span style="color: #674b1b"><span style="font-size: small">(10:34:15)</span> <b>rynge:</b></span> Trying some hacks...<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:11:44)</span> <b>rynge:</b></span> <pre># condor_status -pool <a href="http://flock.opensciencegrid.org">flock.opensciencegrid.org</a> -const 'FactoryType =!= "OSG-ITB"' -af AuthenticatedIdentity AuthenticationMethod | sort | uniq -c<br/>  27344 condor@family FAMILY<br/>    320 <a href="mailto:CUResearchComputing@flock.opensciencegrid.org">CUResearchComputing@flock.opensciencegrid.org</a> IDTOKENS<br/>   2950 <a href="mailto:EricGough@flock.opensciencegrid.org">EricGough@flock.opensciencegrid.org</a> IDTOKENS<br/>    839 <a href="mailto:jetstream@flock.opensciencegrid.org">jetstream@flock.opensciencegrid.org</a> IDTOKENS<br/>     47 <a href="mailto:ndsu-backfill@flock.opensciencegrid.org">ndsu-backfill@flock.opensciencegrid.org</a> IDTOKENS<br/>      1 <a href="mailto:tiger_pilots@flock.opensciencegrid.org">tiger_pilots@flock.opensciencegrid.org</a> IDTOKENS<br/>     10 <a href="mailto:UChicago@flock.opensciencegrid.org">UChicago@flock.opensciencegrid.org</a> GSI</pre><br/><br/>
<span style="color: #674b1b"><span style="font-size: small">(11:12:10)</span> <b>rynge:</b></span> So how is that <tt>FAMILY</tt> method happening? Is it GSI/IDTOKEN which then switches to FAMILY?<br/>
<blockquote>
<span style="color: #43761b"><span style="font-size: small">(2021-04-21 09:09:49)</span> <b>blin:</b></span> @zmiller any idea why we're seeing FAMILY as an <tt>AuthMethod</tt> for startds in the OS pool? I thought FAMILY was just for parent/child processes on the same host<br/>
<span style="color: #674b1b"><span style="font-size: small">(2021-04-22 10:36:34)</span> <b>rynge:</b></span> Just following up, BrianB pointed out that it was because I have sub-collectors and I only queried the main collector. The sub-&gt;main communication was family<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-04-22 10:37:04)</span> <b>blin:</b></span> ahhh ok<br/>
<span style="color: #674b1b"><span style="font-size: small">(2021-04-22 10:37:16)</span> <b>rynge:</b></span> Querying the sub collectors give the right results<br/>
<span style="color: #674b1b"><span style="font-size: small">(2021-04-22 10:37:25)</span> <b>rynge:</b></span> <pre># for I in $(seq 9700 9999); do condor_status -pool "<a href="http://flock.opensciencegrid.org:$I">flock.opensciencegrid.org:$I</a>" -const 'FactoryType =!= "OSG-ITB"' -af AuthenticatedIdentity AuthenticationMethod ; done | sort | uniq -c<br/>    985 <a href="mailto:pilot@flock.opensciencegrid.org">pilot@flock.opensciencegrid.org</a> GSI<br/>  29849 <a href="mailto:vofrontend_service@flock.opensciencegrid.org">vofrontend_service@flock.opensciencegrid.org</a> IDTOKENS</pre><br/><br/>
<span style="color: #674b1b"><span style="font-size: small">(2021-04-22 10:37:42)</span> <b>rynge:</b></span> Only a few stragglers GSI ones left!<br/>
<span style="color: #43761b"><span style="font-size: small">(2021-04-22 10:37:48)</span> <b>blin:</b></span> wow, awesome!<br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(11:13:08)</span> <b>blin:</b></span> i think family is used between daemons that have a parent/child PID relationship<br/>
<span style="color: #43761b"><span style="font-size: small">(11:13:48)</span> <b>blin:</b></span> but i'm not sure how that makes sense with pilot startds...<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:16:23)</span> <b>rynge:</b></span> Well I *think* it is working<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:16:28)</span> <b>rynge:</b></span> IDTOKEN that is<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:16:38)</span> <b>rynge:</b></span> Once side effect is the site collector:<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:16:42)</span> <b>rynge:</b></span> <pre>04/20/21 09:15:50 (pid:68802) SECMAN: required authentication with collector <a href="http://osg.isi.edu:9619">osg.isi.edu:9619</a> failed, so aborting command UPDATE_STARTD_AD.<br/>04/20/21 09:15:50 (pid:68802) ERROR: AUTHENTICATE:1003:Failed to authenticate with any method</pre><br/><br/>
<span style="color: #43761b"><span style="font-size: small">(11:19:13)</span> <b>blin:</b></span> we do have this in the CE:<br/><pre>COLLECTOR.SEC_ADVERTISE_STARTD_AUTHENTICATION_METHODS = FS,TOKEN,SCITOKENS,GSI,SSL</pre><br/>but i guess that makes sense for the pool-issued token to not work with the CE collector. @bbockelm we'll have to think about how we can maybe pass along a credential that the startd can use here<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:21:10)</span> <b>rynge:</b></span> This is also a little bit odd:<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:21:13)</span> <b>rynge:</b></span> <pre>SEC_TOKEN_SYSTEM_DIRECTORY=$(LOCAL_DIR)/ticket<br/>GSI_DAEMON_PROXY=/var/lib/condor/execute/dir_54827/glide_7vD7TJ/ticket/myproxy</pre><br/><br/>
<span style="color: #674b1b"><span style="font-size: small">(11:21:41)</span> <b>rynge:</b></span> Mixing GSI and IDTOKEN dir<br/>
<span style="color: #43761b"><span style="font-size: small">(11:22:30)</span> <b>blin:</b></span> what's LOCAL_DIR?<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:22:51)</span> <b>rynge:</b></span> <tt>/var/lib/condor/execute/dir_54827/glide_7vD7TJ</tt><br/>
<span style="color: #674b1b"><span style="font-size: small">(11:22:55)</span> <b>rynge:</b></span> So it goes in the same dir<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:23:26)</span> <b>rynge:</b></span> <pre># ls -l ticket/<br/>total 20<br/>-r-------- 1 osg osg 12313 Apr 20 09:22 myproxy<br/>-rw------- 1 osg osg   460 Apr 20 09:22 OSG_US_ISI_osg.idtoken</pre><br/><br/>
<span style="color: #674b1b"><span style="font-size: small">(11:27:04)</span> <b>rynge:</b></span> @jpeterson @jdost321 Can we get a 9.0.0 tarball on itb?<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:31:31)</span> <b>rynge:</b></span> Actually, I would like CONDOR_VERSION 9.0.x on both itb and production<br/>
<span style="color: #3c8c69"><span style="font-size: small">(11:38:40)</span> <b>jpeterson:</b></span> That is not a part of the factory that I deal with.<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:46:57)</span> <b>rynge:</b></span> Sorry my bad<br/>
<span style="color: #385a86"><span style="font-size: small">(12:02:23)</span> <b>jdost321:</b></span> @rynge how urgent is it to get 9.0.0 tarball?<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:06:35)</span> <b>rynge:</b></span> The next couple of days would be good - there is some deadline for May 1st, but also we need to finish testing 3.7.3<br/>
<span style="color: #385a86"><span style="font-size: small">(12:07:54)</span> <b>jdost321:</b></span> ok, i was intending to today at least, just wanted to make sure you didn't need right now<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:09:06)</span> <b>rynge:</b></span> No we are good<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:43:12)</span> <b>bbockelm:</b></span> @jdost321 - one thing that ToddT pointed out is the new utility for monitoring GPU utilization is not included in the tarball generation.  Is it easy to add a new binary in?<br/>
<span style="color: #385a86"><span style="font-size: small">(12:50:36)</span> <b>jdost321:</b></span> yeah i think it's just adding a line in create_condor_tarball gwms script<br/>
<span style="color: #385a86"><span style="font-size: small">(12:50:55)</span> <b>jdost321:</b></span> we might need to also add relevent *.so file deps if they aren't already added<br/>
<span style="color: #9e3997"><span style="font-size: small">(13:16:34)</span> <b>bbockelm:</b></span> Ok, it's called <tt>condor_gpu_utilization</tt>  and should be in the <tt>libexec</tt> folder.<br/>
<span style="color: #73769d"><span style="font-size: small">(13:23:19)</span> <b>tim.theisen:</b></span> We talked about the glidein tarball creation in our HTCondor meeting. We are always adding new features and gmws seems to miss out on them. Wouldn't it be better to trim what you don't want out of the tarball?<br/>
<span style="color: #73769d"><span style="font-size: small">(13:24:50)</span> <b>tim.theisen:</b></span> Also, what is the goal of trimming down the tarball? It is about 15 MB. How much smaller is the trimmed tarball? And doesn't this pale in comparison to the size of a typical job?<br/>
<span style="color: #674b1b"><span style="font-size: small">(13:25:34)</span> <b>rynge:</b></span> It would also be sitting in squid caches on most sites<br/>
</body>
</html>
