<!DOCTYPE html>
<html>
<head>
<title>Wed Jun 7, 2017 : #gfactory (osg)</title>
</head>
<body>
<h3>Wed Jun 7, 2017 : #gfactory (osg)</h3>
<span style="color: #9e3997"><span style="font-size: small">(00:10:04)</span> <b>bbockelm:</b></span> Hi Eric - what are the X509-related attributes from one of the suspiciously-mapped pilots?  Should be able to do something like <tt>condor_ce_q -l $JOB_ID | grep -i x509</tt><br/>
<span style="color: #d58247"><span style="font-size: small">(02:00:15)</span> <b>essedore:</b></span> @essedore uploaded a file: <a href="https://opensciencegrid.slack.com/files/essedore/F5PR9QA7L/-.txt">Untitled</a><br/>
<span style="color: #d58247"><span style="font-size: small">(02:01:06)</span> <b>essedore:</b></span> @essedore uploaded a file: <a href="https://opensciencegrid.slack.com/files/essedore/F5QKKKHLN/-.txt">Untitled</a><br/>
<span style="color: #d58247"><span style="font-size: small">(02:02:23)</span> <b>essedore:</b></span> @bbockelm thanks for taking a look<br/>
<span style="color: #9e3997"><span style="font-size: small">(02:09:41)</span> <b>bbockelm:</b></span> indeed, that appears incorrect.  I think this is maybe a configuration problem on the factory -- likely submitting from the same <tt>condor_gridmanager</tt> for diferent frontends?<br/>
<span style="color: #9e3997"><span style="font-size: small">(02:10:11)</span> <b>bbockelm:</b></span> Could be a change on the frontend side (Edgar? Mats?) or a factory-specific misconfiguration.<br/>
<span style="color: #9e3997"><span style="font-size: small">(02:11:01)</span> <b>bbockelm:</b></span> @marian should be able to look at that factory, I think (and perhaps is the only other person in the right timezone?)<br/>
<span style="color: #53b759"><span style="font-size: small">(02:20:38)</span> <b>marian:</b></span> @essedore: what do you expect it to be, Eric? On the factory side we map per FE DN ... could be that something has changed on the FE? ... I'll look what DNs we are mapping for ligo user vs osgvo ...<br/>
<span style="color: #53b759"><span style="font-size: small">(02:35:53)</span> <b>marian:</b></span> for OSGVO we map <tt>CN=glideinwms/osg-flock.grid.iu.edu</tt> to <tt>feosglock</tt> on the factory side ... for LIGO we map <tt>CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a></tt> to <tt>feligo</tt> ... I'm surprised that your glidein requests use <tt>CN=pilot/osg-flock.grid.iu.edu</tt> which I don't see anywhere ... @rynge, has anything changed for the DN of OSGVO Frontend? (see glideinwms vs pilot in the CN) ... however, @essedore: for your job gateway <tt><a href="http://its-condor-ce.syr.edu">its-condor-ce.syr.edu</a></tt> I see we enable these frontends to request pilots: <tt>glowVO,OSGVO,SBGrid,HCC,GLUEX,Fermilab,DUNE,LI<br/>GO,CMS</tt>... it is incorrect? what it should be changed to?<br/>
<span style="color: #9e3997"><span style="font-size: small">(02:57:33)</span> <b>bbockelm:</b></span> I think that's the right list of VOs - it's just unclear why the OSG VO is using the security session for LIGO.<br/>
<span style="color: #9e3997"><span style="font-size: small">(02:58:00)</span> <b>bbockelm:</b></span> From the factory side, what account are those pilots being submitted under?<br/>
<span style="color: #53b759"><span style="font-size: small">(02:58:58)</span> <b>marian:</b></span> that's weird thing, I don't see <tt>CN=pilot/osg-flock.grid.iu.edu</tt> mapped to any user<br/>
<span style="color: #53b759"><span style="font-size: small">(02:59:07)</span> <b>marian:</b></span> on the factory<br/>
<span style="color: #9e3997"><span style="font-size: small">(03:00:56)</span> <b>bbockelm:</b></span> but the DN used to authenticate the frontend can be distinct from the proxy used for the pilot.  Who owns the pilot job at on the factory side?<br/>
<span style="color: #53b759"><span style="font-size: small">(03:19:23)</span> <b>marian:</b></span> feosgflock<br/>
<span style="color: #53b759"><span style="font-size: small">(03:19:51)</span> <b>marian:</b></span> it's mapped here ... but I see in past days all go held due:<br/>
<span style="color: #53b759"><span style="font-size: small">(03:19:52)</span> <b>marian:</b></span> 12 (5672820.025.000) 06/07 01:17:51 Job was held.<br/>        CE job in status 1 put on hold by SYSTEM_PERIODIC_HOLD due to expired user proxy.<br/>        Code 26 Subcode 0<br/>
<span style="color: #674b1b"><span style="font-size: small">(09:50:56)</span> <b>rynge:</b></span> Good morning! Yes, OSG VO has separate certs for factory auth and pilot submits. CN=glideinwms/osg-flock.grid.iu.edu is for the factory, CN=pilot/osg-flock.grid.iu.edu is for the pilot submits<br/>
<span style="color: #674b1b"><span style="font-size: small">(09:51:20)</span> <b>rynge:</b></span> IIRC, there was another security session issue in the factory recently<br/>
<span style="color: #674b1b"><span style="font-size: small">(09:51:29)</span> <b>rynge:</b></span> And this sounds very similar<br/>
<span style="color: #674b1b"><span style="font-size: small">(09:53:39)</span> <b>rynge:</b></span> Another potential culprit: CN=<a href="http://osg-ligo-1.t2.ucsd.edu">osg-ligo-1.t2.ucsd.edu</a> is registered in the OSG VOMS - I think we did this for testing the FE merging<br/>
<span style="color: #674b1b"><span style="font-size: small">(09:54:03)</span> <b>rynge:</b></span> However, that seems backwards (should show up as LIGO jobs running under the OSG VO)<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:36:56)</span> <b>bbockelm:</b></span> <a href="https://ggus.eu/?mode=ticket_info&amp;ticket_id=127989">https://ggus.eu/?mode=ticket_info&amp;ticket_id=127989</a> can someone handle this ticket?  Imperial is moving everything over tonight.<br/>
<span style="color: #d58247"><span style="font-size: small">(11:05:14)</span> <b>essedore:</b></span> Sorry to come back to the thread late, the VO list above looks fine - for the most part this is an account error, but the error is causing questions on the accuracy of our accounting data<br/>
<span style="color: #d58247"><span style="font-size: small">(11:05:27)</span> <b>essedore:</b></span> (assuming it is an error)<br/>
<span style="color: #385a86"><span style="font-size: small">(11:47:48)</span> <b>jdost321:</b></span> @essedore @bbockelm @marian @rynge is there a ticket or email thread for this? we really only intend the factory ops slack for live discussion between factory operators, not as an official support line. It's easy for factory ops to completely miss these types of issues if it isn't in an osg ticket or at least in an email with <a href="mailto:osg-gfactory-support@physics.ucsd.edu">osg-gfactory-support@physics.ucsd.edu</a> cc'd<br/>
<span style="color: #385a86"><span style="font-size: small">(11:48:12)</span> <b>jdost321:</b></span> that said i'm looking now<br/>
<span style="color: #385a86"><span style="font-size: small">(11:48:34)</span> <b>jdost321:</b></span> currently there's zero ligo jobs on the syracuse queue, but i'll look in the history to see if at some point they were sharing a gridmanager<br/>
<span style="color: #53b759"><span style="font-size: small">(11:59:54)</span> <b>marian:</b></span> I'm out since couple of hours already, had to pick up sick kiddo from school... just fyi<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:03)</span> <b>jdost321:</b></span> unfortunately our condor history files rotated before i could find anytihing on ligo's last run at syracuse<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:15)</span> <b>jdost321:</b></span> but in general they map to 2 diff linux uid's / condor users on the factory<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:22)</span> <b>jdost321:</b></span> feosgflock with these credentials:<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:30)</span> <b>jdost321:</b></span> subject   : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-flock.grid.iu.edu/CN=3859707352<br/>issuer    : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-flock.grid.iu.edu<br/>identity  : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-flock.grid.iu.edu<br/>type      : RFC compliant proxy<br/>strength  : 1024 bits<br/>path      : /var/lib/gwms-factory/client-proxies/user_feosgflock/glidein_gfactory_instance/credential_osg-flock-grid-iu-edu_OSG_gWMSFrontend.main_357570<br/>timeleft  : 167:28:57<br/>key usage : Digital Signature, Key Encipherment, Data Encipherment<br/>=== VO osg extension information ===<br/>VO        : osg<br/>subject   : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-flock.grid.iu.edu<br/>issuer    : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=<a href="http://voms1.opensciencegrid.org">voms1.opensciencegrid.org</a><br/>attribute : /osg/Role=NULL/Capability=NULL<br/>attribute : /osg/ams/Role=NULL/Capability=NULL<br/>attribute : /osg/ligo/Role=NULL/Capability=NULL<br/>timeleft  : 23:28:56<br/>uri       : <a href="http://voms1.opensciencegrid.org:15027">voms1.opensciencegrid.org:15027</a><br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:40)</span> <b>jdost321:</b></span> and feligo with these<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:48)</span> <b>jdost321:</b></span> ...<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:49)</span> <b>jdost321:</b></span> ...<br/>
<span style="color: #385a86"><span style="font-size: small">(12:11:50)</span> <b>jdost321:</b></span> subject   : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu/CN=1556528538<br/>issuer    : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu<br/>identity  : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu<br/>type      : RFC compliant proxy<br/>strength  : 1024 bits<br/>path      : /var/lib/gwms-factory/client-proxies/user_feligo/glidein_gfactory_instance/credential_osg-ligo-1-t2-ucsd-edu_OSG_gWMSFrontend.main_57265<br/>timeleft  : 22:19:31<br/>key usage : Digital Signature, Key Encipherment, Data Encipherment<br/>=== VO osg extension information ===<br/>VO        : osg<br/>subject   : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/osg-ligo-1.t2.ucsd.edu<br/>issuer    : /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=<a href="http://voms1.opensciencegrid.org">voms1.opensciencegrid.org</a><br/>attribute : /osg/ligo/Role=NULL/Capability=NULL<br/>attribute : /osg/Role=NULL/Capability=NULL<br/>attribute : /osg/uclhc/Role=NULL/Capability=NULL<br/>timeleft  : 22:19:31<br/>uri       : <a href="http://voms1.opensciencegrid.org:15027">voms1.opensciencegrid.org:15027</a><br/>
<span style="color: #385a86"><span style="font-size: small">(12:12:18)</span> <b>jdost321:</b></span> separate gridmanagers start on the factory under users feligo and feosgflock respectively<br/>
<span style="color: #385a86"><span style="font-size: small">(12:12:28)</span> <b>jdost321:</b></span> and credentials are owned by the respective users<br/>
<span style="color: #385a86"><span style="font-size: small">(12:12:48)</span> <b>jdost321:</b></span> so i don't see how its possible the credentials can be crossed, unless there is a serious security bug in condor<br/>
<span style="color: #385a86"><span style="font-size: small">(12:13:36)</span> <b>jdost321:</b></span> note both creds are indeed in the osg vo, only special thing to distinguish ligo is the voms attr; attribute : /osg/ligo/Role=NULL/Capability=NULL<br/>
<span style="color: #385a86"><span style="font-size: small">(12:13:49)</span> <b>jdost321:</b></span> is Syracuse mappings looking at this and doing the right thing on the CE side?<br/>
<span style="color: #674b1b"><span style="font-size: small">(13:16:00)</span> <b>rynge:</b></span> Thanks for looking! Can we suggest to Eric where to look for those mappings?<br/>
<span style="color: #385a86"><span style="font-size: small">(13:25:34)</span> <b>jdost321:</b></span> @rynge @essedore i'm not a site admin, but i'm guessing gums or gridmap on the CE?<br/>
<span style="color: #d58247"><span style="font-size: small">(14:40:48)</span> <b>essedore:</b></span> @jdost321 I will take a look<br/>
<span style="color: #d58247"><span style="font-size: small">(14:46:20)</span> <b>essedore:</b></span> note exactly sure what we are looking for, so I pasted where I see ligo referenced<br/>
<span style="color: #d58247"><span style="font-size: small">(14:46:28)</span> <b>essedore:</b></span> @essedore uploaded a file: <a href="https://opensciencegrid.slack.com/files/essedore/F5R3J1SMC/-.txt">Untitled</a><br/>
<span style="color: #385a86"><span style="font-size: small">(14:47:28)</span> <b>jdost321:</b></span> looks like you're mapping everyone to ligo<br/>
<span style="color: #d58247"><span style="font-size: small">(14:47:53)</span> <b>essedore:</b></span> I noticed I got a new version of this file today, where does it get generated?<br/>
<span style="color: #d58247"><span style="font-size: small">(14:48:15)</span> <b>essedore:</b></span> @essedore uploaded a file: <a href="https://opensciencegrid.slack.com/files/essedore/F5PN0NYJV/-.txt">Untitled</a><br/>
<span style="color: #385a86"><span style="font-size: small">(14:48:19)</span> <b>jdost321:</b></span> we might need to ping someone from osg software, @blin @bbockelm any ideas?<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:49:50)</span> <b>bbockelm:</b></span> @jdost321 - I suspect there's a gahp process shared over two proxies from the same frontend<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:50:16)</span> <b>bbockelm:</b></span> I think it's a factory issue triggered by a frontend change<br/>
<span style="color: #385a86"><span style="font-size: small">(14:50:57)</span> <b>jdost321:</b></span> but do you see Eric's gridmap??<br/>
<span style="color: #385a86"><span style="font-size: small">(14:51:05)</span> <b>jdost321:</b></span> osgflock is mapping to ligo and every other pilot dn is too<br/>
<span style="color: #385a86"><span style="font-size: small">(14:51:15)</span> <b>jdost321:</b></span> its not a factory issue as far as i can tell<br/>
<span style="color: #9e3997"><span style="font-size: small">(14:56:54)</span> <b>bbockelm:</b></span> Oh weird - how'd that get generated?<br/>
<span style="color: #385a86"><span style="font-size: small">(14:57:22)</span> <b>jdost321:</b></span> thats' my question to you.. how are gridmap files usually generated?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:58:45)</span> <b>blin:</b></span> generally by edg-mkgridmap but there's nothing preventing users from writing their own<br/>
<span style="color: #a63024"><span style="font-size: small">(15:11:56)</span> <b>efajardo:</b></span> I was looking at <a href="http://its-condor-ce.syr.edu">its-condor-ce.syr.edu</a><br/>
<span style="color: #a63024"><span style="font-size: small">(15:12:25)</span> <b>efajardo:</b></span> the <tt>edg-mkgridmap.conf </tt> seems well configured<br/>
<span style="color: #a63024"><span style="font-size: small">(15:12:33)</span> <b>efajardo:</b></span> <pre> cat /etc/edg-mkgridmap.conf | grep ligo<br/># USER-VO-MAP ligo LIGO -- 12 -- Patrick Brady (<a href="mailto:patrick@gravity.phys.uwm.edu">patrick@gravity.phys.uwm.edu</a>)    <br/>group <a href="vomss://voms.opensciencegrid.org:8443/voms/osg?/osg/ligo">vomss://voms.opensciencegrid.org:8443/voms/osg?/osg/ligo</a> ligo</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(15:12:47)</span> <b>efajardo:</b></span> and so does the osg part<br/>
<span style="color: #a63024"><span style="font-size: small">(15:12:50)</span> <b>efajardo:</b></span> <pre># USER-VO-MAP osg OSG -- 23 -- Rob Quick (<a href="mailto:rquick@iupui.edu">rquick@iupui.edu</a>)    <br/>group <a href="vomss://voms.opensciencegrid.org:8443/voms/osg">vomss://voms.opensciencegrid.org:8443/voms/osg</a> osg<br/>group <a href="vomss://voms.grid.iu.edu:8443/voms/osg">vomss://voms.grid.iu.edu:8443/voms/osg</a> osg</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(15:13:54)</span> <b>efajardo:</b></span> Ahh ohh shit I know why this happened.<br/>
<span style="color: #a63024"><span style="font-size: small">(15:16:14)</span> <b>efajardo:</b></span> @essedore in this file <tt>/etc/edg-mkgridmap.conf </tt> can you change the order of this two: <pre># USER-VO-MAP osg OSG -- 23 -- Rob Quick (<a href="mailto:rquick@iupui.edu">rquick@iupui.edu</a>)    <br/>group <a href="vomss://voms.opensciencegrid.org:8443/voms/osg">vomss://voms.opensciencegrid.org:8443/voms/osg</a> osg<br/>group <a href="vomss://voms.grid.iu.edu:8443/voms/osg">vomss://voms.grid.iu.edu:8443/voms/osg</a> osg</pre> and <pre># USER-VO-MAP ligo LIGO -- 12 -- Patrick Brady (<a href="mailto:patrick@gravity.phys.uwm.edu">patrick@gravity.phys.uwm.edu</a>)    <br/>group <a href="vomss://voms.opensciencegrid.org:8443/voms/osg?/osg/ligo">vomss://voms.opensciencegrid.org:8443/voms/osg?/osg/ligo</a> ligo</pre><br/>
<span style="color: #a63024"><span style="font-size: small">(15:16:22)</span> <b>efajardo:</b></span> so LIGO comes after OSG?<br/>
<span style="color: #a63024"><span style="font-size: small">(15:16:33)</span> <b>efajardo:</b></span> so OSG is 23 and LIGO is 12?<br/>
<span style="color: #d58247"><span style="font-size: small">(15:21:27)</span> <b>essedore:</b></span> sure, just a moment<br/>
<span style="color: #d58247"><span style="font-size: small">(15:23:01)</span> <b>essedore:</b></span> do I need to kick anything for the change to take place?<br/>
<span style="color: #d58247"><span style="font-size: small">(15:25:23)</span> <b>essedore:</b></span> I fixed its-condor-ce1 as well<br/>
<span style="color: #d58247"><span style="font-size: small">(15:25:47)</span> <b>essedore:</b></span> @efajardo let me know if I need to bounce anything<br/>
<span style="color: #a63024"><span style="font-size: small">(15:26:29)</span> <b>efajardo:</b></span> @essedore you can run <tt> edg-mkgridmap</tt> and see if the <tt>/etc/grid-security/grid-mapfile</tt> changes<br/>
<span style="color: #d58247"><span style="font-size: small">(15:32:12)</span> <b>essedore:</b></span> All set, they are updated<br/>
<span style="color: #d58247"><span style="font-size: small">(15:34:38)</span> <b>essedore:</b></span> It looks like it is "fixed"<br/>
<span style="color: #d58247"><span style="font-size: small">(15:39:30)</span> <b>essedore:</b></span> at least in the gridmap file<br/>
<span style="color: #d58247"><span style="font-size: small">(15:40:04)</span> <b>essedore:</b></span> @efajardo will this take immediate effect on incoming jobs?<br/>
<span style="color: #d58247"><span style="font-size: small">(15:40:22)</span> <b>essedore:</b></span> @jdost321 Just a few more questions then I will quietly back away...<br/>
<span style="color: #a63024"><span style="font-size: small">(15:46:28)</span> <b>efajardo:</b></span> @essedore yes this will take effect on new incoming jobs<br/>
<span style="color: #a63024"><span style="font-size: small">(15:46:45)</span> <b>efajardo:</b></span> but the old ones that are alureadu having the uid mapped to ligo would still be ligo<br/>
<span style="color: #d58247"><span style="font-size: small">(15:49:35)</span> <b>essedore:</b></span> Got it, thanks<br/>
</body>
</html>
