<!DOCTYPE html>
<html>
<head>
<title>Tue Oct 30, 2018 : #gfactory (osg)</title>
</head>
<body>
<h3>Tue Oct 30, 2018 : #gfactory (osg)</h3>
<span style="color: #43761b"><span style="font-size: small">(10:07:26)</span> <b>blin:</b></span> @marco.mascheroni @marian related to my above query, do you guys have logs for  OSG_US_NMSU_DISCOVERY?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:08:07)</span> <b>blin:</b></span> i'm trying to find where he came to the conclusion that they need a shared home dir<br/>
<span style="color: #43761b"><span style="font-size: small">(10:08:21)</span> <b>blin:</b></span> since the condor blahp shouldn't need it for file transfer according to @dweitzel<br/>
<span style="color: #53b759"><span style="font-size: small">(10:58:13)</span> <b>marian:</b></span> maybe I don't fully understand @blin ... what's problem with OSG_US_NMSU_DISCOVERY? looks like pilots are happily running as well as jobs ... the entry point in the factory sets <tt>work_dir="OSG"</tt> ... also, nothing obvious in the glidein logs for that entry ... is there any ticket with more details what we're investigating here?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:59:51)</span> <b>blin:</b></span> huh, ok<br/>
<span style="color: #43761b"><span style="font-size: small">(10:59:53)</span> <b>blin:</b></span> here's the ticket: <a href="https://support.opensciencegrid.org/a/tickets/7654">https://support.opensciencegrid.org/a/tickets/7654</a><br/>
<span style="color: #43761b"><span style="font-size: small">(11:00:59)</span> <b>blin:</b></span> ah, i think we're actually concerned about <tt>OSG_US_NMSU_AGGIE</tt> but that looks ok, too<br/>
<span style="color: #43761b"><span style="font-size: small">(11:01:00)</span> <b>blin:</b></span> <a href="http://gfactory-1.t2.ucsd.edu/factory/monitor/factoryStatus.html?entry=OSG_US_NMSU_AGGIE_GRID&amp;frontend=total&amp;infoGroup=running&amp;elements=StatusRunningCores,ClientCoresTotal,ClientCoresRunning,ClientCoresIdle,&amp;rra=0&amp;window_min=0&amp;window_max=0&amp;timezone=-5">http://gfactory-1.t2.ucsd.edu/factory/monitor/factoryStatus.html?entry=OSG_US_NMSU_AGGIE_GRID&amp;frontend=total&amp;infoGroup=running&amp;elements=StatusRunningCores,ClientCoresTotal,ClientCoresRunning,ClientCoresIdle,&amp;rra=0&amp;window_min=0&amp;window_max=0&amp;timezone=-5</a><br/>
<span style="color: #53b759"><span style="font-size: small">(11:04:17)</span> <b>marian:</b></span> you mean <tt>OSG_US_NMSU_AGGIE_GRID</tt> I guess ...<br/>
<span style="color: #53b759"><span style="font-size: small">(11:04:27)</span> <b>marian:</b></span> yes, there are some validation errors, actually:<br/>
<span style="color: #53b759"><span style="font-size: small">(11:04:43)</span> <b>marian:</b></span> <pre><br/>  &lt;detail&gt;<br/>     Validation failed in client/crl-check.<br/><br/>     The test script did not produce an XML file. No further information available.<br/>  &lt;/detail&gt;<br/></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:05:49)</span> <b>blin:</b></span> ugh, ok<br/>
<span style="color: #43761b"><span style="font-size: small">(11:06:10)</span> <b>blin:</b></span> could you give me the contents of the factory entry? i want to make sure we've got the right CE<br/>
<span style="color: #53b759"><span style="font-size: small">(11:06:29)</span> <b>marian:</b></span> specifically on these nodes validation fails:<br/>
<span style="color: #53b759"><span style="font-size: small">(11:06:34)</span> <b>marian:</b></span> <pre><br/><a href="http://grid-dev1.nmsu.edu">grid-dev1.nmsu.edu</a><br/><a href="http://grid-dev2.nmsu.edu">grid-dev2.nmsu.edu</a><br/><a href="http://grid-dev3.nmsu.edu">grid-dev3.nmsu.edu</a><br/><a href="http://grid-dev4.nmsu.edu">grid-dev4.nmsu.edu</a><br/><a href="http://grid-dev5.nmsu.edu">grid-dev5.nmsu.edu</a><br/></pre><br/>
<span style="color: #53b759"><span style="font-size: small">(11:07:38)</span> <b>marian:</b></span> content of the entry:<br/><pre><br/>      &lt;entry name="OSG_US_NMSU_AGGIE_GRID" auth_method="grid_proxy" comment="An HTCondor-CE-Bosco hosted at UChicago --Marco" enabled="True" gatekeeper="<a href="http://hosted-ce21.grid.uchicago.edu">hosted-ce21.grid.uchicago.edu</a> <a href="http://hosted-ce21.grid.uchicago.edu:9619">hosted-ce21.grid.uchicago.edu:9619</a>" gridtype="condor" proxy_url="OSG" trust_domain="grid" verbosity="std" work_dir="OSG"&gt;<br/>         &lt;config&gt;<br/>            &lt;max_jobs&gt;<br/>               &lt;default_per_frontend glideins="200" held="25" idle="10"/&gt;<br/>               &lt;per_entry glideins="10" held="5" idle="5"/&gt;<br/>               &lt;per_frontends&gt;<br/>               &lt;/per_frontends&gt;<br/>            &lt;/max_jobs&gt;<br/>            &lt;release max_per_cycle="20" sleep="0.2"/&gt;<br/>            &lt;remove max_per_cycle="5" sleep="0.2"/&gt;<br/>            &lt;restrictions require_glidein_glexec_use="False" require_voms_proxy="False"/&gt;<br/>            &lt;submit cluster_size="5" max_per_cycle="20" sleep="0.2" slots_layout="fixed"&gt;<br/>               &lt;submit_attrs&gt;<br/>               &lt;/submit_attrs&gt;<br/>            &lt;/submit&gt;<br/>         &lt;/config&gt;<br/>         &lt;allow_frontends&gt;<br/>         &lt;/allow_frontends&gt;<br/>         &lt;attrs&gt;<br/>            &lt;attr name="GLEXEC_BIN" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="string" value="NONE"/&gt;<br/>            &lt;attr name="GLIDEIN_Country" const="True" glidein_publish="True" job_publish="True" parameter="True" publish="True" type="string" value="US"/&gt;<br/>            &lt;attr name="GLIDEIN_CPUS" const="True" glidein_publish="False" job_publish="True" parameter="True" publish="True" type="string" value="1"/&gt;<br/>            &lt;attr name="GLIDEIN_Max_Walltime" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="int" value="84600"/&gt;<br/>            &lt;attr name="GLIDEIN_REQUIRED_OS" const="True" glidein_publish="True" job_publish="False" parameter="True" publish="True" type="string" value="any"/&gt;<br/>            &lt;attr name="GLIDEIN_ResourceName" const="True" glidein_publish="True" job_publish="True" parameter="True" publish="True" type="string" value="OSG_US_NMSU_AGGIE_GRID"/&gt;<br/>            &lt;attr name="GLIDEIN_Site" const="True" glidein_publish="True" job_publish="True" parameter="True" publish="True" type="string" value="OSG_US_NMSU_AGGIE_GRID"/&gt;<br/>            &lt;attr name="GLIDEIN_Supported_VOs" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="string" value="OSGVO"/&gt;<br/>         &lt;/attrs&gt;<br/>         &lt;files&gt;<br/>         &lt;/files&gt;<br/>         &lt;infosys_refs&gt;<br/>         &lt;/infosys_refs&gt;<br/>         &lt;monitorgroups&gt;<br/>         &lt;/monitorgroups&gt;<br/>      &lt;/entry&gt;<br/></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:09:50)</span> <b>blin:</b></span> thanks<br/>
<span style="color: #53b759"><span style="font-size: small">(11:10:49)</span> <b>marian:</b></span> you're welcome!<br/>
<span style="color: #53b759"><span style="font-size: small">(11:11:40)</span> <b>marian:</b></span> (let me know if I need to chime in in something, will substitute Jeff in best effort as he is out these days)<br/>
<span style="color: #43761b"><span style="font-size: small">(11:12:43)</span> <b>blin:</b></span> will do, thanks for the help<br/>
<span style="color: #43761b"><span style="font-size: small">(11:47:31)</span> <b>blin:</b></span> @rynge we have pilots failing at NMSU with <tt>Validation failed in client/crl-check.</tt> which appears to come from osg-flock<br/>
<span style="color: #43761b"><span style="font-size: small">(11:48:52)</span> <b>blin:</b></span> do the OSG pilots expect certs/crls to be in the home dir?<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:49:44)</span> <b>rynge:</b></span> No, they look in the standard locatation<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:50:16)</span> <b>rynge:</b></span> That check should be pretty well exercised at this point. Do you think it is wrong?<br/>
<span style="color: #43761b"><span style="font-size: small">(11:50:51)</span> <b>blin:</b></span> no, not that it's wrong. i'm just trying to figure out why it's failing at NMSU so i was just trying to understand what the crl check was looking for precisely<br/>
<span style="color: #43761b"><span style="font-size: small">(11:51:11)</span> <b>blin:</b></span> esp since suchandra told us that a shared home dir was required on all clusters for the hosted CE (even condor clusters)<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:52:20)</span> <b>rynge:</b></span> The reason we have it is that gwms does not check, but depends on the gsi<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:52:45)</span> <b>rynge:</b></span> And when we kept changing CAs in OSG, that kept breaking sites as they did not have updated ca packages<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:53:00)</span> <b>rynge:</b></span> crl-check checks for  a few basic CAs<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:53:34)</span> <b>rynge:</b></span> <pre><br/>Checking CA certificate /home/osg/osg-wn-client/etc/grid-security/certificates/70d35895.0<br/>ERROR: Missing required CA certificate: /home/osg/osg-wn-client/etc/grid-security/certificates/70d35895.0<br/></pre><br/>
<span style="color: #674b1b"><span style="font-size: small">(11:53:54)</span> <b>rynge:</b></span> Could be that they have an old wn client<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:54:03)</span> <b>rynge:</b></span> Or one without CA certs<br/>
<span style="color: #43761b"><span style="font-size: small">(11:54:37)</span> <b>blin:</b></span> is that an error you find for NMSU?<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:57:10)</span> <b>rynge:</b></span> Yeah, for OSG_US_NMSU_AGGIE_GRID<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:57:15)</span> <b>rynge:</b></span> the DISCOVERY one seems to work fine<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:58:37)</span> <b>rynge:</b></span> gwms is complaining about it as well, but not as loudly<br/>
<span style="color: #674b1b"><span style="font-size: small">(11:58:42)</span> <b>rynge:</b></span> <pre><br/>WARNING - Could not find CA certificates!<br/>Looked in:<br/>	$X509_CERT_DIR (/home/osg/osg-wn-client/etc/grid-security/certificates)<br/>	$HOME/.globus/certificates/ (/home/osg/.globus/certificates/)<br/>	/etc/grid-security/certificates/	$GLOBUS_LOCATION/share/certificates/ (/usr/share/certificates/)<br/>	$X509_CADIR ()<br/>grid-proxy-init command not found in path!<br/>voms-proxy-init command not found in path!<br/>Not all x509 commands found in path (2 missing)!<br/></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:59:04)</span> <b>blin:</b></span> just curious, where are you looking for these errors?<br/>
<span style="color: #43761b"><span style="font-size: small">(11:59:07)</span> <b>blin:</b></span> it would be nice to know how to fish :slightly_smiling_face:<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:00:14)</span> <b>rynge:</b></span> <a href="http://flock.opensciencegrid.org/overview/glideins.php">http://flock.opensciencegrid.org/overview/glideins.php</a><br/>
<span style="color: #43761b"><span style="font-size: small">(12:00:44)</span> <b>blin:</b></span> cool!<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:01:26)</span> <b>rynge:</b></span> It is an internal view of how some of the recent glideins perform for OSG VO. There are caveats. It is only from one factory. Glideins which die before/during submit are not included. ...<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:02:04)</span> <b>rynge:</b></span> But if you look at the ones with 0 success / 100 failures - those usually indicate a broken site<br/>
<span style="color: #43761b"><span style="font-size: small">(12:02:29)</span> <b>blin:</b></span> yeah, this is great<br/>
<span style="color: #43761b"><span style="font-size: small">(12:02:45)</span> <b>blin:</b></span> my troubleshooting workflow generally dead ends if pilots are launching but failing to validate<br/>
<span style="color: #43761b"><span style="font-size: small">(12:02:48)</span> <b>blin:</b></span> this helps a lot<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:02:54)</span> <b>rynge:</b></span> I go through that list every now and then and report sites to factory support<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:13:39)</span> <b>marco.mascheroni:</b></span> For the OSG_US_NMSU_AGGIE_GRID error, I debugged it with Suchandra some time ago. The conclusion was that the /home/osg/osg-wn-client/etc/grid-security/certificates/70d35895.0 direcotry that is on the submission node had to be shared with the worker nodes<br/>
<span style="color: #43761b"><span style="font-size: small">(12:16:20)</span> <b>blin:</b></span> @marco.mascheroni from what @rynge is saying above, i don't think sharing that dir is strictly necessary since the pilot will use the standard location in <tt>/etc/grid-security/certificates</tt><br/>
<span style="color: #e23f99"><span style="font-size: small">(12:18:02)</span> <b>marco.mascheroni:</b></span> ok I see<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:18:37)</span> <b>rynge:</b></span> I don't know how the campus ce stuff is configured, but in general /etc/grid-security/certificates , _or_ one of the alternate locations/env vars are required on the workes<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:26:39)</span> <b>marco.mascheroni:</b></span> do you know which variable should I change to have the validation script look at /home/osg/osg-wn-client/setup.s<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:26:42)</span> <b>marco.mascheroni:</b></span> sorry<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:27:13)</span> <b>marco.mascheroni:</b></span> at <tt>/etc/grid-security/certificates</tt> instead of  /home/osg/osg-wn-client/etc/grid-security/certificates/70d35895.0<br/>
<span style="color: #43761b"><span style="font-size: small">(12:27:52)</span> <b>blin:</b></span> i believe it's automatic according to @rynge<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:28:34)</span> <b>rynge:</b></span> Well the site can set the X509 env vars for non standard locations<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:29:34)</span> <b>rynge:</b></span> The site has:<br/>
<span style="color: #674b1b"><span style="font-size: small">(12:29:38)</span> <b>rynge:</b></span> <pre><br/>$X509_CERT_DIR (/home/osg/osg-wn-client/etc/grid-security/certificates)<br/></pre><br/>
<span style="color: #674b1b"><span style="font-size: small">(12:30:15)</span> <b>rynge:</b></span> If the site has /etc/grid-security/certificates , that env var needs to be cleared<br/>
<span style="color: #43761b"><span style="font-size: small">(12:31:09)</span> <b>blin:</b></span> ah i see<br/>
<span style="color: #e23f99"><span style="font-size: small">(12:33:28)</span> <b>marco.mascheroni:</b></span> I can have a look where this is set after dinner, I have access to the submit node for aggie grid. I guess can ask for access to NMSU as well<br/>
<span style="color: #43761b"><span style="font-size: small">(12:35:52)</span> <b>blin:</b></span> @marco.mascheroni i think this may be getting set on the CE end. check the value of <tt>grid_dir</tt> in <tt>/etc/osg/config.d/10-storage.ini</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(12:39:01)</span> <b>blin:</b></span> but it also wouldn't hurt to check on the submit node<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:25:42)</span> <b>marco.mascheroni:</b></span> grid_dir = /etc/osg/wn-client/<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:26:02)</span> <b>marco.mascheroni:</b></span> but I see these on the .bashrc of the submit node<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:26:03)</span> <b>marco.mascheroni:</b></span> # Source this file if using sh or a shell derived from it<br/>export OSG_LOCATION="/home/osg/osg-wn-client"<br/>export GFAL_CONFIG_DIR="$OSG_LOCATION/etc/gfal2.d/"<br/>export GFAL_PLUGIN_DIR="$OSG_LOCATION/usr/lib64/gfal2-plugins/"<br/>export GLOBUS_LOCATION="$OSG_LOCATION/usr"<br/>export PATH="$OSG_LOCATION/usr/bin:$OSG_LOCATION/usr/sbin:$PATH"<br/>export X509_CERT_DIR="$OSG_LOCATION/etc/grid-security/certificates"<br/>export X509_VOMS_DIR="$OSG_LOCATION/etc/grid-security/vomsdir"<br/>export VOMS_USERCONF="$OSG_LOCATION/etc/vomses"<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:29:05)</span> <b>marco.mascheroni:</b></span> Looks to me the idea was to have all the setups in /home/osg/osg-wn-client and then have the worker nodes ose everything from there using a shared file system<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:29:07)</span> <b>marco.mascheroni:</b></span> I'll try to set OSG_LOCATION to "" and see what happens<br/>
<span style="color: #43761b"><span style="font-size: small">(14:30:25)</span> <b>blin:</b></span> did you see my update in the freshdesk ticket?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:33:32)</span> <b>blin:</b></span> we'll have to see how they want to deploy the wn client<br/>
<span style="color: #43761b"><span style="font-size: small">(14:33:38)</span> <b>blin:</b></span> i'm not sure if they have it installed yet<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:35:34)</span> <b>marco.mascheroni:</b></span> oh ok. I missed it. Anyway,  if they install the wn client we should be good. I mean, thinking about it they would need to install it anyway if they don't want to use a shered file system<br/>
<span style="color: #e23f99"><span style="font-size: small">(14:37:30)</span> <b>marco.mascheroni:</b></span> your reply makes sense to me<br/>
</body>
</html>
