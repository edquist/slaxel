<!DOCTYPE html>
<html>
<head>
<title>Thu Sep 10, 2020 : #gfactory (osg)</title>
</head>
<body>
<h3>Thu Sep 10, 2020 : #gfactory (osg)</h3>
<span style="color: #e06b56"><span style="font-size: small">(12:15:54)</span> <b>jthiltges:</b></span> On CE <a href="http://rhino-gw1.unl.edu">rhino-gw1.unl.edu</a>, we're seeing permission errors in the SchedLog<br/><pre>09/10/20 11:35:39 PERMISSION DENIED to <a href="mailto:pilot-okd-gpfe01.fnal.gov@daemon.opensciencegrid.org">pilot-okd-gpfe01.fnal.gov@daemon.opensciencegrid.org</a> from host 169.228.38.36 for command 1112 (QMGMT_WRITE_CMD), access level WRITE: reason: WRITE authorization policy contains no matching ALLOW entry for this request; identifiers used for this host: 169.228.38.36, hostname size = 0, original ip address = 169.228.38.36</pre><br/>I assume the issue is the lack of reverse DNS.<br/><pre>$ host 169.228.38.36<br/>Host 36.38.228.169.in-addr.arpa. not found: 3(NXDOMAIN)</pre><br/>The name mentions FNAL, but it's in UCSD IP space. I'm not sure where this should be reported. Pointers to the right direction would be appreciated!<br/>
<span style="color: #43761b"><span style="font-size: small">(12:24:02)</span> <b>blin:</b></span> yeah, GSI needs reverse DNS<br/>
<span style="color: #43761b"><span style="font-size: small">(12:25:48)</span> <b>blin:</b></span> the fnal mapping is likely just because it's coming in with an FNAL-related proxy<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:32:02)</span> <b>jthiltges:</b></span> The IP seems to line up with <a href="http://gfactory-1.t2.ucsd.edu">gfactory-1.t2.ucsd.edu</a> from days gone by. But the forward DNS entry is gone as well.<br/>
<span style="color: #43761b"><span style="font-size: small">(12:33:36)</span> <b>blin:</b></span> yeah, that's the old factory<br/>
<span style="color: #43761b"><span style="font-size: small">(12:34:27)</span> <b>blin:</b></span> gfactory-2 is the new one<br/>
<span style="color: #43761b"><span style="font-size: small">(12:34:57)</span> <b>blin:</b></span> that's curious, i thought gfactory-1 was taken down so that's a little weird<br/>
<span style="color: #43761b"><span style="font-size: small">(12:35:00)</span> <b>blin:</b></span> @jdost321 would know for sure<br/>
<span style="color: #385a86"><span style="font-size: small">(12:47:54)</span> <b>jdost321:</b></span> <pre>169.228.38.36</pre><br/>iwas gfactory-1 its now <a href="http://gfactory-itb-1.opensciencegrid.org">gfactory-itb-1.opensciencegrid.org</a><br/>
<span style="color: #385a86"><span style="font-size: small">(12:48:05)</span> <b>jdost321:</b></span> we never needed ptr for factories so we never created one<br/>
<span style="color: #43761b"><span style="font-size: small">(12:49:06)</span> <b>blin:</b></span> yeah, i don't think the PTR is necessary here<br/>
<span style="color: #43761b"><span style="font-size: small">(12:49:18)</span> <b>blin:</b></span> it's clients that require a PTR from the server<br/>
<span style="color: #43761b"><span style="font-size: small">(12:50:06)</span> <b>blin:</b></span> @jthiltges i think you may need to set <tt>SCHEDD_DEBUG = D_SECURITY:2</tt> to get more info on the proxy that they're submitting with<br/>
<span style="color: #43761b"><span style="font-size: small">(12:50:25)</span> <b>blin:</b></span> and potentially update your voms-mapfile or grid-mapfile<br/>
<span style="color: #e06b56"><span style="font-size: small">(12:50:35)</span> <b>jthiltges:</b></span> I'll check it out. Thanks!<br/>
<span style="color: #385a86"><span style="font-size: small">(12:51:12)</span> <b>jdost321:</b></span> looks like its fife pilots that are going held on rhino, were they ever authorized?<br/>
<span style="color: #385a86"><span style="font-size: small">(12:51:14)</span> <b>jdost321:</b></span> <pre>subject   : /DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-okd-gpfe01.fnal.gov/CN=2243160808">pilot-okd-gpfe01.fnal.gov/CN=2243160808</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-okd-gpfe01.fnal.gov">pilot-okd-gpfe01.fnal.gov</a><br/>identity  : /DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-okd-gpfe01.fnal.gov">pilot-okd-gpfe01.fnal.gov</a><br/>type      : RFC compliant proxy<br/>strength  : 1024 bits<br/>path      : /var/lib/gwms-factory/client-proxies/user_fefermilab/glidein_gfactory_instance/credential_fermilab_okd_gpfe01.fife_test_singularity_684221<br/>timeleft  : 66:09:34<br/>key usage : Digital Signature, Key Encipherment, Data Encipherment<br/>=== VO fermilab extension information ===<br/>VO        : fermilab<br/>subject   : /DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-okd-gpfe01.fnal.gov">pilot-okd-gpfe01.fnal.gov</a><br/>issuer    : /DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://voms1.fnal.gov">voms1.fnal.gov</a><br/>attribute : /fermilab/Role=pilot/Capability=NULL<br/>attribute : /fermilab/Role=NULL/Capability=NULL<br/>attribute : /fermilab/admx/Role=NULL/Capability=NULL<br/>attribute : /fermilab/argoneut/Role=NULL/Capability=NULL<br/>attribute : /fermilab/cdf/Role=NULL/Capability=NULL<br/>attribute : /fermilab/cdms/Role=NULL/Capability=NULL<br/>attribute : /fermilab/coupp/Role=NULL/Capability=NULL<br/>attribute : /fermilab/genie/Role=NULL/Capability=NULL<br/>attribute : /fermilab/gm2/Role=NULL/Capability=NULL<br/>attribute : /fermilab/grid/Role=NULL/Capability=NULL<br/>attribute : /fermilab/icarus/Role=NULL/Capability=NULL<br/>attribute : /fermilab/lariat/Role=NULL/Capability=NULL<br/>attribute : /fermilab/mars/Role=NULL/Capability=NULL<br/>attribute : /fermilab/minerva/Role=NULL/Capability=NULL<br/>attribute : /fermilab/miniboone/Role=NULL/Capability=NULL<br/>attribute : /fermilab/minos/Role=NULL/Capability=NULL<br/>attribute : /fermilab/mu2e/Role=NULL/Capability=NULL<br/>attribute : /fermilab/next/Role=NULL/Capability=NULL<br/>attribute : /fermilab/noble/Role=NULL/Capability=NULL<br/>attribute : /fermilab/nova/Role=NULL/Capability=NULL<br/>attribute : /fermilab/numix/Role=NULL/Capability=NULL<br/>attribute : /fermilab/patriot/Role=NULL/Capability=NULL<br/>attribute : /fermilab/sbnd/Role=NULL/Capability=NULL<br/>attribute : /fermilab/seaquest/Role=NULL/Capability=NULL<br/>attribute : /fermilab/spinquest/Role=NULL/Capability=NULL<br/>attribute : /fermilab/test/Role=NULL/Capability=NULL<br/>attribute : /fermilab/uboone/Role=NULL/Capability=NULL<br/>timeleft  : 66:09:34<br/>uri       : <a href="http://voms1.fnal.gov:15001">voms1.fnal.gov:15001</a></pre><br/>
<span style="color: #8d4b84"><span style="font-size: small">(12:57:31)</span> <b>kherner:</b></span> Hmm, maybe not. That DN is different from the old one (gpfrontend01/02.fnal.gov)<br/>
<span style="color: #e06b56"><span style="font-size: small">(13:56:49)</span> <b>jthiltges:</b></span> To make sure I'm following, the issue possibly lies with FNAL VOMS configuration, rather than the rhino CE itself?<br/>
<span style="color: #8d4b84"><span style="font-size: small">(13:57:36)</span> <b>kherner:</b></span> No<br/>
<span style="color: #16569E"><span style="font-size: small">(13:57:37)</span> <b>edquist:</b></span> 53]]<br/>
<span style="color: #8d4b84"><span style="font-size: small">(13:57:58)</span> <b>kherner:</b></span> If it were the FNAL VOMS server then things would be failing left and right.<br/>
<span style="color: #8d4b84"><span style="font-size: small">(14:01:01)</span> <b>kherner:</b></span> Possible that the Rhino CE will only authorize certain DNs, and the one for the newer OKD-based frontend may not be on the list.<br/>
<span style="color: #e06b56"><span style="font-size: small">(14:10:26)</span> <b>jthiltges:</b></span> For whatever it's worth, I'm now seeing permission granted for that host. (With no changes on this end to my knowledge, outside of changing the debug level. Argh.)<br/><br/><pre>09/10/20 13:24:24 ZKM: name to map is '/DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-okd-gpfe01.fnal.gov">pilot-okd-gpfe01.fnal.gov</a>'<br/>...<br/>09/10/20 13:24:24 PERMISSION GRANTED to <a href="mailto:fermilab@users.opensciencegrid.org">fermilab@users.opensciencegrid.org</a> from host 169.228.38.36 for command 1112 (QMGMT_WRITE_CMD), access level WRITE: reason: WRITE authorization policy allows IP address 169.228.38.36; identifiers used for this remote host: 169.228.38.36</pre><br/>
<span style="color: #e06b56"><span style="font-size: small">(14:23:22)</span> <b>jthiltges:</b></span> Reviewing the schedd debug output, I am seeing denials with gfactory-2 for <tt>/DC=org/DC=incommon/C=US/ST=Illinois/L=Batavia/O=Fermi Research Alliance/OU=Fermilab/CN=<a href="http://pilot-gpfrontend01.fnal.gov">pilot-gpfrontend01.fnal.gov</a></tt><br/><br/><pre>09/10/20 13:25:10 PERMISSION DENIED to pilot-gpfrontend01.fnal.gov@daemon.opensciencegrid.org from host 169.228.38.43 for command 1112 (QMGMT_WRITE_CMD), access level WRITE: reason: WRITE authorization policy contains no matching ALLOW entry for this request; identifiers used for this host: 169.228.38.43, hostname size = 0, original ip address = 169.228.38.43</pre><br/>A difference that jumps out to me:<br/><pre>09/10/20 13:25:10 ZKM: VOMS FQAN not present (error 17), ignoring.</pre><br/>I'm seeing similar denials on other Nebraska CEs, so hopefully not just a Rhino misconfig.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:32:30)</span> <b>blin:</b></span> @jthiltges anything in /var/log/messages or journalctl re lcmaps?<br/>
<blockquote>
<span style="color: #e06b56"><span style="font-size: small">(17:15:54)</span> <b>jthiltges:</b></span> Good idea on the debug level. But sadly nothing in the LCMAPS logs. I don't see any log entries for CN=<a href="http://pilot-gpfrontend01.fnal.gov">pilot-gpfrontend01.fnal.gov</a>.<br/><br/>From a packet capture, the certificate looks like it's related to dune VO.<br/><br/>Since we're seeing dune things coming in OK under CN=<a href="http://pilot-okd-gpfe01.fnal.gov">pilot-okd-gpfe01.fnal.gov</a> ... I'm just going to pretend this didn't happen. I guess.<br/><br/>Thanks for the advice!<br/>
<span style="color: #43761b"><span style="font-size: small">(17:30:34)</span> <b>blin:</b></span> hrmmmm i wonder if it has something to do with the pilot-gpfrontend01 and how it's signing its proxies<br/>
<span style="color: #43761b"><span style="font-size: small">(17:30:36)</span> <b>blin:</b></span> ¯\_(ツ)_/¯<br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(14:32:50)</span> <b>blin:</b></span> turning up the debug level may be helpful: <a href="https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#htcondor-ce-hosts">https://opensciencegrid.org/docs/security/lcmaps-voms-authentication/#htcondor-ce-hosts</a><br/>
</body>
</html>
