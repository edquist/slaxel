<!DOCTYPE html>
<html>
<head>
<title>Mon Mar 30, 2020 : #gfactory (osg)</title>
</head>
<body>
<h3>Mon Mar 30, 2020 : #gfactory (osg)</h3>
<span style="color: #c386df"><span style="font-size: small">(15:21:20)</span> <b>khurtado:</b></span> Hi guys, general question related to GPUs. We are getting a Hosted-CE submitting to a GPU cluster we have at ND. Submission works fine and some VO jobs started running, but most or all failed.<br/>Something I noticed is that the pilot jobs sent do not have any RequestGPUs classad on it. Is it possible the pilot startd is advertising  GPUs&gt;1, but the condor job running the pilot actually doesn’t have any GPU allocated and hence failing trying to get CUDA devices?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:22:39)</span> <b>blin:</b></span> what's the CE hostname?<br/>
<span style="color: #c386df"><span style="font-size: small">(15:24:33)</span> <b>khurtado:</b></span> <a href="http://hosted-ce35.grid.uchicago.edu">hosted-ce35.grid.uchicago.edu</a><br/>
<span style="color: #43761b"><span style="font-size: small">(15:25:24)</span> <b>blin:</b></span> it looks like the factory config is sending pilots requesting 1 gpu<br/>
<span style="color: #c386df"><span style="font-size: small">(15:26:53)</span> <b>khurtado:</b></span> This is what I see at the schedd<br/><pre><br/>[osg04@camlosg tutorial-interactivegpus]$ condor_history osg04 -limit 10 -af:h ClusterId RequestGpus Cmd<br/>ClusterId RequestGpus Cmd<br/>232       undefined   /home/osg04/bosco/sandbox/e132/e132f7d2/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#840.0#1584986962/condor_exec.exe">hosted-ce35.grid.uchicago.edu#840.0#1584986962/condor_exec.exe</a><br/>231       undefined   /home/osg04/bosco/sandbox/d205/d2059d39/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#839.0#1584986962/condor_exec.exe">hosted-ce35.grid.uchicago.edu#839.0#1584986962/condor_exec.exe</a><br/>228       undefined   /home/osg04/bosco/sandbox/ec78/ec7815b5/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#832.0#1584974439/condor_exec.exe">hosted-ce35.grid.uchicago.edu#832.0#1584974439/condor_exec.exe</a><br/>249       undefined   /home/osg04/bosco/sandbox/2e16/2e167ceb/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#879.0#1585004872/condor_exec.exe">hosted-ce35.grid.uchicago.edu#879.0#1585004872/condor_exec.exe</a><br/>250       undefined   /home/osg04/bosco/sandbox/7eba/7ebaf55b/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#880.0#1585004872/condor_exec.exe">hosted-ce35.grid.uchicago.edu#880.0#1585004872/condor_exec.exe</a><br/>247       undefined   /home/osg04/bosco/sandbox/031d/031da9e5/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#875.0#1585001779/condor_exec.exe">hosted-ce35.grid.uchicago.edu#875.0#1585001779/condor_exec.exe</a><br/>248       undefined   /home/osg04/bosco/sandbox/506d/506d4f70/hosted-ce35.grid.uchicago.edu_9619_<a href="http://hosted-ce35.grid.uchicago.edu#876.0#1585001779/condor_exec.exe">hosted-ce35.grid.uchicago.edu#876.0#1585001779/condor_exec.exe</a></pre><br/>
<span style="color: #43761b"><span style="font-size: small">(15:27:15)</span> <b>blin:</b></span> looks good on the CE end, too:<br/><pre>blin@blin-latitude:~$ ce=<a href="http://hosted-ce35.grid.uchicago.edu">hosted-ce35.grid.uchicago.edu</a><br/>blin@blin-latitude:~$ condor_q -name $ce -pool $ce:9619 -all -af requestgpus<br/>1<br/>1</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(15:27:16)</span> <b>khurtado:</b></span> Could it be a bosco thing?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:28:39)</span> <b>blin:</b></span> hrm yeah, that's quite possible<br/>
<span style="color: #c386df"><span style="font-size: small">(15:29:52)</span> <b>khurtado:</b></span> Do I need any local_attributes*.sh patch in bosco in order to propagate the GPU classad when bosco submits the job?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:31:51)</span> <b>blin:</b></span> i think you can work around this for now by adding this to your GPU job route: <tt>set_default_CERequirements = RequestGpus;</tt><br/>
<span style="color: #43761b"><span style="font-size: small">(15:32:32)</span> <b>blin:</b></span> then yeah, add this to <tt>condor_local_submit_attributes.sh</tt>:<br/><pre>#!/bin/bash<br/>echo "request_gpus = $RequestGpus"</pre><br/>
<span style="color: #c386df"><span style="font-size: small">(15:38:03)</span> <b>khurtado:</b></span> Oh, ok. I don’t think I have root access to the CE. Could you or maybe @marco.mascheroni add that rule?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:39:29)</span> <b>blin:</b></span> ah it's not a SLATE CE?<br/>
<span style="color: #c386df"><span style="font-size: small">(15:39:33)</span> <b>khurtado:</b></span> Regarding <tt>condor_local_submit_attributes.sh</tt>, do I just manually add that file to all bosco instances in the osg accounts, or is there a patch that the CE needs to use when it installs bosco on the remote target?<br/>
<span style="color: #c386df"><span style="font-size: small">(15:39:45)</span> <b>khurtado:</b></span> Ah, no, this one is an OSG Hosted-CE<br/>
<span style="color: #c386df"><span style="font-size: small">(15:39:56)</span> <b>khurtado:</b></span> The SLATE CE I have is for another cluster :)<br/>
<span style="color: #43761b"><span style="font-size: small">(15:40:03)</span> <b>blin:</b></span> here, i'll open a ticket with operations and add you<br/>
<span style="color: #c386df"><span style="font-size: small">(15:40:12)</span> <b>khurtado:</b></span> Thank you!<br/>
</body>
</html>
