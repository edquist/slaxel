<!DOCTYPE html>
<html>
<head>
<title>Thu May 27, 2021 : #gracc (osg)</title>
</head>
<body>
<h3>Thu May 27, 2021 : #gracc (osg)</h3>
<span style="color: #43761b"><span style="font-size: small">(14:01:41)</span> <b>blin:</b></span> @miwalls so I still don't see any new records coming in. This may not be all that strange since we only account for pilots when jobs finish running and i imagine you guys aren't running all that many OSG jobs yet. Is that right?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:02:16)</span> <b>blin:</b></span> <b>@edquist</b> if we kill a job manually, gratia-probe should generate a record on its next invocation, right?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:04:30)</span> <b>miwalls:</b></span> I have many completed OSG jobs. At the moment we are running 10 jobs. There are about 30 completed in the last day.<br/>
<span style="color: #43761b"><span style="font-size: small">(14:05:39)</span> <b>blin:</b></span> <b>@edquist</b> what should we set the debug level to?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:06:50)</span> <b>miwalls:</b></span> For slurm what permissions should the pass file be? I see that the cron runs as root is that right?<br/>
<span style="color: #43761b"><span style="font-size: small">(14:07:39)</span> <b>blin:</b></span> yup, it is rootly<br/>
<span style="color: #16569E"><span style="font-size: small">(14:08:13)</span> <b>edquist:</b></span> yeah i think that is the general idea - it might be possible that duplicate data will be sent to gracc (and then ignored), but it shouldn't be lost ...<br/>
<span style="color: #16569E"><span style="font-size: small">(14:09:35)</span> <b>edquist:</b></span> the debug level 4 is for the DEBUG messages<br/>
<span style="color: #43761b"><span style="font-size: small">(14:10:56)</span> <b>blin:</b></span> is that the highest?<br/>
<span style="color: #16569E"><span style="font-size: small">(14:11:50)</span> <b>edquist:</b></span> there is a 5 but i don't think we use it (checking)<br/>
<span style="color: #16569E"><span style="font-size: small">(14:12:23)</span> <b>edquist:</b></span> if you want feel free to set it to 5 and you won't miss anything but when i am debugging i just set it to 4<br/>
<span style="color: #16569E"><span style="font-size: small">(14:12:55)</span> <b>edquist:</b></span> oh dear<br/>
<span style="color: #43761b"><span style="font-size: small">(14:14:19)</span> <b>blin:</b></span> @miwalls what does your <tt>ProbeConfig</tt> look like? i forget if there's any sensitive data in there but you should make sure to look it over and scrub out anything sensitive just in case<br/>
<span style="color: #16569E"><span style="font-size: small">(14:14:54)</span> <b>edquist:</b></span> i take it back there are some very detailed DebugPrint lines that use debug level 5 or even 6<br/>
<span style="color: #16569E"><span style="font-size: small">(14:15:07)</span> <b>edquist:</b></span> if you want a lot of noise<br/>
<span style="color: #a63024"><span style="font-size: small">(14:46:41)</span> <b>miwalls:</b></span> Apologies we were rebooting switches in the HPC rack. Here is the Config.<br/>&lt;ProbeConfiguration<br/><br/>    Title1="Collector Information"<br/><br/>    CollectorHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/>    SSLHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/>    SSLRegistrationHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/><br/>    CollectorService="/gratia-servlets/rmi"<br/>    SSLCollectorService="/gratia-servlets/rmi"<br/>    RegistrationService="/gratia-registration/register"<br/><br/>    Title2="Probe information and functional configuration"<br/><br/>    ProbeName="slurm:<a href="http://cc-condor.hpc.siue.edu">cc-condor.hpc.siue.edu</a>"<br/>    SiteName="OSG_US_SIUE_CC"<br/>    Grid="OSG"<br/>    SuppressUnknownVORecords="0"<br/>    SuppressNoDNRecords="0"<br/>    SuppressGridLocalRecords="0"<br/>    QuarantineUnknownVORecords="1"<br/>    EnableProbe="1"<br/><br/>    Title3="Tuning parameter"<br/><br/>    BundleSize="100"<br/>    MaxPendingFiles="100000"<br/>    MaxStagedArchives="400"<br/>    UseSyslog="0"<br/>    ConnectionTimeout="900"<br/><br/>    LogLevel="2"<br/>       Comments32="Controls debug messages printed to log file."<br/>    DebugLevel="0"<br/>       Comments33="Controls debug messages printed to screen."<br/>    LogRotate="31"<br/>    LogFileName=""<br/>       Comments34="If LogFileName is set, then there is no log file rotation. Otherwise Log file rotation will create one new file each day and delete the older ones"<br/>    DataLengthMax="0"<br/>       Comments35="The maximum number of records (or hours, depending on the probe) processed in a single invocation, 0 = all records, no max"<br/>    DataFileExpiration="31"<br/>       Comments36="The number of days quarantined and unusable data files are kept"<br/>    QuarantineSize="200"<br/>       Comments37="The maximum size in Mb allowed to be kept in each quarantined directory"<br/>    GratiaExtension="gratia.xml"<br/><br/>    Title4="Authentication Configuration"<br/><br/>    UseSSL="0"<br/>    CertificateFile="/etc/grid-security/hostcert.pem"<br/>    KeyFile="/etc/grid-security/hostkey.pem"<br/>    UseGratiaCertificates="0"<br/>       Comments40="If no directory is specified the gratia certificate file will be created in 'WorkingFolder'/certs."<br/>    GratiaCertificateFile="/var/lib/gratia/data/certs/gratia.probecert.pem"<br/>    GratiaKeyFile="/var/lib/gratia/data/certs/gratia.probekey.pem"<br/><br/>    Title5="File and directory location"<br/><br/>    UserVOMapFile="/var/lib/osg/user-vo-map"<br/>        Comments51="Location and wildcard pattern of log files that contains certificate information about the jobs in the format followed by the 'blah demons'."<br/>    CertInfoLogPattern="/var/log/accounting/blahp.log-*"<br/>    CondorCEHistoryFolder="/var/lib/gratia/condorce_data"<br/><br/>    DataFolder="/var/lib/gratia/data/"<br/>    WorkingFolder="/var/lib/gratia/tmp"<br/>    LogFolder="/var/log/gratia"<br/><br/><br/>    SlurmLocation="/usr/local"<br/>        Comments91="Custom install location for slurm; eg: /opt/slurm"<br/>    SlurmDbHost="<a href="http://cc-head-01.hpc.siue.edu">cc-head-01.hpc.siue.edu</a>"<br/>    SlurmDbPort="3306"<br/>    SlurmDbUser="condor"<br/>    SlurmDbPasswordFile="/etc/gratia/slurm/slurm-pass.txt"<br/>    SlurmDbName="slurm"<br/>    SlurmCluster="cc"<br/><br/>    SOAPHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/>/&gt;<br/><br/>&lt;!-- This probe has not yet been configured --&gt;<br/>
<span style="color: #43761b"><span style="font-size: small">(14:48:55)</span> <b>blin:</b></span> Could you set <tt>DebugLevel="4"</tt>, kill a few jobs on the CE, then run <tt>/usr/share/gratia/slurm/slurm_meter -c</tt> as root?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:57:39)</span> <b>miwalls:</b></span> condor_ce_rm or scancel?<br/>
<span style="color: #a63024"><span style="font-size: small">(14:59:13)</span> <b>miwalls:</b></span> It prints out a massive amount of files from here '/var/lib/gratia/data/quarantine/subdir.<a href="http://slurm_cc-condor.hpc.siue.edu">slurm_cc-condor.hpc.siue.edu</a>_<a href="http://gratia-osg-prod.opensciencegrid.org">gratia-osg-prod.opensciencegrid.org</a>_80/<br/>
<span style="color: #43761b"><span style="font-size: small">(14:59:40)</span> <b>blin:</b></span> (in the future condor_ce_rm is better)<br/>
<span style="color: #43761b"><span style="font-size: small">(14:59:57)</span> <b>blin:</b></span> aha, do you have anything in the logs?<br/>
<span style="color: #43761b"><span style="font-size: small">(15:00:12)</span> <b>blin:</b></span> <b>@edquist</b> ^^ please take it from here, i have to jump on a meeting<br/>
<span style="color: #a63024"><span style="font-size: small">(15:11:22)</span> <b>miwalls:</b></span> 2021-05-27 15:05:38 CDT Gratia: Using config file: /etc/gratia/slurm/ProbeConfig<br/>2021-05-27 15:05:38 CDT Gratia: Initializing Gratia with /etc/gratia/slurm/ProbeConfig<br/>2021-05-27 15:05:38 CDT Gratia: Creating a Record 2021-05-27T20:05:38Z<br/>2021-05-27 15:05:38 CDT Gratia: Creating a ProbeDetails record 2021-05-27T20:05:38Z<br/>2021-05-27 15:05:38 CDT Gratia: ***********************************************************<br/>2021-05-27 15:05:38 CDT Gratia: UsageXml:  &lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;ProbeDetails&gt;<br/>&lt;RecordIdentity createTime="2021-05-27T20:05:38Z" recordId="cc-condor.hpc.siue.edu:181181.0"/&gt;<br/>        &lt;ProbeName&gt;slurm:<a href="http://cc-condor.hpc.siue.edu">cc-condor.hpc.siue.edu</a>&lt;/ProbeName&gt;<br/>        &lt;SiteName&gt;OSG_US_SIUE_CC&lt;/SiteName&gt;<br/>        &lt;Grid&gt;OSG&lt;/Grid&gt;<br/>        &lt;ReporterLibrary version="1.23.3-1.osg35.el7.0d9c420"&gt;Gratia&lt;/ReporterLibrary&gt;<br/>&lt;/ProbeDetails&gt;<br/>2021-05-27 15:05:38 CDT Gratia: OK - Handshake added to bundle (1/100)<br/>2021-05-27 15:05:38 CDT Gratia: ***********************************************************<br/>2021-05-27 15:05:38 CDT Gratia: List of backup directories: ['/var/lib/gratia/tmp']<br/>2021-05-27 15:05:38 CDT Gratia: Reprocessing response: OK - Reprocessing 0 record(s) uploaded, 0 bundled, 0 failed<br/>2021-05-27 15:05:38 CDT Gratia: After reprocessing: 0 in outbox 0 in staged outbox 0 tar files<br/>2021-05-27 15:05:38 CDT Gratia: Resuming from checkpoint in /var/lib/gratia/tmp/checkpoint<br/>2021-05-27 15:05:38 CDT Gratia: Creating a Record 2021-05-27T20:05:38Z<br/>2021-05-27 15:05:38 CDT Gratia: Creating a UsageRecord 2021-05-27T20:05:38Z<br/>2021-05-27 15:05:38 CDT Gratia: System CPU for job 3403 is not readable.  Below is the full job description<br/>2021-05-27 15:05:38 CDT Gratia: {'id_job': 3403, 'exit_code': 0, 'id_group': 1001, 'id_user': 87502, 'job_name': 'bl_a7ovSS', 'tres_alloc': '1=1,3=18446744073709551614,4=1,5=1', 'partition': 'OSG', 'state': 3, 'time_start': 1622047775, 'time_end': 1622047776, 'time_suspended': Decimal('0'), 'wall_time': Decimal('1'), 'acct': 'none', 'user': 'miwalls', 'max_rss': 0, 'cpu_user': Decimal('0.0051'), 'cpu_sys': Decimal('0.0000'), 'cluster': 'cc', 'cpus_alloc': 1}<br/>2021-05-27 15:05:38 CDT Gratia: Setting System CPU to 0.0<br/>2021-05-27 15:05:38 CDT Gratia: ***********************************************************<br/>2021-05-27 15:05:38 CDT Gratia: Usage Record: &lt;gratia.common.Gratia.UsageRecord object at 0x7fffe8aeec88&gt;<br/>2021-05-27 15:05:38 CDT Gratia: WARNING: No mapfile specified; not using VO mapping.<br/>2021-05-27 15:05:38 CDT Gratia: Running : &lt;function UsageCheckXmldoc at 0x7fffeba8ab70&gt;&lt;xml.dom.minidom.Document object at 0x7fffe91cc528&gt;FalseNone<br/>2021-05-27 15:05:38 CDT Gratia: ERROR: unable to find valid certinfo file for job 3403<br/>2021-05-27 15:05:38 CDT Gratia: printing failed message:<br/>2021-05-27 15:05:38 CDT Gratia: Processing bundle file:<br/>2021-05-27 15:05:38 CDT Gratia: Connection via HTTP to: <a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a><br/>2021-05-27 15:05:38 CDT Gratia: TransactionId:  slurm:cc-condor.hpc.siue.edu2021-05-27T200538Z<br/>2021-05-27 15:05:38 CDT Gratia: Response: (SUCCESS, OK)<br/>2021-05-27 15:05:38 CDT Gratia: Processing bundle Response code:  0<br/>2021-05-27 15:05:38 CDT Gratia: Processing bundle Response message:  OK<br/>2021-05-27 15:05:38 CDT Gratia: OK - Processed bundle with 1 records:  OK<br/>2021-05-27 15:05:38 CDT Gratia: ***********************************************************<br/>2021-05-27 15:05:38 CDT Gratia: Removing log files older than 31 days from /var/log/gratia<br/>2021-05-27 15:05:38 CDT Gratia:  Will check the files: ['/var/log/gratia/2021-04-26.log', '/var/log/gratia/2021-04-27.log', '/var/log/gratia/2021-04-28.log', '/var/log/gratia/2021-04-29.log', '/var/log/gratia/2021-04-30.log', '/var/log/gratia/2021-05-01.log', '/var/log/gratia/2021-05-02.log', '/var/log/gratia/2021-05-03.log', '/var/log/gratia/2021-05-04.log', '/var/log/gratia/2021-05-05.log', '/var/log/gratia/2021-05-06.log', '/var/log/gratia/2021-05-07.log', '/var/log/gratia/2021-05-08.log', '/var/log/gratia/2021-05-09.log', '/var/log/gratia/2021-05-10.log', '/var/log/gratia/2021-05-11.log', '/var/log/gratia/2021-05-12.log', '/var/log/gratia/2021-05-13.log', '/var/log/gratia/2021-05-14.log', '/var/log/gratia/2021-05-15.log', '/var/log/gratia/2021-05-16.log', '/var/log/gratia/2021-05-17.log', '/var/log/gratia/2021-05-18.log', '/var/log/gratia/2021-05-19.log', '/var/log/gratia/2021-05-20.log', '/var/log/gratia/2021-05-21.log', '/var/log/gratia/2021-05-22.log', '/var/log/gratia/2021-05-23.log', '/var/log/gratia/2021-05-24.log', '/var/log/gratia/2021-05-25.log', '/var/log/gratia/2021-05-26.log', '/var/log/gratia/2021-05-27.log']<br/>2021-05-27 15:05:38 CDT Gratia: /var/log/gratia uses 0.016% and there is 85% free<br/>2021-05-27 15:05:38 CDT Gratia: Removing incomplete data files older than 31 days from /var/lib/gratia/data/<br/>2021-05-27 15:05:38 CDT Gratia: Removing quarantines data files older than 31 days from /var/lib/gratia/data/quarantine<br/>2021-05-27 15:05:38 CDT Gratia:  Will check the files: ['/var/lib/gratia/data/quarantine/subdir.<a href="http://slurm_cc-condor.hpc.siue.edu">slurm_cc-condor.hpc.siue.edu</a>_<a href="http://gratia-osg-prod.opensciencegrid.org">gratia-osg-prod.opensciencegrid.org</a>_80']<br/>
<span style="color: #a63024"><span style="font-size: small">(15:13:38)</span> <b>miwalls:</b></span> Then it prints the massive number of quarantined files then shows this.<br/>2021-05-27 15:05:38 CDT Gratia: End of execution summary: new records sent successfully: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           new records suppressed: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           new records failed: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           records reprocessed successfully: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           reprocessed records failed: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           handshake records sent successfully: 1<br/>2021-05-27 15:05:38 CDT Gratia:                           handshake records failed: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           bundle of records sent successfully: 1<br/>2021-05-27 15:05:38 CDT Gratia:                           bundle of records failed: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           outstanding records: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           outstanding staged records: 0<br/>2021-05-27 15:05:38 CDT Gratia:                           outstanding records tar files: 0<br/>2021-05-27 15:05:38 CDT Gratia: End-of-execution disconnect ...<br/>
</body>
</html>
