<!DOCTYPE html>
<html>
<head>
<title>Thu Mar 11, 2021 : #gracc (osg)</title>
</head>
<body>
<h3>Thu Mar 11, 2021 : #gracc (osg)</h3>
<span style="color: #5870dd"><span style="font-size: small">(10:02:35)</span> <b>duncan.macleod:</b></span> hi all, I'm trying to debug 'missing data' in gracc for LIGO. On <a href="https://gracc.opensciencegrid.org/d/000000037/payload-jobs-summary?from=1614729600000&amp;to=1615334399000&amp;orgId=1&amp;var-ReportableVOName=All&amp;var-Project=LIGO&amp;var-Facility=All&amp;var-User=All&amp;var-ExitCode=All&amp;var-Probe=All&amp;var-interval=1d&amp;var-Organization=All">this</a> page I see zero usage for the entire LIGO project on March 7th - internally from the Caltech OSG schedd I see several thousand hours of usage - who's the best person to help me understand the discrepancy (cc @patra, @peter.couvares)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:11:57)</span> <b>blin:</b></span> is the caltech schedd a CE or a user access point?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:13:15)</span> <b>duncan.macleod:</b></span> hi @blin, when I said 'the caltech OSG schedd' I meant a user access point, but CIT does also run a CE (I presume, since GRACC lists <tt>LIGO-CIT-CE</tt>)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:14:10)</span> <b>blin:</b></span> what's the fqdn of the host?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:14:30)</span> <b>duncan.macleod:</b></span> <a href="http://ldas-osg.ligo.caltech.edu">ldas-osg.ligo.caltech.edu</a><br/>
<span style="color: #43761b"><span style="font-size: small">(10:16:39)</span> <b>blin:</b></span> ok, i also see the gap internally. is the <tt>gratia-probe-cron</tt> service active and enabled on that host?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:17:21)</span> <b>duncan.macleod:</b></span> I have no idea what that means, maybe @patra or @james.clark knows, but I can ask the host owner on another channel<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:20:01)</span> <b>duncan.macleod:</b></span> I am told that 'yes' that service is active and enabled<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:20:20)</span> <b>duncan.macleod:</b></span> <pre>$ systemctl status gratia-probes-cron<br/>‚óè gratia-probes-cron.service - SYSV: Enable specified gratia probes to run via cron. based on fetch-crl-cron script (Steve Traylen &lt;steve.traylen@cern.ch&gt;)<br/>   Loaded: loaded (/etc/rc.d/init.d/gratia-probes-cron; bad; vendor preset: disabled)<br/>   Active: active (exited) since Thu 2021-03-11 03:35:11 PST; 4h 44min ago<br/>     Docs: man:systemd-sysv-generator(8)<br/>  Process: 9222 ExecStart=/etc/rc.d/init.d/gratia-probes-cron start (code=exited, status=0/SUCCESS)<br/>    Tasks: 0<br/>   Memory: 0B</pre><br/><br/>
<span style="color: #43761b"><span style="font-size: small">(10:23:21)</span> <b>blin:</b></span> ok that tracks since we've got records from the last few days. could you or @james.clark pass along the contents of <tt>/etc/gratia/condor/ProbeConfig</tt>?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:24:25)</span> <b>duncan.macleod:</b></span> here, or some other medium?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:24:28)</span> <b>duncan.macleod:</b></span> (I have that file open now)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:24:49)</span> <b>blin:</b></span> here's fine, there isn't anything sensitive in that file<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:25:01)</span> <b>duncan.macleod:</b></span> <pre>&lt;ProbeConfiguration<br/><br/>    Title1="Collector Information"<br/><br/>    CollectorHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/>    SSLHost="<a href="http://gratia-osg-prod.opensciencegrid.org:443">gratia-osg-prod.opensciencegrid.org:443</a>"<br/>    SSLRegistrationHost="<a href="http://gratia-osg-prod.opensciencegrid.org:80">gratia-osg-prod.opensciencegrid.org:80</a>"<br/><br/>    CollectorService="/gratia-servlets/rmi"<br/>    SSLCollectorService="/gratia-servlets/rmi"<br/>    RegistrationService="/gratia-registration/register"<br/><br/>    Title2="Probe information and functional configuration"<br/><br/>    ProbeName="condor:<a href="http://ldas-osg.ligo.caltech.edu">ldas-osg.ligo.caltech.edu</a>"<br/>    SiteName="LIGO-CIT"<br/>    Grid="OSG"<br/>    SuppressUnknownVORecords="0"<br/>    SuppressNoDNRecords="0"<br/>    SuppressGridLocalRecords="1"<br/>    QuarantineUnknownVORecords="1"<br/>    EnableProbe="1"<br/>    MapUnknownToGroup="1"<br/>    MapGroupToRole="1"<br/>    VOOverride="ligo"<br/>    ExtraAttributes="LigoSearchTag"<br/><br/>    Title3="Tuning parameter"<br/><br/>    BundleSize="100"<br/>    MaxPendingFiles="100000"<br/>    MaxStagedArchives="400"<br/>    UseSyslog="0"<br/>    ConnectionTimeout="900"<br/><br/>    LogLevel="2"<br/>       Comments32="Controls debug messages printed to log file."<br/>    DebugLevel="0"<br/>       Comments33="Controls debug messages printed to screen."<br/>    LogRotate="31"<br/>    LogFileName=""<br/>       Comments34="If LogFileName is set, then there is no log file rotation. Otherwise Log file rotation will create one new file each day and delete the older ones"<br/>    DataLengthMax="0"<br/>       Comments35="The maximum number of records (or hours, depending on the probe) processed in a single invocation, 0 = all records, no max"<br/>    DataFileExpiration="31"<br/>       Comments36="The number of days quarantined and unusable data files are kept"<br/>    QuarantineSize="200"<br/>       Comments37="The maximum size in Mb allowed to be kept in each quarantined directory"<br/>    GratiaExtension="gratia.xml"<br/><br/>    Title4="Authentication Configuration"<br/><br/>    UseSSL="0"<br/>    CertificateFile="/etc/grid-security/hostcert.pem"<br/>    KeyFile="/etc/grid-security/hostkey.pem"<br/>    UseGratiaCertificates="0"<br/>       Comments40="If no directory is specified the gratia certificate file will be created in 'WorkingFolder'/certs."<br/>    GratiaCertificateFile="/var/lib/gratia/data/certs/gratia.probecert.pem"<br/>    GratiaKeyFile="/var/lib/gratia/data/certs/gratia.probekey.pem"<br/><br/>    Title5="File and directory location"<br/><br/>    UserVOMapFile="/var/lib/osg/user-vo-map"<br/>        Comments51="Location and wildcard pattern of log files that contains certificate information about the jobs in the format followed by the 'blah demons'."<br/>    CertInfoLogPattern="/var/log/accounting/blahp.log-*"<br/>    CondorCEHistoryFolder="/var/lib/gratia/condorce_data"<br/><br/>    DataFolder="/var/lib/gratia/data/"<br/>    WorkingFolder="/var/lib/gratia/tmp"<br/>    LogFolder="/var/log/gratia"<br/><br/><br/>    CondorScheddName=""<br/>      Comments91="Use this to set the name of the scheduler, if there are mutliple."<br/>    NoCertinfoBatchRecordsAreLocal="0"<br/><br/>/&gt;<br/><br/>&lt;!-- This probe has not yet been configured --&gt;</pre><br/><br/>
<span style="color: #43761b"><span style="font-size: small">(10:27:14)</span> <b>blin:</b></span> ok thanks. let's take this to a ticket, i'll create it<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:27:31)</span> <b>duncan.macleod:</b></span> cc @stuart.anderson (the host owner)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:29:15)</span> <b>blin:</b></span> one thing that's a little strange: don't you guys have other user access points? an issue at the caltech host doesn't explain 0 hours of usage for the entirety of LIGO<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:29:40)</span> <b>duncan.macleod:</b></span> in principle 'yes', but 99.9% of all of our OSG submissions come from CIT<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:29:57)</span> <b>duncan.macleod:</b></span> zero usage from any other submit point matches our internal records (as far as I can tell)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:30:18)</span> <b>blin:</b></span> ok, that tracks then<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:51:55)</span> <b>duncan.macleod:</b></span> @blin, sorry if this is best put on the ticket, but I see lots of log messages for that gratia probe that look like this:<br/><br/><pre>Info: suppressing record with GlobalJobId <a href="http://condor.ldas-osg.ligo.caltech.edu#33612911.0#1615092540">condor.ldas-osg.ligo.caltech.edu#33612911.0#1615092540</a> due to Grid == Local</pre><br/>I presume that this means that gracc will not have received information about the relevant condor job?<br/>
<span style="color: #43761b"><span style="font-size: small">(10:53:43)</span> <b>blin:</b></span> yup, that would correspond to the setting in the ProbeConfig<br/><pre>    SuppressGridLocalRecords="1"</pre><br/>however i forget the logic behind that and that setting is probably what you actually want<br/>
<span style="color: #43761b"><span style="font-size: small">(10:54:35)</span> <b>blin:</b></span> iirc, suppressing grid local records is for schedd's that have both OSG and local usage but <b>@edquist</b> would be able to speak to that<br/>
<span style="color: #16569E"><span style="font-size: small">(10:55:35)</span> <b>edquist:</b></span> that sounds right to me<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:56:10)</span> <b>duncan.macleod:</b></span> ok, the condor history shows that _all_ jobs from that host on that day have the following classad:<br/><pre>MATCH_EXP_JOBGLIDEIN_ResourceName = "Local Job"</pre><br/>is that the relevant one? or am I looking in the wrong place?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:56:47)</span> <b>duncan.macleod:</b></span> maybe better is <tt>flock_local = true</tt>?<br/>
<span style="color: #5870dd"><span style="font-size: small">(10:56:55)</span> <b>duncan.macleod:</b></span> (sorry, I'm sort of stumbling around in the dark here)<br/>
<span style="color: #43761b"><span style="font-size: small">(10:59:05)</span> <b>blin:</b></span> yeah, the match exp is relevant<br/>
<span style="color: #43761b"><span style="font-size: small">(10:59:39)</span> <b>blin:</b></span> that generally means that the jobs ran on non-OSG resources, i.e. local ones available to caltech<br/>
<span style="color: #43761b"><span style="font-size: small">(11:00:12)</span> <b>blin:</b></span> if that's not the case, then there may be something wrong with the configuration of the pilots that you're getting<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:00:36)</span> <b>duncan.macleod:</b></span> @stuart.anderson, @james.clark, can you add some actual knowledge to my vague guessing?<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:02:58)</span> <b>james.clark:</b></span> there's a lot to track through on top of other channels, sorry: what's the question?<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:03:41)</span> <b>duncan.macleod:</b></span> we're trying to debug why gracc reports 0 usage for LIGO on March 7th, it's essentially because all of the jobs submitted to <a href="http://ldas-osg.ligo.caltech.edu">ldas-osg.ligo.caltech.edu</a> had <tt>flock_local = true</tt><br/>
<span style="color: #5870dd"><span style="font-size: small">(11:04:29)</span> <b>duncan.macleod:</b></span> I think the <tt>flock_local = true</tt> setting means the job ends up with <tt>MATCH_EXP_JOBGLIDEIN_ResourceName = "Local Job"</tt> in the classad<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:04:47)</span> <b>duncan.macleod:</b></span> currently we're classifying that as an OSG job that ran locally - it sounds like OSG (Gracc) ignore those jobs<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:06:24)</span> <b>james.clark:</b></span> 1.  i'm not sure <tt>flock_local=True</tt> actually does anything yet.   the plan is that it will (this is to be prototyped on the LHO) but right now, that is functionally acheived with <tt>+DESIRED_Sites="nogrid"</tt><br/>2. I think march 7th would include the major outage which is being worked on <br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:07:26)</span> <b>james.clark:</b></span> e.g. <a href="https://graph.t2.ucsd.edu:3000/d/000000020/igwn-osg-pool?orgId=1&amp;from=1614574800000&amp;to=1615525199000&amp;var-GlideinSite=All&amp;var-LigoTag=All">https://graph.t2.ucsd.edu:3000/d/000000020/igwn-osg-pool?orgId=1&amp;from=1614574800000&amp;to=1615525199000&amp;var-GlideinSite=All&amp;var-LigoTag=All</a><br/>
<span style="color: #5870dd"><span style="font-size: small">(11:07:37)</span> <b>duncan.macleod:</b></span> the problem is that our accounting thinks there were ~3k core hours of 'OSG' usage CIT-&gt;CIT<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:07:55)</span> <b>james.clark:</b></span> ah, that makes more sense<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:09:11)</span> <b>james.clark:</b></span> so our accounting includes the local jobs and osg does not.<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:09:35)</span> <b>duncan.macleod:</b></span> we try and weed out actual local jobs in the accounting collector, but we're clearly not doing a good job<br/>
<span style="color: #a2a5dc"><span style="font-size: small">(11:11:39)</span> <b>james.clark:</b></span> so you want the attribute to identify them as such?<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:12:38)</span> <b>duncan.macleod:</b></span> let's take this off-list so we don't fill up OSG chat with LIGO issues (<a href="http://chat.ligo.org">chat.ligo.org</a>)<br/>
<span style="color: #43761b"><span style="font-size: small">(11:14:10)</span> <b>blin:</b></span> @duncan.macleod so do I have it right that the LIGO hours that are missing, are correctly missing from the GRACC?<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:15:07)</span> <b>duncan.macleod:</b></span> Let's go with 'yes' for now, until James Clark educates me on the nuances of which jobs go to which pool from that host<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:15:12)</span> <b>duncan.macleod:</b></span> Thanks for your help @blin<br/>
<span style="color: #43761b"><span style="font-size: small">(11:15:54)</span> <b>blin:</b></span> ok, in that case I'll resolve the ticket I created but if you guys conclude that there's still an issue, feel free to respond to it<br/>
<span style="color: #43761b"><span style="font-size: small">(11:16:01)</span> <b>blin:</b></span> it'll open it back up<br/>
<span style="color: #5870dd"><span style="font-size: small">(11:16:15)</span> <b>duncan.macleod:</b></span> thanks<br/>
</body>
</html>
