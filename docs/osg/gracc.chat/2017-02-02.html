<!DOCTYPE html>
<html>
<head>
<title>Thu Feb 2, 2017 : #gracc (osg)</title>
</head>
<body>
<h3>Thu Feb 2, 2017 : #gracc (osg)</h3>
<span style="color: #235e5b"><span style="font-size: small">(12:29:32)</span> <b>dweitzel:</b></span> Just to confirm, gracc meeting today?<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:29:13)</span> <b>kretzke:</b></span> yes<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:34:45)</span> <b>kretzke:</b></span> we’re moving to Zoom, I just sent out an invite with details<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:35:09)</span> <b>sthapa:</b></span> A question about gracc views when you’re free<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:36:15)</span> <b>kretzke:</b></span> sure<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:36:47)</span> <b>sthapa:</b></span> Looking at hosted_stanford stats<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:37:00)</span> <b>sthapa:</b></span> The pilot jobs summary seems to diverge a bunch from the payload summary:<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:37:02)</span> <b>sthapa:</b></span> <a href="https://gracc.opensciencegrid.org/dashboard/db/pilot-jobs-summary?from=now-14d&amp;to=now&amp;var-VOName=All&amp;var-Project=All&amp;var-Facility=HOSTED_STANFORD&amp;var-User=All&amp;var-ExitCode=All&amp;var-Probe=All&amp;var-interval=1d">https://gracc.opensciencegrid.org/dashboard/db/pilot-jobs-summary?from=now-14d&amp;to=now&amp;var-VOName=All&amp;var-Project=All&amp;var-Facility=HOSTED_STANFORD&amp;var-User=All&amp;var-ExitCode=All&amp;var-Probe=All&amp;var-interval=1d</a><br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:37:06)</span> <b>sthapa:</b></span> <a href="https://gracc.opensciencegrid.org/dashboard/db/payload-jobs-summary?var-VOName=All&amp;var-Project=All&amp;var-Facility=HOSTED_STANFORD&amp;var-User=All&amp;var-ExitCode=All&amp;var-Probe=All&amp;var-interval=1d">https://gracc.opensciencegrid.org/dashboard/db/payload-jobs-summary?var-VOName=All&amp;var-Project=All&amp;var-Facility=HOSTED_STANFORD&amp;var-User=All&amp;var-ExitCode=All&amp;var-Probe=All&amp;var-interval=1d</a><br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:37:40)</span> <b>sthapa:</b></span> Some of the that is expected but the two should match over the last week or so<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:38:50)</span> <b>sthapa:</b></span> The gratia logs look like records are being sent successfully.  The site itself should be producing around 10-20k cpu hours per day<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:40:27)</span> <b>kretzke:</b></span> hm...<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:43:49)</span> <b>dweitzel:</b></span> @kretzke I didn't get the zoom invite email.<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:44:17)</span> <b>kretzke:</b></span> first didn’t go through, I just sent another<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:44:20)</span> <b>dweitzel:</b></span> k<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:47:12)</span> <b>dweitzel:</b></span> nope, nothing yet.<br/>
<span style="color: #aba727"><span style="font-size: small">(13:47:28)</span> <b>sbhat:</b></span> nothing here either<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:48:35)</span> <b>dweitzel:</b></span> got something!<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:48:45)</span> <b>dweitzel:</b></span> are we doing video?<br/>
<span style="color: #3c8c69"><span style="font-size: small">(13:49:08)</span> <b>kretzke:</b></span> nah. well, I mean if you really want...<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:49:34)</span> <b>dweitzel:</b></span> Eh, I'm just in my office, so nothing special here<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:57:14)</span> <b>dweitzel:</b></span> @sthapa I don't see anything special.<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:59:06)</span> <b>dweitzel:</b></span> Are all the jobs 8 core jobs?<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:59:11)</span> <b>sthapa:</b></span> yes<br/>
<span style="color: #235e5b"><span style="font-size: small">(13:59:29)</span> <b>dweitzel:</b></span> I'm seeing about 50/50 1 core and 8 core.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(13:59:55)</span> <b>sthapa:</b></span> Is that in pilot view or payload view?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:00:02)</span> <b>dweitzel:</b></span> Pilot<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:00:07)</span> <b>dweitzel:</b></span> @dweitzel uploaded a file: <a href="https://opensciencegrid.slack.com/files/dweitzel/F40641LR1/pasted_image_at_2017_02_02_02_00_pm.png">Pasted image at 2017-02-02, 2:00 PM</a><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:00:12)</span> <b>dweitzel:</b></span> But the 1 core jobs only showed up in the last 7 days.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:00:18)</span> <b>dweitzel:</b></span> anything change about a week ago?<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:01:02)</span> <b>sthapa:</b></span> not with the factory, I did update the htcondor-ce rpms<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:01:32)</span> <b>dweitzel:</b></span> @dweitzel uploaded a file: <a href="https://opensciencegrid.slack.com/files/dweitzel/F4085N16E/pasted_image_at_2017_02_02_02_01_pm.png">Pasted image at 2017-02-02, 2:01 PM</a><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:01:34)</span> <b>dweitzel:</b></span> And 8 core jobs.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:01:34)</span> <b>sthapa:</b></span> but looking at the sge output, all the jobs are using 8 cores<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:01:44)</span> <b>dweitzel:</b></span> so, when 8 core jobs stopped, 1 core jobs started.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:02:18)</span> <b>dweitzel:</b></span> so... looks like some hack was wiped with the update.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:02:50)</span> <b>sthapa:</b></span> I did do some hacking since the factory requests 8 cores and I have to change that to 4 core<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:03:05)</span> <b>sthapa:</b></span> let me look at the classads on the htcondor-ce<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:08:51)</span> <b>sthapa:</b></span> The jobs with requestcpus = 8 look like the routed job, the jobs with requestcpu = 1 are the initial job<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:09:21)</span> <b>sthapa:</b></span> Which job does the gratia probe use for reporting?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:10:38)</span> <b>dweitzel:</b></span> the routed job: <a href="https://github.com/opensciencegrid/gratia-probe/blob/master/condor/condor_meter#L754">https://github.com/opensciencegrid/gratia-probe/blob/master/condor/condor_meter#L754</a><br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:18:42)</span> <b>sthapa:</b></span> Hmm, looks like xcount is correct on all the jobs, the request cpus might be off<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:22:55)</span> <b>sthapa:</b></span> All the routed jobs in the current job queue have the correct requestcpus and xcount .  I’ll check tomorrow to see if the reporting looks normal<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:26:58)</span> <b>dweitzel:</b></span> Wasn't there some hack we had to do?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:27:54)</span> <b>dweitzel:</b></span> As far as I can tell, gratia only looks at <tt>MachineAttrCpus0</tt> for # of processors: <a href="https://github.com/opensciencegrid/gratia-probe/blob/master/condor/condor_meter#L714">https://github.com/opensciencegrid/gratia-probe/blob/master/condor/condor_meter#L714</a><br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:28:56)</span> <b>sthapa:</b></span> I have this in the job route<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:29:01)</span> <b>sthapa:</b></span> @sthapa uploaded a file: <a href="https://opensciencegrid.slack.com/files/sthapa/F408MJ30A/-.txt">Untitled</a><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:29:16)</span> <b>dweitzel:</b></span> yeah, that seems right.  But that isn't going to fix gratia.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:29:28)</span> <b>dweitzel:</b></span> That makes the blahp work correctly.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:31:44)</span> <b>sthapa:</b></span> MachineAttrCpus0 doesn’t seem to be set for any job in the queue<br/>
<blockquote>
<span style="color: #235e5b"><span style="font-size: small">(14:35:39)</span> <b>dweitzel:</b></span> sthapa: Starting a thread here.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:35:52)</span> <b>sthapa:</b></span> ok<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:36:24)</span> <b>dweitzel:</b></span> MachineAttrCpus0 wouldn't be set for anything.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:36:31)</span> <b>dweitzel:</b></span> do you remember setting that anywhere?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:36:38)</span> <b>dweitzel:</b></span> or... hacking the gratia probe?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:36:49)</span> <b>dweitzel:</b></span> that's the only way I can think of that Processors was set to 8.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:37:49)</span> <b>sthapa:</b></span> No I don’t think I set that or hacked the gratia probe  That might have happened but I’ve forgotten<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:38:19)</span> <b>sthapa:</b></span> Although if the hack went away wouldn’t all the records have 8 or 1 cpus ?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:38:42)</span> <b>dweitzel:</b></span> Yup, that's exactly what happened.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:38:54)</span> <b>dweitzel:</b></span> given the pictures in the channel from before.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:45:50)</span> <b>sthapa:</b></span> Okay, so how do I fix this?  hack the gratia probe or is there a way I can set the appropriate attributes somewhere?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:47:35)</span> <b>dweitzel:</b></span> Is RequestCpus set correctly in the routed job?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:47:52)</span> <b>dweitzel:</b></span> If so, I would hack the gratia probe to look at RequestCpus if set.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:52:06)</span> <b>sthapa:</b></span> It looks like it is, although xcount is probably better if I’m hacking the probe<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:53:54)</span> <b>dweitzel:</b></span> eh, xcount is less generic.<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:54:08)</span> <b>dweitzel:</b></span> we might be able to contribute RequestCpus upstream.<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:56:11)</span> <b>sthapa:</b></span> Okay<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:56:31)</span> <b>sthapa:</b></span> Hmm, didn’t we open a jira ticket or something similar.  This is sounding familiar<br/>
<span style="color: #5b89d5"><span style="font-size: small">(14:57:14)</span> <b>sthapa:</b></span> Yes, we do: <a href="https://jira.opensciencegrid.org/browse/GRATIA-192">https://jira.opensciencegrid.org/browse/GRATIA-192</a><br/>
<span style="color: #235e5b"><span style="font-size: small">(14:59:29)</span> <b>dweitzel:</b></span> yup, that's it.<br/>
</blockquote>
<span style="color: #43761b"><span style="font-size: small">(14:32:53)</span> <b>blin:</b></span> hey guys two quick questions: is there an ITB GRACC instance? And if so, does it pull its data from the ITB gratia collector?<br/>
<span style="color: #235e5b"><span style="font-size: small">(14:32:56)</span> <b>dweitzel:</b></span> yeah, it wouldn't be.<br/>
<span style="color: #3c8c69"><span style="font-size: small">(14:33:13)</span> <b>kretzke:</b></span> @blin yes to both<br/>
<span style="color: #3c8c69"><span style="font-size: small">(14:34:47)</span> <b>kretzke:</b></span> although the itb instance is co-hosted and shares the same elasticsearch cluster<br/>
<span style="color: #43761b"><span style="font-size: small">(14:36:52)</span> <b>blin:</b></span> @kretzke how do you construct pilot/payload queries against the itb and itb sites?<br/>
<blockquote>
<span style="color: #3c8c69"><span style="font-size: small">(14:44:59)</span> <b>kretzke:</b></span> blin: <a href="https://gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-1h,mode:quick,to:now))&amp;_a=(columns:!(_source),index:'gracc.osg-itb.raw-*',interval:auto,query:(query_string:(analyze_wildcard:!f,query:'*')),sort:!(EndTime,desc))">https://gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-1h,mode:quick,to:now))&amp;_a=(columns:!(_source),index:'gracc.osg-itb.raw-*',interval:auto,query:(query_string:(analyze_wildcard:!f,query:'*')),sort:!(EndTime,desc))</a><br/>
<span style="color: #43761b"><span style="font-size: small">(14:50:06)</span> <b>blin:</b></span> this is perfect, thanks!<br/>
<span style="color: #43761b"><span style="font-size: small">(14:55:43)</span> <b>blin:</b></span> @kretzke do you differentiate between pilots and payloads with <tt>ResourceType</tt>? Does <tt>ResourceType=Batch</tt> mean it's a pilot record?<br/>
<span style="color: #3c8c69"><span style="font-size: small">(14:55:57)</span> <b>kretzke:</b></span> yep, exactly<br/>
<span style="color: #43761b"><span style="font-size: small">(14:58:10)</span> <b>blin:</b></span> huh so there aren't any payloads that run in the ITB<br/>
<span style="color: #3c8c69"><span style="font-size: small">(14:59:37)</span> <b>kretzke:</b></span> itb fifebatch does <a href="https://gracc.opensciencegrid.org/kibana/app/kibana#/doc/gracc.osg-itb.raw-*/gracc.osg-itb.raw3-2017.01/JobUsageRecord?id=083f8860927ac5dbc69f03906605b9f4">https://gracc.opensciencegrid.org/kibana/app/kibana#/doc/gracc.osg-itb.raw-*/gracc.osg-itb.raw3-2017.01/JobUsageRecord?id=083f8860927ac5dbc69f03906605b9f4</a><br/>
<span style="color: #43761b"><span style="font-size: small">(15:01:08)</span> <b>blin:</b></span> ah, didn't realize the default time frame was so short<br/>
<span style="color: #43761b"><span style="font-size: small">(15:01:14)</span> <b>blin:</b></span> awesome, this is so much better than sql queries<br/>
<span style="color: #43761b"><span style="font-size: small">(15:01:15)</span> <b>blin:</b></span> thanks :slightly_smiling_face:<br/>
<span style="color: #3c8c69"><span style="font-size: small">(15:03:27)</span> <b>kretzke:</b></span> np. let me know if you have any more question!<br/>
</blockquote>
<span style="color: #3c8c69"><span style="font-size: small">(14:40:49)</span> <b>kretzke:</b></span> there aren’t any dashboards set up for it at this point. you can do queries against the <tt>gracc.osg-itb.raw-*</tt> indices directly or in kibana. I was working on getting a read-only kibana set up for general use<br/>
</body>
</html>
