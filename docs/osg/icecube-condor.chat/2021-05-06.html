<!DOCTYPE html>
<html>
<head>
<title>Thu May 6, 2021 : #icecube-condor (osg)</title>
</head>
<body>
<h3>Thu May 6, 2021 : #icecube-condor (osg)</h3>
<span style="color: #50a0cf"><span style="font-size: small">(10:40:32)</span> <b>dschultz:</b></span> would any of the condor team know why a condor starter is segfaulting when transferring an input file?  startd is 8.6.1, schedd is 8.9.13<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:40:51)</span> <b>dschultz:</b></span> my best guess is the new AES support isn't backwards compatible that far<br/>
<span style="color: #43761b"><span style="font-size: small">(10:41:32)</span> <b>blin:</b></span> is X.509 involved?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:41:39)</span> <b>dschultz:</b></span> it shouldn't be<br/>
<span style="color: #43761b"><span style="font-size: small">(10:41:54)</span> <b>blin:</b></span> there's a none issue with 8.9.12+ between schedd/starter and AES/X.509<br/>
<span style="color: #43761b"><span style="font-size: small">(10:42:16)</span> <b>blin:</b></span> you can try setting some config back to BLOWFISH on both sides and that may fix it<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:42:18)</span> <b>dschultz:</b></span> here's the stack trace, if that helps pinpoint it:<br/><pre>05/06/21 10:31:49 (pid:41906) FILETRANSFER: Failed to execute /tmp/condorinstall0/libexec/curl_plugin, ignoring<br/>05/06/21 10:31:49 (pid:41906) FILETRANSFER: failed to add plugin "/tmp/condorinstall0/libexec/curl_plugin" because: FILETRANSFER:1:Failed to execute /tmp/condorinstall0/libexec/curl_plugin, ignoring<br/>05/06/21 10:31:49 (pid:41906) my_popenv: Failed to exec in child, errno=2 (No such file or directory)<br/>05/06/21 10:31:49 (pid:41906) FILETRANSFER: Failed to execute /tmp/condorinstall0/libexec/data_plugin, ignoring<br/>05/06/21 10:31:49 (pid:41906) FILETRANSFER: failed to add plugin "/tmp/condorinstall0/libexec/data_plugin" because: FILETRANSFER:1:Failed to execute /tmp/condorinstall0/libexec/data_plugin, ignoring|FILETRANSFER:1:Failed to execute /tmp/condorinstall0/libexec/curl_plugin, ignoring<br/>05/06/21 10:31:49 (pid:41906) File transfer completed successfully.<br/>Stack dump for process 41906 at timestamp 1620315110 (14 frames)<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(dprintf_dump_stack+0x12d)[0x7f2dfcda885d]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(+0x230172)[0x7f2dfcdb0172]<br/>/lib64/libpthread.so.0(+0xf630)[0x7f2dfb401630]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZNK17CondorVersionInfo19built_since_versionEiii+0x11)[0x7f2dfcc89c01]<br/>condor_starter(REMOTE_CONDOR_dprintf_stats+0x3a)[0x428a7a]<br/>condor_starter(_ZN9JICShadow17transferCompletedEP12FileTransfer+0x144)[0x447654]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZN12FileTransfer6ReaperEP7Serviceii+0x1c0)[0x7f2dfccab980]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZN10DaemonCore10CallReaperEiPKcii+0x136)[0x7f2dfce6ce36]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZN10DaemonCore17HandleProcessExitEii+0x2f9)[0x7f2dfce74ee9]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZN10DaemonCore24HandleDC_SERVICEWAITPIDSEi+0x7e)[0x7f2dfce750ee]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZN10DaemonCore6DriverEv+0x82d)[0x7f2dfce792ed]<br/>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_Z7dc_mainiPPc+0x1799)[0x7f2dfce59049]<br/>/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f2dfb046555]<br/>condor_starter[0x41f949]</pre><br/>
<span style="color: #73769d"><span style="font-size: small">(10:44:03)</span> <b>tim.theisen:</b></span> AES is not available on 8.6. So, blowfish would already be in use it encryption is enabled.<br/>
<span style="color: #73769d"><span style="font-size: small">(10:44:50)</span> <b>tim.theisen:</b></span> This is claiming that the curl plugin is missing.<br/>
<span style="color: #73769d"><span style="font-size: small">(10:45:30)</span> <b>tim.theisen:</b></span> This is the problem where RELEASE_DIR defaults to /tmp/condorinstall0<br/>
<span style="color: #73769d"><span style="font-size: small">(10:48:30)</span> <b>tim.theisen:</b></span> RELEASE_DIR should be set to /usr. What does condor_config_val report for RELEASE_DIR on the startd machine?<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:52:18)</span> <b>bbockelm:</b></span> @tim.theisen - I think David is more worried about the segfault causing file transfers to fail versus the plugin failure.<br/>
<span style="color: #73769d"><span style="font-size: small">(10:52:53)</span> <b>tim.theisen:</b></span> You are right.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:52:57)</span> <b>bbockelm:</b></span> <pre>/scratch/dschultz/pyglidein/pyglidein/glidein/glideinExec/lib/libcondor_utils_8_6_1.so(_ZNK17CondorVersionInfo19built_since_versionEiii+0x11)[0x7f2dfcc89c01]</pre><br/>That's the fundamental problem.  It's a bug in 8.6.1 it seems.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:52:58)</span> <b>dschultz:</b></span> yeah.  I fixed the RELEASE_DIR so it finds some of the plugins, though we don't have the curl plugin installed<br/>
<span style="color: #73769d"><span style="font-size: small">(10:53:41)</span> <b>tim.theisen:</b></span> 8.6.1 is real old<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:53:41)</span> <b>dschultz:</b></span> so, you're telling me I need to upgrade then.  was hoping to avoid the obvious solution<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:54:07)</span> <b>bbockelm:</b></span> I suspect that bug is uniquely triggered by a newer schedd.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:00:02)</span> <b>dschultz:</b></span> anyway, thanks for your quick help<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:18:34)</span> <b>dschultz:</b></span> rather than trying to update our own glidein tarball, I tried out using <a href="https://github.com/opensciencegrid/osgvo-docker-pilot">https://github.com/opensciencegrid/osgvo-docker-pilot</a> using singularity.<br/>after a few tweaks to get it to talk to our CM, that works fairly well.  I might have some patches to add in a few features, if that would be of interest<br/>
<span style="color: #43761b"><span style="font-size: small">(17:19:17)</span> <b>blin:</b></span> oh for sure!<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:19:49)</span> <b>dschultz:</b></span> one thing I definitely need to add is a timeout while idle to kill itself<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:21:08)</span> <b>dschultz:</b></span> I also couldn't find this in the osg singularity repo on cvmfs.  if you could make that available, that would be useful<br/>
<span style="color: #43761b"><span style="font-size: small">(17:36:47)</span> <b>blin:</b></span> i'm not opposed to adding an optional timeout but i'm not sure it's all that interesting for our intended use case<br/>
<span style="color: #43761b"><span style="font-size: small">(17:37:46)</span> <b>blin:</b></span> for sites, these would just be running as backfill and some other process should handle preemption if there's other work to be done<br/>
<span style="color: #c386df"><span style="font-size: small">(18:50:07)</span> <b>matyas:</b></span> there sorta is a timeout: condor kills itself after 30 minutes with no work, it's just that supervisord restarts it<br/>
<span style="color: #c386df"><span style="font-size: small">(18:52:26)</span> <b>matyas:</b></span> I dunno if we've ever tried using that image under singularity -- it's meant to be able to run singularity jobs inside it, which is why it needs all those capabilities<br/>
<span style="color: #c386df"><span style="font-size: small">(18:52:51)</span> <b>matyas:</b></span> does singularity-in-singularity work?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(20:38:23)</span> <b>dschultz:</b></span> yes, singularity-in-singularity works, though it requires user namespaces<br/>
<span style="color: #50a0cf"><span style="font-size: small">(20:39:39)</span> <b>dschultz:</b></span> at some point later this year or early next year, I'm going to start requiring that for IceCube sites so I can run containers inside containers<br/>
<span style="color: #50a0cf"><span style="font-size: small">(20:40:10)</span> <b>dschultz:</b></span> (because I can't tell our sites to run docker, but many of them have installed singularity)<br/>
<span style="color: #50a0cf"><span style="font-size: small">(20:42:05)</span> <b>dschultz:</b></span> as to the timeout, I could probably figure out another way to kill idle/unused pilots.  that's been on our list, but we've just used a simple startd check for years now<br/>
<span style="color: #9e3997"><span style="font-size: small">(21:15:13)</span> <b>bbockelm:</b></span> @dschultz - were you able to get IDTOKENS working with your collector?  Or did you sneak in the authentication in some other way?<br/>
</body>
</html>
