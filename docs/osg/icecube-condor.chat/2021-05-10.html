<!DOCTYPE html>
<html>
<head>
<title>Mon May 10, 2021 : #icecube-condor (osg)</title>
</head>
<body>
<h3>Mon May 10, 2021 : #icecube-condor (osg)</h3>
<span style="color: #50a0cf"><span style="font-size: small">(10:20:45)</span> <b>dschultz:</b></span> @bbockelm how/what kind of debugging?  do you mean building condor by hand to enable gdb to print useful things?<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:28:17)</span> <b>bbockelm:</b></span> ah - I was thinking more like:<br/><pre>_condor_TOOL_DEBUG=D_FULLDEBUG,D_SECURITY condor_token_request -debug -pool <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a></pre><br/>That'll be enough to let us know about where it barfs.<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:28:57)</span> <b>bbockelm:</b></span> If you have GDB and the <tt>condor-debuginfo</tt> RPM installed on the host, a traceback is also nice but don't spend too much time on it.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:29:47)</span> <b>dschultz:</b></span> <pre>05/10/21 10:29:25 KEYCACHE: created: 0x564f475622d0<br/>05/10/21 10:29:25 Result of reading /etc/issue:  \S<br/> <br/>05/10/21 10:29:25 Result of reading /etc/redhat-release:  CentOS Stream release 8<br/> <br/>05/10/21 10:29:25 Growing processor array to 64<br/>05/10/21 10:29:25 Using IDs: 48 processors, 24 CPUs, 24 HTs<br/>05/10/21 10:29:25 Reading condor configuration from '/etc/condor/condor_config'<br/>05/10/21 10:29:25 Enumerating interfaces: lo 127.0.0.1 up<br/>05/10/21 10:29:25 Enumerating interfaces: bond0 128.104.8.70 up<br/>05/10/21 10:29:25 Will use TCP to update collector <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a> &lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;<br/>/usr/include/c++/8/bits/stl_vector.h:932: std::vector&lt;_Tp, _Alloc&gt;::reference std::vector&lt;_Tp, _Alloc&gt;::operator[](std::vector&lt;_Tp, _Alloc&gt;::size_type) [with _Tp = char; _Alloc = std::allocator&lt;char&gt;; std::vector&lt;_Tp, _Alloc&gt;::reference = char&amp;; std::vector&lt;_Tp, _Alloc&gt;::size_type = long unsigned int]: Assertion '__builtin_expect(__n &lt; this-&gt;size(), true)' failed.<br/>Aborted (core dumped)</pre><br/><br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:29:51)</span> <b>dschultz:</b></span> not sure that's all that helpful<br/>
<span style="color: #9e3997"><span style="font-size: small">(10:30:27)</span> <b>bbockelm:</b></span> Hm.  Getting closer.  How about <tt>D_ALL:2</tt> ?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(10:33:49)</span> <b>dschultz:</b></span> here's the end of that:<br/><pre>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_ALWAYS:2) Using IDs: 48 processors, 24 CPUs, 24 HTs<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_ALWAYS:2) Reading condor configuration from '/etc/condor/condor_config'<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_ALWAYS:2) Enumerating interfaces: lo 127.0.0.1 up<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_ALWAYS:2) Enumerating interfaces: bond0 128.104.8.70 up<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) NETWORK_INTERFACE=* matches lo 127.0.0.1, bond0 128.104.8.70, choosing IP 128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) DNS returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) We returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) hostname: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a><br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) I am: hostname: sub-2, fully qualified doman name: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a>, IP: 128.104.8.70, IPv4: 128.104.8.70, IPv6: <br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Trying to getting network interface information after reading config<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) NETWORK_INTERFACE=* matches lo 127.0.0.1, bond0 128.104.8.70, choosing IP 128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) NETWORK_INTERFACE=* matches lo 127.0.0.1, bond0 128.104.8.70, choosing IP 128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) DNS returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) We returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) hostname: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a><br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) I am: hostname: sub-2, fully qualified doman name: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a>, IP: 128.104.8.70, IPv4: 128.104.8.70, IPv6: <br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) NETWORK_INTERFACE=* matches lo 127.0.0.1, bond0 128.104.8.70, choosing IP 128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) DNS returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) We returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.70<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) hostname: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a><br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) I am: hostname: sub-2, fully qualified doman name: <a href="http://sub-2.icecube.wisc.edu">sub-2.icecube.wisc.edu</a>, IP: 128.104.8.70, IPv4: 128.104.8.70, IPv6: <br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) CONDOR_FSYNC is undefined, using default value of True<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) STRICT_CLASSAD_EVALUATION is undefined, using default value of False<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) TIMEOUT_MULTIPLIER is undefined, using default value of 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) TOOL_TIMEOUT_MULTIPLIER is undefined, using default value of 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_DAEMONCORE) *** TIMEOUT_MULTIPLIER :: 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Checking if <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a> is a sinful address<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a> is not a sinful address: does not begin with "&lt;"<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) New Daemon obj (collector) name: "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>", pool: "NULL", addr: "NULL"<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Using name "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>" to find daemon<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Port not specified, using default (9618)<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Host info "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>" is a hostname, finding IP address<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) DNS returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.72<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) We returned:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) 	128.104.8.72<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Found CM IP address and port &lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Daemon client (collector) address determined: name: "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>", pool: "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>", alias: "<a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>", addr: "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;"<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_ALWAYS:2) Will use TCP to update collector <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a> &lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) TIMEOUT_MULTIPLIER is undefined, using default value of 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_CONFIG:2) TOOL_TIMEOUT_MULTIPLIER is undefined, using default value of 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_DAEMONCORE) *** TIMEOUT_MULTIPLIER :: 0<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) New Daemon obj (collector) name: "NULL", pool: "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;", addr: "NULL"<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Destroying Daemon object:<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Type: 5 (collector), Name: <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>, Addr: &lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) FullHost: <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>, Host: glidein-cm, Pool: <a href="http://glidein-cm.icecube.wisc.edu">glidein-cm.icecube.wisc.edu</a>, Port: 9618<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) IsLocal: N, IdStr: (null), Error: (null)<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME)  --- End of Daemon object info ---<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Using name "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;" to find daemon<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Port 9618 specified in name<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Daemon client (collector) address determined: name: "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;", pool: "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;", alias: "NULL", addr: "&lt;128.104.8.72:9618?alias=glidein-cm.icecube.wisc.edu&gt;"<br/>05/10/21 10:33:22 (fd:3) (pid:2194335) (D_HOSTNAME) Host info "128.104.8.72" is an IP address<br/>/usr/include/c++/8/bits/stl_vector.h:932: std::vector&lt;_Tp, _Alloc&gt;::reference std::vector&lt;_Tp, _Alloc&gt;::operator[](std::vector&lt;_Tp, _Alloc&gt;::size_type) [with _Tp = char; _Alloc = std::allocator&lt;char&gt;; std::vector&lt;_Tp, _Alloc&gt;::reference = char&amp;; std::vector&lt;_Tp, _Alloc&gt;::size_type = long unsigned int]: Assertion '__builtin_expect(__n &lt; this-&gt;size(), true)' failed.<br/>Aborted</pre><br/>
<span style="color: #902d59"><span style="font-size: small">(10:46:37)</span> <b>zmiller:</b></span> @bbockelm Is this an artifact of the vector::resize() vs vector::reserve() issue?  We just patched a bunch of those recently.<br/>
<span style="color: #9e3997"><span style="font-size: small">(11:25:51)</span> <b>bbockelm:</b></span> @zmiller - maybe.  My understanding is this is a RHEL7 host and those issues were specific to RHEL8.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:29:25)</span> <b>dschultz:</b></span> this is a rhel8 host<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:30:32)</span> <b>dschultz:</b></span> running centos 8 stream, condor version 8.9.13 (will probably be upgraded to 9.0 soon)<br/>
<span style="color: #902d59"><span style="font-size: small">(11:37:51)</span> <b>zmiller:</b></span> FYI, 9.0.1 should be out tomorrow and likely has a fix for this (if this is the issue I am supposing)<br/>
<span style="color: #43761b"><span style="font-size: small">(11:42:31)</span> <b>blin:</b></span> @dschultz do you get condor from the UW or OSG repos?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:47:37)</span> <b>dschultz:</b></span> looks like OSG<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:48:35)</span> <b>dschultz:</b></span> actually, both repos are enabled?<br/>
<span style="color: #43761b"><span style="font-size: small">(11:48:57)</span> <b>blin:</b></span> heh, you probably want to check the yum priorities between the two<br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:49:05)</span> <b>dschultz:</b></span> looks like condor is coming from<br/><pre>[htcondor-development]<br/>name=HTCondor Development RPM Repository for Redhat Enterprise Linux 8<br/>baseurl=<a href="https://research.cs.wisc.edu/htcondor/yum/development/rhel8">https://research.cs.wisc.edu/htcondor/yum/development/rhel8</a><br/>enabled=1<br/>gpgcheck=1<br/>priority=90</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:49:42)</span> <b>blin:</b></span> but if you do an <tt>rpm -q condor</tt>, you should be able to tell which repo it came from: OSG condor will have an <tt>.osg*.</tt><br/>
<span style="color: #50a0cf"><span style="font-size: small">(11:50:04)</span> <b>dschultz:</b></span> <pre># rpm -q condor<br/>condor-8.9.13-1.el8.x86_64</pre><br/>
<span style="color: #43761b"><span style="font-size: small">(11:50:22)</span> <b>blin:</b></span> yup, that looks like it's from the UW repo<br/>
<span style="color: #43761b"><span style="font-size: small">(11:50:45)</span> <b>blin:</b></span> in that case, keep an eye out for 9.0.1 tomorrow!<br/>
<span style="color: #9e3997"><span style="font-size: small">(12:49:29)</span> <b>bbockelm:</b></span> ah, if this is RHEL 8 -- yeah, @dschultz I'm pretty sure this is solved then.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(14:48:23)</span> <b>dschultz:</b></span> if I have another machine running a schedd, what's the best way to set that up so users can run <tt>condor_status</tt> to see the pool?  I can give the root user a token to manage the schedd, and it can run <tt>condor_status</tt> fine.  do I have to give every user a token?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:25:25)</span> <b>bbockelm:</b></span> you know, we were just talking about that!<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:26:25)</span> <b>bbockelm:</b></span> The best way to do that is give the schedd the signing key and let users do a <tt>condor_token_fetch</tt> to auto-generate the token (perhaps with some magic to do that on first login).<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:26:49)</span> <b>bbockelm:</b></span> The alternative is to lower the security a bit and allow insecure reads from the collector.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(16:30:22)</span> <b>dschultz:</b></span> I personally would be fine with tokens on login, but I'm guessing the users wouldn't be happy with that.  so we should probably lower security<br/>
<span style="color: #50a0cf"><span style="font-size: small">(16:31:05)</span> <b>dschultz:</b></span> or I guess the other option is, since we control user's home dirs, we could pre-populate them with valid tokens?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:32:53)</span> <b>bbockelm:</b></span> Yup, you can do that.<br/><br/>FWIW, I really did mean first login.  Why would users even notice?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(16:39:07)</span> <b>dschultz:</b></span> maybe I'm just unfamiliar with how that's supposed to work.  is it basically silent, with no user or admin interaction necessary?<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:46:59)</span> <b>bbockelm:</b></span> yeah.  <tt>condor_token_fetch</tt> (with the right arguments) will authenticate to the schedd to request a token as the logged-in user.<br/>
<span style="color: #50a0cf"><span style="font-size: small">(16:48:11)</span> <b>dschultz:</b></span> ok, will try that out this week. I guess this is a hint that the docs could use a few common examples like this :slightly_smiling_face:<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:48:43)</span> <b>bbockelm:</b></span> :slightly_smiling_face: Hint taken!<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:49:03)</span> <b>bbockelm:</b></span> though it sounds like the solution for 9.0.x would be to re-allow MITM for reads and 9.1.x to automate said solution.<br/>
<span style="color: #9e3997"><span style="font-size: small">(16:53:04)</span> <b>bbockelm:</b></span> erm, something like this might work in <tt>/etc/profile.d/populate_user_token.sh</tt>:<br/><pre>if [ ! -f ~/.condor/tokens.d/99-auto-generated ]; then<br/>    mkdir -p ~/.condor/tokens.d<br/>    condor_token_fetch 2&gt; /dev/null &gt; ~/.condor/tokens.d/.auto_generated &amp;&amp; mv ~/.condor/tokens.d/.auto-generated ~/.condor/tokens.d/99-auto-generated<br/>fi</pre><br/>
<span style="color: #50a0cf"><span style="font-size: small">(16:55:24)</span> <b>dschultz:</b></span> yeah, that might work<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:01:51)</span> <b>dschultz:</b></span> are these tokens restricted at all?  or is the average user supposed to be able to use their token to start a startd?<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:02:01)</span> <b>dschultz:</b></span> (or maybe I need to add a restriction somewhere else)<br/>
<span style="color: #50a0cf"><span style="font-size: small">(17:04:20)</span> <b>dschultz:</b></span> I suppose I shouldn't have<br/><pre>ALLOW_WRITE = *</pre><br/>and should restrict that more<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:01:26)</span> <b>bbockelm:</b></span> A user can always create their own token.  The tricky part happens if the token is good at the schedd and the collector and the collector allows every one authenticated to do things.<br/>
<span style="color: #9e3997"><span style="font-size: small">(19:04:40)</span> <b>bbockelm:</b></span> You can further restrict the default generated one but then the user can just create their own. Better to tweak the server configuration <br/>
</body>
</html>
